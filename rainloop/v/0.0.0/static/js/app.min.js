/*! RainLoop Webmail Main Module (c) RainLoop Team | Licensed under CC BY-NC-SA 3.0 */
!function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){this.sBase="#/",this.sVersion=Sb.settingsGet("Version"),this.sSpecSuffix=Sb.settingsGet("AuthAccountHash")||"0",this.sServer=(Sb.settingsGet("IndexFile")||"./")+"?"}function l(a,c,d,e){var f=this;f.editor=null,f.iBlurTimer=0,f.fOnBlur=c||null,f.fOnReady=d||null,f.fOnModeChange=e||null,f.$element=b(a),f.init()}function m(a,b,d,e,f,g){this.list=a,this.listChecked=c.computed(function(){return h.filter(this.list(),function(a){return a.checked()})},this).extend({rateLimit:0}),this.isListChecked=c.computed(function(){return 0<this.listChecked().length},this),this.focusedItem=c.observable(null),this.selectedItem=b,this.selectedItemUseCallback=!0,this.itemSelectedThrottle=h.debounce(h.bind(this.itemSelected,this),300),this.listChecked.subscribe(function(a){0<a.length?null===this.selectedItem()?this.selectedItem.valueHasMutated():this.selectedItem(null):this.bAutoSelect&&this.focusedItem()&&this.selectedItem(this.focusedItem())},this),this.selectedItem.subscribe(function(a){a?(this.isListChecked()&&h.each(this.listChecked(),function(a){a.checked(!1)}),this.selectedItemUseCallback&&this.itemSelectedThrottle(a)):this.selectedItemUseCallback&&this.itemSelected(null)},this),this.selectedItem.extend({toggleSubscribe:[null,function(a){a&&a.selected(!1)},function(a){a&&a.selected(!0)}]}),this.focusedItem.extend({toggleSubscribe:[null,function(a){a&&a.focused(!1)},function(a){a&&a.focused(!0)}]}),this.oContentVisible=null,this.oContentScrollable=null,this.sItemSelector=d,this.sItemSelectedSelector=e,this.sItemCheckedSelector=f,this.sItemFocusedSelector=g,this.sLastUid="",this.bAutoSelect=!0,this.oCallbacks={},this.emptyFunction=function(){},this.focusedItem.subscribe(function(a){a&&(this.sLastUid=this.getItemUid(a))},this);var i=[],j=[],k=null,l=null;this.list.subscribe(function(a){var b=this;Fb.isArray(a)&&h.each(a,function(a){if(a){var c=b.getItemUid(a);i.push(c),a.checked()&&j.push(c),null===k&&a.focused()&&(k=c),null===l&&a.selected()&&(l=c)}})},this,"beforeChange"),this.list.subscribe(function(a){var b=this,c=null,d=!1,e=[],f=k,g=!1,m=!1,n=0;this.selectedItemUseCallback=!1,this.focusedItem(null),this.selectedItem(null),Fb.isArray(a)&&(n=j.length,h.each(a,function(a){var c=b.getItemUid(a);e.push(c),null!==k&&k===c&&(b.focusedItem(a),k=null),n>0&&-1<Fb.inArray(c,j)&&(g=!0,a.checked(!0),n--),g||null===l||l!==c||(m=!0,b.selectedItem(a),l=null)}),this.selectedItemUseCallback=!0,g||m||!this.bAutoSelect||(b.focusedItem()?b.selectedItem(b.focusedItem()):0<a.length&&(null!==f&&(d=!1,f=h.find(i,function(a){return d&&-1<Fb.inArray(a,e)?a:(f===a&&(d=!0),!1)}),f&&(c=h.find(a,function(a){return f===b.getItemUid(a)}))),b.selectedItem(c||null),b.focusedItem(b.selectedItem())))),i=[],j=[],k=null,l=null},this)}function n(){}function o(){}function p(){var a=[o,n],b=h.find(a,function(a){return a.supported()});b&&(b=b,this.oDriver=new b)}function q(){}function r(a,b){this.bDisabeCloseOnEsc=!1,this.sPosition=Fb.pString(a),this.sTemplate=Fb.pString(b),this.sDefaultKeyScope=Db.KeyState.None,this.sCurrentKeyScope=this.sDefaultKeyScope,this.viewModelName="",this.viewModelVisibility=c.observable(!1),this.modalVisibility=c.observable(!1).extend({rateLimit:0}),this.viewModelDom=null}function s(a,b){this.sScreenName=a,this.aViewModels=Fb.isArray(b)?b:[]}function t(){this.sDefaultScreenName="",this.oScreens={},this.oBoot=null,this.oCurrentScreen=null}function u(a,b){this.email=a||"",this.name=b||"",this.privateType=null,this.clearDuplicateName()}function v(){this.idContact=0,this.display="",this.properties=[],this.tags="",this.readOnly=!1,this.focused=c.observable(!1),this.selected=c.observable(!1),this.checked=c.observable(!1),this.deleted=c.observable(!1)}function w(a,b,d,e,f){this.type=c.observable(Fb.isUnd(a)?Db.ContactPropertyType.Unknown:a),this.typeStr=c.observable(Fb.isUnd(b)?"":b),this.focused=c.observable(Fb.isUnd(e)?!1:!!e),this.value=c.observable(Fb.pString(d)),this.placeholder=c.observable(f||""),this.placeholderValue=c.computed(function(){var a=this.placeholder();return a?Fb.i18n(a):""},this),this.largeValue=c.computed(function(){return Db.ContactPropertyType.Note===this.type()},this)}function x(){this.idContactTag=0,this.name=c.observable(""),this.readOnly=!1}function y(){this.mimeType="",this.fileName="",this.estimatedSize=0,this.friendlySize="",this.isInline=!1,this.isLinked=!1,this.cid="",this.cidWithOutTags="",this.contentLocation="",this.download="",this.folder="",this.uid="",this.mimeIndex=""}function z(a,b,d,e,f,g,h){this.id=a,this.isInline=Fb.isUnd(e)?!1:!!e,this.isLinked=Fb.isUnd(f)?!1:!!f,this.CID=Fb.isUnd(g)?"":g,this.contentLocation=Fb.isUnd(h)?"":h,this.fromMessage=!1,this.fileName=c.observable(b),this.size=c.observable(Fb.isUnd(d)?null:d),this.tempName=c.observable(""),this.progress=c.observable(""),this.error=c.observable(""),this.waiting=c.observable(!0),this.uploading=c.observable(!1),this.enabled=c.observable(!0),this.friendlySize=c.computed(function(){var a=this.size();return null===a?"":Fb.friendlySize(this.size())},this)}function A(){this.folderFullNameRaw="",this.uid="",this.hash="",this.requestHash="",this.subject=c.observable(""),this.size=c.observable(0),this.dateTimeStampInUTC=c.observable(0),this.priority=c.observable(Db.MessagePriority.Normal),this.fromEmailString=c.observable(""),this.toEmailsString=c.observable(""),this.senderEmailsString=c.observable(""),this.emails=[],this.from=[],this.to=[],this.cc=[],this.bcc=[],this.replyTo=[],this.deliveredTo=[],this.newForAnimation=c.observable(!1),this.deleted=c.observable(!1),this.unseen=c.observable(!1),this.flagged=c.observable(!1),this.answered=c.observable(!1),this.forwarded=c.observable(!1),this.isReadReceipt=c.observable(!1),this.focused=c.observable(!1),this.selected=c.observable(!1),this.checked=c.observable(!1),this.hasAttachments=c.observable(!1),this.attachmentsMainType=c.observable(""),this.moment=c.observable(f()),this.attachmentIconClass=c.computed(function(){var a="";if(this.hasAttachments())switch(a="icon-attachment",this.attachmentsMainType()){case"image":a="icon-image";break;case"archive":a="icon-file-zip";break;case"doc":a="icon-file-text"}return a},this),this.fullFormatDateValue=c.computed(function(){return A.calculateFullFromatDateValue(this.dateTimeStampInUTC())},this),this.fullFormatDateValue=c.computed(function(){return A.calculateFullFromatDateValue(this.dateTimeStampInUTC())},this),this.momentDate=Fb.createMomentDate(this),this.momentShortDate=Fb.createMomentShortDate(this),this.dateTimeStampInUTC.subscribe(function(a){var b=f().unix();this.moment(f.unix(a>b?b:a))},this),this.body=null,this.plainRaw="",this.isRtl=c.observable(!1),this.isHtml=c.observable(!1),this.hasImages=c.observable(!1),this.attachments=c.observableArray([]),this.isPgpSigned=c.observable(!1),this.isPgpEncrypted=c.observable(!1),this.pgpSignedVerifyStatus=c.observable(Db.SignedVerifyStatus.None),this.pgpSignedVerifyUser=c.observable(""),this.priority=c.observable(Db.MessagePriority.Normal),this.readReceipt=c.observable(""),this.aDraftInfo=[],this.sMessageId="",this.sInReplyTo="",this.sReferences="",this.parentUid=c.observable(0),this.threads=c.observableArray([]),this.threadsLen=c.observable(0),this.hasUnseenSubMessage=c.observable(!1),this.hasFlaggedSubMessage=c.observable(!1),this.lastInCollapsedThread=c.observable(!1),this.lastInCollapsedThreadLoading=c.observable(!1),this.threadsLenResult=c.computed(function(){var a=this.threadsLen();return 0===this.parentUid()&&a>0?a+1:""},this)}function B(){this.name=c.observable(""),this.fullName="",this.fullNameRaw="",this.fullNameHash="",this.delimiter="",this.namespace="",this.deep=0,this.interval=0,this.selectable=!1,this.existen=!0,this.type=c.observable(Db.FolderType.User),this.focused=c.observable(!1),this.selected=c.observable(!1),this.edited=c.observable(!1),this.collapsed=c.observable(!0),this.subScribed=c.observable(!0),this.subFolders=c.observableArray([]),this.deleteAccess=c.observable(!1),this.actionBlink=c.observable(!1).extend({falseTimeout:1e3}),this.nameForEdit=c.observable(""),this.name.subscribe(function(a){this.nameForEdit(a)},this),this.edited.subscribe(function(a){a&&this.nameForEdit(this.name())},this),this.privateMessageCountAll=c.observable(0),this.privateMessageCountUnread=c.observable(0),this.collapsedPrivate=c.observable(!0)}function C(a,b){this.email=a,this.deleteAccess=c.observable(!1),this.canBeDalete=c.observable(b)}function D(a,b,d){this.id=a,this.email=c.observable(b),this.name=c.observable(""),this.replyTo=c.observable(""),this.bcc=c.observable(""),this.deleteAccess=c.observable(!1),this.canBeDalete=c.observable(d)}function E(){}function F(){this.enabled=c.observable(!0),this.conditions=c.observableArray([]),this.action=c.observable(Db.FiltersAction.None)}function G(a,b,d,e,f,g,h){this.index=a,this.id=d,this.guid=b,this.user=e,this.email=f,this.armor=h,this.isPrivate=!!g,this.deleteAccess=c.observable(!1)}function H(){r.call(this,"Popups","PopupsFolderClear"),this.selectedFolder=c.observable(null),this.clearingProcess=c.observable(!1),this.clearingError=c.observable(""),this.folderFullNameForClear=c.computed(function(){var a=this.selectedFolder();return a?a.printableFullName():""},this),this.folderNameForClear=c.computed(function(){var a=this.selectedFolder();return a?a.localName():""},this),this.dangerDescHtml=c.computed(function(){return Fb.i18n("POPUPS_CLEAR_FOLDER/DANGER_DESC_HTML_1",{FOLDER:this.folderNameForClear()})},this),this.clearCommand=Fb.createCommand(this,function(){var a=this,b=this.selectedFolder();b&&(Sb.data().message(null),Sb.data().messageList([]),this.clearingProcess(!0),Sb.cache().setFolderHash(b.fullNameRaw,""),Sb.remote().folderClear(function(b,c){a.clearingProcess(!1),Db.StorageResultType.Success===b&&c&&c.Result?(Sb.reloadMessageList(!0),a.cancelCommand()):c&&c.ErrorCode?a.clearingError(Fb.getNotification(c.ErrorCode)):a.clearingError(Fb.getNotification(Db.Notification.MailServerError))},b.fullNameRaw))},function(){var a=this.selectedFolder(),b=this.clearingProcess();return!b&&null!==a}),t.constructorEnd(this)}function I(){r.call(this,"Popups","PopupsFolderCreate"),Fb.initOnStartOrLangChange(function(){this.sNoParentText=Fb.i18n("POPUPS_CREATE_FOLDER/SELECT_NO_PARENT")},this),this.folderName=c.observable(""),this.folderName.focused=c.observable(!1),this.selectedParentValue=c.observable(Cb.Values.UnuseOptionValue),this.parentFolderSelectList=c.computed(function(){var a=Sb.data(),b=[],c=null,d=null,e=a.folderList(),f=function(a){return a?a.isSystemFolder()?a.name()+" "+a.manageFolderSystemName():a.name():""};return b.push(["",this.sNoParentText]),""!==a.namespace&&(c=function(b){return a.namespace!==b.fullNameRaw.substr(0,a.namespace.length)}),Sb.folderListOptionsBuilder([],e,[],b,null,c,d,f)},this),this.createFolder=Fb.createCommand(this,function(){var a=Sb.data(),b=this.selectedParentValue();""===b&&1<a.namespace.length&&(b=a.namespace.substr(0,a.namespace.length-1)),a.foldersCreating(!0),Sb.remote().folderCreate(function(a,b){Sb.data().foldersCreating(!1),Db.StorageResultType.Success===a&&b&&b.Result?Sb.folders():Sb.data().foldersListError(b&&b.ErrorCode?Fb.getNotification(b.ErrorCode):Fb.i18n("NOTIFICATIONS/CANT_CREATE_FOLDER"))},this.folderName(),b),this.cancelCommand()},function(){return this.simpleFolderNameValidation(this.folderName())}),this.defautOptionsAfterRender=Fb.defautOptionsAfterRender,t.constructorEnd(this)}function J(){r.call(this,"Popups","PopupsFolderSystem"),Fb.initOnStartOrLangChange(function(){this.sChooseOnText=Fb.i18n("POPUPS_SYSTEM_FOLDERS/SELECT_CHOOSE_ONE"),this.sUnuseText=Fb.i18n("POPUPS_SYSTEM_FOLDERS/SELECT_UNUSE_NAME")},this),this.notification=c.observable(""),this.folderSelectList=c.computed(function(){return Sb.folderListOptionsBuilder([],Sb.data().folderList(),Sb.data().folderListSystemNames(),[["",this.sChooseOnText],[Cb.Values.UnuseOptionValue,this.sUnuseText]])},this);var a=Sb.data(),b=this,d=null,e=null;this.sentFolder=a.sentFolder,this.draftFolder=a.draftFolder,this.spamFolder=a.spamFolder,this.trashFolder=a.trashFolder,this.archiveFolder=a.archiveFolder,d=h.debounce(function(){Sb.settingsSet("SentFolder",b.sentFolder()),Sb.settingsSet("DraftFolder",b.draftFolder()),Sb.settingsSet("SpamFolder",b.spamFolder()),Sb.settingsSet("TrashFolder",b.trashFolder()),Sb.settingsSet("ArchiveFolder",b.archiveFolder()),Sb.remote().saveSystemFolders(Fb.emptyFunction,{SentFolder:b.sentFolder(),DraftFolder:b.draftFolder(),SpamFolder:b.spamFolder(),TrashFolder:b.trashFolder(),ArchiveFolder:b.archiveFolder(),NullFolder:"NullFolder"})},1e3),e=function(){Sb.settingsSet("SentFolder",b.sentFolder()),Sb.settingsSet("DraftFolder",b.draftFolder()),Sb.settingsSet("SpamFolder",b.spamFolder()),Sb.settingsSet("TrashFolder",b.trashFolder()),Sb.settingsSet("ArchiveFolder",b.archiveFolder()),d()},this.sentFolder.subscribe(e),this.draftFolder.subscribe(e),this.spamFolder.subscribe(e),this.trashFolder.subscribe(e),this.archiveFolder.subscribe(e),this.defautOptionsAfterRender=Fb.defautOptionsAfterRender,t.constructorEnd(this)}function K(){r.call(this,"Popups","PopupsCompose"),this.oEditor=null,this.aDraftInfo=null,this.sInReplyTo="",this.bFromDraft=!1,this.bSkipNext=!1,this.sReferences="",this.bCapaAdditionalIdentities=Sb.capa(Db.Capa.AdditionalIdentities);var b=this,d=Sb.data(),e=function(a){!1===b.showCcAndBcc()&&0<a.length&&b.showCcAndBcc(!0)};this.capaOpenPGP=d.capaOpenPGP,this.resizer=c.observable(!1).extend({throttle:50}),this.identitiesDropdownTrigger=c.observable(!1),this.to=c.observable(""),this.to.focusTrigger=c.observable(!1),this.cc=c.observable(""),this.bcc=c.observable(""),this.replyTo=c.observable(""),this.subject=c.observable(""),this.isHtml=c.observable(!1),this.requestReadReceipt=c.observable(!1),this.sendError=c.observable(!1),this.sendSuccessButSaveError=c.observable(!1),this.savedError=c.observable(!1),this.savedTime=c.observable(0),this.savedOrSendingText=c.observable(""),this.emptyToError=c.observable(!1),this.showCcAndBcc=c.observable(!1),this.cc.subscribe(e,this),this.bcc.subscribe(e,this),this.draftFolder=c.observable(""),this.draftUid=c.observable(""),this.sending=c.observable(!1),this.saving=c.observable(!1),this.attachments=c.observableArray([]),this.attachmentsInProcess=this.attachments.filter(function(a){return a&&""===a.tempName()}),this.attachmentsInReady=this.attachments.filter(function(a){return a&&""!==a.tempName()}),this.attachments.subscribe(function(){this.triggerForResize()},this),this.isDraftFolderMessage=c.computed(function(){return""!==this.draftFolder()&&""!==this.draftUid()},this),this.composeUploaderButton=c.observable(null),this.composeUploaderDropPlace=c.observable(null),this.dragAndDropEnabled=c.observable(!1),this.dragAndDropOver=c.observable(!1).extend({throttle:1}),this.dragAndDropVisible=c.observable(!1).extend({throttle:1}),this.attacheMultipleAllowed=c.observable(!1),this.addAttachmentEnabled=c.observable(!1),this.composeEditorArea=c.observable(null),this.identities=Sb.data().identities,this.currentIdentityID=c.observable(""),this.currentIdentityString=c.observable(""),this.currentIdentityResultEmail=c.observable(""),this.identitiesOptions=c.computed(function(){var a=[{optValue:d.accountEmail(),optText:this.formattedFrom(!1)}];return h.each(d.identities(),function(b){a.push({optValue:b.id,optText:b.formattedNameForCompose()})}),a},this),c.computed(function(){var a="",b="",c=null,d=this.identities(),e=this.currentIdentityID();return this.bCapaAdditionalIdentities&&e&&e!==Sb.data().accountEmail()&&(c=h.find(d,function(a){return a&&e===a.id}),a=c?c.formattedNameForCompose():"",b=c?c.formattedNameForEmail():"",""===a&&d[0])?(this.currentIdentityID(d[0].id),""):(""===a&&(a=this.formattedFrom(!1),b=this.formattedFrom(!0)),this.currentIdentityString(a),this.currentIdentityResultEmail(b),a)},this),this.to.subscribe(function(a){this.emptyToError()&&0<a.length&&this.emptyToError(!1)},this),this.editorResizeThrottle=h.throttle(h.bind(this.editorResize,this),100),this.resizer.subscribe(function(){this.editorResizeThrottle()},this),this.canBeSended=c.computed(function(){return!this.sending()&&!this.saving()&&0===this.attachmentsInProcess().length&&0<this.to().length},this),this.canBeSendedOrSaved=c.computed(function(){return!this.sending()&&!this.saving()},this),this.deleteCommand=Fb.createCommand(this,function(){Sb.deleteMessagesFromFolderWithoutCheck(this.draftFolder(),[this.draftUid()]),Lb.hideScreenPopup(K)},function(){return this.isDraftFolderMessage()}),this.sendMessageResponse=h.bind(this.sendMessageResponse,this),this.saveMessageResponse=h.bind(this.saveMessageResponse,this),this.sendCommand=Fb.createCommand(this,function(){var a=Fb.trim(this.to()),b=Sb.data().sentFolder(),c=[];0===a.length?this.emptyToError(!0):(Sb.data().replySameFolder()&&Fb.isArray(this.aDraftInfo)&&3===this.aDraftInfo.length&&Fb.isNormal(this.aDraftInfo[2])&&0<this.aDraftInfo[2].length&&(b=this.aDraftInfo[2]),""===b?Lb.showScreenPopup(J,[Db.SetSystemFoldersNotification.Sent]):(this.sendError(!1),this.sending(!0),Fb.isArray(this.aDraftInfo)&&3===this.aDraftInfo.length&&(c=Sb.cache().getMessageFlagsFromCache(this.aDraftInfo[2],this.aDraftInfo[1]),c&&("forward"===this.aDraftInfo[0]?c[3]=!0:c[2]=!0,Sb.cache().setMessageFlagsToCache(this.aDraftInfo[2],this.aDraftInfo[1],c),Sb.reloadFlagsCurrentMessageListAndMessageFromCache(),Sb.cache().setFolderHash(this.aDraftInfo[2],""))),b=Cb.Values.UnuseOptionValue===b?"":b,Sb.cache().setFolderHash(this.draftFolder(),""),Sb.cache().setFolderHash(b,""),Sb.remote().sendMessage(this.sendMessageResponse,this.draftFolder(),this.draftUid(),b,this.currentIdentityResultEmail(),a,this.cc(),this.bcc(),this.subject(),this.oEditor?this.oEditor.isHtml():!1,this.oEditor?this.oEditor.getData():"",this.prepearAttachmentsForSendOrSave(),this.aDraftInfo,this.sInReplyTo,this.sReferences,this.requestReadReceipt())))},this.canBeSendedOrSaved),this.saveCommand=Fb.createCommand(this,function(){Sb.data().draftFolderNotEnabled()?Lb.showScreenPopup(J,[Db.SetSystemFoldersNotification.Draft]):(this.savedError(!1),this.saving(!0),this.bSkipNext=!0,Sb.cache().setFolderHash(Sb.data().draftFolder(),""),Sb.remote().saveMessage(this.saveMessageResponse,this.draftFolder(),this.draftUid(),Sb.data().draftFolder(),this.currentIdentityResultEmail(),this.to(),this.cc(),this.bcc(),this.subject(),this.oEditor?this.oEditor.isHtml():!1,this.oEditor?this.oEditor.getData():"",this.prepearAttachmentsForSendOrSave(),this.aDraftInfo,this.sInReplyTo,this.sReferences))},this.canBeSendedOrSaved),Sb.sub("interval.1m",function(){!this.modalVisibility()||Sb.data().draftFolderNotEnabled()||this.isEmptyForm(!1)||this.bSkipNext||this.saving()||this.sending()||this.savedError()||(this.bSkipNext=!1,this.saveCommand())},this),this.showCcAndBcc.subscribe(function(){this.triggerForResize()},this),this.dropboxEnabled=c.observable(Sb.settingsGet("DropboxApiKey")?!0:!1),this.dropboxCommand=Fb.createCommand(this,function(){return a.Dropbox&&a.Dropbox.choose({success:function(a){a&&a[0]&&a[0].link&&b.addDropboxAttachment(a[0])},linkType:"direct",multiselect:!1}),!0},function(){return this.dropboxEnabled()}),this.driveEnabled=c.observable(!1),this.driveCommand=Fb.createCommand(this,function(){return!0},function(){return this.driveEnabled()}),this.bDisabeCloseOnEsc=!0,this.sDefaultKeyScope=Db.KeyState.Compose,t.constructorEnd(this)}function L(){r.call(this,"Popups","PopupsContacts");var b=this,d=function(a){a&&0<a.length&&b.viewProperties.removeAll(a)};this.allowContactsSync=Sb.data().allowContactsSync,this.enableContactsSync=Sb.data().enableContactsSync,this.allowExport=!Ib.bMobileDevice,this.search=c.observable(""),this.contactsCount=c.observable(0),this.contacts=Sb.data().contacts,this.contactTags=Sb.data().contactTags,this.currentContact=c.observable(null),this.importUploaderButton=c.observable(null),this.contactsPage=c.observable(1),this.contactsPageCount=c.computed(function(){var a=Math.ceil(this.contactsCount()/Cb.Defaults.ContactsPerPage);return 0>=a?1:a},this),this.contactsPagenator=c.computed(Fb.computedPagenatorHelper(this.contactsPage,this.contactsPageCount)),this.emptySelection=c.observable(!0),this.viewClearSearch=c.observable(!1),this.viewID=c.observable(""),this.viewReadOnly=c.observable(!1),this.viewProperties=c.observableArray([]),this.viewTags=c.observable(""),this.viewTags.visibility=c.observable(!1),this.viewTags.focusTrigger=c.observable(!1),this.viewTags.focusTrigger.subscribe(function(a){a||""!==this.viewTags()?a&&this.viewTags.visibility(!0):this.viewTags.visibility(!1)},this),this.viewSaveTrigger=c.observable(Db.SaveSettingsStep.Idle),this.viewPropertiesNames=this.viewProperties.filter(function(a){return-1<Fb.inArray(a.type(),[Db.ContactPropertyType.FirstName,Db.ContactPropertyType.LastName])}),this.viewPropertiesOther=this.viewProperties.filter(function(a){return-1<Fb.inArray(a.type(),[Db.ContactPropertyType.Note])}),this.viewPropertiesOther=c.computed(function(){var a=h.filter(this.viewProperties(),function(a){return-1<Fb.inArray(a.type(),[Db.ContactPropertyType.Nick])});return h.sortBy(a,function(a){return a.type()})},this),this.viewPropertiesEmails=this.viewProperties.filter(function(a){return Db.ContactPropertyType.Email===a.type()}),this.viewPropertiesWeb=this.viewProperties.filter(function(a){return Db.ContactPropertyType.Web===a.type()}),this.viewHasNonEmptyRequaredProperties=c.computed(function(){var a=this.viewPropertiesNames(),b=this.viewPropertiesEmails(),c=function(a){return""!==Fb.trim(a.value())};return!(!h.find(a,c)&&!h.find(b,c))},this),this.viewPropertiesPhones=this.viewProperties.filter(function(a){return Db.ContactPropertyType.Phone===a.type()}),this.viewPropertiesEmailsNonEmpty=this.viewPropertiesNames.filter(function(a){return""!==Fb.trim(a.value())}),this.viewPropertiesEmailsEmptyAndOnFocused=this.viewPropertiesEmails.filter(function(a){var b=a.focused();return""===Fb.trim(a.value())&&!b}),this.viewPropertiesPhonesEmptyAndOnFocused=this.viewPropertiesPhones.filter(function(a){var b=a.focused();return""===Fb.trim(a.value())&&!b}),this.viewPropertiesWebEmptyAndOnFocused=this.viewPropertiesWeb.filter(function(a){var b=a.focused();return""===Fb.trim(a.value())&&!b}),this.viewPropertiesOtherEmptyAndOnFocused=c.computed(function(){return h.filter(this.viewPropertiesOther(),function(a){var b=a.focused();return""===Fb.trim(a.value())&&!b})},this),this.viewPropertiesEmailsEmptyAndOnFocused.subscribe(function(a){d(a)}),this.viewPropertiesPhonesEmptyAndOnFocused.subscribe(function(a){d(a)}),this.viewPropertiesWebEmptyAndOnFocused.subscribe(function(a){d(a)}),this.viewPropertiesOtherEmptyAndOnFocused.subscribe(function(a){d(a)}),this.viewSaving=c.observable(!1),this.useCheckboxesInList=Sb.data().useCheckboxesInList,this.search.subscribe(function(){this.reloadContactList()},this),this.contacts.subscribe(function(){Fb.windowResize()},this),this.viewProperties.subscribe(function(){Fb.windowResize()},this),this.contactsChecked=c.computed(function(){return h.filter(this.contacts(),function(a){return a.checked()})},this),this.contactsCheckedOrSelected=c.computed(function(){var a=this.contactsChecked(),b=this.currentContact();return h.union(a,b?[b]:[])},this),this.contactsCheckedOrSelectedUids=c.computed(function(){return h.map(this.contactsCheckedOrSelected(),function(a){return a.idContact})},this),this.selector=new m(this.contacts,this.currentContact,".e-contact-item .actionHandle",".e-contact-item.selected",".e-contact-item .checkboxItem",".e-contact-item.focused"),this.selector.on("onItemSelect",h.bind(function(a){this.populateViewContact(a?a:null),a||this.emptySelection(!0)},this)),this.selector.on("onItemGetUid",function(a){return a?a.generateUid():""}),this.newCommand=Fb.createCommand(this,function(){this.populateViewContact(null),this.currentContact(null)}),this.deleteCommand=Fb.createCommand(this,function(){this.deleteSelectedContacts(),this.emptySelection(!0)},function(){return 0<this.contactsCheckedOrSelected().length}),this.newMessageCommand=Fb.createCommand(this,function(){var a=this.contactsCheckedOrSelected(),b=[];Fb.isNonEmptyArray(a)&&(b=h.map(a,function(a){if(a){var b=a.getNameAndEmailHelper(),c=b?new u(b[0],b[1]):null;if(c&&c.validate())return c}return null}),b=h.compact(b)),Fb.isNonEmptyArray(b)&&(Lb.hideScreenPopup(L),Lb.showScreenPopup(K,[Db.ComposeType.Empty,null,b]))},function(){return 0<this.contactsCheckedOrSelected().length}),this.clearCommand=Fb.createCommand(this,function(){this.search("")}),this.saveCommand=Fb.createCommand(this,function(){this.viewSaving(!0),this.viewSaveTrigger(Db.SaveSettingsStep.Animate);var a=Fb.fakeMd5(),c=[];h.each(this.viewProperties(),function(a){a.type()&&""!==Fb.trim(a.value())&&c.push([a.type(),a.value(),a.typeStr()])}),Sb.remote().contactSave(function(c,d){var e=!1;b.viewSaving(!1),Db.StorageResultType.Success===c&&d&&d.Result&&d.Result.RequestUid===a&&0<Fb.pInt(d.Result.ResultID)&&(""===b.viewID()&&b.viewID(Fb.pInt(d.Result.ResultID)),b.reloadContactList(),e=!0),h.delay(function(){b.viewSaveTrigger(e?Db.SaveSettingsStep.TrueResult:Db.SaveSettingsStep.FalseResult)},300),e&&(b.watchDirty(!1),h.delay(function(){b.viewSaveTrigger(Db.SaveSettingsStep.Idle)},1e3))},a,this.viewID(),this.viewTags(),c)},function(){var a=this.viewHasNonEmptyRequaredProperties(),b=this.viewReadOnly();return!this.viewSaving()&&a&&!b}),this.syncCommand=Fb.createCommand(this,function(){var b=this;Sb.contactsSync(function(c,d){Db.StorageResultType.Success===c&&d&&d.Result||a.alert(Fb.getNotification(d&&d.ErrorCode?d.ErrorCode:Db.Notification.ContactsSyncError)),b.reloadContactList(!0)})},function(){return!this.contacts.syncing()&&!this.contacts.importing()}),this.bDropPageAfterDelete=!1,this.watchDirty=c.observable(!1),this.watchHash=c.observable(!1),this.viewHash=c.computed(function(){return""+b.viewTags()+"|"+h.map(b.viewProperties(),function(a){return a.value()}).join("")}),this.viewHash.subscribe(function(){!this.watchHash()||this.viewReadOnly()||this.watchDirty()||this.watchDirty(!0)},this),this.sDefaultKeyScope=Db.KeyState.ContactList,t.constructorEnd(this)}function M(){r.call(this,"Popups","PopupsAdvancedSearch"),this.fromFocus=c.observable(!1),this.from=c.observable(""),this.to=c.observable(""),this.subject=c.observable(""),this.text=c.observable(""),this.selectedDateValue=c.observable(-1),this.hasAttachment=c.observable(!1),this.starred=c.observable(!1),this.unseen=c.observable(!1),this.searchCommand=Fb.createCommand(this,function(){var a=this.buildSearchString();""!==a&&Sb.data().mainMessageListSearch(a),this.cancelCommand()}),t.constructorEnd(this)}function N(){r.call(this,"Popups","PopupsAddAccount"),this.email=c.observable(""),this.login=c.observable(""),this.password=c.observable(""),this.emailError=c.observable(!1),this.loginError=c.observable(!1),this.passwordError=c.observable(!1),this.email.subscribe(function(){this.emailError(!1)},this),this.login.subscribe(function(){this.loginError(!1)},this),this.password.subscribe(function(){this.passwordError(!1)},this),this.allowCustomLogin=Sb.data().allowCustomLogin,this.submitRequest=c.observable(!1),this.submitError=c.observable(""),this.emailFocus=c.observable(!1),this.loginFocus=c.observable(!1),this.addAccountCommand=Fb.createCommand(this,function(){return this.emailError(""===Fb.trim(this.email())),this.passwordError(""===Fb.trim(this.password())),this.emailError()||this.passwordError()?!1:(this.submitRequest(!0),Sb.remote().accountAdd(h.bind(function(a,b){this.submitRequest(!1),Db.StorageResultType.Success===a&&b&&"AccountAdd"===b.Action?b.Result?(Sb.accountsAndIdentities(),this.cancelCommand()):b.ErrorCode&&this.submitError(Fb.getNotification(b.ErrorCode)):this.submitError(Fb.getNotification(Db.Notification.UnknownError))},this),this.email(),this.allowCustomLogin()?this.login():"",this.password()),!0)},function(){return!this.submitRequest()}),this.loginFocus.subscribe(function(a){a&&""===this.login()&&""!==this.email()&&this.login(this.email())},this),t.constructorEnd(this)}function O(){r.call(this,"Popups","PopupsAddOpenPgpKey"),this.key=c.observable(""),this.key.error=c.observable(!1),this.key.focus=c.observable(!1),this.key.subscribe(function(){this.key.error(!1)},this),this.addOpenPgpKeyCommand=Fb.createCommand(this,function(){var a=30,b=null,c=Fb.trim(this.key()),d=/[\-]{3,6}BEGIN PGP (PRIVATE|PUBLIC) KEY BLOCK[\-]{3,6}[\s\S]+[\-]{3,6}END PGP (PRIVATE|PUBLIC) KEY BLOCK[\-]{3,6}/gi,e=Sb.data().openpgpKeyring;if(this.key.error(""===c),!e||this.key.error())return!1;for(;;){if(b=d.exec(c),!b||0>a)break;b[0]&&b[1]&&b[2]&&b[1]===b[2]&&("PRIVATE"===b[1]?e.privateKeys.importKey(b[0]):"PUBLIC"===b[1]&&e.publicKeys.importKey(b[0])),a--}return e.store(),Sb.reloadOpenPgpKeys(),Fb.delegateRun(this,"cancelCommand"),!0}),t.constructorEnd(this)}function P(){r.call(this,"Popups","PopupsViewOpenPgpKey"),this.key=c.observable(""),this.keyDom=c.observable(null),t.constructorEnd(this)}function Q(){r.call(this,"Popups","PopupsGenerateNewOpenPgpKey"),this.email=c.observable(""),this.email.focus=c.observable(""),this.email.error=c.observable(!1),this.name=c.observable(""),this.password=c.observable(""),this.keyBitLength=c.observable(2048),this.submitRequest=c.observable(!1),this.email.subscribe(function(){this.email.error(!1)},this),this.generateOpenPgpKeyCommand=Fb.createCommand(this,function(){var b=this,c="",d=null,e=Sb.data().openpgpKeyring;return this.email.error(""===Fb.trim(this.email())),!e||this.email.error()?!1:(c=this.email(),""!==this.name()&&(c=this.name()+" <"+c+">"),this.submitRequest(!0),h.delay(function(){d=a.openpgp.generateKeyPair(1,Fb.pInt(b.keyBitLength()),c,Fb.trim(b.password())),d&&d.privateKeyArmored&&(e.privateKeys.importKey(d.privateKeyArmored),e.publicKeys.importKey(d.publicKeyArmored),e.store(),Sb.reloadOpenPgpKeys(),Fb.delegateRun(b,"cancelCommand")),b.submitRequest(!1)},100),!0)}),t.constructorEnd(this)}function R(){r.call(this,"Popups","PopupsComposeOpenPgp"),this.notification=c.observable(""),this.sign=c.observable(!0),this.encrypt=c.observable(!0),this.password=c.observable(""),this.password.focus=c.observable(!1),this.buttonFocus=c.observable(!1),this.from=c.observable(""),this.to=c.observableArray([]),this.text=c.observable(""),this.resultCallback=null,this.submitRequest=c.observable(!1),this.doCommand=Fb.createCommand(this,function(){var b=this,c=!0,d=Sb.data(),e=null,f=[];this.submitRequest(!0),c&&this.sign()&&""===this.from()&&(this.notification(Fb.i18n("PGP_NOTIFICATIONS/SPECIFY_FROM_EMAIL")),c=!1),c&&this.sign()&&(e=d.findPrivateKeyByEmail(this.from(),this.password()),e||(this.notification(Fb.i18n("PGP_NOTIFICATIONS/NO_PRIVATE_KEY_FOUND_FOR",{EMAIL:this.from()})),c=!1)),c&&this.encrypt()&&0===this.to().length&&(this.notification(Fb.i18n("PGP_NOTIFICATIONS/SPECIFY_AT_LEAST_ONE_RECIPIENT")),c=!1),c&&this.encrypt()&&(f=[],h.each(this.to(),function(a){var e=d.findPublicKeysByEmail(a);0===e.length&&c&&(b.notification(Fb.i18n("PGP_NOTIFICATIONS/NO_PUBLIC_KEYS_FOUND_FOR",{EMAIL:a})),c=!1),f=f.concat(e)}),!c||0!==f.length&&this.to().length===f.length||(c=!1)),h.delay(function(){if(b.resultCallback&&c)try{e&&0===f.length?b.resultCallback(a.openpgp.signClearMessage([e],b.text())):e&&0<f.length?b.resultCallback(a.openpgp.signAndEncryptMessage(f,e,b.text())):!e&&0<f.length&&b.resultCallback(a.openpgp.encryptMessage(f,b.text()))}catch(d){b.notification(Fb.i18n("PGP_NOTIFICATIONS/PGP_ERROR",{ERROR:""+d})),c=!1}c&&b.cancelCommand(),b.submitRequest(!1)},10)},function(){return!this.submitRequest()&&(this.sign()||this.encrypt())}),this.sDefaultKeyScope=Db.KeyState.PopupComposeOpenPGP,t.constructorEnd(this)}function S(){r.call(this,"Popups","PopupsIdentity"),this.id="",this.edit=c.observable(!1),this.owner=c.observable(!1),this.email=c.observable("").validateEmail(),this.email.focused=c.observable(!1),this.name=c.observable(""),this.name.focused=c.observable(!1),this.replyTo=c.observable("").validateSimpleEmail(),this.replyTo.focused=c.observable(!1),this.bcc=c.observable("").validateSimpleEmail(),this.bcc.focused=c.observable(!1),this.submitRequest=c.observable(!1),this.submitError=c.observable(""),this.addOrEditIdentityCommand=Fb.createCommand(this,function(){return this.email.hasError()||this.email.hasError(""===Fb.trim(this.email())),this.email.hasError()?(this.owner()||this.email.focused(!0),!1):this.replyTo.hasError()?(this.replyTo.focused(!0),!1):this.bcc.hasError()?(this.bcc.focused(!0),!1):(this.submitRequest(!0),Sb.remote().identityUpdate(h.bind(function(a,b){this.submitRequest(!1),Db.StorageResultType.Success===a&&b?b.Result?(Sb.accountsAndIdentities(),this.cancelCommand()):b.ErrorCode&&this.submitError(Fb.getNotification(b.ErrorCode)):this.submitError(Fb.getNotification(Db.Notification.UnknownError))
},this),this.id,this.email(),this.name(),this.replyTo(),this.bcc()),!0)},function(){return!this.submitRequest()}),this.label=c.computed(function(){return Fb.i18n("POPUPS_IDENTITIES/"+(this.edit()?"TITLE_UPDATE_IDENTITY":"TITLE_ADD_IDENTITY"))},this),this.button=c.computed(function(){return Fb.i18n("POPUPS_IDENTITIES/"+(this.edit()?"BUTTON_UPDATE_IDENTITY":"BUTTON_ADD_IDENTITY"))},this),t.constructorEnd(this)}function T(){r.call(this,"Popups","PopupsLanguages"),this.exp=c.observable(!1),this.languages=c.computed(function(){return h.map(Sb.data().languages(),function(a){return{key:a,selected:c.observable(!1),fullName:Fb.convertLangName(a)}})}),Sb.data().mainLanguage.subscribe(function(){this.resetMainLanguage()},this),t.constructorEnd(this)}function U(){r.call(this,"Popups","PopupsTwoFactorTest");var a=this;this.code=c.observable(""),this.code.focused=c.observable(!1),this.code.status=c.observable(null),this.testing=c.observable(!1),this.testCode=Fb.createCommand(this,function(){this.testing(!0),Sb.remote().testTwoFactor(function(b,c){a.testing(!1),a.code.status(Db.StorageResultType.Success===b&&c&&c.Result?!0:!1)},this.code())},function(){return""!==this.code()&&!this.testing()}),t.constructorEnd(this)}function V(){r.call(this,"Popups","PopupsAsk"),this.askDesc=c.observable(""),this.yesButton=c.observable(""),this.noButton=c.observable(""),this.yesFocus=c.observable(!1),this.noFocus=c.observable(!1),this.fYesAction=null,this.fNoAction=null,this.bDisabeCloseOnEsc=!0,this.sDefaultKeyScope=Db.KeyState.PopupAsk,t.constructorEnd(this)}function W(){r.call(this,"Popups","PopupsKeyboardShortcutsHelp"),this.sDefaultKeyScope=Db.KeyState.PopupKeyboardShortcutsHelp,t.constructorEnd(this)}function X(){r.call(this,"Center","Login");var b=Sb.data();this.email=c.observable(""),this.login=c.observable(""),this.password=c.observable(""),this.signMe=c.observable(!1),this.additionalCode=c.observable(""),this.additionalCode.error=c.observable(!1),this.additionalCode.focused=c.observable(!1),this.additionalCode.visibility=c.observable(!1),this.additionalCodeSignMe=c.observable(!1),this.logoImg=Fb.trim(Sb.settingsGet("LoginLogo")),this.loginDescription=Fb.trim(Sb.settingsGet("LoginDescription")),this.logoCss=Fb.trim(Sb.settingsGet("LoginCss")),this.emailError=c.observable(!1),this.loginError=c.observable(!1),this.passwordError=c.observable(!1),this.emailFocus=c.observable(!1),this.loginFocus=c.observable(!1),this.submitFocus=c.observable(!1),this.email.subscribe(function(){this.emailError(!1),this.additionalCode(""),this.additionalCode.visibility(!1)},this),this.login.subscribe(function(){this.loginError(!1)},this),this.password.subscribe(function(){this.passwordError(!1)},this),this.additionalCode.subscribe(function(){this.additionalCode.error(!1)},this),this.additionalCode.visibility.subscribe(function(){this.additionalCode.error(!1)},this),this.submitRequest=c.observable(!1),this.submitError=c.observable(""),this.allowCustomLogin=b.allowCustomLogin,this.allowLanguagesOnLogin=b.allowLanguagesOnLogin,this.langRequest=c.observable(!1),this.mainLanguage=b.mainLanguage,this.bSendLanguage=!1,this.mainLanguageFullName=c.computed(function(){return Fb.convertLangName(this.mainLanguage())},this),this.signMeType=c.observable(Db.LoginSignMeType.Unused),this.signMeType.subscribe(function(a){this.signMe(Db.LoginSignMeType.DefaultOn===a)},this),this.signMeVisibility=c.computed(function(){return Db.LoginSignMeType.Unused!==this.signMeType()},this),this.submitCommand=Fb.createCommand(this,function(){return this.emailError(""===Fb.trim(this.email())),this.passwordError(""===Fb.trim(this.password())),this.additionalCode.visibility()&&this.additionalCode.error(""===Fb.trim(this.additionalCode())),this.emailError()||this.passwordError()||this.additionalCode.error()?!1:(this.submitRequest(!0),Sb.remote().login(h.bind(function(a,b){Db.StorageResultType.Success===a&&b&&"Login"===b.Action?b.Result?b.TwoFactorAuth?(this.additionalCode(""),this.additionalCode.visibility(!0),this.additionalCode.focused(!0),this.submitRequest(!1)):Sb.loginAndLogoutReload():b.ErrorCode?(this.submitRequest(!1),this.submitError(Fb.getNotification(b.ErrorCode)),""===this.submitError()&&this.submitError(Fb.getNotification(Db.Notification.UnknownError))):this.submitRequest(!1):(this.submitRequest(!1),this.submitError(Fb.getNotification(Db.Notification.UnknownError)))},this),this.email(),this.allowCustomLogin()?this.login():"",this.password(),!!this.signMe(),this.bSendLanguage?this.mainLanguage():"",this.additionalCode.visibility()?this.additionalCode():"",this.additionalCode.visibility()?!!this.additionalCodeSignMe():!1),!0)},function(){return!this.submitRequest()}),this.facebookLoginEnabled=c.observable(!1),this.facebookCommand=Fb.createCommand(this,function(){return a.open(Sb.link().socialFacebook(),"Facebook","left=200,top=100,width=650,height=335,menubar=no,status=no,resizable=yes,scrollbars=yes"),!0},function(){return!this.submitRequest()&&this.facebookLoginEnabled()}),this.googleLoginEnabled=c.observable(!1),this.googleCommand=Fb.createCommand(this,function(){return a.open(Sb.link().socialGoogle(),"Google","left=200,top=100,width=650,height=335,menubar=no,status=no,resizable=yes,scrollbars=yes"),!0},function(){return!this.submitRequest()&&this.googleLoginEnabled()}),this.twitterLoginEnabled=c.observable(!1),this.twitterCommand=Fb.createCommand(this,function(){return a.open(Sb.link().socialTwitter(),"Twitter","left=200,top=100,width=650,height=335,menubar=no,status=no,resizable=yes,scrollbars=yes"),!0},function(){return!this.submitRequest()&&this.twitterLoginEnabled()}),this.loginFocus.subscribe(function(a){a&&""===this.login()&&""!==this.email()&&this.login(this.email())},this),this.socialLoginEnabled=c.computed(function(){var a=this.facebookLoginEnabled(),b=this.googleLoginEnabled(),c=this.twitterLoginEnabled();return a||b||c},this),t.constructorEnd(this)}function Y(){r.call(this,"Right","SystemDropDown");var a=Sb.data();this.accounts=a.accounts,this.accountEmail=a.accountEmail,this.accountsLoading=a.accountsLoading,this.accountMenuDropdownTrigger=c.observable(!1),this.capaAdditionalAccounts=Sb.capa(Db.Capa.AdditionalAccounts),this.loading=c.computed(function(){return this.accountsLoading()},this),this.accountClick=h.bind(this.accountClick,this)}function Z(){Y.call(this),t.constructorEnd(this)}function $(){Y.call(this),t.constructorEnd(this)}function _(){r.call(this,"Left","MailFolderList");var a=Sb.data();this.messageList=a.messageList,this.folderList=a.folderList,this.folderListSystem=a.folderListSystem,this.foldersChanging=a.foldersChanging,this.leftPanelDisabled=a.leftPanelDisabled,this.iDropOverTimer=0,this.allowContacts=!!Sb.settingsGet("ContactsIsAllowed"),t.constructorEnd(this)}function ab(){r.call(this,"Right","MailMessageList"),this.sLastUid=null,this.bPrefetch=!1,this.emptySubjectValue="";var a=Sb.data();this.popupVisibility=Sb.popupVisibility,this.message=a.message,this.messageList=a.messageList,this.folderList=a.folderList,this.currentMessage=a.currentMessage,this.isMessageSelected=a.isMessageSelected,this.messageListSearch=a.messageListSearch,this.messageListError=a.messageListError,this.folderMenuForMove=a.folderMenuForMove,this.useCheckboxesInList=a.useCheckboxesInList,this.mainMessageListSearch=a.mainMessageListSearch,this.messageListEndFolder=a.messageListEndFolder,this.messageListChecked=a.messageListChecked,this.messageListCheckedOrSelected=a.messageListCheckedOrSelected,this.messageListCheckedOrSelectedUidsWithSubMails=a.messageListCheckedOrSelectedUidsWithSubMails,this.messageListCompleteLoadingThrottle=a.messageListCompleteLoadingThrottle,Fb.initOnStartOrLangChange(function(){this.emptySubjectValue=Fb.i18n("MESSAGE_LIST/EMPTY_SUBJECT_TEXT")},this),this.userQuota=a.userQuota,this.userUsageSize=a.userUsageSize,this.userUsageProc=a.userUsageProc,this.moveDropdownTrigger=c.observable(!1),this.moreDropdownTrigger=c.observable(!1),this.dragOver=c.observable(!1).extend({throttle:1}),this.dragOverEnter=c.observable(!1).extend({throttle:1}),this.dragOverArea=c.observable(null),this.dragOverBodyArea=c.observable(null),this.messageListItemTemplate=c.computed(function(){return Db.Layout.NoPreview!==a.layout()?"MailMessageListItem":"MailMessageListItemNoPreviewPane"}),this.messageListSearchDesc=c.computed(function(){var b=a.messageListEndSearch();return""===b?"":Fb.i18n("MESSAGE_LIST/SEARCH_RESULT_FOR",{SEARCH:b})}),this.messageListPagenator=c.computed(Fb.computedPagenatorHelper(a.messageListPage,a.messageListPageCount)),this.checkAll=c.computed({read:function(){return 0<Sb.data().messageListChecked().length},write:function(a){a=!!a,h.each(Sb.data().messageList(),function(b){b.checked(a)})}}),this.inputMessageListSearchFocus=c.observable(!1),this.sLastSearchValue="",this.inputProxyMessageListSearch=c.computed({read:this.mainMessageListSearch,write:function(a){this.sLastSearchValue=a},owner:this}),this.isIncompleteChecked=c.computed(function(){var a=Sb.data().messageList().length,b=Sb.data().messageListChecked().length;return a>0&&b>0&&a>b},this),this.hasMessages=c.computed(function(){return 0<this.messageList().length},this),this.hasCheckedOrSelectedLines=c.computed(function(){return 0<this.messageListCheckedOrSelected().length},this),this.isSpamFolder=c.computed(function(){return a.spamFolder()===this.messageListEndFolder()&&""!==a.spamFolder()},this),this.isSpamDisabled=c.computed(function(){return Cb.Values.UnuseOptionValue===a.spamFolder()},this),this.isTrashFolder=c.computed(function(){return a.trashFolder()===this.messageListEndFolder()&&""!==a.trashFolder()},this),this.isDraftFolder=c.computed(function(){return a.draftFolder()===this.messageListEndFolder()&&""!==a.draftFolder()},this),this.isSentFolder=c.computed(function(){return a.sentFolder()===this.messageListEndFolder()&&""!==a.sentFolder()},this),this.isArchiveFolder=c.computed(function(){return a.archiveFolder()===this.messageListEndFolder()&&""!==a.archiveFolder()},this),this.isArchiveDisabled=c.computed(function(){return Cb.Values.UnuseOptionValue===Sb.data().archiveFolder()},this),this.canBeMoved=this.hasCheckedOrSelectedLines,this.clearCommand=Fb.createCommand(this,function(){Lb.showScreenPopup(H,[Sb.data().currentFolder()])}),this.multyForwardCommand=Fb.createCommand(this,function(){Lb.showScreenPopup(K,[Db.ComposeType.ForwardAsAttachment,Sb.data().messageListCheckedOrSelected()])},this.canBeMoved),this.deleteWithoutMoveCommand=Fb.createCommand(this,function(){Sb.deleteMessagesFromFolder(Db.FolderType.Trash,Sb.data().currentFolderFullNameRaw(),Sb.data().messageListCheckedOrSelectedUidsWithSubMails(),!1)},this.canBeMoved),this.deleteCommand=Fb.createCommand(this,function(){Sb.deleteMessagesFromFolder(Db.FolderType.Trash,Sb.data().currentFolderFullNameRaw(),Sb.data().messageListCheckedOrSelectedUidsWithSubMails(),!0)},this.canBeMoved),this.archiveCommand=Fb.createCommand(this,function(){Sb.deleteMessagesFromFolder(Db.FolderType.Archive,Sb.data().currentFolderFullNameRaw(),Sb.data().messageListCheckedOrSelectedUidsWithSubMails(),!0)},this.canBeMoved),this.spamCommand=Fb.createCommand(this,function(){Sb.deleteMessagesFromFolder(Db.FolderType.Spam,Sb.data().currentFolderFullNameRaw(),Sb.data().messageListCheckedOrSelectedUidsWithSubMails(),!0)},this.canBeMoved),this.notSpamCommand=Fb.createCommand(this,function(){Sb.deleteMessagesFromFolder(Db.FolderType.NotSpam,Sb.data().currentFolderFullNameRaw(),Sb.data().messageListCheckedOrSelectedUidsWithSubMails(),!0)},this.canBeMoved),this.moveCommand=Fb.createCommand(this,Fb.emptyFunction,this.canBeMoved),this.reloadCommand=Fb.createCommand(this,function(){Sb.data().messageListCompleteLoadingThrottle()||Sb.reloadMessageList(!1,!0)}),this.quotaTooltip=h.bind(this.quotaTooltip,this),this.selector=new m(this.messageList,this.currentMessage,".messageListItem .actionHandle",".messageListItem.selected",".messageListItem .checkboxMessage",".messageListItem.focused"),this.selector.on("onItemSelect",h.bind(function(b){b?(a.message(a.staticMessageList.populateByMessageListItem(b)),this.populateMessageBody(a.message()),Db.Layout.NoPreview===a.layout()&&(Lb.setHash(Sb.link().messagePreview(),!0),a.message.focused(!0))):a.message(null)},this)),this.selector.on("onItemGetUid",function(a){return a?a.generateUid():""}),a.messageListEndHash.subscribe(function(){this.selector.scrollToTop()},this),a.layout.subscribe(function(a){this.selector.autoSelect(Db.Layout.NoPreview!==a)},this),a.layout.valueHasMutated(),Sb.sub("mailbox.message-list.selector.go-down",function(){this.selector.goDown(!0)},this).sub("mailbox.message-list.selector.go-up",function(){this.selector.goUp(!0)},this),t.constructorEnd(this)}function bb(){r.call(this,"Right","MailMessageView");var a=this,b="",d=Sb.data(),e=function(b){return Fb.createCommand(a,function(){this.replyOrforward(b)},a.canBeRepliedOrForwarded)};this.oMessageScrollerDom=null,this.keyScope=d.keyScope,this.message=d.message,this.currentMessage=d.currentMessage,this.messageListChecked=d.messageListChecked,this.hasCheckedMessages=d.hasCheckedMessages,this.messageListCheckedOrSelectedUidsWithSubMails=d.messageListCheckedOrSelectedUidsWithSubMails,this.messageLoading=d.messageLoading,this.messageLoadingThrottle=d.messageLoadingThrottle,this.messagesBodiesDom=d.messagesBodiesDom,this.useThreads=d.useThreads,this.replySameFolder=d.replySameFolder,this.layout=d.layout,this.usePreviewPane=d.usePreviewPane,this.isMessageSelected=d.isMessageSelected,this.messageActiveDom=d.messageActiveDom,this.messageError=d.messageError,this.fullScreenMode=d.messageFullScreenMode,this.showFullInfo=c.observable(!1),this.moreDropdownTrigger=c.observable(!1),this.messageDomFocused=c.observable(!1).extend({rateLimit:0}),this.messageVisibility=c.computed(function(){return!this.messageLoadingThrottle()&&!!this.message()},this),this.message.subscribe(function(a){a||this.currentMessage(null)},this),this.canBeRepliedOrForwarded=this.messageVisibility,this.closeMessage=Fb.createCommand(this,function(){d.message(null)}),this.replyCommand=e(Db.ComposeType.Reply),this.replyAllCommand=e(Db.ComposeType.ReplyAll),this.forwardCommand=e(Db.ComposeType.Forward),this.forwardAsAttachmentCommand=e(Db.ComposeType.ForwardAsAttachment),this.editAsNewCommand=e(Db.ComposeType.EditAsNew),this.messageVisibilityCommand=Fb.createCommand(this,Fb.emptyFunction,this.messageVisibility),this.messageEditCommand=Fb.createCommand(this,function(){this.editMessage()},this.messageVisibility),this.deleteCommand=Fb.createCommand(this,function(){this.message()&&Sb.deleteMessagesFromFolder(Db.FolderType.Trash,this.message().folderFullNameRaw,[this.message().uid],!0)},this.messageVisibility),this.deleteWithoutMoveCommand=Fb.createCommand(this,function(){this.message()&&Sb.deleteMessagesFromFolder(Db.FolderType.Trash,Sb.data().currentFolderFullNameRaw(),[this.message().uid],!1)},this.messageVisibility),this.archiveCommand=Fb.createCommand(this,function(){this.message()&&Sb.deleteMessagesFromFolder(Db.FolderType.Archive,this.message().folderFullNameRaw,[this.message().uid],!0)},this.messageVisibility),this.spamCommand=Fb.createCommand(this,function(){this.message()&&Sb.deleteMessagesFromFolder(Db.FolderType.Spam,this.message().folderFullNameRaw,[this.message().uid],!0)},this.messageVisibility),this.notSpamCommand=Fb.createCommand(this,function(){this.message()&&Sb.deleteMessagesFromFolder(Db.FolderType.NotSpam,this.message().folderFullNameRaw,[this.message().uid],!0)},this.messageVisibility),this.viewHash="",this.viewSubject=c.observable(""),this.viewFromShort=c.observable(""),this.viewToShort=c.observable(""),this.viewFrom=c.observable(""),this.viewTo=c.observable(""),this.viewCc=c.observable(""),this.viewBcc=c.observable(""),this.viewDate=c.observable(""),this.viewMoment=c.observable(""),this.viewLineAsCcc=c.observable(""),this.viewViewLink=c.observable(""),this.viewDownloadLink=c.observable(""),this.viewUserPic=c.observable(Cb.DataImages.UserDotPic),this.viewUserPicVisible=c.observable(!1),this.viewPgpPassword=c.observable(""),this.viewPgpSignedVerifyStatus=c.computed(function(){return this.message()?this.message().pgpSignedVerifyStatus():Db.SignedVerifyStatus.None},this),this.viewPgpSignedVerifyUser=c.computed(function(){return this.message()?this.message().pgpSignedVerifyUser():""},this),this.message.subscribe(function(c){this.messageActiveDom(null),this.viewPgpPassword(""),c?(this.viewHash!==c.hash&&this.scrollMessageToTop(),this.viewHash=c.hash,this.viewSubject(c.subject()),this.viewFromShort(c.fromToLine(!0,!0)),this.viewToShort(c.toToLine(!0,!0)),this.viewFrom(c.fromToLine(!1)),this.viewTo(c.toToLine(!1)),this.viewCc(c.ccToLine(!1)),this.viewBcc(c.bccToLine(!1)),this.viewDate(c.fullFormatDateValue()),this.viewMoment(c.momentDate()),this.viewLineAsCcc(c.lineAsCcc()),this.viewViewLink(c.viewLink()),this.viewDownloadLink(c.downloadLink()),b=c.fromAsSingleEmail(),Sb.cache().getUserPic(b,function(c,d){c!==a.viewUserPic()&&b===d&&(a.viewUserPicVisible(!1),a.viewUserPic(Cb.DataImages.UserDotPic),""!==c&&(a.viewUserPicVisible(!0),a.viewUserPic(c)))})):(this.viewHash="",this.scrollMessageToTop())},this),this.fullScreenMode.subscribe(function(a){a?Ob.addClass("rl-message-fullscreen"):Ob.removeClass("rl-message-fullscreen"),Fb.windowResize()}),this.messageLoadingThrottle.subscribe(function(a){a&&Fb.windowResize()}),this.goUpCommand=Fb.createCommand(this,function(){Sb.pub("mailbox.message-list.selector.go-up")}),this.goDownCommand=Fb.createCommand(this,function(){Sb.pub("mailbox.message-list.selector.go-down")}),t.constructorEnd(this)}function cb(a){r.call(this,"Left","SettingsMenu"),this.leftPanelDisabled=Sb.data().leftPanelDisabled,this.menu=a.menu,t.constructorEnd(this)}function db(){r.call(this,"Right","SettingsPane"),t.constructorEnd(this)}function eb(){var a=Sb.data();this.mainLanguage=a.mainLanguage,this.mainMessagesPerPage=a.mainMessagesPerPage,this.mainMessagesPerPageArray=Cb.Defaults.MessagesPerPageArray,this.editorDefaultType=a.editorDefaultType,this.showImages=a.showImages,this.interfaceAnimation=a.interfaceAnimation,this.useDesktopNotifications=a.useDesktopNotifications,this.threading=a.threading,this.useThreads=a.useThreads,this.replySameFolder=a.replySameFolder,this.layout=a.layout,this.usePreviewPane=a.usePreviewPane,this.useCheckboxesInList=a.useCheckboxesInList,this.allowLanguagesOnSettings=a.allowLanguagesOnSettings,this.isDesktopNotificationsSupported=c.computed(function(){return Db.DesktopNotifications.NotSupported!==a.desktopNotificationsPermisions()}),this.isDesktopNotificationsDenied=c.computed(function(){return Db.DesktopNotifications.NotSupported===a.desktopNotificationsPermisions()||Db.DesktopNotifications.Denied===a.desktopNotificationsPermisions()}),this.mainLanguageFullName=c.computed(function(){return Fb.convertLangName(this.mainLanguage())},this),this.languageTrigger=c.observable(Db.SaveSettingsStep.Idle).extend({throttle:100}),this.mppTrigger=c.observable(Db.SaveSettingsStep.Idle),this.isAnimationSupported=Ib.bAnimationSupported}function fb(){var a=Sb.data();this.contactsAutosave=a.contactsAutosave,this.allowContactsSync=a.allowContactsSync,this.enableContactsSync=a.enableContactsSync,this.contactsSyncUrl=a.contactsSyncUrl,this.contactsSyncUser=a.contactsSyncUser,this.contactsSyncPass=a.contactsSyncPass,this.saveTrigger=c.computed(function(){return[this.enableContactsSync()?"1":"0",this.contactsSyncUrl(),this.contactsSyncUser(),this.contactsSyncPass()].join("|")},this).extend({throttle:500}),this.saveTrigger.subscribe(function(){Sb.remote().saveContactsSyncData(null,this.enableContactsSync(),this.contactsSyncUrl(),this.contactsSyncUser(),this.contactsSyncPass())},this)}function gb(){var a=Sb.data();this.accounts=a.accounts,this.processText=c.computed(function(){return a.accountsLoading()?Fb.i18n("SETTINGS_ACCOUNTS/LOADING_PROCESS"):""},this),this.visibility=c.computed(function(){return""===this.processText()?"hidden":"visible"},this),this.accountForDeletion=c.observable(null).extend({falseTimeout:3e3}).extend({toggleSubscribe:[this,function(a){a&&a.deleteAccess(!1)},function(a){a&&a.deleteAccess(!0)}]})}function hb(){var a=Sb.data();this.editor=null,this.displayName=a.displayName,this.signature=a.signature,this.signatureToAll=a.signatureToAll,this.replyTo=a.replyTo,this.signatureDom=c.observable(null),this.displayNameTrigger=c.observable(Db.SaveSettingsStep.Idle),this.replyTrigger=c.observable(Db.SaveSettingsStep.Idle),this.signatureTrigger=c.observable(Db.SaveSettingsStep.Idle)}function ib(){var a=Sb.data();this.editor=null,this.displayName=a.displayName,this.signature=a.signature,this.signatureToAll=a.signatureToAll,this.replyTo=a.replyTo,this.signatureDom=c.observable(null),this.displayNameTrigger=c.observable(Db.SaveSettingsStep.Idle),this.replyTrigger=c.observable(Db.SaveSettingsStep.Idle),this.signatureTrigger=c.observable(Db.SaveSettingsStep.Idle),this.identities=a.identities,this.processText=c.computed(function(){return a.identitiesLoading()?Fb.i18n("SETTINGS_IDENTITIES/LOADING_PROCESS"):""},this),this.visibility=c.computed(function(){return""===this.processText()?"hidden":"visible"},this),this.identityForDeletion=c.observable(null).extend({falseTimeout:3e3}).extend({toggleSubscribe:[this,function(a){a&&a.deleteAccess(!1)},function(a){a&&a.deleteAccess(!0)}]})}function jb(){this.filters=c.observableArray([]),this.filters.loading=c.observable(!1)}function kb(){this.processing=c.observable(!1),this.clearing=c.observable(!1),this.secreting=c.observable(!1),this.viewUser=c.observable(""),this.viewEnable=c.observable(!1),this.viewEnable.subs=!0,this.twoFactorStatus=c.observable(!1),this.viewSecret=c.observable(""),this.viewBackupCodes=c.observable(""),this.viewUrl=c.observable(""),this.bFirst=!0,this.viewTwoFactorStatus=c.computed(function(){return Ib.langChangeTrigger(),Fb.i18n(this.twoFactorStatus()?"SETTINGS_SECURITY/TWO_FACTOR_SECRET_CONFIGURED_DESC":"SETTINGS_SECURITY/TWO_FACTOR_SECRET_NOT_CONFIGURED_DESC")},this),this.onResult=h.bind(this.onResult,this),this.onSecretResult=h.bind(this.onSecretResult,this)}function lb(){var a=Sb.data();this.googleEnable=a.googleEnable,this.googleActions=a.googleActions,this.googleLoggined=a.googleLoggined,this.googleUserName=a.googleUserName,this.facebookEnable=a.facebookEnable,this.facebookActions=a.facebookActions,this.facebookLoggined=a.facebookLoggined,this.facebookUserName=a.facebookUserName,this.twitterEnable=a.twitterEnable,this.twitterActions=a.twitterActions,this.twitterLoggined=a.twitterLoggined,this.twitterUserName=a.twitterUserName,this.connectGoogle=Fb.createCommand(this,function(){this.googleLoggined()||Sb.googleConnect()},function(){return!this.googleLoggined()&&!this.googleActions()}),this.disconnectGoogle=Fb.createCommand(this,function(){Sb.googleDisconnect()}),this.connectFacebook=Fb.createCommand(this,function(){this.facebookLoggined()||Sb.facebookConnect()},function(){return!this.facebookLoggined()&&!this.facebookActions()}),this.disconnectFacebook=Fb.createCommand(this,function(){Sb.facebookDisconnect()}),this.connectTwitter=Fb.createCommand(this,function(){this.twitterLoggined()||Sb.twitterConnect()},function(){return!this.twitterLoggined()&&!this.twitterActions()}),this.disconnectTwitter=Fb.createCommand(this,function(){Sb.twitterDisconnect()})}function mb(){this.changeProcess=c.observable(!1),this.errorDescription=c.observable(""),this.passwordMismatch=c.observable(!1),this.passwordUpdateError=c.observable(!1),this.passwordUpdateSuccess=c.observable(!1),this.currentPassword=c.observable(""),this.currentPassword.error=c.observable(!1),this.newPassword=c.observable(""),this.newPassword2=c.observable(""),this.currentPassword.subscribe(function(){this.passwordUpdateError(!1),this.passwordUpdateSuccess(!1),this.currentPassword.error(!1)},this),this.newPassword.subscribe(function(){this.passwordUpdateError(!1),this.passwordUpdateSuccess(!1),this.passwordMismatch(!1)},this),this.newPassword2.subscribe(function(){this.passwordUpdateError(!1),this.passwordUpdateSuccess(!1),this.passwordMismatch(!1)},this),this.saveNewPasswordCommand=Fb.createCommand(this,function(){this.newPassword()!==this.newPassword2()?(this.passwordMismatch(!0),this.errorDescription(Fb.i18n("SETTINGS_CHANGE_PASSWORD/ERROR_PASSWORD_MISMATCH"))):(this.changeProcess(!0),this.passwordUpdateError(!1),this.passwordUpdateSuccess(!1),this.currentPassword.error(!1),this.passwordMismatch(!1),this.errorDescription(""),Sb.remote().changePassword(this.onChangePasswordResponse,this.currentPassword(),this.newPassword()))},function(){return!this.changeProcess()&&""!==this.currentPassword()&&""!==this.newPassword()&&""!==this.newPassword2()}),this.onChangePasswordResponse=h.bind(this.onChangePasswordResponse,this)}function nb(){var a=Sb.data();this.foldersListError=a.foldersListError,this.folderList=a.folderList,this.processText=c.computed(function(){var a=Sb.data(),b=a.foldersLoading(),c=a.foldersCreating(),d=a.foldersDeleting(),e=a.foldersRenaming();return c?Fb.i18n("SETTINGS_FOLDERS/CREATING_PROCESS"):d?Fb.i18n("SETTINGS_FOLDERS/DELETING_PROCESS"):e?Fb.i18n("SETTINGS_FOLDERS/RENAMING_PROCESS"):b?Fb.i18n("SETTINGS_FOLDERS/LOADING_PROCESS"):""},this),this.visibility=c.computed(function(){return""===this.processText()?"hidden":"visible"},this),this.folderForDeletion=c.observable(null).extend({falseTimeout:3e3}).extend({toggleSubscribe:[this,function(a){a&&a.deleteAccess(!1)},function(a){a&&a.deleteAccess(!0)}]}),this.folderForEdit=c.observable(null).extend({toggleSubscribe:[this,function(a){a&&a.edited(!1)},function(a){a&&a.canBeEdited()&&a.edited(!0)}]}),this.useImapSubscribe=!!Sb.settingsGet("UseImapSubscribe")}function ob(){var d=this,e=Sb.data();this.mainTheme=e.mainTheme,this.themesObjects=c.observableArray([]),this.themeTrigger=c.observable(Db.SaveSettingsStep.Idle).extend({throttle:100}),this.oLastAjax=null,this.iTimer=0,Sb.data().theme.subscribe(function(c){h.each(this.themesObjects(),function(a){a.selected(c===a.name)});var e=b("#rlThemeLink"),f=b("#rlThemeStyle"),g=e.attr("href");g||(g=f.attr("data-href")),g&&(g=g.toString().replace(/\/-\/[^\/]+\/\-\//,"/-/"+c+"/-/"),g=g.toString().replace(/\/Css\/[^\/]+\/User\//,"/Css/0/User/"),"Json/"!==g.substring(g.length-5,g.length)&&(g+="Json/"),a.clearTimeout(d.iTimer),d.themeTrigger(Db.SaveSettingsStep.Animate),this.oLastAjax&&this.oLastAjax.abort&&this.oLastAjax.abort(),this.oLastAjax=b.ajax({url:g,dataType:"json"}).done(function(a){a&&Fb.isArray(a)&&2===a.length&&(!e||!e[0]||f&&f[0]||(f=b('<style id="rlThemeStyle"></style>'),e.after(f),e.remove()),f&&f[0]&&(f.attr("data-href",g).attr("data-theme",a[0]),f&&f[0]&&f[0].styleSheet&&!Fb.isUnd(f[0].styleSheet.cssText)?f[0].styleSheet.cssText=a[1]:f.text(a[1])),d.themeTrigger(Db.SaveSettingsStep.TrueResult))}).always(function(){d.iTimer=a.setTimeout(function(){d.themeTrigger(Db.SaveSettingsStep.Idle)},1e3),d.oLastAjax=null})),Sb.remote().saveSettings(null,{Theme:c})},this)}function pb(){this.openpgpkeys=Sb.data().openpgpkeys,this.openpgpkeysPublic=Sb.data().openpgpkeysPublic,this.openpgpkeysPrivate=Sb.data().openpgpkeysPrivate,this.openPgpKeyForDeletion=c.observable(null).extend({falseTimeout:3e3}).extend({toggleSubscribe:[this,function(a){a&&a.deleteAccess(!1)},function(a){a&&a.deleteAccess(!0)}]})}function qb(){this.leftPanelDisabled=c.observable(!1),this.useKeyboardShortcuts=c.observable(!0),this.keyScopeReal=c.observable(Db.KeyState.All),this.keyScopeFake=c.observable(Db.KeyState.All),this.keyScope=c.computed({owner:this,read:function(){return this.keyScopeFake()},write:function(a){Db.KeyState.Menu!==a&&(Db.KeyState.Compose===a?Fb.disableKeyFilter():Fb.restoreKeyFilter(),this.keyScopeFake(a),Ib.dropdownVisibility()&&(a=Db.KeyState.Menu)),this.keyScopeReal(a)}}),this.keyScopeReal.subscribe(function(a){j.setScope(a)}),this.leftPanelDisabled.subscribe(function(a){Sb.pub("left-panel."+(a?"off":"on"))}),Ib.dropdownVisibility.subscribe(function(a){a?(Ib.tooltipTrigger(!Ib.tooltipTrigger()),this.keyScope(Db.KeyState.Menu)):Db.KeyState.Menu===j.getScope()&&this.keyScope(this.keyScopeFake())},this),Fb.initDataConstructorBySettings(this)}function rb(){qb.call(this);var d=function(a){return function(){var b=Sb.cache().getFolderFromCacheList(a());b&&b.type(Db.FolderType.User)}},e=function(a){return function(b){var c=Sb.cache().getFolderFromCacheList(b);c&&c.type(a)}};this.devEmail="",this.devLogin="",this.devPassword="",this.accountEmail=c.observable(""),this.accountIncLogin=c.observable(""),this.accountOutLogin=c.observable(""),this.projectHash=c.observable(""),this.threading=c.observable(!1),this.lastFoldersHash="",this.remoteSuggestions=!1,this.sentFolder=c.observable(""),this.draftFolder=c.observable(""),this.spamFolder=c.observable(""),this.trashFolder=c.observable(""),this.archiveFolder=c.observable(""),this.sentFolder.subscribe(d(this.sentFolder),this,"beforeChange"),this.draftFolder.subscribe(d(this.draftFolder),this,"beforeChange"),this.spamFolder.subscribe(d(this.spamFolder),this,"beforeChange"),this.trashFolder.subscribe(d(this.trashFolder),this,"beforeChange"),this.archiveFolder.subscribe(d(this.archiveFolder),this,"beforeChange"),this.sentFolder.subscribe(e(Db.FolderType.SentItems),this),this.draftFolder.subscribe(e(Db.FolderType.Draft),this),this.spamFolder.subscribe(e(Db.FolderType.Spam),this),this.trashFolder.subscribe(e(Db.FolderType.Trash),this),this.archiveFolder.subscribe(e(Db.FolderType.Archive),this),this.draftFolderNotEnabled=c.computed(function(){return""===this.draftFolder()||Cb.Values.UnuseOptionValue===this.draftFolder()},this),this.displayName=c.observable(""),this.signature=c.observable(""),this.signatureToAll=c.observable(!1),this.replyTo=c.observable(""),this.enableTwoFactor=c.observable(!1),this.accounts=c.observableArray([]),this.accountsLoading=c.observable(!1).extend({throttle:100}),this.identities=c.observableArray([]),this.identitiesLoading=c.observable(!1).extend({throttle:100}),this.contactTags=c.observableArray([]),this.contacts=c.observableArray([]),this.contacts.loading=c.observable(!1).extend({throttle:200}),this.contacts.importing=c.observable(!1).extend({throttle:200}),this.contacts.syncing=c.observable(!1).extend({throttle:200}),this.contacts.exportingVcf=c.observable(!1).extend({throttle:200}),this.contacts.exportingCsv=c.observable(!1).extend({throttle:200}),this.allowContactsSync=c.observable(!1),this.enableContactsSync=c.observable(!1),this.contactsSyncUrl=c.observable(""),this.contactsSyncUser=c.observable(""),this.contactsSyncPass=c.observable(""),this.allowContactsSync=c.observable(!!Sb.settingsGet("ContactsSyncIsAllowed")),this.enableContactsSync=c.observable(!!Sb.settingsGet("EnableContactsSync")),this.contactsSyncUrl=c.observable(Sb.settingsGet("ContactsSyncUrl")),this.contactsSyncUser=c.observable(Sb.settingsGet("ContactsSyncUser")),this.contactsSyncPass=c.observable(Sb.settingsGet("ContactsSyncPassword")),this.namespace="",this.folderList=c.observableArray([]),this.folderList.focused=c.observable(!1),this.foldersListError=c.observable(""),this.foldersLoading=c.observable(!1),this.foldersCreating=c.observable(!1),this.foldersDeleting=c.observable(!1),this.foldersRenaming=c.observable(!1),this.foldersChanging=c.computed(function(){var a=this.foldersLoading(),b=this.foldersCreating(),c=this.foldersDeleting(),d=this.foldersRenaming();return a||b||c||d},this),this.foldersInboxUnreadCount=c.observable(0),this.currentFolder=c.observable(null).extend({toggleSubscribe:[null,function(a){a&&a.selected(!1)},function(a){a&&a.selected(!0)}]}),this.currentFolderFullNameRaw=c.computed(function(){return this.currentFolder()?this.currentFolder().fullNameRaw:""},this),this.currentFolderFullName=c.computed(function(){return this.currentFolder()?this.currentFolder().fullName:""},this),this.currentFolderFullNameHash=c.computed(function(){return this.currentFolder()?this.currentFolder().fullNameHash:""},this),this.currentFolderName=c.computed(function(){return this.currentFolder()?this.currentFolder().name():""},this),this.folderListSystemNames=c.computed(function(){var a=["INBOX"],b=this.folderList(),c=this.sentFolder(),d=this.draftFolder(),e=this.spamFolder(),f=this.trashFolder(),g=this.archiveFolder();
return Fb.isArray(b)&&0<b.length&&(""!==c&&Cb.Values.UnuseOptionValue!==c&&a.push(c),""!==d&&Cb.Values.UnuseOptionValue!==d&&a.push(d),""!==e&&Cb.Values.UnuseOptionValue!==e&&a.push(e),""!==f&&Cb.Values.UnuseOptionValue!==f&&a.push(f),""!==g&&Cb.Values.UnuseOptionValue!==g&&a.push(g)),a},this),this.folderListSystem=c.computed(function(){return h.compact(h.map(this.folderListSystemNames(),function(a){return Sb.cache().getFolderFromCacheList(a)}))},this),this.folderMenuForMove=c.computed(function(){return Sb.folderListOptionsBuilder(this.folderListSystem(),this.folderList(),[this.currentFolderFullNameRaw()],null,null,null,null,function(a){return a?a.localName():""})},this),this.staticMessageList=[],this.messageList=c.observableArray([]).extend({rateLimit:0}),this.messageListCount=c.observable(0),this.messageListSearch=c.observable(""),this.messageListPage=c.observable(1),this.messageListThreadFolder=c.observable(""),this.messageListThreadUids=c.observableArray([]),this.messageListThreadFolder.subscribe(function(){this.messageListThreadUids([])},this),this.messageListEndFolder=c.observable(""),this.messageListEndSearch=c.observable(""),this.messageListEndPage=c.observable(1),this.messageListEndHash=c.computed(function(){return this.messageListEndFolder()+"|"+this.messageListEndSearch()+"|"+this.messageListEndPage()},this),this.messageListPageCount=c.computed(function(){var a=Math.ceil(this.messageListCount()/this.messagesPerPage());return 0>=a?1:a},this),this.mainMessageListSearch=c.computed({read:this.messageListSearch,write:function(a){Lb.setHash(Sb.link().mailBox(this.currentFolderFullNameHash(),1,Fb.trim(a.toString())))},owner:this}),this.messageListError=c.observable(""),this.messageListLoading=c.observable(!1),this.messageListIsNotCompleted=c.observable(!1),this.messageListCompleteLoadingThrottle=c.observable(!1).extend({throttle:200}),this.messageListCompleteLoading=c.computed(function(){var a=this.messageListLoading(),b=this.messageListIsNotCompleted();return a||b},this),this.messageListCompleteLoading.subscribe(function(a){this.messageListCompleteLoadingThrottle(a)},this),this.messageList.subscribe(h.debounce(function(a){h.each(a,function(a){a.newForAnimation()&&a.newForAnimation(!1)})},500)),this.staticMessageList=new A,this.message=c.observable(null),this.messageLoading=c.observable(!1),this.messageLoadingThrottle=c.observable(!1).extend({throttle:50}),this.message.focused=c.observable(!1),this.message.subscribe(function(b){b?Db.Layout.NoPreview===this.layout()&&this.message.focused(!0):(this.message.focused(!1),this.hideMessageBodies(),Db.Layout.NoPreview===Sb.data().layout()&&-1<a.location.hash.indexOf("message-preview")&&Sb.historyBack())},this),this.message.focused.subscribe(function(a){a?(Sb.data().folderList.focused(!1),Sb.data().keyScope(Db.KeyState.MessageView)):Db.KeyState.MessageView===Sb.data().keyScope()&&Sb.data().keyScope(Db.KeyState.MessageList)}),this.folderList.focused.subscribe(function(a){a?Sb.data().keyScope(Db.KeyState.FolderList):Db.KeyState.FolderList===Sb.data().keyScope()&&Sb.data().keyScope(Db.KeyState.MessageList)}),this.messageLoading.subscribe(function(a){this.messageLoadingThrottle(a)},this),this.messageFullScreenMode=c.observable(!1),this.messageError=c.observable(""),this.messagesBodiesDom=c.observable(null),this.messagesBodiesDom.subscribe(function(a){!a||a instanceof jQuery||this.messagesBodiesDom(b(a))},this),this.messageActiveDom=c.observable(null),this.isMessageSelected=c.computed(function(){return null!==this.message()},this),this.currentMessage=c.observable(null),this.messageListChecked=c.computed(function(){return h.filter(this.messageList(),function(a){return a.checked()})},this).extend({rateLimit:0}),this.hasCheckedMessages=c.computed(function(){return 0<this.messageListChecked().length},this).extend({rateLimit:0}),this.messageListCheckedOrSelected=c.computed(function(){var a=this.messageListChecked(),b=this.currentMessage();return h.union(a,b?[b]:[])},this),this.messageListCheckedOrSelectedUidsWithSubMails=c.computed(function(){var a=[];return h.each(this.messageListCheckedOrSelected(),function(b){b&&(a.push(b.uid),0<b.threadsLen()&&0===b.parentUid()&&b.lastInCollapsedThread()&&(a=h.union(a,b.threads())))}),a},this),this.userQuota=c.observable(0),this.userUsageSize=c.observable(0),this.userUsageProc=c.computed(function(){var a=this.userQuota(),b=this.userUsageSize();return a>0?Math.ceil(b/a*100):0},this),this.capaOpenPGP=c.observable(!1),this.openpgpkeys=c.observableArray([]),this.openpgpKeyring=null,this.openpgpkeysPublic=this.openpgpkeys.filter(function(a){return!(!a||a.isPrivate)}),this.openpgpkeysPrivate=this.openpgpkeys.filter(function(a){return!(!a||!a.isPrivate)}),this.googleActions=c.observable(!1),this.googleLoggined=c.observable(!1),this.googleUserName=c.observable(""),this.facebookActions=c.observable(!1),this.facebookLoggined=c.observable(!1),this.facebookUserName=c.observable(""),this.twitterActions=c.observable(!1),this.twitterLoggined=c.observable(!1),this.twitterUserName=c.observable(""),this.customThemeType=c.observable(Db.CustomThemeType.Light),this.purgeMessageBodyCacheThrottle=h.throttle(this.purgeMessageBodyCache,3e4)}function sb(){this.oRequests={}}function tb(){sb.call(this),this.oRequests={}}function ub(){this.oEmailsPicsHashes={},this.oServices={},this.bCapaGravatar=Sb.capa(Db.Capa.Gravatar)}function vb(){ub.call(this),this.oFoldersCache={},this.oFoldersNamesCache={},this.oFolderHashCache={},this.oFolderUidNextCache={},this.oMessageListHashCache={},this.oMessageFlagsCache={},this.oNewMessage={},this.oRequestedMessage={}}function wb(a){s.call(this,"settings",a),this.menu=c.observableArray([]),this.oCurrentSubScreen=null,this.oViewModelPlace=null}function xb(){s.call(this,"login",[X])}function yb(){s.call(this,"mailbox",[Z,_,ab,bb]),this.oLastRoute={}}function zb(){wb.call(this,[$,cb,db]),Fb.initOnStartOrLangChange(function(){this.sSettingsTitle=Fb.i18n("TITLES/SETTINGS")},this,function(){Sb.setTitle(this.sSettingsTitle)})}function Ab(){q.call(this),this.oSettings=null,this.oPlugins=null,this.oLocal=null,this.oLink=null,this.oSubs={},this.isLocalAutocomplete=!0,this.popupVisibilityNames=c.observableArray([]),this.popupVisibility=c.computed(function(){return 0<this.popupVisibilityNames().length},this),this.iframe=b('<iframe style="display:none" src="javascript:;" />').appendTo("body"),Pb.on("error",function(a){Sb&&a&&a.originalEvent&&a.originalEvent.message&&-1===Fb.inArray(a.originalEvent.message,["Script error.","Uncaught Error: Error calling method on NPObject."])&&Sb.remote().jsError(Fb.emptyFunction,a.originalEvent.message,a.originalEvent.filename,a.originalEvent.lineno,location&&location.toString?location.toString():"",Ob.attr("class"),Fb.microtime()-Ib.now)}),Qb.on("keydown",function(a){a&&a.ctrlKey&&Ob.addClass("rl-ctrl-key-pressed")}).on("keyup",function(a){a&&!a.ctrlKey&&Ob.removeClass("rl-ctrl-key-pressed")})}function Bb(){Ab.call(this),this.oData=null,this.oRemote=null,this.oCache=null,this.oMoveCache={},this.quotaDebounce=h.debounce(this.quota,3e4),this.moveOrDeleteResponseHelper=h.bind(this.moveOrDeleteResponseHelper,this),this.messagesMoveTrigger=h.debounce(this.messagesMoveTrigger,500),a.setInterval(function(){Sb.pub("interval.30s")},3e4),a.setInterval(function(){Sb.pub("interval.1m")},6e4),a.setInterval(function(){Sb.pub("interval.2m")},12e4),a.setInterval(function(){Sb.pub("interval.3m")},18e4),a.setInterval(function(){Sb.pub("interval.5m")},3e5),a.setInterval(function(){Sb.pub("interval.10m")},6e5),a.setTimeout(function(){a.setInterval(function(){Sb.pub("interval.10m-after5m")},6e5)},3e5),b.wakeUp(function(){Sb.remote().jsVersion(function(b,c){Db.StorageResultType.Success===b&&c&&!c.Result&&(a.parent&&Sb.settingsGet("InIframe")?a.parent.location.reload():a.location.reload())},Sb.settingsGet("Version"))},{},36e5)}var Cb={},Db={},Eb={},Fb={},Gb={},Hb={},Ib={},Jb={settings:[],"settings-removed":[],"settings-disabled":[]},Kb=[],Lb=null,Mb=a.rainloopAppData||{},Nb=a.rainloopI18N||{},Ob=b("html"),Pb=b(a),Qb=b(a.document),Rb=a.Notification&&a.Notification.requestPermission?a.Notification:null,Sb=null,Tb=b("<div></div>");Ib.now=(new Date).getTime(),Ib.momentTrigger=c.observable(!0),Ib.dropdownVisibility=c.observable(!1).extend({rateLimit:0}),Ib.tooltipTrigger=c.observable(!1).extend({rateLimit:0}),Ib.langChangeTrigger=c.observable(!0),Ib.iAjaxErrorCount=0,Ib.iTokenErrorCount=0,Ib.iMessageBodyCacheCount=0,Ib.bUnload=!1,Ib.sUserAgent=(navigator.userAgent||"").toLowerCase(),Ib.bIsiOSDevice=-1<Ib.sUserAgent.indexOf("iphone")||-1<Ib.sUserAgent.indexOf("ipod")||-1<Ib.sUserAgent.indexOf("ipad"),Ib.bIsAndroidDevice=-1<Ib.sUserAgent.indexOf("android"),Ib.bMobileDevice=Ib.bIsiOSDevice||Ib.bIsAndroidDevice,Ib.bDisableNanoScroll=Ib.bMobileDevice,Ib.bAllowPdfPreview=!Ib.bMobileDevice,Ib.bAnimationSupported=!Ib.bMobileDevice&&Ob.hasClass("csstransitions"),Ib.sAnimationType="",Ib.oHtmlEditorDefaultConfig={title:!1,stylesSet:!1,customConfig:"",contentsCss:"",toolbarGroups:[{name:"spec"},{name:"styles"},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"colors"},{name:"paragraph",groups:["list","indent","blocks","align"]},{name:"links"},{name:"insert"},{name:"others"}],removePlugins:"contextmenu",removeButtons:"Format,Undo,Redo,Cut,Copy,Paste,Anchor,Strike,Subscript,Superscript,Image,SelectAll",removeDialogTabs:"link:advanced;link:target;image:advanced;images:advanced",extraPlugins:"plain",allowedContent:!0,autoParagraph:!1,enterMode:a.CKEDITOR.ENTER_BR,shiftEnterMode:a.CKEDITOR.ENTER_BR,font_defaultLabel:"Arial",fontSize_defaultLabel:"13",fontSize_sizes:"10/10px;12/12px;13/13px;14/14px;16/16px;18/18px;20/20px;24/24px;28/28px;36/36px;48/48px"},Ib.oHtmlEditorLangsMap={de:"de",es:"es",fr:"fr",hu:"hu",is:"is",it:"it",ko:"ko","ko-kr":"ko",lv:"lv",nl:"nl",no:"no",pl:"pl",pt:"pt","pt-pt":"pt","pt-br":"pt-br",ru:"ru",ro:"ro",zh:"zh","zh-cn":"zh-cn"},Ib.bAllowPdfPreview&&navigator&&navigator.mimeTypes&&(Ib.bAllowPdfPreview=!!h.find(navigator.mimeTypes,function(a){return a&&"application/pdf"===a.type})),Cb.Defaults={},Cb.Values={},Cb.DataImages={},Cb.Defaults.MessagesPerPage=20,Cb.Defaults.ContactsPerPage=50,Cb.Defaults.MessagesPerPageArray=[10,20,30,50,100],Cb.Defaults.DefaultAjaxTimeout=3e4,Cb.Defaults.SearchAjaxTimeout=3e5,Cb.Defaults.SendMessageAjaxTimeout=3e5,Cb.Defaults.SaveMessageAjaxTimeout=2e5,Cb.Defaults.ContactsSyncAjaxTimeout=2e5,Cb.Values.UnuseOptionValue="__UNUSE__",Cb.Values.ClientSideCookieIndexName="rlcsc",Cb.Values.ImapDefaulPort=143,Cb.Values.ImapDefaulSecurePort=993,Cb.Values.SmtpDefaulPort=25,Cb.Values.SmtpDefaulSecurePort=465,Cb.Values.MessageBodyCacheLimit=15,Cb.Values.AjaxErrorLimit=7,Cb.Values.TokenErrorLimit=10,Cb.DataImages.UserDotPic="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII=",Cb.DataImages.TranspPic="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",Db.StorageResultType={Success:"success",Abort:"abort",Error:"error",Unload:"unload"},Db.State={Empty:10,Login:20,Auth:30},Db.StateType={Webmail:0,Admin:1},Db.Capa={Prem:"PREM",TwoFactor:"TWO_FACTOR",OpenPGP:"OPEN_PGP",Prefetch:"PREFETCH",Gravatar:"GRAVATAR",Themes:"THEMES",Filters:"FILTERS",AdditionalAccounts:"ADDITIONAL_ACCOUNTS",AdditionalIdentities:"ADDITIONAL_IDENTITIES"},Db.KeyState={All:"all",None:"none",ContactList:"contact-list",MessageList:"message-list",FolderList:"folder-list",MessageView:"message-view",Compose:"compose",Settings:"settings",Menu:"menu",PopupComposeOpenPGP:"compose-open-pgp",PopupKeyboardShortcutsHelp:"popup-keyboard-shortcuts-help",PopupAsk:"popup-ask"},Db.FolderType={Inbox:10,SentItems:11,Draft:12,Trash:13,Spam:14,Archive:15,NotSpam:80,User:99},Db.LoginSignMeTypeAsString={DefaultOff:"defaultoff",DefaultOn:"defaulton",Unused:"unused"},Db.LoginSignMeType={DefaultOff:0,DefaultOn:1,Unused:2},Db.ComposeType={Empty:"empty",Reply:"reply",ReplyAll:"replyall",Forward:"forward",ForwardAsAttachment:"forward-as-attachment",Draft:"draft",EditAsNew:"editasnew"},Db.UploadErrorCode={Normal:0,FileIsTooBig:1,FilePartiallyUploaded:2,FileNoUploaded:3,MissingTempFolder:4,FileOnSaveingError:5,FileType:98,Unknown:99},Db.SetSystemFoldersNotification={None:0,Sent:1,Draft:2,Spam:3,Trash:4,Archive:5},Db.ClientSideKeyName={FoldersLashHash:0,MessagesInboxLastHash:1,MailBoxListSize:2,ExpandedFolders:3,FolderListSize:4},Db.EventKeyCode={Backspace:8,Tab:9,Enter:13,Esc:27,PageUp:33,PageDown:34,Left:37,Right:39,Up:38,Down:40,End:35,Home:36,Space:32,Insert:45,Delete:46,A:65,S:83},Db.MessageSetAction={SetSeen:0,UnsetSeen:1,SetFlag:2,UnsetFlag:3},Db.MessageSelectAction={All:0,None:1,Invert:2,Unseen:3,Seen:4,Flagged:5,Unflagged:6},Db.DesktopNotifications={Allowed:0,NotAllowed:1,Denied:2,NotSupported:9},Db.MessagePriority={Low:5,Normal:3,High:1},Db.EditorDefaultType={Html:"Html",Plain:"Plain"},Db.CustomThemeType={Light:"Light",Dark:"Dark"},Db.ServerSecure={None:0,SSL:1,TLS:2},Db.SearchDateType={All:-1,Days3:3,Days7:7,Month:30},Db.EmailType={Defailt:0,Facebook:1,Google:2},Db.SaveSettingsStep={Animate:-2,Idle:-1,TrueResult:1,FalseResult:0},Db.InterfaceAnimation={None:"None",Normal:"Normal",Full:"Full"},Db.Layout={NoPreview:0,SidePreview:1,BottomPreview:2},Db.FilterConditionField={From:0,To:1,Subject:2},Db.FilterConditionType={contains:0,NotContains:1,EqualTo:2,NotEqualTo:3},Db.FiltersAction={None:0,Move:1,Delete:2},Db.SignedVerifyStatus={UnknownPublicKeys:-4,UnknownPrivateKey:-3,Unverified:-2,Error:-1,None:0,Success:1},Db.ContactPropertyType={Unknown:0,FullName:10,FirstName:15,LastName:16,MiddleName:16,Nick:18,NamePrefix:20,NameSuffix:21,Email:30,Phone:31,Web:32,Birthday:40,Facebook:90,Skype:91,GitHub:92,Note:110,Custom:250},Db.Notification={InvalidToken:101,AuthError:102,AccessError:103,ConnectionError:104,CaptchaError:105,SocialFacebookLoginAccessDisable:106,SocialTwitterLoginAccessDisable:107,SocialGoogleLoginAccessDisable:108,DomainNotAllowed:109,AccountNotAllowed:110,AccountTwoFactorAuthRequired:120,AccountTwoFactorAuthError:121,CouldNotSaveNewPassword:130,CurrentPasswordIncorrect:131,NewPasswordShort:132,NewPasswordWeak:133,NewPasswordForbidden:134,ContactsSyncError:140,CantGetMessageList:201,CantGetMessage:202,CantDeleteMessage:203,CantMoveMessage:204,CantCopyMessage:205,CantSaveMessage:301,CantSendMessage:302,InvalidRecipients:303,CantCreateFolder:400,CantRenameFolder:401,CantDeleteFolder:402,CantSubscribeFolder:403,CantUnsubscribeFolder:404,CantDeleteNonEmptyFolder:405,CantSaveSettings:501,CantSavePluginSettings:502,DomainAlreadyExists:601,CantInstallPackage:701,CantDeletePackage:702,InvalidPluginPackage:703,UnsupportedPluginPackage:704,LicensingServerIsUnavailable:710,LicensingExpired:711,LicensingBanned:712,DemoSendMessageError:750,AccountAlreadyExists:801,MailServerError:901,ClientViewError:902,UnknownNotification:999,UnknownError:999},Fb.trim=b.trim,Fb.inArray=b.inArray,Fb.isArray=h.isArray,Fb.isFunc=h.isFunction,Fb.isUnd=h.isUndefined,Fb.isNull=h.isNull,Fb.emptyFunction=function(){},Fb.isNormal=function(a){return!Fb.isUnd(a)&&!Fb.isNull(a)},Fb.windowResize=h.debounce(function(b){Fb.isUnd(b)?Pb.resize():a.setTimeout(function(){Pb.resize()},b)},50),Fb.isPosNumeric=function(a,b){return Fb.isNormal(a)?(Fb.isUnd(b)?0:!b)?/^[1-9]+[0-9]*$/.test(a.toString()):/^[0-9]*$/.test(a.toString()):!1},Fb.pInt=function(b){return Fb.isNormal(b)&&""!==b?a.parseInt(b,10):0},Fb.pString=function(a){return Fb.isNormal(a)?""+a:""},Fb.isNonEmptyArray=function(a){return Fb.isArray(a)&&0<a.length},Fb.exportPath=function(b,c,d){for(var e=null,f=b.split("."),g=d||a;f.length&&(e=f.shift());)f.length||Fb.isUnd(c)?g=g[e]?g[e]:g[e]={}:g[e]=c},Fb.pImport=function(a,b,c){a[b]=c},Fb.pExport=function(a,b,c){return Fb.isUnd(a[b])?c:a[b]},Fb.encodeHtml=function(a){return Fb.isNormal(a)?a.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""},Fb.splitPlainText=function(a,b){var c="",d="",e=a,f=0,g=0;for(b=Fb.isUnd(b)?100:b;e.length>b;)d=e.substring(0,b),f=d.lastIndexOf(" "),g=d.lastIndexOf("\n"),-1!==g&&(f=g),-1===f&&(f=b),c+=d.substring(0,f)+"\n",e=e.substring(f+1);return c+e},Fb.timeOutAction=function(){var b={};return function(c,d,e){Fb.isUnd(b[c])&&(b[c]=0),a.clearTimeout(b[c]),b[c]=a.setTimeout(d,e)}}(),Fb.timeOutActionSecond=function(){var b={};return function(c,d,e){b[c]||(b[c]=a.setTimeout(function(){d(),b[c]=0},e))}}(),Fb.audio=function(){var b=!1;return function(c,d){if(!1===b)if(Ib.bIsiOSDevice)b=null;else{var e=!1,f=!1,g=a.Audio?new a.Audio:null;g&&g.canPlayType&&g.play?(e=""!==g.canPlayType('audio/mpeg; codecs="mp3"'),e||(f=""!==g.canPlayType('audio/ogg; codecs="vorbis"')),e||f?(b=g,b.preload="none",b.loop=!1,b.autoplay=!1,b.muted=!1,b.src=e?c:d):b=null):b=null}return b}}(),Fb.hos=function(a,b){return a&&Object.hasOwnProperty?Object.hasOwnProperty.call(a,b):!1},Fb.i18n=function(a,b,c){var d="",e=Fb.isUnd(Nb[a])?Fb.isUnd(c)?a:c:Nb[a];if(!Fb.isUnd(b)&&!Fb.isNull(b))for(d in b)Fb.hos(b,d)&&(e=e.replace("%"+d+"%",b[d]));return e},Fb.i18nToNode=function(a){h.defer(function(){b(".i18n",a).each(function(){var a=b(this),c="";c=a.data("i18n-text"),c?a.text(Fb.i18n(c)):(c=a.data("i18n-html"),c&&a.html(Fb.i18n(c)),c=a.data("i18n-placeholder"),c&&a.attr("placeholder",Fb.i18n(c)),c=a.data("i18n-title"),c&&a.attr("title",Fb.i18n(c)))})})},Fb.i18nToDoc=function(){a.rainloopI18N&&(Nb=a.rainloopI18N||{},Fb.i18nToNode(Qb),Ib.langChangeTrigger(!Ib.langChangeTrigger())),a.rainloopI18N={}},Fb.initOnStartOrLangChange=function(a,b,c){a&&a.call(b),c?Ib.langChangeTrigger.subscribe(function(){a&&a.call(b),c.call(b)}):a&&Ib.langChangeTrigger.subscribe(a,b)},Fb.inFocus=function(){return document.activeElement?(Fb.isUnd(document.activeElement.__inFocusCache)&&(document.activeElement.__inFocusCache=b(document.activeElement).is("input,textarea,iframe,.cke_editable")),!!document.activeElement.__inFocusCache):!1},Fb.removeInFocus=function(){if(document&&document.activeElement&&document.activeElement.blur){var a=b(document.activeElement);a.is("input,textarea")&&document.activeElement.blur()}},Fb.removeSelection=function(){if(a&&a.getSelection){var b=a.getSelection();b&&b.removeAllRanges&&b.removeAllRanges()}else document&&document.selection&&document.selection.empty&&document.selection.empty()},Fb.replySubjectAdd=function(b,c,d){var e=null,f=Fb.trim(c);return f=null===(e=new a.RegExp("^"+b+"[\\s]?\\:(.*)$","gi").exec(c))||Fb.isUnd(e[1])?null===(e=new a.RegExp("^("+b+"[\\s]?[\\[\\(]?)([\\d]+)([\\]\\)]?[\\s]?\\:.*)$","gi").exec(c))||Fb.isUnd(e[1])||Fb.isUnd(e[2])||Fb.isUnd(e[3])?b+": "+c:e[1]+(Fb.pInt(e[2])+1)+e[3]:b+"[2]: "+e[1],f=f.replace(/[\s]+/g," "),f=(Fb.isUnd(d)?!0:d)?Fb.fixLongSubject(f):f},Fb.fixLongSubject=function(a){var b=0,c=null;a=Fb.trim(a.replace(/[\s]+/," "));do c=/^Re(\[([\d]+)\]|):[\s]{0,3}Re(\[([\d]+)\]|):/gi.exec(a),(!c||Fb.isUnd(c[0]))&&(c=null),c&&(b=0,b+=Fb.isUnd(c[2])?1:0+Fb.pInt(c[2]),b+=Fb.isUnd(c[4])?1:0+Fb.pInt(c[4]),a=a.replace(/^Re(\[[\d]+\]|):[\s]{0,3}Re(\[[\d]+\]|):/gi,"Re"+(b>0?"["+b+"]":"")+":"));while(c);return a=a.replace(/[\s]+/," ")},Fb.roundNumber=function(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)},Fb.friendlySize=function(a){return a=Fb.pInt(a),a>=1073741824?Fb.roundNumber(a/1073741824,1)+"GB":a>=1048576?Fb.roundNumber(a/1048576,1)+"MB":a>=1024?Fb.roundNumber(a/1024,0)+"KB":a+"B"},Fb.log=function(b){a.console&&a.console.log&&a.console.log(b)},Fb.getNotification=function(a,b){return a=Fb.pInt(a),Db.Notification.ClientViewError===a&&b?b:Fb.isUnd(Eb[a])?"":Eb[a]},Fb.initNotificationLanguage=function(){Eb[Db.Notification.InvalidToken]=Fb.i18n("NOTIFICATIONS/INVALID_TOKEN"),Eb[Db.Notification.AuthError]=Fb.i18n("NOTIFICATIONS/AUTH_ERROR"),Eb[Db.Notification.AccessError]=Fb.i18n("NOTIFICATIONS/ACCESS_ERROR"),Eb[Db.Notification.ConnectionError]=Fb.i18n("NOTIFICATIONS/CONNECTION_ERROR"),Eb[Db.Notification.CaptchaError]=Fb.i18n("NOTIFICATIONS/CAPTCHA_ERROR"),Eb[Db.Notification.SocialFacebookLoginAccessDisable]=Fb.i18n("NOTIFICATIONS/SOCIAL_FACEBOOK_LOGIN_ACCESS_DISABLE"),Eb[Db.Notification.SocialTwitterLoginAccessDisable]=Fb.i18n("NOTIFICATIONS/SOCIAL_TWITTER_LOGIN_ACCESS_DISABLE"),Eb[Db.Notification.SocialGoogleLoginAccessDisable]=Fb.i18n("NOTIFICATIONS/SOCIAL_GOOGLE_LOGIN_ACCESS_DISABLE"),Eb[Db.Notification.DomainNotAllowed]=Fb.i18n("NOTIFICATIONS/DOMAIN_NOT_ALLOWED"),Eb[Db.Notification.AccountNotAllowed]=Fb.i18n("NOTIFICATIONS/ACCOUNT_NOT_ALLOWED"),Eb[Db.Notification.AccountTwoFactorAuthRequired]=Fb.i18n("NOTIFICATIONS/ACCOUNT_TWO_FACTOR_AUTH_REQUIRED"),Eb[Db.Notification.AccountTwoFactorAuthError]=Fb.i18n("NOTIFICATIONS/ACCOUNT_TWO_FACTOR_AUTH_ERROR"),Eb[Db.Notification.CouldNotSaveNewPassword]=Fb.i18n("NOTIFICATIONS/COULD_NOT_SAVE_NEW_PASSWORD"),Eb[Db.Notification.CurrentPasswordIncorrect]=Fb.i18n("NOTIFICATIONS/CURRENT_PASSWORD_INCORRECT"),Eb[Db.Notification.NewPasswordShort]=Fb.i18n("NOTIFICATIONS/NEW_PASSWORD_SHORT"),Eb[Db.Notification.NewPasswordWeak]=Fb.i18n("NOTIFICATIONS/NEW_PASSWORD_WEAK"),Eb[Db.Notification.NewPasswordForbidden]=Fb.i18n("NOTIFICATIONS/NEW_PASSWORD_FORBIDDENT"),Eb[Db.Notification.ContactsSyncError]=Fb.i18n("NOTIFICATIONS/CONTACTS_SYNC_ERROR"),Eb[Db.Notification.CantGetMessageList]=Fb.i18n("NOTIFICATIONS/CANT_GET_MESSAGE_LIST"),Eb[Db.Notification.CantGetMessage]=Fb.i18n("NOTIFICATIONS/CANT_GET_MESSAGE"),Eb[Db.Notification.CantDeleteMessage]=Fb.i18n("NOTIFICATIONS/CANT_DELETE_MESSAGE"),Eb[Db.Notification.CantMoveMessage]=Fb.i18n("NOTIFICATIONS/CANT_MOVE_MESSAGE"),Eb[Db.Notification.CantCopyMessage]=Fb.i18n("NOTIFICATIONS/CANT_MOVE_MESSAGE"),Eb[Db.Notification.CantSaveMessage]=Fb.i18n("NOTIFICATIONS/CANT_SAVE_MESSAGE"),Eb[Db.Notification.CantSendMessage]=Fb.i18n("NOTIFICATIONS/CANT_SEND_MESSAGE"),Eb[Db.Notification.InvalidRecipients]=Fb.i18n("NOTIFICATIONS/INVALID_RECIPIENTS"),Eb[Db.Notification.CantCreateFolder]=Fb.i18n("NOTIFICATIONS/CANT_CREATE_FOLDER"),Eb[Db.Notification.CantRenameFolder]=Fb.i18n("NOTIFICATIONS/CANT_RENAME_FOLDER"),Eb[Db.Notification.CantDeleteFolder]=Fb.i18n("NOTIFICATIONS/CANT_DELETE_FOLDER"),Eb[Db.Notification.CantDeleteNonEmptyFolder]=Fb.i18n("NOTIFICATIONS/CANT_DELETE_NON_EMPTY_FOLDER"),Eb[Db.Notification.CantSubscribeFolder]=Fb.i18n("NOTIFICATIONS/CANT_SUBSCRIBE_FOLDER"),Eb[Db.Notification.CantUnsubscribeFolder]=Fb.i18n("NOTIFICATIONS/CANT_UNSUBSCRIBE_FOLDER"),Eb[Db.Notification.CantSaveSettings]=Fb.i18n("NOTIFICATIONS/CANT_SAVE_SETTINGS"),Eb[Db.Notification.CantSavePluginSettings]=Fb.i18n("NOTIFICATIONS/CANT_SAVE_PLUGIN_SETTINGS"),Eb[Db.Notification.DomainAlreadyExists]=Fb.i18n("NOTIFICATIONS/DOMAIN_ALREADY_EXISTS"),Eb[Db.Notification.CantInstallPackage]=Fb.i18n("NOTIFICATIONS/CANT_INSTALL_PACKAGE"),Eb[Db.Notification.CantDeletePackage]=Fb.i18n("NOTIFICATIONS/CANT_DELETE_PACKAGE"),Eb[Db.Notification.InvalidPluginPackage]=Fb.i18n("NOTIFICATIONS/INVALID_PLUGIN_PACKAGE"),Eb[Db.Notification.UnsupportedPluginPackage]=Fb.i18n("NOTIFICATIONS/UNSUPPORTED_PLUGIN_PACKAGE"),Eb[Db.Notification.LicensingServerIsUnavailable]=Fb.i18n("NOTIFICATIONS/LICENSING_SERVER_IS_UNAVAILABLE"),Eb[Db.Notification.LicensingExpired]=Fb.i18n("NOTIFICATIONS/LICENSING_EXPIRED"),Eb[Db.Notification.LicensingBanned]=Fb.i18n("NOTIFICATIONS/LICENSING_BANNED"),Eb[Db.Notification.DemoSendMessageError]=Fb.i18n("NOTIFICATIONS/DEMO_SEND_MESSAGE_ERROR"),Eb[Db.Notification.AccountAlreadyExists]=Fb.i18n("NOTIFICATIONS/ACCOUNT_ALREADY_EXISTS"),Eb[Db.Notification.MailServerError]=Fb.i18n("NOTIFICATIONS/MAIL_SERVER_ERROR"),Eb[Db.Notification.UnknownNotification]=Fb.i18n("NOTIFICATIONS/UNKNOWN_ERROR"),Eb[Db.Notification.UnknownError]=Fb.i18n("NOTIFICATIONS/UNKNOWN_ERROR")},Fb.getUploadErrorDescByCode=function(a){var b="";switch(Fb.pInt(a)){case Db.UploadErrorCode.FileIsTooBig:b=Fb.i18n("UPLOAD/ERROR_FILE_IS_TOO_BIG");break;case Db.UploadErrorCode.FilePartiallyUploaded:b=Fb.i18n("UPLOAD/ERROR_FILE_PARTIALLY_UPLOADED");break;case Db.UploadErrorCode.FileNoUploaded:b=Fb.i18n("UPLOAD/ERROR_NO_FILE_UPLOADED");break;case Db.UploadErrorCode.MissingTempFolder:b=Fb.i18n("UPLOAD/ERROR_MISSING_TEMP_FOLDER");break;case Db.UploadErrorCode.FileOnSaveingError:b=Fb.i18n("UPLOAD/ERROR_ON_SAVING_FILE");break;case Db.UploadErrorCode.FileType:b=Fb.i18n("UPLOAD/ERROR_FILE_TYPE");break;default:b=Fb.i18n("UPLOAD/ERROR_UNKNOWN")}return b},Fb.delegateRun=function(a,b,c,d){a&&a[b]&&(d=Fb.pInt(d),0>=d?a[b].apply(a,Fb.isArray(c)?c:[]):h.delay(function(){a[b].apply(a,Fb.isArray(c)?c:[])},d))},Fb.killCtrlAandS=function(b){if(b=b||a.event,b&&b.ctrlKey&&!b.shiftKey&&!b.altKey){var c=b.target||b.srcElement,d=b.keyCode||b.which;if(d===Db.EventKeyCode.S)return b.preventDefault(),void 0;if(c&&c.tagName&&c.tagName.match(/INPUT|TEXTAREA/i))return;d===Db.EventKeyCode.A&&(a.getSelection?a.getSelection().removeAllRanges():a.document.selection&&a.document.selection.clear&&a.document.selection.clear(),b.preventDefault())}},Fb.createCommand=function(a,b,d){var e=b?function(){return e.canExecute&&e.canExecute()&&b.apply(a,Array.prototype.slice.call(arguments)),!1}:function(){};return e.enabled=c.observable(!0),d=Fb.isUnd(d)?!0:d,e.canExecute=Fb.isFunc(d)?c.computed(function(){return e.enabled()&&d.call(a)}):c.computed(function(){return e.enabled()&&!!d}),e},Fb.initDataConstructorBySettings=function(b){b.editorDefaultType=c.observable(Db.EditorDefaultType.Html),b.showImages=c.observable(!1),b.interfaceAnimation=c.observable(Db.InterfaceAnimation.Full),b.contactsAutosave=c.observable(!1),Ib.sAnimationType=Db.InterfaceAnimation.Full,b.capaThemes=c.observable(!1),b.allowCustomLogin=c.observable(!1),b.allowLanguagesOnSettings=c.observable(!0),b.allowLanguagesOnLogin=c.observable(!0),b.desktopNotifications=c.observable(!1),b.useThreads=c.observable(!0),b.replySameFolder=c.observable(!0),b.useCheckboxesInList=c.observable(!0),b.layout=c.observable(Db.Layout.SidePreview),b.usePreviewPane=c.computed(function(){return Db.Layout.NoPreview!==b.layout()}),b.interfaceAnimation.subscribe(function(a){if(Ib.bMobileDevice||a===Db.InterfaceAnimation.None)Ob.removeClass("rl-anim rl-anim-full").addClass("no-rl-anim"),Ib.sAnimationType=Db.InterfaceAnimation.None;else switch(a){case Db.InterfaceAnimation.Full:Ob.removeClass("no-rl-anim").addClass("rl-anim rl-anim-full"),Ib.sAnimationType=a;break;case Db.InterfaceAnimation.Normal:Ob.removeClass("no-rl-anim rl-anim-full").addClass("rl-anim"),Ib.sAnimationType=a}}),b.interfaceAnimation.valueHasMutated(),b.desktopNotificationsPermisions=c.computed(function(){b.desktopNotifications();var c=Db.DesktopNotifications.NotSupported;if(Rb&&Rb.permission)switch(Rb.permission.toLowerCase()){case"granted":c=Db.DesktopNotifications.Allowed;break;case"denied":c=Db.DesktopNotifications.Denied;break;case"default":c=Db.DesktopNotifications.NotAllowed}else a.webkitNotifications&&a.webkitNotifications.checkPermission&&(c=a.webkitNotifications.checkPermission());return c}),b.useDesktopNotifications=c.computed({read:function(){return b.desktopNotifications()&&Db.DesktopNotifications.Allowed===b.desktopNotificationsPermisions()},write:function(a){if(a){var c=b.desktopNotificationsPermisions();Db.DesktopNotifications.Allowed===c?b.desktopNotifications(!0):Db.DesktopNotifications.NotAllowed===c?Rb.requestPermission(function(){b.desktopNotifications.valueHasMutated(),Db.DesktopNotifications.Allowed===b.desktopNotificationsPermisions()?b.desktopNotifications()?b.desktopNotifications.valueHasMutated():b.desktopNotifications(!0):b.desktopNotifications()?b.desktopNotifications(!1):b.desktopNotifications.valueHasMutated()}):b.desktopNotifications(!1)}else b.desktopNotifications(!1)}}),b.language=c.observable(""),b.languages=c.observableArray([]),b.mainLanguage=c.computed({read:b.language,write:function(a){a!==b.language()?-1<Fb.inArray(a,b.languages())?b.language(a):0<b.languages().length&&b.language(b.languages()[0]):b.language.valueHasMutated()}}),b.theme=c.observable(""),b.themes=c.observableArray([]),b.mainTheme=c.computed({read:b.theme,write:function(a){if(a!==b.theme()){var c=b.themes();-1<Fb.inArray(a,c)?b.theme(a):0<c.length&&b.theme(c[0])}else b.theme.valueHasMutated()}}),b.capaAdditionalAccounts=c.observable(!1),b.capaAdditionalIdentities=c.observable(!1),b.capaGravatar=c.observable(!1),b.determineUserLanguage=c.observable(!1),b.messagesPerPage=c.observable(Cb.Defaults.MessagesPerPage),b.mainMessagesPerPage=b.messagesPerPage,b.mainMessagesPerPage=c.computed({read:b.messagesPerPage,write:function(a){-1<Fb.inArray(Fb.pInt(a),Cb.Defaults.MessagesPerPageArray)?a!==b.messagesPerPage()&&b.messagesPerPage(a):b.messagesPerPage.valueHasMutated()}}),b.facebookEnable=c.observable(!1),b.facebookAppID=c.observable(""),b.facebookAppSecret=c.observable(""),b.twitterEnable=c.observable(!1),b.twitterConsumerKey=c.observable(""),b.twitterConsumerSecret=c.observable(""),b.googleEnable=c.observable(!1),b.googleClientID=c.observable(""),b.googleClientSecret=c.observable(""),b.dropboxEnable=c.observable(!1),b.dropboxApiKey=c.observable(""),b.contactsIsAllowed=c.observable(!1)},Fb.createMomentDate=function(a){return Fb.isUnd(a.moment)&&(a.moment=c.observable(f())),c.computed(function(){return Ib.momentTrigger(),this.moment().fromNow()},a)},Fb.createMomentShortDate=function(a){return c.computed(function(){var a="",b=f(),c=this.moment(),d=this.momentDate();return a=4>=b.diff(c,"hours")?d:b.format("L")===c.format("L")?Fb.i18n("MESSAGE_LIST/TODAY_AT",{TIME:c.format("LT")}):b.clone().subtract("days",1).format("L")===c.format("L")?Fb.i18n("MESSAGE_LIST/YESTERDAY_AT",{TIME:c.format("LT")}):b.year()===c.year()?c.format("D MMM."):c.format("LL")},a)},Fb.isFolderExpanded=function(a){var b=Sb.local().get(Db.ClientSideKeyName.ExpandedFolders);return h.isArray(b)&&-1!==h.indexOf(b,a)},Fb.setExpandedFolder=function(a,b){var c=Sb.local().get(Db.ClientSideKeyName.ExpandedFolders);h.isArray(c)||(c=[]),b?(c.push(a),c=h.uniq(c)):c=h.without(c,a),Sb.local().set(Db.ClientSideKeyName.ExpandedFolders,c)},Fb.initLayoutResizer=function(a,c,d){var e=60,f=155,g=b(a),h=b(c),i=Sb.local().get(d)||null,j=function(a){a&&(g.css({width:""+a+"px"}),h.css({left:""+a+"px"}))},k=function(a){if(a)g.resizable("disable"),j(e);else{g.resizable("enable");var b=Fb.pInt(Sb.local().get(d))||f;j(b>f?b:f)}},l=function(a,b){b&&b.size&&b.size.width&&(Sb.local().set(d,b.size.width),h.css({left:""+b.size.width+"px"}))};null!==i&&j(i>f?i:f),g.resizable({helper:"ui-resizable-helper",minWidth:f,maxWidth:350,handles:"e",stop:l}),Sb.sub("left-panel.off",function(){k(!0)}),Sb.sub("left-panel.on",function(){k(!1)})},Fb.initBlockquoteSwitcher=function(a){if(a){var c=b("blockquote:not(.rl-bq-switcher)",a).filter(function(){return 0===b(this).parent().closest("blockquote",a).length});c&&0<c.length&&c.each(function(){var a=b(this),c=a.height();(0===c||c>100)&&(a.addClass("rl-bq-switcher hidden-bq"),b('<span class="rlBlockquoteSwitcher"><i class="icon-ellipsis" /></span>').insertBefore(a).click(function(){a.toggleClass("hidden-bq"),Fb.windowResize()}).after("<br />").before("<br />"))})}},Fb.removeBlockquoteSwitcher=function(a){a&&(b(a).find("blockquote.rl-bq-switcher").each(function(){b(this).removeClass("rl-bq-switcher hidden-bq")}),b(a).find(".rlBlockquoteSwitcher").each(function(){b(this).remove()}))},Fb.toggleMessageBlockquote=function(a){a&&a.find(".rlBlockquoteSwitcher").click()},Fb.extendAsViewModel=function(a,b,c){b&&(c||(c=r),b.__name=a,Gb.regViewModelHook(a,b),h.extend(b.prototype,c.prototype))},Fb.addSettingsViewModel=function(a,b,c,d,e){a.__rlSettingsData={Label:c,Template:b,Route:d,IsDefault:!!e},Jb.settings.push(a)},Fb.removeSettingsViewModel=function(a){Jb["settings-removed"].push(a)},Fb.disableSettingsViewModel=function(a){Jb["settings-disabled"].push(a)},Fb.convertThemeName=function(a){return"@custom"===a.substr(-7)&&(a=Fb.trim(a.substring(0,a.length-7))),Fb.trim(a.replace(/[^a-zA-Z]+/g," ").replace(/([A-Z])/g," $1").replace(/[\s]+/g," "))},Fb.quoteName=function(a){return a.replace(/["]/g,'\\"')},Fb.microtime=function(){return(new Date).getTime()},Fb.convertLangName=function(a,b){return Fb.i18n("LANGS_NAMES"+(!0===b?"_EN":"")+"/LANG_"+a.toUpperCase().replace(/[^a-zA-Z0-9]+/,"_"),null,a)
},Fb.fakeMd5=function(a){var b="",c="0123456789abcdefghijklmnopqrstuvwxyz";for(a=Fb.isUnd(a)?32:Fb.pInt(a);b.length<a;)b+=c.substr(Math.round(Math.random()*c.length),1);return b},Fb.md5=function(a){function b(a,b){return a<<b|a>>>32-b}function c(a,b){var c,d,e,f,g;return e=2147483648&a,f=2147483648&b,c=1073741824&a,d=1073741824&b,g=(1073741823&a)+(1073741823&b),c&d?2147483648^g^e^f:c|d?1073741824&g?3221225472^g^e^f:1073741824^g^e^f:g^e^f}function d(a,b,c){return a&b|~a&c}function e(a,b,c){return a&c|b&~c}function f(a,b,c){return a^b^c}function g(a,b,c){return b^(a|~c)}function h(a,e,f,g,h,i,j){return a=c(a,c(c(d(e,f,g),h),j)),c(b(a,i),e)}function i(a,d,f,g,h,i,j){return a=c(a,c(c(e(d,f,g),h),j)),c(b(a,i),d)}function j(a,d,e,g,h,i,j){return a=c(a,c(c(f(d,e,g),h),j)),c(b(a,i),d)}function k(a,d,e,f,h,i,j){return a=c(a,c(c(g(d,e,f),h),j)),c(b(a,i),d)}function l(a){for(var b,c=a.length,d=c+8,e=(d-d%64)/64,f=16*(e+1),g=Array(f-1),h=0,i=0;c>i;)b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|a.charCodeAt(i)<<h,i++;return b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|128<<h,g[f-2]=c<<3,g[f-1]=c>>>29,g}function m(a){var b,c,d="",e="";for(c=0;3>=c;c++)b=a>>>8*c&255,e="0"+b.toString(16),d+=e.substr(e.length-2,2);return d}function n(a){a=a.replace(/rn/g,"n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}var o,p,q,r,s,t,u,v,w,x=Array(),y=7,z=12,A=17,B=22,C=5,D=9,E=14,F=20,G=4,H=11,I=16,J=23,K=6,L=10,M=15,N=21;for(a=n(a),x=l(a),t=1732584193,u=4023233417,v=2562383102,w=271733878,o=0;o<x.length;o+=16)p=t,q=u,r=v,s=w,t=h(t,u,v,w,x[o+0],y,3614090360),w=h(w,t,u,v,x[o+1],z,3905402710),v=h(v,w,t,u,x[o+2],A,606105819),u=h(u,v,w,t,x[o+3],B,3250441966),t=h(t,u,v,w,x[o+4],y,4118548399),w=h(w,t,u,v,x[o+5],z,1200080426),v=h(v,w,t,u,x[o+6],A,2821735955),u=h(u,v,w,t,x[o+7],B,4249261313),t=h(t,u,v,w,x[o+8],y,1770035416),w=h(w,t,u,v,x[o+9],z,2336552879),v=h(v,w,t,u,x[o+10],A,4294925233),u=h(u,v,w,t,x[o+11],B,2304563134),t=h(t,u,v,w,x[o+12],y,1804603682),w=h(w,t,u,v,x[o+13],z,4254626195),v=h(v,w,t,u,x[o+14],A,2792965006),u=h(u,v,w,t,x[o+15],B,1236535329),t=i(t,u,v,w,x[o+1],C,4129170786),w=i(w,t,u,v,x[o+6],D,3225465664),v=i(v,w,t,u,x[o+11],E,643717713),u=i(u,v,w,t,x[o+0],F,3921069994),t=i(t,u,v,w,x[o+5],C,3593408605),w=i(w,t,u,v,x[o+10],D,38016083),v=i(v,w,t,u,x[o+15],E,3634488961),u=i(u,v,w,t,x[o+4],F,3889429448),t=i(t,u,v,w,x[o+9],C,568446438),w=i(w,t,u,v,x[o+14],D,3275163606),v=i(v,w,t,u,x[o+3],E,4107603335),u=i(u,v,w,t,x[o+8],F,1163531501),t=i(t,u,v,w,x[o+13],C,2850285829),w=i(w,t,u,v,x[o+2],D,4243563512),v=i(v,w,t,u,x[o+7],E,1735328473),u=i(u,v,w,t,x[o+12],F,2368359562),t=j(t,u,v,w,x[o+5],G,4294588738),w=j(w,t,u,v,x[o+8],H,2272392833),v=j(v,w,t,u,x[o+11],I,1839030562),u=j(u,v,w,t,x[o+14],J,4259657740),t=j(t,u,v,w,x[o+1],G,2763975236),w=j(w,t,u,v,x[o+4],H,1272893353),v=j(v,w,t,u,x[o+7],I,4139469664),u=j(u,v,w,t,x[o+10],J,3200236656),t=j(t,u,v,w,x[o+13],G,681279174),w=j(w,t,u,v,x[o+0],H,3936430074),v=j(v,w,t,u,x[o+3],I,3572445317),u=j(u,v,w,t,x[o+6],J,76029189),t=j(t,u,v,w,x[o+9],G,3654602809),w=j(w,t,u,v,x[o+12],H,3873151461),v=j(v,w,t,u,x[o+15],I,530742520),u=j(u,v,w,t,x[o+2],J,3299628645),t=k(t,u,v,w,x[o+0],K,4096336452),w=k(w,t,u,v,x[o+7],L,1126891415),v=k(v,w,t,u,x[o+14],M,2878612391),u=k(u,v,w,t,x[o+5],N,4237533241),t=k(t,u,v,w,x[o+12],K,1700485571),w=k(w,t,u,v,x[o+3],L,2399980690),v=k(v,w,t,u,x[o+10],M,4293915773),u=k(u,v,w,t,x[o+1],N,2240044497),t=k(t,u,v,w,x[o+8],K,1873313359),w=k(w,t,u,v,x[o+15],L,4264355552),v=k(v,w,t,u,x[o+6],M,2734768916),u=k(u,v,w,t,x[o+13],N,1309151649),t=k(t,u,v,w,x[o+4],K,4149444226),w=k(w,t,u,v,x[o+11],L,3174756917),v=k(v,w,t,u,x[o+2],M,718787259),u=k(u,v,w,t,x[o+9],N,3951481745),t=c(t,p),u=c(u,q),v=c(v,r),w=c(w,s);var O=m(t)+m(u)+m(v)+m(w);return O.toLowerCase()},Fb.convertPlainTextToHtml=function(a){return a.toString().replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\r/g,"").replace(/\n/g,"<br />")},Fb.draggeblePlace=function(){return b('<div class="draggablePlace"><span class="text"></span>&nbsp;<i class="icon-copy icon-white visible-on-ctrl"></i><i class="icon-mail icon-white hidden-on-ctrl"></i></div>').appendTo("#rl-hidden")},Fb.defautOptionsAfterRender=function(a,c){c&&!Fb.isUnd(c.disabled)&&a&&b(a).toggleClass("disabled",c.disabled).prop("disabled",c.disabled)},Fb.windowPopupKnockout=function(c,d,e,f){var g=null,h=a.open(""),i="__OpenerApplyBindingsUid"+Fb.fakeMd5()+"__",j=b("#"+d);a[i]=function(){if(h&&h.document.body&&j&&j[0]){var d=b(h.document.body);b("#rl-content",d).html(j.html()),b("html",h.document).addClass("external "+b("html").attr("class")),Fb.i18nToNode(d),t.prototype.applyExternal(c,b("#rl-content",d)[0]),a[i]=null,f(h)}},h.document.open(),h.document.write('<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="user-scalable=no" /><meta name="apple-mobile-web-app-capable" content="yes" /><meta name="robots" content="noindex, nofollow, noodp" /><title>'+Fb.encodeHtml(e)+'</title></head><body><div id="rl-content"></div></body></html>'),h.document.close(),g=h.document.createElement("script"),g.type="text/javascript",g.innerHTML="if(window&&window.opener&&window.opener['"+i+"']){window.opener['"+i+"']();window.opener['"+i+"']=null}",h.document.getElementsByTagName("head")[0].appendChild(g)},Fb.settingsSaveHelperFunction=function(a,b,c,d){return c=c||null,d=Fb.isUnd(d)?1e3:Fb.pInt(d),function(e,f,g,i,j){b.call(c,f&&f.Result?Db.SaveSettingsStep.TrueResult:Db.SaveSettingsStep.FalseResult),a&&a.call(c,e,f,g,i,j),h.delay(function(){b.call(c,Db.SaveSettingsStep.Idle)},d)}},Fb.settingsSaveHelperSimpleFunction=function(a,b){return Fb.settingsSaveHelperFunction(null,a,b,1e3)},Fb.htmlToPlain=function(a){var c="",d="> ",e=function(){if(arguments&&1<arguments.length){var a=b.trim(arguments[1]).replace(/__bq__start__(.|[\s\S\n\r]*)__bq__end__/gm,e);return a="\n"+d+b.trim(a).replace(/\n/gm,"\n"+d)+"\n>\n",a.replace(/\n([> ]+)/gm,function(){return arguments&&1<arguments.length?"\n"+b.trim(arguments[1].replace(/[\s]/,""))+" ":""})}return""},f=function(){if(arguments&&1<arguments.length){var a=b.trim(arguments[1]);return 0<a.length&&(a=a.replace(/<div[^>]*>(.|[\s\S\r\n]*)<\/div>/gim,f),a="\n"+b.trim(a)+"\n"),a}return""},g=function(){return arguments&&1<arguments.length?""+arguments[1]+arguments[2].replace(/</g,"&lt;").replace(/>/g,"&gt;"):""},h=function(){if(arguments&&1<arguments.length){var a=b.trim(arguments[1]);return a}return""};return c=a.replace(/[\s]+/gm," ").replace(/((?:href|data)\s?=\s?)("[^"]+?"|'[^']+?')/gim,g).replace(/<br\s?\/?>/gim,"\n").replace(/<\/h\d>/gi,"\n").replace(/<\/p>/gi,"\n\n").replace(/<\/li>/gi,"\n").replace(/<\/td>/gi,"\n").replace(/<\/tr>/gi,"\n").replace(/<hr[^>]*>/gim,"\n_______________________________\n\n").replace(/<img [^>]*>/gim,"").replace(/<div[^>]*>(.|[\s\S\r\n]*)<\/div>/gim,f).replace(/<blockquote[^>]*>/gim,"\n__bq__start__\n").replace(/<\/blockquote>/gim,"\n__bq__end__\n").replace(/<a [^>]*>(.|[\s\S\r\n]*)<\/a>/gim,h).replace(/&nbsp;/gi," ").replace(/<[^>]*>/gm,"").replace(/&gt;/gi,">").replace(/&lt;/gi,"<").replace(/&amp;/gi,"&").replace(/&\w{2,6};/gi,""),c.replace(/\n[ \t]+/gm,"\n").replace(/[\n]{3,}/gm,"\n\n").replace(/__bq__start__(.|[\s\S\r\n]*)__bq__end__/gm,e).replace(/__bq__start__/gm,"").replace(/__bq__end__/gm,"")},Fb.plainToHtml=function(a){return a.toString().replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\r/g,"").replace(/\n/g,"<br />")},Fb.resizeAndCrop=function(b,c,d){var e=new a.Image;e.onload=function(){var a=[0,0],b=document.createElement("canvas"),e=b.getContext("2d");b.width=c,b.height=c,a=this.width>this.height?[this.width-this.height,0]:[0,this.height-this.width],e.fillStyle="#fff",e.fillRect(0,0,c,c),e.drawImage(this,a[0]/2,a[1]/2,this.width-a[0],this.height-a[1],0,0,c,c),d(b.toDataURL("image/jpeg"))},e.src=b},Fb.computedPagenatorHelper=function(a,b){return function(){var c=0,d=0,e=2,f=[],g=a(),h=b(),i=function(a,b,c){var d={current:a===g,name:Fb.isUnd(c)?a.toString():c.toString(),custom:Fb.isUnd(c)?!1:!0,title:Fb.isUnd(c)?"":a.toString(),value:a.toString()};(Fb.isUnd(b)?0:!b)?f.unshift(d):f.push(d)};if(h>1||h>0&&g>h){for(g>h?(i(h),c=h,d=h):((3>=g||g>=h-2)&&(e+=2),i(g),c=g,d=g);e>0;)if(c-=1,d+=1,c>0&&(i(c,!1),e--),h>=d)i(d,!0),e--;else if(0>=c)break;3===c?i(2,!1):c>3&&i(Math.round((c-1)/2),!1,"..."),h-2===d?i(h-1,!0):h-2>d&&i(Math.round((h+d)/2),!0,"..."),c>1&&i(1,!1),h>d&&i(h,!0)}return f}},Fb.selectElement=function(b){if(a.getSelection){var c=a.getSelection();c.removeAllRanges();var d=document.createRange();d.selectNodeContents(b),c.addRange(d)}else if(document.selection){var e=document.body.createTextRange();e.moveToElementText(b),e.select()}},Fb.disableKeyFilter=function(){a.key&&(j.filter=function(){return Sb.data().useKeyboardShortcuts()})},Fb.restoreKeyFilter=function(){a.key&&(j.filter=function(a){if(Sb.data().useKeyboardShortcuts()){var b=a.target||a.srcElement,c=b?b.tagName:"";return c=c.toUpperCase(),!("INPUT"===c||"SELECT"===c||"TEXTAREA"===c||b&&"DIV"===c&&"editorHtmlArea"===b.className&&b.contentEditable)}return!1})},Fb.detectDropdownVisibility=h.debounce(function(){Ib.dropdownVisibility(!!h.find(Kb,function(a){return a.hasClass("open")}))},50),Hb={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",urlsafe_encode:function(a){return Hb.encode(a).replace(/[+]/g,"-").replace(/[\/]/g,"_").replace(/[=]/g,".")},encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=Hb._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=this._keyStr.indexOf(a.charAt(j++)),f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!==g&&(i+=String.fromCharCode(c)),64!==h&&(i+=String.fromCharCode(d));return Hb._utf8_decode(i)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0,d=a.length,e=0;d>c;c++)e=a.charCodeAt(c),128>e?b+=String.fromCharCode(e):e>127&&2048>e?(b+=String.fromCharCode(e>>6|192),b+=String.fromCharCode(63&e|128)):(b+=String.fromCharCode(e>>12|224),b+=String.fromCharCode(e>>6&63|128),b+=String.fromCharCode(63&e|128));return b},_utf8_decode:function(a){for(var b="",c=0,d=0,e=0,f=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(e=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&e),c+=2):(e=a.charCodeAt(c+1),f=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&e)<<6|63&f),c+=3);return b}},c.bindingHandlers.tooltip={init:function(a,d){if(!Ib.bMobileDevice){var e=b(a),f=e.data("tooltip-class")||"",g=e.data("tooltip-placement")||"top";e.tooltip({delay:{show:500,hide:100},html:!0,container:"body",placement:g,trigger:"hover",title:function(){return e.is(".disabled")||Ib.dropdownVisibility()?"":'<span class="tooltip-class '+f+'">'+Fb.i18n(c.utils.unwrapObservable(d()))+"</span>"}}).click(function(){e.tooltip("hide")}),Ib.tooltipTrigger.subscribe(function(){e.tooltip("hide")})}}},c.bindingHandlers.tooltip2={init:function(a,c){var d=b(a),e=d.data("tooltip-class")||"",f=d.data("tooltip-placement")||"top";d.tooltip({delay:{show:500,hide:100},html:!0,container:"body",placement:f,title:function(){return d.is(".disabled")||Ib.dropdownVisibility()?"":'<span class="tooltip-class '+e+'">'+c()()+"</span>"}}).click(function(){d.tooltip("hide")}),Ib.tooltipTrigger.subscribe(function(){d.tooltip("hide")})}},c.bindingHandlers.tooltip3={init:function(a){var c=b(a);c.tooltip({container:"body",trigger:"hover manual",title:function(){return c.data("tooltip3-data")||""}}),Qb.click(function(){c.tooltip("hide")}),Ib.tooltipTrigger.subscribe(function(){c.tooltip("hide")})},update:function(a,d){var e=c.utils.unwrapObservable(d());""===e?b(a).data("tooltip3-data","").tooltip("hide"):b(a).data("tooltip3-data",e).tooltip("show")}},c.bindingHandlers.registrateBootstrapDropdown={init:function(a){Kb.push(b(a))}},c.bindingHandlers.openDropdownTrigger={update:function(a,d){if(c.utils.unwrapObservable(d())){var e=b(a);e.hasClass("open")||(e.find(".dropdown-toggle").dropdown("toggle"),Fb.detectDropdownVisibility()),d()(!1)}}},c.bindingHandlers.dropdownCloser={init:function(a){b(a).closest(".dropdown").on("click",".e-item",function(){b(a).dropdown("toggle")})}},c.bindingHandlers.popover={init:function(a,d){b(a).popover(c.utils.unwrapObservable(d()))}},c.bindingHandlers.csstext={init:function(a,d){a&&a.styleSheet&&!Fb.isUnd(a.styleSheet.cssText)?a.styleSheet.cssText=c.utils.unwrapObservable(d()):b(a).text(c.utils.unwrapObservable(d()))},update:function(a,d){a&&a.styleSheet&&!Fb.isUnd(a.styleSheet.cssText)?a.styleSheet.cssText=c.utils.unwrapObservable(d()):b(a).text(c.utils.unwrapObservable(d()))}},c.bindingHandlers.resizecrop={init:function(a){b(a).addClass("resizecrop").resizecrop({width:"100",height:"100",wrapperCSS:{"border-radius":"10px"}})},update:function(a,c){c()(),b(a).resizecrop({width:"100",height:"100"})}},c.bindingHandlers.onEnter={init:function(c,d,e,f){b(c).on("keypress",function(e){e&&13===a.parseInt(e.keyCode,10)&&(b(c).trigger("change"),d().call(f))})}},c.bindingHandlers.onEsc={init:function(c,d,e,f){b(c).on("keypress",function(e){e&&27===a.parseInt(e.keyCode,10)&&(b(c).trigger("change"),d().call(f))})}},c.bindingHandlers.clickOnTrue={update:function(a,d){c.utils.unwrapObservable(d())&&b(a).click()}},c.bindingHandlers.modal={init:function(a,d){b(a).toggleClass("fade",!Ib.bMobileDevice).modal({keyboard:!1,show:c.utils.unwrapObservable(d())}).on("shown",function(){Fb.windowResize()}).find(".close").click(function(){d()(!1)})},update:function(a,d){b(a).modal(c.utils.unwrapObservable(d())?"show":"hide")}},c.bindingHandlers.i18nInit={init:function(a){Fb.i18nToNode(a)}},c.bindingHandlers.i18nUpdate={update:function(a,b){c.utils.unwrapObservable(b()),Fb.i18nToNode(a)}},c.bindingHandlers.link={update:function(a,d){b(a).attr("href",c.utils.unwrapObservable(d()))}},c.bindingHandlers.title={update:function(a,d){b(a).attr("title",c.utils.unwrapObservable(d()))}},c.bindingHandlers.textF={init:function(a,d){b(a).text(c.utils.unwrapObservable(d()))}},c.bindingHandlers.initDom={init:function(a,b){b()(a)}},c.bindingHandlers.initResizeTrigger={init:function(a,d){var e=c.utils.unwrapObservable(d());b(a).css({height:e[1],"min-height":e[1]})},update:function(a,d){var e=c.utils.unwrapObservable(d()),f=Fb.pInt(e[1]),g=0,h=b(a).offset().top;h>0&&(h+=Fb.pInt(e[2]),g=Pb.height()-h,g>f&&(f=g),b(a).css({height:f,"min-height":f}))}},c.bindingHandlers.appendDom={update:function(a,d){b(a).hide().empty().append(c.utils.unwrapObservable(d())).show()}},c.bindingHandlers.draggable={init:function(d,e,f){if(!Ib.bMobileDevice){var g=100,h=3,i=f(),j=i&&i.droppableSelector?i.droppableSelector:"",k={distance:20,handle:".dragHandle",cursorAt:{top:22,left:3},refreshPositions:!0,scroll:!0};j&&(k.drag=function(c){b(j).each(function(){var d=null,e=null,f=b(this),i=f.offset(),j=i.top+f.height();a.clearInterval(f.data("timerScroll")),f.data("timerScroll",!1),c.pageX>=i.left&&c.pageX<=i.left+f.width()&&(c.pageY>=j-g&&c.pageY<=j&&(d=function(){f.scrollTop(f.scrollTop()+h),Fb.windowResize()},f.data("timerScroll",a.setInterval(d,10)),d()),c.pageY>=i.top&&c.pageY<=i.top+g&&(e=function(){f.scrollTop(f.scrollTop()-h),Fb.windowResize()},f.data("timerScroll",a.setInterval(e,10)),e()))})},k.stop=function(){b(j).each(function(){a.clearInterval(b(this).data("timerScroll")),b(this).data("timerScroll",!1)})}),k.helper=function(a){return e()(a&&a.target?c.dataFor(a.target):null)},b(d).draggable(k).on("mousedown",function(){Fb.removeInFocus()})}}},c.bindingHandlers.droppable={init:function(a,c,d){if(!Ib.bMobileDevice){var e=c(),f=d(),g=f&&f.droppableOver?f.droppableOver:null,h=f&&f.droppableOut?f.droppableOut:null,i={tolerance:"pointer",hoverClass:"droppableHover"};e&&(i.drop=function(a,b){e(a,b)},g&&(i.over=function(a,b){g(a,b)}),h&&(i.out=function(a,b){h(a,b)}),b(a).droppable(i))}}},c.bindingHandlers.nano={init:function(a){Ib.bDisableNanoScroll||b(a).addClass("nano").nanoScroller({iOSNativeScrolling:!1,preventPageScrolling:!0})}},c.bindingHandlers.saveTrigger={init:function(a){var c=b(a);c.data("save-trigger-type",c.is("input[type=text],input[type=email],input[type=password],select,textarea")?"input":"custom"),"custom"===c.data("save-trigger-type")?c.append('&nbsp;&nbsp;<i class="icon-spinner animated"></i><i class="icon-remove error"></i><i class="icon-ok success"></i>').addClass("settings-saved-trigger"):c.addClass("settings-saved-trigger-input")},update:function(a,d){var e=c.utils.unwrapObservable(d()),f=b(a);if("custom"===f.data("save-trigger-type"))switch(e.toString()){case"1":f.find(".animated,.error").hide().removeClass("visible").end().find(".success").show().addClass("visible");break;case"0":f.find(".animated,.success").hide().removeClass("visible").end().find(".error").show().addClass("visible");break;case"-2":f.find(".error,.success").hide().removeClass("visible").end().find(".animated").show().addClass("visible");break;default:f.find(".animated").hide().end().find(".error,.success").removeClass("visible")}else switch(e.toString()){case"1":f.addClass("success").removeClass("error");break;case"0":f.addClass("error").removeClass("success");break;case"-2":break;default:f.removeClass("error success")}}},c.bindingHandlers.emailsTags={init:function(a,c){var d=b(a),e=c(),f=function(a){e&&e.focusTrigger&&e.focusTrigger(a)};d.inputosaurus({parseOnBlur:!0,allowDragAndDrop:!0,focusCallback:f,inputDelimiters:[",",";"],autoCompleteSource:function(a,b){Sb.getAutocomplete(a.term,function(a){b(h.map(a,function(a){return a.toLine(!1)}))})},parseHook:function(a){return h.map(a,function(a){var b=Fb.trim(a),c=null;return""!==b?(c=new u,c.mailsoParse(b),c.clearDuplicateName(),[c.toLine(!1),c]):[b,null]})},change:h.bind(function(a){d.data("EmailsTagsValue",a.target.value),e(a.target.value)},this)}),e.subscribe(function(a){d.data("EmailsTagsValue")!==a&&(d.val(a),d.data("EmailsTagsValue",a),d.inputosaurus("refresh"))}),e.focusTrigger&&e.focusTrigger.subscribe(function(a){a&&d.inputosaurus("focus")})}},c.bindingHandlers.contactTags={init:function(a,c){var d=b(a),e=c(),f=function(a){e&&e.focusTrigger&&e.focusTrigger(a)};d.inputosaurus({parseOnBlur:!0,allowDragAndDrop:!1,focusCallback:f,inputDelimiters:[",",";"],outputDelimiter:",",autoCompleteSource:function(a,b){Sb.getContactsTagsAutocomplete(a.term,function(a){b(h.map(a,function(a){return a.toLine(!1)}))})},parseHook:function(a){return h.map(a,function(a){var b=Fb.trim(a),c=null;return""!==b?(c=new x,c.name(b),[c.toLine(!1),c]):[b,null]})},change:h.bind(function(a){d.data("ContactsTagsValue",a.target.value),e(a.target.value)},this)}),e.subscribe(function(a){d.data("ContactsTagsValue")!==a&&(d.val(a),d.data("ContactsTagsValue",a),d.inputosaurus("refresh"))}),e.focusTrigger&&e.focusTrigger.subscribe(function(a){a&&d.inputosaurus("focus")})}},c.bindingHandlers.command={init:function(a,d,e,f){var g=b(a),h=d();if(!h||!h.enabled||!h.canExecute)throw new Error("You are not using command function");g.addClass("command"),c.bindingHandlers[g.is("form")?"submit":"click"].init.apply(f,arguments)},update:function(a,c){var d=!0,e=b(a),f=c();d=f.enabled(),e.toggleClass("command-not-enabled",!d),d&&(d=f.canExecute(),e.toggleClass("command-can-not-be-execute",!d)),e.toggleClass("command-disabled disable disabled",!d).toggleClass("no-disabled",!!d),(e.is("input")||e.is("button"))&&e.prop("disabled",!d)}},c.extenders.trimmer=function(a){var b=c.computed({read:a,write:function(b){a(Fb.trim(b.toString()))},owner:this});return b(a()),b},c.extenders.reversible=function(a){var b=a();return a.commit=function(){b=a()},a.reverse=function(){a(b)},a.commitedValue=function(){return b},a},c.extenders.toggleSubscribe=function(a,b){return a.subscribe(b[1],b[0],"beforeChange"),a.subscribe(b[2],b[0]),a},c.extenders.falseTimeout=function(b,c){return b.iTimeout=0,b.subscribe(function(d){d&&(a.clearTimeout(b.iTimeout),b.iTimeout=a.setTimeout(function(){b(!1),b.iTimeout=0},Fb.pInt(c)))}),b},c.observable.fn.validateNone=function(){return this.hasError=c.observable(!1),this},c.observable.fn.validateEmail=function(){return this.hasError=c.observable(!1),this.subscribe(function(a){a=Fb.trim(a),this.hasError(""!==a&&!/^[^@\s]+@[^@\s]+$/.test(a))},this),this.valueHasMutated(),this},c.observable.fn.validateSimpleEmail=function(){return this.hasError=c.observable(!1),this.subscribe(function(a){a=Fb.trim(a),this.hasError(""!==a&&!/^.+@.+$/.test(a))},this),this.valueHasMutated(),this},c.observable.fn.validateFunc=function(a){return this.hasFuncError=c.observable(!1),Fb.isFunc(a)&&(this.subscribe(function(b){this.hasFuncError(!a(b))},this),this.valueHasMutated()),this},k.prototype.root=function(){return this.sBase},k.prototype.attachmentDownload=function(a){return this.sServer+"/Raw/"+this.sSpecSuffix+"/Download/"+a},k.prototype.attachmentPreview=function(a){return this.sServer+"/Raw/"+this.sSpecSuffix+"/View/"+a},k.prototype.attachmentPreviewAsPlain=function(a){return this.sServer+"/Raw/"+this.sSpecSuffix+"/ViewAsPlain/"+a},k.prototype.upload=function(){return this.sServer+"/Upload/"+this.sSpecSuffix+"/"},k.prototype.uploadContacts=function(){return this.sServer+"/UploadContacts/"+this.sSpecSuffix+"/"},k.prototype.uploadBackground=function(){return this.sServer+"/UploadBackground/"+this.sSpecSuffix+"/"},k.prototype.append=function(){return this.sServer+"/Append/"+this.sSpecSuffix+"/"},k.prototype.change=function(b){return this.sServer+"/Change/"+this.sSpecSuffix+"/"+a.encodeURIComponent(b)+"/"},k.prototype.ajax=function(a){return this.sServer+"/Ajax/"+this.sSpecSuffix+"/"+a},k.prototype.messageViewLink=function(a){return this.sServer+"/Raw/"+this.sSpecSuffix+"/ViewAsPlain/"+a},k.prototype.messageDownloadLink=function(a){return this.sServer+"/Raw/"+this.sSpecSuffix+"/Download/"+a},k.prototype.inbox=function(){return this.sBase+"mailbox/Inbox"},k.prototype.messagePreview=function(){return this.sBase+"mailbox/message-preview"},k.prototype.settings=function(a){var b=this.sBase+"settings";return Fb.isUnd(a)||""===a||(b+="/"+a),b},k.prototype.admin=function(a){var b=this.sBase;switch(a){case"AdminDomains":b+="domains";break;case"AdminSecurity":b+="security";break;case"AdminLicensing":b+="licensing"}return b},k.prototype.mailBox=function(a,b,c){b=Fb.isNormal(b)?Fb.pInt(b):1,c=Fb.pString(c);var d=this.sBase+"mailbox/";return""!==a&&(d+=encodeURI(a)),b>1&&(d=d.replace(/[\/]+$/,""),d+="/p"+b),""!==c&&(d=d.replace(/[\/]+$/,""),d+="/"+encodeURI(c)),d},k.prototype.phpInfo=function(){return this.sServer+"Info"},k.prototype.langLink=function(a){return this.sServer+"/Lang/0/"+encodeURI(a)+"/"+this.sVersion+"/"},k.prototype.getUserPicUrlFromHash=function(a){return this.sServer+"/Raw/"+this.sSpecSuffix+"/UserPic/"+a+"/"+this.sVersion+"/"},k.prototype.exportContactsVcf=function(){return this.sServer+"/Raw/"+this.sSpecSuffix+"/ContactsVcf/"},k.prototype.exportContactsCsv=function(){return this.sServer+"/Raw/"+this.sSpecSuffix+"/ContactsCsv/"},k.prototype.emptyContactPic=function(){return"rainloop/v/"+this.sVersion+"/static/css/images/empty-contact.png"},k.prototype.emptyFullContactPic=function(){return a.location.protocol+"//"+a.location.hostname+("80"==""+a.location.port||""==""+a.location.port?"":":"+a.location.port)+a.location.pathname+"rainloop/v/"+this.sVersion+"/static/css/images/empty-contact.png"},k.prototype.sound=function(a){return"rainloop/v/"+this.sVersion+"/static/sounds/"+a},k.prototype.themePreviewLink=function(a){var b="rainloop/v/"+this.sVersion+"/";return"@custom"===a.substr(-7)&&(a=Fb.trim(a.substring(0,a.length-7)),b=""),b+"themes/"+encodeURI(a)+"/images/preview.png"},k.prototype.notificationMailIcon=function(){return"rainloop/v/"+this.sVersion+"/static/css/images/icom-message-notification.png"},k.prototype.openPgpJs=function(){return"rainloop/v/"+this.sVersion+"/static/js/openpgp.min.js"},k.prototype.socialGoogle=function(){return this.sServer+"SocialGoogle"+(""!==this.sSpecSuffix?"/"+this.sSpecSuffix+"/":"")},k.prototype.socialTwitter=function(){return this.sServer+"SocialTwitter"+(""!==this.sSpecSuffix?"/"+this.sSpecSuffix+"/":"")},k.prototype.socialFacebook=function(){return this.sServer+"SocialFacebook"+(""!==this.sSpecSuffix?"/"+this.sSpecSuffix+"/":"")},Gb.oViewModelsHooks={},Gb.oSimpleHooks={},Gb.regViewModelHook=function(a,b){b&&(b.__hookName=a)},Gb.addHook=function(a,b){Fb.isFunc(b)&&(Fb.isArray(Gb.oSimpleHooks[a])||(Gb.oSimpleHooks[a]=[]),Gb.oSimpleHooks[a].push(b))},Gb.runHook=function(a,b){Fb.isArray(Gb.oSimpleHooks[a])&&(b=b||[],h.each(Gb.oSimpleHooks[a],function(a){a.apply(null,b)}))},Gb.mainSettingsGet=function(a){return Sb?Sb.settingsGet(a):null},Gb.remoteRequest=function(a,b,c,d,e,f){Sb&&Sb.remote().defaultRequest(a,b,c,d,e,f)},Gb.settingsGet=function(a,b){var c=Gb.mainSettingsGet("Plugins");return c=c&&Fb.isUnd(c[a])?null:c[a],c?Fb.isUnd(c[b])?null:c[b]:null},l.prototype.blurTrigger=function(){if(this.fOnBlur){var b=this;a.clearTimeout(b.iBlurTimer),b.iBlurTimer=a.setTimeout(function(){b.fOnBlur()},200)}},l.prototype.focusTrigger=function(){this.fOnBlur&&a.clearTimeout(this.iBlurTimer)},l.prototype.isHtml=function(){return this.editor?"wysiwyg"===this.editor.mode:!1},l.prototype.checkDirty=function(){return this.editor?this.editor.checkDirty():!1},l.prototype.resetDirty=function(){this.editor&&this.editor.resetDirty()},l.prototype.getData=function(){return this.editor?"plain"===this.editor.mode&&this.editor.plugins.plain&&this.editor.__plain?this.editor.__plain.getRawData():this.editor.getData():""},l.prototype.modeToggle=function(a){this.editor&&(a?"plain"===this.editor.mode&&this.editor.setMode("wysiwyg"):"wysiwyg"===this.editor.mode&&this.editor.setMode("plain"))},l.prototype.setHtml=function(a,b){this.editor&&(this.modeToggle(!0),this.editor.setData(a),b&&this.focus())},l.prototype.setPlain=function(a,b){if(this.editor){if(this.modeToggle(!1),"plain"===this.editor.mode&&this.editor.plugins.plain&&this.editor.__plain)return this.editor.__plain.setRawData(a);this.editor.setData(a),b&&this.focus()}},l.prototype.init=function(){if(this.$element&&this.$element[0]){var b=this,c=Ib.oHtmlEditorDefaultConfig,d=Sb.settingsGet("Language"),e=!!Sb.settingsGet("AllowHtmlEditorSourceButton");e&&c.toolbarGroups&&!c.toolbarGroups.__SourceInited&&(c.toolbarGroups.__SourceInited=!0,c.toolbarGroups.push({name:"document",groups:["mode","document","doctools"]})),c.language=Ib.oHtmlEditorLangsMap[d]||"en",b.editor=a.CKEDITOR.appendTo(b.$element[0],c),b.editor.on("key",function(a){return a&&a.data&&9===a.data.keyCode?!1:void 0}),b.editor.on("blur",function(){b.blurTrigger()}),b.editor.on("mode",function(){b.blurTrigger(),b.fOnModeChange&&b.fOnModeChange("plain"!==b.editor.mode)}),b.editor.on("focus",function(){b.focusTrigger()}),b.fOnReady&&b.editor.on("instanceReady",function(){b.editor.setKeystroke(a.CKEDITOR.CTRL+65,"selectAll"),b.fOnReady(),b.__resizable=!0,b.resize()})}},l.prototype.focus=function(){this.editor&&this.editor.focus()},l.prototype.blur=function(){this.editor&&this.editor.focusManager.blur(!0)},l.prototype.resize=function(){this.editor&&this.__resizable&&this.editor.resize(this.$element.width(),this.$element.innerHeight())},l.prototype.clear=function(a){this.setHtml("",a)},m.prototype.itemSelected=function(a){this.isListChecked()?a||(this.oCallbacks.onItemSelect||this.emptyFunction)(a||null):a&&(this.oCallbacks.onItemSelect||this.emptyFunction)(a)},m.prototype.goDown=function(a){this.newSelectPosition(Db.EventKeyCode.Down,!1,a)},m.prototype.goUp=function(a){this.newSelectPosition(Db.EventKeyCode.Up,!1,a)},m.prototype.init=function(a,d,e){if(this.oContentVisible=a,this.oContentScrollable=d,e=e||"all",this.oContentVisible&&this.oContentScrollable){var f=this;b(this.oContentVisible).on("selectstart",function(a){a&&a.preventDefault&&a.preventDefault()}).on("click",this.sItemSelector,function(a){f.actionClick(c.dataFor(this),a)}).on("click",this.sItemCheckedSelector,function(a){var b=c.dataFor(this);b&&(a&&a.shiftKey?f.actionClick(b,a):(f.focusedItem(b),b.checked(!b.checked())))}),j("enter",e,function(){return f.focusedItem()&&!f.focusedItem().selected()?(f.actionClick(f.focusedItem()),!1):!0}),j("ctrl+up, command+up, ctrl+down, command+down",e,function(){return!1}),j("up, shift+up, down, shift+down, home, end, pageup, pagedown, insert, space",e,function(a,b){if(a&&b&&b.shortcut){var c=0;switch(b.shortcut){case"up":case"shift+up":c=Db.EventKeyCode.Up;break;case"down":case"shift+down":c=Db.EventKeyCode.Down;break;case"insert":c=Db.EventKeyCode.Insert;break;case"space":c=Db.EventKeyCode.Space;break;case"home":c=Db.EventKeyCode.Home;break;case"end":c=Db.EventKeyCode.End;break;case"pageup":c=Db.EventKeyCode.PageUp;break;case"pagedown":c=Db.EventKeyCode.PageDown}if(c>0)return f.newSelectPosition(c,j.shift),!1}})}},m.prototype.autoSelect=function(a){this.bAutoSelect=!!a},m.prototype.getItemUid=function(a){var b="",c=this.oCallbacks.onItemGetUid||null;return c&&a&&(b=c(a)),b.toString()},m.prototype.newSelectPosition=function(a,b,c){var d=0,e=10,f=!1,g=!1,i=null,j=this.list(),k=j?j.length:0,l=this.focusedItem();if(k>0)if(l){if(l)if(Db.EventKeyCode.Down===a||Db.EventKeyCode.Up===a||Db.EventKeyCode.Insert===a||Db.EventKeyCode.Space===a)h.each(j,function(b){if(!g)switch(a){case Db.EventKeyCode.Up:l===b?g=!0:i=b;break;case Db.EventKeyCode.Down:case Db.EventKeyCode.Insert:f?(i=b,g=!0):l===b&&(f=!0)}});else if(Db.EventKeyCode.Home===a||Db.EventKeyCode.End===a)Db.EventKeyCode.Home===a?i=j[0]:Db.EventKeyCode.End===a&&(i=j[j.length-1]);else if(Db.EventKeyCode.PageDown===a){for(;k>d;d++)if(l===j[d]){d+=e,d=d>k-1?k-1:d,i=j[d];break}}else if(Db.EventKeyCode.PageUp===a)for(d=k;d>=0;d--)if(l===j[d]){d-=e,d=0>d?0:d,i=j[d];break}}else Db.EventKeyCode.Down===a||Db.EventKeyCode.Insert===a||Db.EventKeyCode.Space===a||Db.EventKeyCode.Home===a||Db.EventKeyCode.PageUp===a?i=j[0]:(Db.EventKeyCode.Up===a||Db.EventKeyCode.End===a||Db.EventKeyCode.PageDown===a)&&(i=j[j.length-1]);i?(this.focusedItem(i),l&&(b?(Db.EventKeyCode.Up===a||Db.EventKeyCode.Down===a)&&l.checked(!l.checked()):(Db.EventKeyCode.Insert===a||Db.EventKeyCode.Space===a)&&l.checked(!l.checked())),!this.bAutoSelect&&!c||this.isListChecked()||Db.EventKeyCode.Space===a||this.selectedItem(i),this.scrollToFocused()):l&&(!b||Db.EventKeyCode.Up!==a&&Db.EventKeyCode.Down!==a?(Db.EventKeyCode.Insert===a||Db.EventKeyCode.Space===a)&&l.checked(!l.checked()):l.checked(!l.checked()),this.focusedItem(l))},m.prototype.scrollToFocused=function(){if(!this.oContentVisible||!this.oContentScrollable)return!1;var a=20,c=b(this.sItemFocusedSelector,this.oContentScrollable),d=c.position(),e=this.oContentVisible.height(),f=c.outerHeight();return d&&(d.top<0||d.top+f>e)?(d.top<0?this.oContentScrollable.scrollTop(this.oContentScrollable.scrollTop()+d.top-a):this.oContentScrollable.scrollTop(this.oContentScrollable.scrollTop()+d.top-e+f+a),!0):!1},m.prototype.scrollToTop=function(a){return this.oContentVisible&&this.oContentScrollable?(a?this.oContentScrollable.scrollTop(0):this.oContentScrollable.stop().animate({scrollTop:0},200),!0):!1},m.prototype.eventClickFunction=function(a,b){var c=this.getItemUid(a),d=0,e=0,f=null,g="",h=!1,i=!1,j=[],k=!1;if(b&&b.shiftKey&&""!==c&&""!==this.sLastUid&&c!==this.sLastUid)for(j=this.list(),k=a.checked(),d=0,e=j.length;e>d;d++)f=j[d],g=this.getItemUid(f),h=!1,(g===this.sLastUid||g===c)&&(h=!0),h&&(i=!i),(i||h)&&f.checked(k);this.sLastUid=""===c?"":c},m.prototype.actionClick=function(a,b){if(a){var c=!0,d=this.getItemUid(a);
b&&(!b.shiftKey||b.ctrlKey||b.altKey?!b.ctrlKey||b.shiftKey||b.altKey||(c=!1,this.focusedItem(a),this.selectedItem()&&a!==this.selectedItem()&&this.selectedItem().checked(!0),a.checked(!a.checked())):(c=!1,""===this.sLastUid&&(this.sLastUid=d),a.checked(!a.checked()),this.eventClickFunction(a,b),this.focusedItem(a))),c&&(this.focusedItem(a),this.selectedItem(a))}},m.prototype.on=function(a,b){this.oCallbacks[a]=b},n.supported=function(){return!0},n.prototype.set=function(a,c){var d=b.cookie(Cb.Values.ClientSideCookieIndexName),e=!1,f=null;try{f=null===d?null:JSON.parse(d),f||(f={}),f[a]=c,b.cookie(Cb.Values.ClientSideCookieIndexName,JSON.stringify(f),{expires:30}),e=!0}catch(g){}return e},n.prototype.get=function(a){var c=b.cookie(Cb.Values.ClientSideCookieIndexName),d=null;try{d=null===c?null:JSON.parse(c),d=d&&!Fb.isUnd(d[a])?d[a]:null}catch(e){}return d},o.supported=function(){return!!a.localStorage},o.prototype.set=function(b,c){var d=a.localStorage[Cb.Values.ClientSideCookieIndexName]||null,e=!1,f=null;try{f=null===d?null:JSON.parse(d),f||(f={}),f[b]=c,a.localStorage[Cb.Values.ClientSideCookieIndexName]=JSON.stringify(f),e=!0}catch(g){}return e},o.prototype.get=function(b){var c=a.localStorage[Cb.Values.ClientSideCookieIndexName]||null,d=null;try{d=null===c?null:JSON.parse(c),d=d&&!Fb.isUnd(d[b])?d[b]:null}catch(e){}return d},p.prototype.oDriver=null,p.prototype.set=function(a,b){return this.oDriver?this.oDriver.set("p"+a,b):!1},p.prototype.get=function(a){return this.oDriver?this.oDriver.get("p"+a):null},q.prototype.bootstart=function(){},r.prototype.sPosition="",r.prototype.sTemplate="",r.prototype.viewModelName="",r.prototype.viewModelDom=null,r.prototype.viewModelTemplate=function(){return this.sTemplate},r.prototype.viewModelPosition=function(){return this.sPosition},r.prototype.cancelCommand=r.prototype.closeCommand=function(){},r.prototype.storeAndSetKeyScope=function(){this.sCurrentKeyScope=Sb.data().keyScope(),Sb.data().keyScope(this.sDefaultKeyScope)},r.prototype.restoreKeyScope=function(){Sb.data().keyScope(this.sCurrentKeyScope)},r.prototype.registerPopupKeyDown=function(){var a=this;Pb.on("keydown",function(b){if(b&&a.modalVisibility&&a.modalVisibility()){if(!this.bDisabeCloseOnEsc&&Db.EventKeyCode.Esc===b.keyCode)return Fb.delegateRun(a,"cancelCommand"),!1;if(Db.EventKeyCode.Backspace===b.keyCode&&!Fb.inFocus())return!1}return!0})},s.prototype.oCross=null,s.prototype.sScreenName="",s.prototype.aViewModels=[],s.prototype.viewModels=function(){return this.aViewModels},s.prototype.screenName=function(){return this.sScreenName},s.prototype.routes=function(){return null},s.prototype.__cross=function(){return this.oCross},s.prototype.__start=function(){var a=this.routes(),b=null,c=null;Fb.isNonEmptyArray(a)&&(c=h.bind(this.onRoute||Fb.emptyFunction,this),b=d.create(),h.each(a,function(a){b.addRoute(a[0],c).rules=a[1]}),this.oCross=b)},t.constructorEnd=function(a){Fb.isFunc(a.__constructor_end)&&a.__constructor_end.call(a)},t.prototype.sDefaultScreenName="",t.prototype.oScreens={},t.prototype.oBoot=null,t.prototype.oCurrentScreen=null,t.prototype.hideLoading=function(){b("#rl-loading").hide()},t.prototype.routeOff=function(){e.changed.active=!1},t.prototype.routeOn=function(){e.changed.active=!0},t.prototype.setBoot=function(a){return Fb.isNormal(a)&&(this.oBoot=a),this},t.prototype.screen=function(a){return""===a||Fb.isUnd(this.oScreens[a])?null:this.oScreens[a]},t.prototype.buildViewModel=function(a,d){if(a&&!a.__builded){var e=new a(d),f=e.viewModelPosition(),g=b("#rl-content #rl-"+f.toLowerCase()),i=null;a.__builded=!0,a.__vm=e,e.data=Sb.data(),e.viewModelName=a.__name,g&&1===g.length?(i=b("<div></div>").addClass("rl-view-model").addClass("RL-"+e.viewModelTemplate()).hide(),i.appendTo(g),e.viewModelDom=i,a.__dom=i,"Popups"===f&&(e.cancelCommand=e.closeCommand=Fb.createCommand(e,function(){Lb.hideScreenPopup(a)}),e.modalVisibility.subscribe(function(a){var b=this;a?(this.viewModelDom.show(),this.storeAndSetKeyScope(),Sb.popupVisibilityNames.push(this.viewModelName),e.viewModelDom.css("z-index",3e3+Sb.popupVisibilityNames().length+10),Fb.delegateRun(this,"onFocus",[],500)):(Fb.delegateRun(this,"onHide"),this.restoreKeyScope(),Sb.popupVisibilityNames.remove(this.viewModelName),e.viewModelDom.css("z-index",2e3),Ib.tooltipTrigger(!Ib.tooltipTrigger()),h.delay(function(){b.viewModelDom.hide()},300))},e)),Gb.runHook("view-model-pre-build",[a.__name,e,i]),c.applyBindingAccessorsToNode(i[0],{i18nInit:!0,template:function(){return{name:e.viewModelTemplate()}}},e),Fb.delegateRun(e,"onBuild",[i]),e&&"Popups"===f&&e.registerPopupKeyDown(),Gb.runHook("view-model-post-build",[a.__name,e,i])):Fb.log("Cannot find view model position: "+f)}return a?a.__vm:null},t.prototype.applyExternal=function(a,b){a&&b&&c.applyBindings(a,b)},t.prototype.hideScreenPopup=function(a){a&&a.__vm&&a.__dom&&(a.__vm.modalVisibility(!1),Gb.runHook("view-model-on-hide",[a.__name,a.__vm]))},t.prototype.showScreenPopup=function(a,b){a&&(this.buildViewModel(a),a.__vm&&a.__dom&&(a.__vm.modalVisibility(!0),Fb.delegateRun(a.__vm,"onShow",b||[]),Gb.runHook("view-model-on-show",[a.__name,a.__vm,b||[]])))},t.prototype.screenOnRoute=function(a,b){var c=this,d=null,e=null;""===Fb.pString(a)&&(a=this.sDefaultScreenName),""!==a&&(d=this.screen(a),d||(d=this.screen(this.sDefaultScreenName),d&&(b=a+"/"+b,a=this.sDefaultScreenName)),d&&d.__started&&(d.__builded||(d.__builded=!0,Fb.isNonEmptyArray(d.viewModels())&&h.each(d.viewModels(),function(a){this.buildViewModel(a,d)},this),Fb.delegateRun(d,"onBuild")),h.defer(function(){c.oCurrentScreen&&(Fb.delegateRun(c.oCurrentScreen,"onHide"),Fb.isNonEmptyArray(c.oCurrentScreen.viewModels())&&h.each(c.oCurrentScreen.viewModels(),function(a){a.__vm&&a.__dom&&"Popups"!==a.__vm.viewModelPosition()&&(a.__dom.hide(),a.__vm.viewModelVisibility(!1),Fb.delegateRun(a.__vm,"onHide"))})),c.oCurrentScreen=d,c.oCurrentScreen&&(Fb.delegateRun(c.oCurrentScreen,"onShow"),Gb.runHook("screen-on-show",[c.oCurrentScreen.screenName(),c.oCurrentScreen]),Fb.isNonEmptyArray(c.oCurrentScreen.viewModels())&&h.each(c.oCurrentScreen.viewModels(),function(a){a.__vm&&a.__dom&&"Popups"!==a.__vm.viewModelPosition()&&(a.__dom.show(),a.__vm.viewModelVisibility(!0),Fb.delegateRun(a.__vm,"onShow"),Fb.delegateRun(a.__vm,"onFocus",[],200),Gb.runHook("view-model-on-show",[a.__name,a.__vm]))},c)),e=d.__cross(),e&&e.parse(b)})))},t.prototype.startScreens=function(a){b("#rl-content").css({visibility:"hidden"}),h.each(a,function(a){var b=new a,c=b?b.screenName():"";b&&""!==c&&(""===this.sDefaultScreenName&&(this.sDefaultScreenName=c),this.oScreens[c]=b)},this),h.each(this.oScreens,function(a){a&&!a.__started&&a.__start&&(a.__started=!0,a.__start(),Gb.runHook("screen-pre-start",[a.screenName(),a]),Fb.delegateRun(a,"onStart"),Gb.runHook("screen-post-start",[a.screenName(),a]))},this);var c=d.create();c.addRoute(/^([a-zA-Z0-9\-]*)\/?(.*)$/,h.bind(this.screenOnRoute,this)),e.initialized.add(c.parse,c),e.changed.add(c.parse,c),e.init(),b("#rl-content").css({visibility:"visible"}),h.delay(function(){Ob.removeClass("rl-started-trigger").addClass("rl-started")},50)},t.prototype.setHash=function(a,b,c){a="#"===a.substr(0,1)?a.substr(1):a,a="/"===a.substr(0,1)?a.substr(1):a,c=Fb.isUnd(c)?!1:!!c,(Fb.isUnd(b)?1:!b)?(e.changed.active=!0,e[c?"replaceHash":"setHash"](a),e.setHash(a)):(e.changed.active=!1,e[c?"replaceHash":"setHash"](a),e.changed.active=!0)},t.prototype.bootstart=function(){return this.oBoot&&this.oBoot.bootstart&&this.oBoot.bootstart(),this},Lb=new t,u.newInstanceFromJson=function(a){var b=new u;return b.initByJson(a)?b:null},u.prototype.name="",u.prototype.email="",u.prototype.privateType=null,u.prototype.clear=function(){this.email="",this.name="",this.privateType=null},u.prototype.validate=function(){return""!==this.name||""!==this.email},u.prototype.hash=function(a){return"#"+(a?"":this.name)+"#"+this.email+"#"},u.prototype.clearDuplicateName=function(){this.name===this.email&&(this.name="")},u.prototype.type=function(){return null===this.privateType&&(this.email&&"@facebook.com"===this.email.substr(-13)&&(this.privateType=Db.EmailType.Facebook),null===this.privateType&&(this.privateType=Db.EmailType.Default)),this.privateType},u.prototype.search=function(a){return-1<(this.name+" "+this.email).toLowerCase().indexOf(a.toLowerCase())},u.prototype.parse=function(a){this.clear(),a=Fb.trim(a);var b=/(?:"([^"]+)")? ?<?(.*?@[^>,]+)>?,? ?/g,c=b.exec(a);c?(this.name=c[1]||"",this.email=c[2]||"",this.clearDuplicateName()):/^[^@]+@[^@]+$/.test(a)&&(this.name="",this.email=a)},u.prototype.initByJson=function(a){var b=!1;return a&&"Object/Email"===a["@Object"]&&(this.name=Fb.trim(a.Name),this.email=Fb.trim(a.Email),b=""!==this.email,this.clearDuplicateName()),b},u.prototype.toLine=function(a,b,c){var d="";return""!==this.email&&(b=Fb.isUnd(b)?!1:!!b,c=Fb.isUnd(c)?!1:!!c,a&&""!==this.name?d=b?'<a href="mailto:'+Fb.encodeHtml('"'+this.name+'" <'+this.email+">")+'" target="_blank" tabindex="-1">'+Fb.encodeHtml(this.name)+"</a>":c?Fb.encodeHtml(this.name):this.name:(d=this.email,""!==this.name?b?d=Fb.encodeHtml('"'+this.name+'" <')+'<a href="mailto:'+Fb.encodeHtml('"'+this.name+'" <'+this.email+">")+'" target="_blank" tabindex="-1">'+Fb.encodeHtml(d)+"</a>"+Fb.encodeHtml(">"):(d='"'+this.name+'" <'+d+">",c&&(d=Fb.encodeHtml(d))):b&&(d='<a href="mailto:'+Fb.encodeHtml(this.email)+'" target="_blank" tabindex="-1">'+Fb.encodeHtml(this.email)+"</a>"))),d},u.prototype.mailsoParse=function(a){if(a=Fb.trim(a),""===a)return!1;for(var b=function(a,b,c){a+="";var d=a.length;return 0>b&&(b+=d),d="undefined"==typeof c?d:0>c?c+d:c+b,b>=a.length||0>b||b>d?!1:a.slice(b,d)},c=function(a,b,c,d){return 0>c&&(c+=a.length),d=void 0!==d?d:a.length,0>d&&(d=d+a.length-c),a.slice(0,c)+b.substr(0,d)+b.slice(d)+a.slice(c+d)},d="",e="",f="",g=!1,h=!1,i=!1,j=null,k=0,l=0,m=0;m<a.length;){switch(a.substr(m,1)){case'"':g||h||i?h||i||(l=m,d=b(a,k+1,l-k-1),a=c(a,"",k,l-k+1),l=0,m=0,k=0,g=!1):(g=!0,k=m);break;case"<":g||h||i||(m>0&&0===d.length&&(d=b(a,0,m)),h=!0,k=m);break;case">":h&&(l=m,e=b(a,k+1,l-k-1),a=c(a,"",k,l-k+1),l=0,m=0,k=0,h=!1);break;case"(":g||h||i||(i=!0,k=m);break;case")":i&&(l=m,f=b(a,k+1,l-k-1),a=c(a,"",k,l-k+1),l=0,m=0,k=0,i=!1);break;case"\\":m++}m++}return 0===e.length&&(j=a.match(/[^@\s]+@\S+/i),j&&j[0]?e=j[0]:d=a),e.length>0&&0===d.length&&0===f.length&&(d=a.replace(e,"")),e=Fb.trim(e).replace(/^[<]+/,"").replace(/[>]+$/,""),d=Fb.trim(d).replace(/^["']+/,"").replace(/["']+$/,""),f=Fb.trim(f).replace(/^[(]+/,"").replace(/[)]+$/,""),d=d.replace(/\\\\(.)/,"$1"),f=f.replace(/\\\\(.)/,"$1"),this.name=d,this.email=e,this.clearDuplicateName(),!0},u.prototype.inputoTagLine=function(){return 0<this.name.length?this.name+" ("+this.email+")":this.email},v.prototype.getNameAndEmailHelper=function(){var a="",b="";return Fb.isNonEmptyArray(this.properties)&&h.each(this.properties,function(c){c&&(Db.ContactPropertyType.FirstName===c[0]?a=Fb.trim(c[1]+" "+a):Db.ContactPropertyType.LastName===c[0]?a=Fb.trim(a+" "+c[1]):""===b&&Db.ContactPropertyType.Email===c[0]&&(b=c[1]))},this),""===b?null:[b,a]},v.prototype.parse=function(a){var b=!1;return a&&"Object/Contact"===a["@Object"]&&(this.idContact=Fb.pInt(a.IdContact),this.display=Fb.pString(a.Display),this.readOnly=!!a.ReadOnly,this.tags="",Fb.isNonEmptyArray(a.Properties)&&h.each(a.Properties,function(a){a&&a.Type&&Fb.isNormal(a.Value)&&Fb.isNormal(a.TypeStr)&&this.properties.push([Fb.pInt(a.Type),Fb.pString(a.Value),Fb.pString(a.TypeStr)])},this),Fb.isNonEmptyArray(a.Tags)&&(this.tags=a.Tags.join(",")),b=!0),b},v.prototype.srcAttr=function(){return Sb.link().emptyContactPic()},v.prototype.generateUid=function(){return""+this.idContact},v.prototype.lineAsCcc=function(){var a=[];return this.deleted()&&a.push("deleted"),this.selected()&&a.push("selected"),this.checked()&&a.push("checked"),this.focused()&&a.push("focused"),a.join(" ")},x.prototype.parse=function(a){var b=!1;return a&&"Object/Tag"===a["@Object"]&&(this.idContact=Fb.pInt(a.IdContactTag),this.name(Fb.pString(a.Name)),this.readOnly=!!a.ReadOnly,b=!0),b},x.prototype.filterHelper=function(a){return-1!==this.name().toLowerCase().indexOf(a.toLowerCase())},x.prototype.toLine=function(a){return(Fb.isUnd(a)?1:!a)?this.name():Fb.encodeHtml(this.name())},y.newInstanceFromJson=function(a){var b=new y;return b.initByJson(a)?b:null},y.prototype.mimeType="",y.prototype.fileName="",y.prototype.estimatedSize=0,y.prototype.friendlySize="",y.prototype.isInline=!1,y.prototype.isLinked=!1,y.prototype.cid="",y.prototype.cidWithOutTags="",y.prototype.contentLocation="",y.prototype.download="",y.prototype.folder="",y.prototype.uid="",y.prototype.mimeIndex="",y.prototype.initByJson=function(a){var b=!1;return a&&"Object/Attachment"===a["@Object"]&&(this.mimeType=(a.MimeType||"").toLowerCase(),this.fileName=a.FileName,this.estimatedSize=Fb.pInt(a.EstimatedSize),this.isInline=!!a.IsInline,this.isLinked=!!a.IsLinked,this.cid=a.CID,this.contentLocation=a.ContentLocation,this.download=a.Download,this.folder=a.Folder,this.uid=a.Uid,this.mimeIndex=a.MimeIndex,this.friendlySize=Fb.friendlySize(this.estimatedSize),this.cidWithOutTags=this.cid.replace(/^<+/,"").replace(/>+$/,""),b=!0),b},y.prototype.isImage=function(){return-1<Fb.inArray(this.mimeType.toLowerCase(),["image/png","image/jpg","image/jpeg","image/gif"])},y.prototype.isText=function(){return"text/"===this.mimeType.substr(0,5)&&-1===Fb.inArray(this.mimeType,["text/html"])},y.prototype.isPdf=function(){return Ib.bAllowPdfPreview&&"application/pdf"===this.mimeType},y.prototype.linkDownload=function(){return Sb.link().attachmentDownload(this.download)},y.prototype.linkPreview=function(){return Sb.link().attachmentPreview(this.download)},y.prototype.linkPreviewAsPlain=function(){return Sb.link().attachmentPreviewAsPlain(this.download)},y.prototype.generateTransferDownloadUrl=function(){var b=this.linkDownload();return"http"!==b.substr(0,4)&&(b=a.location.protocol+"//"+a.location.host+a.location.pathname+b),this.mimeType+":"+this.fileName+":"+b},y.prototype.eventDragStart=function(a,b){var c=b.originalEvent||b;return a&&c&&c.dataTransfer&&c.dataTransfer.setData&&c.dataTransfer.setData("DownloadURL",this.generateTransferDownloadUrl()),!0},y.prototype.iconClass=function(){var a=this.mimeType.toLocaleString().split("/"),b="icon-file";return a&&a[1]&&("image"===a[0]?b="icon-file-image":"text"===a[0]?b="icon-file-text":"audio"===a[0]?b="icon-file-music":"video"===a[0]?b="icon-file-movie":-1<Fb.inArray(a[1],["zip","7z","tar","rar","gzip","bzip","bzip2","x-zip","x-7z","x-rar","x-tar","x-gzip","x-bzip","x-bzip2","x-zip-compressed","x-7z-compressed","x-rar-compressed"])?b="icon-file-zip":-1<Fb.inArray(a[1],["rtf","msword","vnd.msword","vnd.openxmlformats-officedocument.wordprocessingml.document","vnd.openxmlformats-officedocument.wordprocessingml.template","vnd.ms-word.document.macroEnabled.12","vnd.ms-word.template.macroEnabled.12"])?b="icon-file-text":-1<Fb.inArray(a[1],["excel","ms-excel","vnd.ms-excel","vnd.openxmlformats-officedocument.spreadsheetml.sheet","vnd.openxmlformats-officedocument.spreadsheetml.template","vnd.ms-excel.sheet.macroEnabled.12","vnd.ms-excel.template.macroEnabled.12","vnd.ms-excel.addin.macroEnabled.12","vnd.ms-excel.sheet.binary.macroEnabled.12"])?b="icon-file-excel":-1<Fb.inArray(a[1],["powerpoint","ms-powerpoint","vnd.ms-powerpoint","vnd.openxmlformats-officedocument.presentationml.presentation","vnd.openxmlformats-officedocument.presentationml.template","vnd.openxmlformats-officedocument.presentationml.slideshow","vnd.ms-powerpoint.addin.macroEnabled.12","vnd.ms-powerpoint.presentation.macroEnabled.12","vnd.ms-powerpoint.template.macroEnabled.12","vnd.ms-powerpoint.slideshow.macroEnabled.12"])&&(b="icon-file-chart-graph")),b},z.prototype.id="",z.prototype.isInline=!1,z.prototype.isLinked=!1,z.prototype.CID="",z.prototype.contentLocation="",z.prototype.fromMessage=!1,z.prototype.cancel=Fb.emptyFunction,z.prototype.initByUploadJson=function(a){var b=!1;return a&&(this.fileName(a.Name),this.size(Fb.isUnd(a.Size)?0:Fb.pInt(a.Size)),this.tempName(Fb.isUnd(a.TempName)?"":a.TempName),this.isInline=!1,b=!0),b},A.newInstanceFromJson=function(a){var b=new A;return b.initByJson(a)?b:null},A.calculateFullFromatDateValue=function(a){return f.unix(a).format("LLL")},A.emailsToLine=function(a,b,c){var d=[],e=0,f=0;if(Fb.isNonEmptyArray(a))for(e=0,f=a.length;f>e;e++)d.push(a[e].toLine(b,c));return d.join(", ")},A.initEmailsFromJson=function(a){var b=0,c=0,d=null,e=[];if(Fb.isNonEmptyArray(a))for(b=0,c=a.length;c>b;b++)d=u.newInstanceFromJson(a[b]),d&&e.push(d);return e},A.replyHelper=function(a,b,c){if(a&&0<a.length)for(var d=0,e=a.length;e>d;d++)Fb.isUnd(b[a[d].email])&&(b[a[d].email]=!0,c.push(a[d]))},A.prototype.clear=function(){this.folderFullNameRaw="",this.uid="",this.hash="",this.requestHash="",this.subject(""),this.size(0),this.dateTimeStampInUTC(0),this.priority(Db.MessagePriority.Normal),this.fromEmailString(""),this.toEmailsString(""),this.senderEmailsString(""),this.emails=[],this.from=[],this.to=[],this.cc=[],this.bcc=[],this.replyTo=[],this.deliveredTo=[],this.newForAnimation(!1),this.deleted(!1),this.unseen(!1),this.flagged(!1),this.answered(!1),this.forwarded(!1),this.isReadReceipt(!1),this.selected(!1),this.checked(!1),this.hasAttachments(!1),this.attachmentsMainType(""),this.body=null,this.isRtl(!1),this.isHtml(!1),this.hasImages(!1),this.attachments([]),this.isPgpSigned(!1),this.isPgpEncrypted(!1),this.pgpSignedVerifyStatus(Db.SignedVerifyStatus.None),this.pgpSignedVerifyUser(""),this.priority(Db.MessagePriority.Normal),this.readReceipt(""),this.aDraftInfo=[],this.sMessageId="",this.sInReplyTo="",this.sReferences="",this.parentUid(0),this.threads([]),this.threadsLen(0),this.hasUnseenSubMessage(!1),this.hasFlaggedSubMessage(!1),this.lastInCollapsedThread(!1),this.lastInCollapsedThreadLoading(!1)},A.prototype.computeSenderEmail=function(){var a=Sb.data().sentFolder(),b=Sb.data().draftFolder();this.senderEmailsString(this.folderFullNameRaw===a||this.folderFullNameRaw===b?this.toEmailsString():this.fromEmailString())},A.prototype.initByJson=function(a){var b=!1;return a&&"Object/Message"===a["@Object"]&&(this.folderFullNameRaw=a.Folder,this.uid=a.Uid,this.hash=a.Hash,this.requestHash=a.RequestHash,this.size(Fb.pInt(a.Size)),this.from=A.initEmailsFromJson(a.From),this.to=A.initEmailsFromJson(a.To),this.cc=A.initEmailsFromJson(a.Cc),this.bcc=A.initEmailsFromJson(a.Bcc),this.replyTo=A.initEmailsFromJson(a.ReplyTo),this.deliveredTo=A.initEmailsFromJson(a.DeliveredTo),this.subject(a.Subject),this.dateTimeStampInUTC(Fb.pInt(a.DateTimeStampInUTC)),this.hasAttachments(!!a.HasAttachments),this.attachmentsMainType(a.AttachmentsMainType),this.fromEmailString(A.emailsToLine(this.from,!0)),this.toEmailsString(A.emailsToLine(this.to,!0)),this.parentUid(Fb.pInt(a.ParentThread)),this.threads(Fb.isArray(a.Threads)?a.Threads:[]),this.threadsLen(Fb.pInt(a.ThreadsLen)),this.initFlagsByJson(a),this.computeSenderEmail(),b=!0),b},A.prototype.initUpdateByMessageJson=function(a){var b=!1,c=Db.MessagePriority.Normal;return a&&"Object/Message"===a["@Object"]&&(c=Fb.pInt(a.Priority),this.priority(-1<Fb.inArray(c,[Db.MessagePriority.High,Db.MessagePriority.Low])?c:Db.MessagePriority.Normal),this.aDraftInfo=a.DraftInfo,this.sMessageId=a.MessageId,this.sInReplyTo=a.InReplyTo,this.sReferences=a.References,Sb.data().capaOpenPGP()&&(this.isPgpSigned(!!a.PgpSigned),this.isPgpEncrypted(!!a.PgpEncrypted)),this.hasAttachments(!!a.HasAttachments),this.attachmentsMainType(a.AttachmentsMainType),this.foundedCIDs=Fb.isArray(a.FoundedCIDs)?a.FoundedCIDs:[],this.attachments(this.initAttachmentsFromJson(a.Attachments)),this.readReceipt(a.ReadReceipt||""),this.computeSenderEmail(),b=!0),b},A.prototype.initAttachmentsFromJson=function(a){var b=0,c=0,d=null,e=[];if(a&&"Collection/AttachmentCollection"===a["@Object"]&&Fb.isNonEmptyArray(a["@Collection"]))for(b=0,c=a["@Collection"].length;c>b;b++)d=y.newInstanceFromJson(a["@Collection"][b]),d&&(""!==d.cidWithOutTags&&0<this.foundedCIDs.length&&0<=Fb.inArray(d.cidWithOutTags,this.foundedCIDs)&&(d.isLinked=!0),e.push(d));return e},A.prototype.initFlagsByJson=function(a){var b=!1;return a&&"Object/Message"===a["@Object"]&&(this.unseen(!a.IsSeen),this.flagged(!!a.IsFlagged),this.answered(!!a.IsAnswered),this.forwarded(!!a.IsForwarded),this.isReadReceipt(!!a.IsReadReceipt),b=!0),b},A.prototype.fromToLine=function(a,b){return A.emailsToLine(this.from,a,b)},A.prototype.toToLine=function(a,b){return A.emailsToLine(this.to,a,b)},A.prototype.ccToLine=function(a,b){return A.emailsToLine(this.cc,a,b)},A.prototype.bccToLine=function(a,b){return A.emailsToLine(this.bcc,a,b)},A.prototype.lineAsCcc=function(){var a=[];if(this.deleted()&&a.push("deleted"),this.selected()&&a.push("selected"),this.checked()&&a.push("checked"),this.flagged()&&a.push("flagged"),this.unseen()&&a.push("unseen"),this.answered()&&a.push("answered"),this.forwarded()&&a.push("forwarded"),this.focused()&&a.push("focused"),this.hasAttachments())switch(a.push("withAttachments"),this.attachmentsMainType()){case"image":a.push("imageOnlyAttachments");break;case"archive":a.push("archiveOnlyAttachments")}return this.newForAnimation()&&a.push("new"),""===this.subject()&&a.push("emptySubject"),0<this.parentUid()&&a.push("hasParentMessage"),0<this.threadsLen()&&0===this.parentUid()&&a.push("hasChildrenMessage"),this.hasUnseenSubMessage()&&a.push("hasUnseenSubMessage"),this.hasFlaggedSubMessage()&&a.push("hasFlaggedSubMessage"),a.join(" ")},A.prototype.hasVisibleAttachments=function(){return!!h.find(this.attachments(),function(a){return!a.isLinked})},A.prototype.findAttachmentByCid=function(a){var b=null,c=this.attachments();return Fb.isNonEmptyArray(c)&&(a=a.replace(/^<+/,"").replace(/>+$/,""),b=h.find(c,function(b){return a===b.cidWithOutTags})),b||null},A.prototype.findAttachmentByContentLocation=function(a){var b=null,c=this.attachments();return Fb.isNonEmptyArray(c)&&(b=h.find(c,function(b){return a===b.contentLocation})),b||null},A.prototype.messageId=function(){return this.sMessageId},A.prototype.inReplyTo=function(){return this.sInReplyTo},A.prototype.references=function(){return this.sReferences},A.prototype.fromAsSingleEmail=function(){return Fb.isArray(this.from)&&this.from[0]?this.from[0].email:""},A.prototype.viewLink=function(){return Sb.link().messageViewLink(this.requestHash)},A.prototype.downloadLink=function(){return Sb.link().messageDownloadLink(this.requestHash)},A.prototype.replyEmails=function(a){var b=[],c=Fb.isUnd(a)?{}:a;return A.replyHelper(this.replyTo,c,b),0===b.length&&A.replyHelper(this.from,c,b),b},A.prototype.replyAllEmails=function(a){var b=[],c=[],d=Fb.isUnd(a)?{}:a;return A.replyHelper(this.replyTo,d,b),0===b.length&&A.replyHelper(this.from,d,b),A.replyHelper(this.to,d,b),A.replyHelper(this.cc,d,c),[b,c]},A.prototype.textBodyToString=function(){return this.body?this.body.html():""},A.prototype.attachmentsToStringLine=function(){var a=h.map(this.attachments(),function(a){return a.fileName+" ("+a.friendlySize+")"});return a&&0<a.length?a.join(", "):""},A.prototype.getDataForWindowPopup=function(){return{popupFrom:this.fromToLine(!1),popupTo:this.toToLine(!1),popupCc:this.ccToLine(!1),popupBcc:this.bccToLine(!1),popupSubject:this.subject(),popupDate:this.fullFormatDateValue(),popupAttachments:this.attachmentsToStringLine(),popupBody:this.textBodyToString()}},A.prototype.viewPopupMessage=function(c){Fb.windowPopupKnockout(this.getDataForWindowPopup(),"PopupsWindowSimpleMessage",this.subject(),function(d){d&&d.document&&d.document.body&&(b("img.lazy",d.document.body).each(function(a,c){var d=b(c),e=d.data("original"),f=d.attr("src");a>=0&&e&&!f&&d.attr("src",e)}),c&&a.setTimeout(function(){d.print()},100))})},A.prototype.printMessage=function(){this.viewPopupMessage(!0)},A.prototype.generateUid=function(){return this.folderFullNameRaw+"/"+this.uid},A.prototype.populateByMessageListItem=function(a){return this.folderFullNameRaw=a.folderFullNameRaw,this.uid=a.uid,this.hash=a.hash,this.requestHash=a.requestHash,this.subject(a.subject()),this.size(a.size()),this.dateTimeStampInUTC(a.dateTimeStampInUTC()),this.priority(a.priority()),this.fromEmailString(a.fromEmailString()),this.toEmailsString(a.toEmailsString()),this.emails=a.emails,this.from=a.from,this.to=a.to,this.cc=a.cc,this.bcc=a.bcc,this.replyTo=a.replyTo,this.deliveredTo=a.deliveredTo,this.unseen(a.unseen()),this.flagged(a.flagged()),this.answered(a.answered()),this.forwarded(a.forwarded()),this.isReadReceipt(a.isReadReceipt()),this.selected(a.selected()),this.checked(a.checked()),this.hasAttachments(a.hasAttachments()),this.attachmentsMainType(a.attachmentsMainType()),this.moment(a.moment()),this.body=null,this.priority(Db.MessagePriority.Normal),this.aDraftInfo=[],this.sMessageId="",this.sInReplyTo="",this.sReferences="",this.parentUid(a.parentUid()),this.threads(a.threads()),this.threadsLen(a.threadsLen()),this.computeSenderEmail(),this},A.prototype.showExternalImages=function(a){this.body&&this.body.data("rl-has-images")&&(a=Fb.isUnd(a)?!1:a,this.hasImages(!1),this.body.data("rl-has-images",!1),b("[data-x-src]",this.body).each(function(){a&&b(this).is("img")?b(this).addClass("lazy").attr("data-original",b(this).attr("data-x-src")).removeAttr("data-x-src"):b(this).attr("src",b(this).attr("data-x-src")).removeAttr("data-x-src")}),b("[data-x-style-url]",this.body).each(function(){var a=Fb.trim(b(this).attr("style"));a=""===a?"":";"===a.substr(-1)?a+" ":a+"; ",b(this).attr("style",a+b(this).attr("data-x-style-url")).removeAttr("data-x-style-url")}),a&&(b("img.lazy",this.body).addClass("lazy-inited").lazyload({threshold:400,effect:"fadeIn",skip_invisible:!1,container:b(".RL-MailMessageView .messageView .messageItem .content")[0]}),Pb.resize()),Fb.windowResize(500))},A.prototype.showInternalImages=function(a){if(this.body&&!this.body.data("rl-init-internal-images")){this.body.data("rl-init-internal-images",!0),a=Fb.isUnd(a)?!1:a;var c=this;b("[data-x-src-cid]",this.body).each(function(){var d=c.findAttachmentByCid(b(this).attr("data-x-src-cid"));d&&d.download&&(a&&b(this).is("img")?b(this).addClass("lazy").attr("data-original",d.linkPreview()):b(this).attr("src",d.linkPreview()))}),b("[data-x-src-location]",this.body).each(function(){var d=c.findAttachmentByContentLocation(b(this).attr("data-x-src-location"));d||(d=c.findAttachmentByCid(b(this).attr("data-x-src-location"))),d&&d.download&&(a&&b(this).is("img")?b(this).addClass("lazy").attr("data-original",d.linkPreview()):b(this).attr("src",d.linkPreview()))}),b("[data-x-style-cid]",this.body).each(function(){var a="",d="",e=c.findAttachmentByCid(b(this).attr("data-x-style-cid"));e&&e.linkPreview&&(d=b(this).attr("data-x-style-cid-name"),""!==d&&(a=Fb.trim(b(this).attr("style")),a=""===a?"":";"===a.substr(-1)?a+" ":a+"; ",b(this).attr("style",a+d+": url('"+e.linkPreview()+"')")))}),a&&!function(a,b){h.delay(function(){a.addClass("lazy-inited").lazyload({threshold:400,effect:"fadeIn",skip_invisible:!1,container:b})},300)}(b("img.lazy",c.body),b(".RL-MailMessageView .messageView .messageItem .content")[0]),Fb.windowResize(500)}},A.prototype.storeDataToDom=function(){this.body&&(this.body.data("rl-is-rtl",!!this.isRtl()),this.body.data("rl-is-html",!!this.isHtml()),this.body.data("rl-has-images",!!this.hasImages()),this.body.data("rl-plain-raw",this.plainRaw),Sb.data().capaOpenPGP()&&(this.body.data("rl-plain-pgp-signed",!!this.isPgpSigned()),this.body.data("rl-plain-pgp-encrypted",!!this.isPgpEncrypted()),this.body.data("rl-pgp-verify-status",this.pgpSignedVerifyStatus()),this.body.data("rl-pgp-verify-user",this.pgpSignedVerifyUser())))},A.prototype.storePgpVerifyDataToDom=function(){this.body&&Sb.data().capaOpenPGP()&&(this.body.data("rl-pgp-verify-status",this.pgpSignedVerifyStatus()),this.body.data("rl-pgp-verify-user",this.pgpSignedVerifyUser()))},A.prototype.fetchDataToDom=function(){this.body&&(this.isRtl(!!this.body.data("rl-is-rtl")),this.isHtml(!!this.body.data("rl-is-html")),this.hasImages(!!this.body.data("rl-has-images")),this.plainRaw=Fb.pString(this.body.data("rl-plain-raw")),Sb.data().capaOpenPGP()?(this.isPgpSigned(!!this.body.data("rl-plain-pgp-signed")),this.isPgpEncrypted(!!this.body.data("rl-plain-pgp-encrypted")),this.pgpSignedVerifyStatus(this.body.data("rl-pgp-verify-status")),this.pgpSignedVerifyUser(this.body.data("rl-pgp-verify-user"))):(this.isPgpSigned(!1),this.isPgpEncrypted(!1),this.pgpSignedVerifyStatus(Db.SignedVerifyStatus.None),this.pgpSignedVerifyUser("")))},A.prototype.verifyPgpSignedClearMessage=function(){if(this.isPgpSigned()){var c=[],d=null,e=this.from&&this.from[0]&&this.from[0].email?this.from[0].email:"",f=Sb.data().findPublicKeysByEmail(e),g=null,i=null,j="";this.pgpSignedVerifyStatus(Db.SignedVerifyStatus.Error),this.pgpSignedVerifyUser("");try{d=a.openpgp.cleartext.readArmored(this.plainRaw),d&&d.getText&&(this.pgpSignedVerifyStatus(f.length?Db.SignedVerifyStatus.Unverified:Db.SignedVerifyStatus.UnknownPublicKeys),c=d.verify(f),c&&0<c.length&&(g=h.find(c,function(a){return a&&a.keyid&&a.valid}),g&&(i=Sb.data().findPublicKeyByHex(g.keyid.toHex()),i&&(j=d.getText(),this.pgpSignedVerifyStatus(Db.SignedVerifyStatus.Success),this.pgpSignedVerifyUser(i.user),j=Tb.empty().append(b('<pre class="b-plain-openpgp signed verified"></pre>').text(j)).html(),Tb.empty(),this.replacePlaneTextBody(j)))))}catch(k){}this.storePgpVerifyDataToDom()}},A.prototype.decryptPgpEncryptedMessage=function(c){if(this.isPgpEncrypted()){var d=[],e=null,f=null,g=this.from&&this.from[0]&&this.from[0].email?this.from[0].email:"",i=Sb.data().findPublicKeysByEmail(g),j=Sb.data().findSelfPrivateKey(c),k=null,l=null,m="";this.pgpSignedVerifyStatus(Db.SignedVerifyStatus.Error),this.pgpSignedVerifyUser(""),j||this.pgpSignedVerifyStatus(Db.SignedVerifyStatus.UnknownPrivateKey);try{e=a.openpgp.message.readArmored(this.plainRaw),e&&j&&e.decrypt&&(this.pgpSignedVerifyStatus(Db.SignedVerifyStatus.Unverified),f=e.decrypt(j),f&&(d=f.verify(i),d&&0<d.length&&(k=h.find(d,function(a){return a&&a.keyid&&a.valid}),k&&(l=Sb.data().findPublicKeyByHex(k.keyid.toHex()),l&&(this.pgpSignedVerifyStatus(Db.SignedVerifyStatus.Success),this.pgpSignedVerifyUser(l.user)))),m=f.getText(),m=Tb.empty().append(b('<pre class="b-plain-openpgp signed verified"></pre>').text(m)).html(),Tb.empty(),this.replacePlaneTextBody(m)))}catch(n){}this.storePgpVerifyDataToDom()}},A.prototype.replacePlaneTextBody=function(a){this.body&&this.body.html(a).addClass("b-text-part plain")},A.prototype.flagHash=function(){return[this.deleted(),this.unseen(),this.flagged(),this.answered(),this.forwarded(),this.isReadReceipt()].join("")},B.newInstanceFromJson=function(a){var b=new B;return b.initByJson(a)?b.initComputed():null},B.prototype.initComputed=function(){return this.hasSubScribedSubfolders=c.computed(function(){return!!h.find(this.subFolders(),function(a){return a.subScribed()&&!a.isSystemFolder()})},this),this.canBeEdited=c.computed(function(){return Db.FolderType.User===this.type()&&this.existen&&this.selectable},this),this.visible=c.computed(function(){var a=this.subScribed(),b=this.hasSubScribedSubfolders();return a||b&&(!this.existen||!this.selectable)},this),this.isSystemFolder=c.computed(function(){return Db.FolderType.User!==this.type()},this),this.hidden=c.computed(function(){var a=this.isSystemFolder(),b=this.hasSubScribedSubfolders();return a&&!b||!this.selectable&&!b},this),this.selectableForFolderList=c.computed(function(){return!this.isSystemFolder()&&this.selectable},this),this.messageCountAll=c.computed({read:this.privateMessageCountAll,write:function(a){Fb.isPosNumeric(a,!0)?this.privateMessageCountAll(a):this.privateMessageCountAll.valueHasMutated()},owner:this}),this.messageCountUnread=c.computed({read:this.privateMessageCountUnread,write:function(a){Fb.isPosNumeric(a,!0)?this.privateMessageCountUnread(a):this.privateMessageCountUnread.valueHasMutated()
},owner:this}),this.printableUnreadCount=c.computed(function(){var a=this.messageCountAll(),b=this.messageCountUnread(),c=this.type();if(Db.FolderType.Inbox===c&&Sb.data().foldersInboxUnreadCount(b),a>0){if(Db.FolderType.Draft===c)return""+a;if(b>0&&Db.FolderType.Trash!==c&&Db.FolderType.Archive!==c&&Db.FolderType.SentItems!==c)return""+b}return""},this),this.canBeDeleted=c.computed(function(){var a=this.isSystemFolder();return!a&&0===this.subFolders().length&&"INBOX"!==this.fullNameRaw},this),this.canBeSubScribed=c.computed(function(){return!this.isSystemFolder()&&this.selectable&&"INBOX"!==this.fullNameRaw},this),this.visible.subscribe(function(){Fb.timeOutAction("folder-list-folder-visibility-change",function(){Pb.trigger("folder-list-folder-visibility-change")},100)}),this.localName=c.computed(function(){Ib.langChangeTrigger();var a=this.type(),b=this.name();if(this.isSystemFolder())switch(a){case Db.FolderType.Inbox:b=Fb.i18n("FOLDER_LIST/INBOX_NAME");break;case Db.FolderType.SentItems:b=Fb.i18n("FOLDER_LIST/SENT_NAME");break;case Db.FolderType.Draft:b=Fb.i18n("FOLDER_LIST/DRAFTS_NAME");break;case Db.FolderType.Spam:b=Fb.i18n("FOLDER_LIST/SPAM_NAME");break;case Db.FolderType.Trash:b=Fb.i18n("FOLDER_LIST/TRASH_NAME");break;case Db.FolderType.Archive:b=Fb.i18n("FOLDER_LIST/ARCHIVE_NAME")}return b},this),this.manageFolderSystemName=c.computed(function(){Ib.langChangeTrigger();var a="",b=this.type(),c=this.name();if(this.isSystemFolder())switch(b){case Db.FolderType.Inbox:a="("+Fb.i18n("FOLDER_LIST/INBOX_NAME")+")";break;case Db.FolderType.SentItems:a="("+Fb.i18n("FOLDER_LIST/SENT_NAME")+")";break;case Db.FolderType.Draft:a="("+Fb.i18n("FOLDER_LIST/DRAFTS_NAME")+")";break;case Db.FolderType.Spam:a="("+Fb.i18n("FOLDER_LIST/SPAM_NAME")+")";break;case Db.FolderType.Trash:a="("+Fb.i18n("FOLDER_LIST/TRASH_NAME")+")";break;case Db.FolderType.Archive:a="("+Fb.i18n("FOLDER_LIST/ARCHIVE_NAME")+")"}return(""!==a&&"("+c+")"===a||"(inbox)"===a.toLowerCase())&&(a=""),a},this),this.collapsed=c.computed({read:function(){return!this.hidden()&&this.collapsedPrivate()},write:function(a){this.collapsedPrivate(a)},owner:this}),this.hasUnreadMessages=c.computed(function(){return 0<this.messageCountUnread()},this),this.hasSubScribedUnreadMessagesSubfolders=c.computed(function(){return!!h.find(this.subFolders(),function(a){return a.hasUnreadMessages()||a.hasSubScribedUnreadMessagesSubfolders()})},this),this},B.prototype.fullName="",B.prototype.fullNameRaw="",B.prototype.fullNameHash="",B.prototype.delimiter="",B.prototype.namespace="",B.prototype.deep=0,B.prototype.interval=0,B.prototype.collapsedCss=function(){return this.hasSubScribedSubfolders()?this.collapsed()?"icon-right-mini e-collapsed-sign":"icon-down-mini e-collapsed-sign":"icon-none e-collapsed-sign"},B.prototype.initByJson=function(a){var b=!1;return a&&"Object/Folder"===a["@Object"]&&(this.name(a.Name),this.delimiter=a.Delimiter,this.fullName=a.FullName,this.fullNameRaw=a.FullNameRaw,this.fullNameHash=a.FullNameHash,this.deep=a.FullNameRaw.split(this.delimiter).length-1,this.selectable=!!a.IsSelectable,this.existen=!!a.IsExisten,this.subScribed(!!a.IsSubscribed),this.type("INBOX"===this.fullNameRaw?Db.FolderType.Inbox:Db.FolderType.User),b=!0),b},B.prototype.printableFullName=function(){return this.fullName.split(this.delimiter).join(" / ")},C.prototype.email="",C.prototype.changeAccountLink=function(){return Sb.link().change(this.email)},D.prototype.formattedName=function(){var a=this.name();return""===a?this.email():a+" <"+this.email()+">"},D.prototype.formattedNameForCompose=function(){var a=this.name();return""===a?this.email():a+" ("+this.email()+")"},D.prototype.formattedNameForEmail=function(){var a=this.name();return""===a?this.email():'"'+Fb.quoteName(a)+'" <'+this.email()+">"},F.prototype.deleteCondition=function(a){this.conditions.remove(a)},F.prototype.addCondition=function(){this.conditions.push(new E)},F.prototype.parse=function(a){var b=!1;return a&&"Object/Filter"===a["@Object"]&&(this.name(Fb.pString(a.Name)),b=!0),b},G.prototype.index=0,G.prototype.id="",G.prototype.guid="",G.prototype.user="",G.prototype.email="",G.prototype.armor="",G.prototype.isPrivate=!1,Fb.extendAsViewModel("PopupsFolderClearViewModel",H),H.prototype.clearPopup=function(){this.clearingProcess(!1),this.selectedFolder(null)},H.prototype.onShow=function(a){this.clearPopup(),a&&this.selectedFolder(a)},Fb.extendAsViewModel("PopupsFolderCreateViewModel",I),I.prototype.sNoParentText="",I.prototype.simpleFolderNameValidation=function(a){return/^[^\\\/]+$/g.test(Fb.trim(a))},I.prototype.clearPopup=function(){this.folderName(""),this.selectedParentValue(""),this.folderName.focused(!1)},I.prototype.onShow=function(){this.clearPopup()},I.prototype.onFocus=function(){this.folderName.focused(!0)},Fb.extendAsViewModel("PopupsFolderSystemViewModel",J),J.prototype.sChooseOnText="",J.prototype.sUnuseText="",J.prototype.onShow=function(a){var b="";switch(a=Fb.isUnd(a)?Db.SetSystemFoldersNotification.None:a){case Db.SetSystemFoldersNotification.Sent:b=Fb.i18n("POPUPS_SYSTEM_FOLDERS/NOTIFICATION_SENT");break;case Db.SetSystemFoldersNotification.Draft:b=Fb.i18n("POPUPS_SYSTEM_FOLDERS/NOTIFICATION_DRAFTS");break;case Db.SetSystemFoldersNotification.Spam:b=Fb.i18n("POPUPS_SYSTEM_FOLDERS/NOTIFICATION_SPAM");break;case Db.SetSystemFoldersNotification.Trash:b=Fb.i18n("POPUPS_SYSTEM_FOLDERS/NOTIFICATION_TRASH");break;case Db.SetSystemFoldersNotification.Archive:b=Fb.i18n("POPUPS_SYSTEM_FOLDERS/NOTIFICATION_ARCHIVE")}this.notification(b)},Fb.extendAsViewModel("PopupsComposeViewModel",K),K.prototype.openOpenPgpPopup=function(){if(this.capaOpenPGP()&&this.oEditor&&!this.oEditor.isHtml()){var a=this;Lb.showScreenPopup(R,[function(b){a.editor(function(a){a.setPlain(b)})},this.oEditor.getData(),this.currentIdentityResultEmail(),this.to(),this.cc(),this.bcc()])}},K.prototype.reloadDraftFolder=function(){var a=Sb.data().draftFolder();""!==a&&(Sb.cache().setFolderHash(a,""),Sb.data().currentFolderFullNameRaw()===a?Sb.reloadMessageList(!0):Sb.folderInformation(a))},K.prototype.findIdentityIdByMessage=function(a,b){var c={},d="",e=function(a){return a&&a.email&&c[a.email]?(d=c[a.email],!0):!1};if(this.bCapaAdditionalIdentities&&h.each(this.identities(),function(a){c[a.email()]=a.id}),c[Sb.data().accountEmail()]=Sb.data().accountEmail(),b)switch(a){case Db.ComposeType.Empty:d=Sb.data().accountEmail();break;case Db.ComposeType.Reply:case Db.ComposeType.ReplyAll:case Db.ComposeType.Forward:case Db.ComposeType.ForwardAsAttachment:h.find(h.union(b.to,b.cc,b.bcc,b.deliveredTo),e);break;case Db.ComposeType.Draft:h.find(h.union(b.from,b.replyTo),e)}else d=Sb.data().accountEmail();return d},K.prototype.selectIdentity=function(a){a&&this.currentIdentityID(a.optValue)},K.prototype.formattedFrom=function(a){var b=Sb.data().displayName(),c=Sb.data().accountEmail();return""===b?c:(Fb.isUnd(a)?1:!a)?b+" ("+c+")":'"'+Fb.quoteName(b)+'" <'+c+">"},K.prototype.sendMessageResponse=function(b,c){var d=!1,e="";this.sending(!1),Db.StorageResultType.Success===b&&c&&c.Result&&(d=!0,this.modalVisibility()&&Fb.delegateRun(this,"closeCommand")),this.modalVisibility()&&!d&&(c&&Db.Notification.CantSaveMessage===c.ErrorCode?(this.sendSuccessButSaveError(!0),a.alert(Fb.trim(Fb.i18n("COMPOSE/SAVED_ERROR_ON_SEND")))):(e=Fb.getNotification(c&&c.ErrorCode?c.ErrorCode:Db.Notification.CantSendMessage,c&&c.ErrorMessage?c.ErrorMessage:""),this.sendError(!0),a.alert(e||Fb.getNotification(Db.Notification.CantSendMessage)))),this.reloadDraftFolder()},K.prototype.saveMessageResponse=function(b,c){var d=!1,e=null;this.saving(!1),Db.StorageResultType.Success===b&&c&&c.Result&&c.Result.NewFolder&&c.Result.NewUid&&(this.bFromDraft&&(e=Sb.data().message(),e&&this.draftFolder()===e.folderFullNameRaw&&this.draftUid()===e.uid&&Sb.data().message(null)),this.draftFolder(c.Result.NewFolder),this.draftUid(c.Result.NewUid),this.modalVisibility()&&(this.savedTime(Math.round((new a.Date).getTime()/1e3)),this.savedOrSendingText(0<this.savedTime()?Fb.i18n("COMPOSE/SAVED_TIME",{TIME:f.unix(this.savedTime()-1).format("LT")}):""),d=!0,this.bFromDraft&&Sb.cache().setFolderHash(this.draftFolder(),""))),this.modalVisibility()||d||(this.savedError(!0),this.savedOrSendingText(Fb.getNotification(Db.Notification.CantSaveMessage))),this.reloadDraftFolder()},K.prototype.onHide=function(){this.reset(),Lb.routeOn()},K.prototype.convertSignature=function(a,b){if(""!==a){var c=!1;":HTML:"===a.substr(0,6)&&(c=!0,a=a.substr(6)),a=a.replace(/[\r]/,""),b=Fb.pString(b),""!==b&&(a=a.replace(/{{FROM}}/,b)),a=a.replace(/[\s]{1,2}{{FROM}}/,"{{FROM}}"),a=a.replace(/{{FROM}}/,""),a=a.replace(/{{DATE}}/,f().format("llll")),c||(a=Fb.convertPlainTextToHtml(a))}return a},K.prototype.editor=function(a){if(a){var b=this;!this.oEditor&&this.composeEditorArea()?h.delay(function(){b.oEditor=new l(b.composeEditorArea(),null,function(){a(b.oEditor)},function(a){b.isHtml(!!a)})},300):this.oEditor&&a(this.oEditor)}},K.prototype.onShow=function(a,c,d){Lb.routeOff();var e=this,f="",g="",i="",j="",k="",l=null,m="",n="",o=[],p={},q=Sb.data().accountEmail(),r=Sb.data().signature(),s=Sb.data().signatureToAll(),t=[],u=null,v=null,w=a||Db.ComposeType.Empty,x=function(a,b){for(var c=0,d=a.length,e=[];d>c;c++)e.push(a[c].toLine(!!b));return e.join(", ")};if(c=c||null,c&&Fb.isNormal(c)&&(v=Fb.isArray(c)&&1===c.length?c[0]:Fb.isArray(c)?null:c),null!==q&&(p[q]=!0,this.currentIdentityID(this.findIdentityIdByMessage(w,v))),this.reset(),Fb.isNonEmptyArray(d)&&this.to(x(d)),""!==w&&v){switch(j=v.fullFormatDateValue(),k=v.subject(),u=v.aDraftInfo,l=b(v.body).clone(),Fb.removeBlockquoteSwitcher(l),m=l.html(),w){case Db.ComposeType.Empty:break;case Db.ComposeType.Reply:this.to(x(v.replyEmails(p))),this.subject(Fb.replySubjectAdd("Re",k)),this.prepearMessageAttachments(v,w),this.aDraftInfo=["reply",v.uid,v.folderFullNameRaw],this.sInReplyTo=v.sMessageId,this.sReferences=Fb.trim(this.sInReplyTo+" "+v.sReferences);break;case Db.ComposeType.ReplyAll:o=v.replyAllEmails(p),this.to(x(o[0])),this.cc(x(o[1])),this.subject(Fb.replySubjectAdd("Re",k)),this.prepearMessageAttachments(v,w),this.aDraftInfo=["reply",v.uid,v.folderFullNameRaw],this.sInReplyTo=v.sMessageId,this.sReferences=Fb.trim(this.sInReplyTo+" "+v.references());break;case Db.ComposeType.Forward:this.subject(Fb.replySubjectAdd("Fwd",k)),this.prepearMessageAttachments(v,w),this.aDraftInfo=["forward",v.uid,v.folderFullNameRaw],this.sInReplyTo=v.sMessageId,this.sReferences=Fb.trim(this.sInReplyTo+" "+v.sReferences);break;case Db.ComposeType.ForwardAsAttachment:this.subject(Fb.replySubjectAdd("Fwd",k)),this.prepearMessageAttachments(v,w),this.aDraftInfo=["forward",v.uid,v.folderFullNameRaw],this.sInReplyTo=v.sMessageId,this.sReferences=Fb.trim(this.sInReplyTo+" "+v.sReferences);break;case Db.ComposeType.Draft:this.to(x(v.to)),this.cc(x(v.cc)),this.bcc(x(v.bcc)),this.bFromDraft=!0,this.draftFolder(v.folderFullNameRaw),this.draftUid(v.uid),this.subject(k),this.prepearMessageAttachments(v,w),this.aDraftInfo=Fb.isNonEmptyArray(u)&&3===u.length?u:null,this.sInReplyTo=v.sInReplyTo,this.sReferences=v.sReferences;break;case Db.ComposeType.EditAsNew:this.to(x(v.to)),this.cc(x(v.cc)),this.bcc(x(v.bcc)),this.subject(k),this.prepearMessageAttachments(v,w),this.aDraftInfo=Fb.isNonEmptyArray(u)&&3===u.length?u:null,this.sInReplyTo=v.sInReplyTo,this.sReferences=v.sReferences}switch(w){case Db.ComposeType.Reply:case Db.ComposeType.ReplyAll:f=v.fromToLine(!1,!0),n=Fb.i18n("COMPOSE/REPLY_MESSAGE_TITLE",{DATETIME:j,EMAIL:f}),m="<br /><br />"+n+":<blockquote><p>"+m+"</p></blockquote>";break;case Db.ComposeType.Forward:f=v.fromToLine(!1,!0),g=v.toToLine(!1,!0),i=v.ccToLine(!1,!0),m="<br /><br /><br />"+Fb.i18n("COMPOSE/FORWARD_MESSAGE_TOP_TITLE")+"<br />"+Fb.i18n("COMPOSE/FORWARD_MESSAGE_TOP_FROM")+": "+f+"<br />"+Fb.i18n("COMPOSE/FORWARD_MESSAGE_TOP_TO")+": "+g+(0<i.length?"<br />"+Fb.i18n("COMPOSE/FORWARD_MESSAGE_TOP_CC")+": "+i:"")+"<br />"+Fb.i18n("COMPOSE/FORWARD_MESSAGE_TOP_SENT")+": "+Fb.encodeHtml(j)+"<br />"+Fb.i18n("COMPOSE/FORWARD_MESSAGE_TOP_SUBJECT")+": "+Fb.encodeHtml(k)+"<br /><br />"+m;break;case Db.ComposeType.ForwardAsAttachment:m=""}s&&""!==r&&Db.ComposeType.EditAsNew!==w&&Db.ComposeType.Draft!==w&&(m=this.convertSignature(r,x(v.from,!0))+"<br />"+m),this.editor(function(a){a.setHtml(m,!1),v.isHtml()||a.modeToggle(!1)})}else Db.ComposeType.Empty===w?(m=this.convertSignature(r),this.editor(function(a){a.setHtml(m,!1),Db.EditorDefaultType.Html!==Sb.data().editorDefaultType()&&a.modeToggle(!1)})):Fb.isNonEmptyArray(c)&&h.each(c,function(a){e.addMessageAsAttachment(a)});t=this.getAttachmentsDownloadsForUpload(),Fb.isNonEmptyArray(t)&&Sb.remote().messageUploadAttachments(function(a,b){if(Db.StorageResultType.Success===a&&b&&b.Result){var c=null,d="";if(!e.viewModelVisibility())for(d in b.Result)b.Result.hasOwnProperty(d)&&(c=e.getAttachmentById(b.Result[d]),c&&c.tempName(d))}else e.setMessageAttachmentFailedDowbloadText()},t),this.triggerForResize()},K.prototype.onFocus=function(){""===this.to()?this.to.focusTrigger(!this.to.focusTrigger()):this.oEditor&&this.oEditor.focus(),this.triggerForResize()},K.prototype.editorResize=function(){this.oEditor&&this.oEditor.resize()},K.prototype.tryToClosePopup=function(){var a=this;Lb.showScreenPopup(V,[Fb.i18n("POPUPS_ASK/DESC_WANT_CLOSE_THIS_WINDOW"),function(){a.modalVisibility()&&Fb.delegateRun(a,"closeCommand")}])},K.prototype.onBuild=function(){this.initUploader();var a=this,c=null;j("ctrl+q, command+q",Db.KeyState.Compose,function(){return a.identitiesDropdownTrigger(!0),!1}),j("ctrl+s, command+s",Db.KeyState.Compose,function(){return a.saveCommand(),!1}),j("ctrl+enter, command+enter",Db.KeyState.Compose,function(){return a.sendCommand(),!1}),j("esc",Db.KeyState.Compose,function(){return a.tryToClosePopup(),!1}),Pb.on("resize",function(){a.triggerForResize()}),this.dropboxEnabled()&&(c=document.createElement("script"),c.type="text/javascript",c.src="https://www.dropbox.com/static/api/1/dropins.js",b(c).attr("id","dropboxjs").attr("data-app-key",Sb.settingsGet("DropboxApiKey")),document.body.appendChild(c))},K.prototype.getAttachmentById=function(a){for(var b=this.attachments(),c=0,d=b.length;d>c;c++)if(b[c]&&a===b[c].id)return b[c];return null},K.prototype.initUploader=function(){if(this.composeUploaderButton()){var a={},b=Fb.pInt(Sb.settingsGet("AttachmentLimit")),c=new g({action:Sb.link().upload(),name:"uploader",queueSize:2,multipleSizeLimit:50,disableFolderDragAndDrop:!1,clickElement:this.composeUploaderButton(),dragAndDropElement:this.composeUploaderDropPlace()});c?(c.on("onDragEnter",h.bind(function(){this.dragAndDropOver(!0)},this)).on("onDragLeave",h.bind(function(){this.dragAndDropOver(!1)},this)).on("onBodyDragEnter",h.bind(function(){this.dragAndDropVisible(!0)},this)).on("onBodyDragLeave",h.bind(function(){this.dragAndDropVisible(!1)},this)).on("onProgress",h.bind(function(b,c,d){var e=null;Fb.isUnd(a[b])?(e=this.getAttachmentById(b),e&&(a[b]=e)):e=a[b],e&&e.progress(" - "+Math.floor(c/d*100)+"%")},this)).on("onSelect",h.bind(function(a,d){this.dragAndDropOver(!1);var e=this,f=Fb.isUnd(d.FileName)?"":d.FileName.toString(),g=Fb.isNormal(d.Size)?Fb.pInt(d.Size):null,h=new z(a,f,g);return h.cancel=function(a){return function(){e.attachments.remove(function(b){return b&&b.id===a}),c&&c.cancel(a)}}(a),this.attachments.push(h),g>0&&b>0&&g>b?(h.error(Fb.i18n("UPLOAD/ERROR_FILE_IS_TOO_BIG")),!1):!0},this)).on("onStart",h.bind(function(b){var c=null;Fb.isUnd(a[b])?(c=this.getAttachmentById(b),c&&(a[b]=c)):c=a[b],c&&(c.waiting(!1),c.uploading(!0))},this)).on("onComplete",h.bind(function(b,c,d){var e="",f=null,g=null,h=this.getAttachmentById(b);g=c&&d&&d.Result&&d.Result.Attachment?d.Result.Attachment:null,f=d&&d.Result&&d.Result.ErrorCode?d.Result.ErrorCode:null,null!==f?e=Fb.getUploadErrorDescByCode(f):g||(e=Fb.i18n("UPLOAD/ERROR_UNKNOWN")),h&&(""!==e&&0<e.length?h.waiting(!1).uploading(!1).error(e):g&&(h.waiting(!1).uploading(!1),h.initByUploadJson(g)),Fb.isUnd(a[b])&&delete a[b])},this)),this.addAttachmentEnabled(!0).dragAndDropEnabled(c.isDragAndDropSupported())):this.addAttachmentEnabled(!1).dragAndDropEnabled(!1)}},K.prototype.prepearAttachmentsForSendOrSave=function(){var a={};return h.each(this.attachmentsInReady(),function(b){b&&""!==b.tempName()&&b.enabled()&&(a[b.tempName()]=[b.fileName(),b.isInline?"1":"0",b.CID,b.contentLocation])}),a},K.prototype.addMessageAsAttachment=function(a){if(a){var b=this,c=null,d=a.subject(),e=function(a){return function(){b.attachments.remove(function(b){return b&&b.id===a})}};d=".eml"===d.substr(-4).toLowerCase()?d:d+".eml",c=new z(a.requestHash,d,a.size()),c.fromMessage=!0,c.cancel=e(a.requestHash),c.waiting(!1).uploading(!0),this.attachments.push(c)}},K.prototype.addDropboxAttachment=function(a){var b=this,c=function(a){return function(){b.attachments.remove(function(b){return b&&b.id===a})}},d=Fb.pInt(Sb.settingsGet("AttachmentLimit")),e=null,f=a.bytes;return e=new z(a.link,a.name,f),e.fromMessage=!1,e.cancel=c(a.link),e.waiting(!1).uploading(!0),this.attachments.push(e),f>0&&d>0&&f>d?(e.uploading(!1),e.error(Fb.i18n("UPLOAD/ERROR_FILE_IS_TOO_BIG")),!1):(Sb.remote().composeUploadExternals(function(a,b){var c=!1;e.uploading(!1),Db.StorageResultType.Success===a&&b&&b.Result&&b.Result[e.id]&&(c=!0,e.tempName(b.Result[e.id])),c||e.error(Fb.getUploadErrorDescByCode(Db.UploadErrorCode.FileNoUploaded))},[a.link]),!0)},K.prototype.prepearMessageAttachments=function(a,b){if(a){var c=this,d=Fb.isNonEmptyArray(a.attachments())?a.attachments():[],e=0,f=d.length,g=null,h=null,i=!1,j=function(a){return function(){c.attachments.remove(function(b){return b&&b.id===a})}};if(Db.ComposeType.ForwardAsAttachment===b)this.addMessageAsAttachment(a);else for(;f>e;e++){switch(h=d[e],i=!1,b){case Db.ComposeType.Reply:case Db.ComposeType.ReplyAll:i=h.isLinked;break;case Db.ComposeType.Forward:case Db.ComposeType.Draft:case Db.ComposeType.EditAsNew:i=!0}i=!0,i&&(g=new z(h.download,h.fileName,h.estimatedSize,h.isInline,h.isLinked,h.cid,h.contentLocation),g.fromMessage=!0,g.cancel=j(h.download),g.waiting(!1).uploading(!0),this.attachments.push(g))}}},K.prototype.removeLinkedAttachments=function(){this.attachments.remove(function(a){return a&&a.isLinked})},K.prototype.setMessageAttachmentFailedDowbloadText=function(){h.each(this.attachments(),function(a){a&&a.fromMessage&&a.waiting(!1).uploading(!1).error(Fb.getUploadErrorDescByCode(Db.UploadErrorCode.FileNoUploaded))},this)},K.prototype.isEmptyForm=function(a){a=Fb.isUnd(a)?!0:!!a;var b=a?0===this.attachments().length:0===this.attachmentsInReady().length;return 0===this.to().length&&0===this.cc().length&&0===this.bcc().length&&0===this.subject().length&&b&&(!this.oEditor||""===this.oEditor.getData())},K.prototype.reset=function(){this.to(""),this.cc(""),this.bcc(""),this.replyTo(""),this.subject(""),this.requestReadReceipt(!1),this.aDraftInfo=null,this.sInReplyTo="",this.bFromDraft=!1,this.sReferences="",this.sendError(!1),this.sendSuccessButSaveError(!1),this.savedError(!1),this.savedTime(0),this.savedOrSendingText(""),this.emptyToError(!1),this.showCcAndBcc(!1),this.attachments([]),this.dragAndDropOver(!1),this.dragAndDropVisible(!1),this.draftFolder(""),this.draftUid(""),this.sending(!1),this.saving(!1),this.oEditor&&this.oEditor.clear(!1)},K.prototype.getAttachmentsDownloadsForUpload=function(){return h.map(h.filter(this.attachments(),function(a){return a&&""===a.tempName()}),function(a){return a.id})},K.prototype.triggerForResize=function(){this.resizer(!this.resizer()),this.editorResizeThrottle()},Fb.extendAsViewModel("PopupsContactsViewModel",L),L.prototype.getPropertyPlceholder=function(a){var b="";switch(a){case Db.ContactPropertyType.LastName:b="CONTACTS/PLACEHOLDER_ENTER_LAST_NAME";break;case Db.ContactPropertyType.FirstName:b="CONTACTS/PLACEHOLDER_ENTER_FIRST_NAME";break;case Db.ContactPropertyType.Nick:b="CONTACTS/PLACEHOLDER_ENTER_NICK_NAME"}return b},L.prototype.addNewProperty=function(a,b){this.viewProperties.push(new w(a,b||"","",!0,this.getPropertyPlceholder(a)))},L.prototype.addNewOrFocusProperty=function(a,b){var c=h.find(this.viewProperties(),function(b){return a===b.type()});c?c.focused(!0):this.addNewProperty(a,b)},L.prototype.addNewTag=function(){this.viewTags.visibility(!0),this.viewTags.focusTrigger(!0)},L.prototype.addNewEmail=function(){this.addNewProperty(Db.ContactPropertyType.Email,"Home")},L.prototype.addNewPhone=function(){this.addNewProperty(Db.ContactPropertyType.Phone,"Mobile")},L.prototype.addNewWeb=function(){this.addNewProperty(Db.ContactPropertyType.Web)},L.prototype.addNewNickname=function(){this.addNewOrFocusProperty(Db.ContactPropertyType.Nick)},L.prototype.addNewNotes=function(){this.addNewOrFocusProperty(Db.ContactPropertyType.Note)},L.prototype.addNewBirthday=function(){this.addNewOrFocusProperty(Db.ContactPropertyType.Birthday)},L.prototype.exportVcf=function(){Sb.download(Sb.link().exportContactsVcf())},L.prototype.exportCsv=function(){Sb.download(Sb.link().exportContactsCsv())},L.prototype.initUploader=function(){if(this.importUploaderButton()){var b=new g({action:Sb.link().uploadContacts(),name:"uploader",queueSize:1,multipleSizeLimit:1,disableFolderDragAndDrop:!0,disableDragAndDrop:!0,disableMultiple:!0,disableDocumentDropPrevent:!0,clickElement:this.importUploaderButton()});b&&b.on("onStart",h.bind(function(){this.contacts.importing(!0)},this)).on("onComplete",h.bind(function(b,c,d){this.contacts.importing(!1),this.reloadContactList(),b&&c&&d&&d.Result||a.alert(Fb.i18n("CONTACTS/ERROR_IMPORT_FILE"))},this))}},L.prototype.removeCheckedOrSelectedContactsFromList=function(){var a=this,b=this.contacts,c=this.currentContact(),d=this.contacts().length,e=this.contactsCheckedOrSelected();0<e.length&&(h.each(e,function(b){c&&c.idContact===b.idContact&&(c=null,a.currentContact(null)),b.deleted(!0),d--}),0>=d&&(this.bDropPageAfterDelete=!0),h.delay(function(){h.each(e,function(a){b.remove(a)})},500))},L.prototype.deleteSelectedContacts=function(){0<this.contactsCheckedOrSelected().length&&(Sb.remote().contactsDelete(h.bind(this.deleteResponse,this),this.contactsCheckedOrSelectedUids()),this.removeCheckedOrSelectedContactsFromList())},L.prototype.deleteResponse=function(a,b){500<(Db.StorageResultType.Success===a&&b&&b.Time?Fb.pInt(b.Time):0)?this.reloadContactList(this.bDropPageAfterDelete):h.delay(function(a){return function(){a.reloadContactList(a.bDropPageAfterDelete)}}(this),500)},L.prototype.removeProperty=function(a){this.viewProperties.remove(a)},L.prototype.populateViewContact=function(a){var b="",c="",d="",e=[];this.watchHash(!1),this.emptySelection(!1),this.viewReadOnly(!1),this.viewTags(""),a&&(b=a.idContact,Fb.isNonEmptyArray(a.properties)&&h.each(a.properties,function(a){a&&a[0]&&(Db.ContactPropertyType.LastName===a[0]?c=a[1]:Db.ContactPropertyType.FirstName===a[0]?d=a[1]:e.push(new w(a[0],a[2]||"",a[1])))}),this.viewTags(a.tags),this.viewReadOnly(!!a.readOnly)),this.viewTags.focusTrigger.valueHasMutated(),this.viewTags.visibility(""!==this.viewTags()),e.unshift(new w(Db.ContactPropertyType.LastName,"",c,!1,this.getPropertyPlceholder(Db.ContactPropertyType.LastName))),e.unshift(new w(Db.ContactPropertyType.FirstName,"",d,!a,this.getPropertyPlceholder(Db.ContactPropertyType.FirstName))),this.viewID(b),this.viewProperties([]),this.viewProperties(e),this.watchDirty(!1),this.watchHash(!0)},L.prototype.reloadContactList=function(a){var b=this,c=(this.contactsPage()-1)*Cb.Defaults.ContactsPerPage;this.bDropPageAfterDelete=!1,(Fb.isUnd(a)?1:!a)||(this.contactsPage(1),c=0),this.contacts.loading(!0),Sb.remote().contacts(function(a,c){var d=0,e=[],f=[];Db.StorageResultType.Success===a&&c&&c.Result&&c.Result.List&&(Fb.isNonEmptyArray(c.Result.List)&&(e=h.map(c.Result.List,function(a){var b=new v;return b.parse(a)?b:null}),e=h.compact(e),d=Fb.pInt(c.Result.Count),d=d>0?d:0),Fb.isNonEmptyArray(c.Result.Tags)&&(f=h.map(c.Result.Tags,function(a){var b=new x;return b.parse(a)?b:null}),f=h.compact(f))),b.contactsCount(d),b.contacts(e),b.contactTags(f),b.contacts.loading(!1),b.viewClearSearch(""!==b.search())},c,Cb.Defaults.ContactsPerPage,this.search())},L.prototype.onBuild=function(a){this.oContentVisible=b(".b-list-content",a),this.oContentScrollable=b(".content",this.oContentVisible),this.selector.init(this.oContentVisible,this.oContentScrollable,Db.KeyState.ContactList);var d=this;j("delete",Db.KeyState.ContactList,function(){return d.deleteCommand(),!1}),a.on("click",".e-pagenator .e-page",function(){var a=c.dataFor(this);a&&(d.contactsPage(Fb.pInt(a.value)),d.reloadContactList())}),this.initUploader()},L.prototype.onShow=function(){Lb.routeOff(),this.reloadContactList(!0)},L.prototype.onHide=function(){Lb.routeOn(),this.currentContact(null),this.emptySelection(!0),this.search(""),this.contactsCount(0),this.contacts([])},Fb.extendAsViewModel("PopupsAdvancedSearchViewModel",M),M.prototype.buildSearchStringValue=function(a){return-1<a.indexOf(" ")&&(a='"'+a+'"'),a},M.prototype.buildSearchString=function(){var a=[],b=Fb.trim(this.from()),c=Fb.trim(this.to()),d=Fb.trim(this.subject()),e=Fb.trim(this.text()),g=[],h=[];return b&&""!==b&&a.push("from:"+this.buildSearchStringValue(b)),c&&""!==c&&a.push("to:"+this.buildSearchStringValue(c)),d&&""!==d&&a.push("subject:"+this.buildSearchStringValue(d)),this.hasAttachment()&&h.push("attachment"),this.unseen()&&g.push("unseen"),this.starred()&&g.push("flagged"),0<h.length&&a.push("has:"+h.join(",")),0<g.length&&a.push("is:"+g.join(",")),-1<this.selectedDateValue()&&a.push("date:"+f().subtract("days",this.selectedDateValue()).format("YYYY.MM.DD")+"/"),e&&""!==e&&a.push("text:"+this.buildSearchStringValue(e)),Fb.trim(a.join(" "))},M.prototype.clearPopup=function(){this.from(""),this.to(""),this.subject(""),this.text(""),this.selectedDateValue(-1),this.hasAttachment(!1),this.starred(!1),this.unseen(!1),this.fromFocus(!0)},M.prototype.onShow=function(){this.clearPopup()},M.prototype.onFocus=function(){this.fromFocus(!0)},Fb.extendAsViewModel("PopupsAddAccountViewModel",N),N.prototype.clearPopup=function(){this.email(""),this.login(""),this.password(""),this.emailError(!1),this.loginError(!1),this.passwordError(!1),this.submitRequest(!1),this.submitError("")},N.prototype.onShow=function(){this.clearPopup()},N.prototype.onFocus=function(){this.emailFocus(!0)},Fb.extendAsViewModel("PopupsAddOpenPgpKeyViewModel",O),O.prototype.clearPopup=function(){this.key(""),this.key.error(!1)},O.prototype.onShow=function(){this.clearPopup()},O.prototype.onFocus=function(){this.key.focus(!0)},Fb.extendAsViewModel("PopupsViewOpenPgpKeyViewModel",P),P.prototype.clearPopup=function(){this.key("")},P.prototype.selectKey=function(){var a=this.keyDom();a&&Fb.selectElement(a)},P.prototype.onShow=function(a){this.clearPopup(),a&&this.key(a.armor)},Fb.extendAsViewModel("PopupsGenerateNewOpenPgpKeyViewModel",Q),Q.prototype.clearPopup=function(){this.name(""),this.password(""),this.email(""),this.email.error(!1),this.keyBitLength(2048)},Q.prototype.onShow=function(){this.clearPopup()},Q.prototype.onFocus=function(){this.email.focus(!0)},Fb.extendAsViewModel("PopupsComposeOpenPgpViewModel",R),R.prototype.clearPopup=function(){this.notification(""),this.password(""),this.password.focus(!1),this.buttonFocus(!1),this.from(""),this.to([]),this.text(""),this.submitRequest(!1),this.resultCallback=null},R.prototype.onBuild=function(){j("tab,shift+tab",Db.KeyState.PopupComposeOpenPGP,h.bind(function(){switch(!0){case this.password.focus():this.buttonFocus(!0);break;case this.buttonFocus():this.password.focus(!0)}return!1},this))},R.prototype.onHide=function(){this.clearPopup()},R.prototype.onFocus=function(){this.sign()?this.password.focus(!0):this.buttonFocus(!0)},R.prototype.onShow=function(a,b,c,d,e,f){this.clearPopup();var g=new u,i="",j=[];this.resultCallback=a,g.clear(),g.mailsoParse(c),""!==g.email&&(i=g.email),""!==d&&j.push(d),""!==e&&j.push(e),""!==f&&j.push(f),j=j.join(", ").split(","),j=h.compact(h.map(j,function(a){return g.clear(),g.mailsoParse(Fb.trim(a)),""===g.email?!1:g.email})),this.from(i),this.to(j),this.text(b)},Fb.extendAsViewModel("PopupsIdentityViewModel",S),S.prototype.clearPopup=function(){this.id="",this.edit(!1),this.owner(!1),this.name(""),this.email(""),this.replyTo(""),this.bcc(""),this.email.hasError(!1),this.replyTo.hasError(!1),this.bcc.hasError(!1),this.submitRequest(!1),this.submitError("")},S.prototype.onShow=function(a){this.clearPopup(),a&&(this.edit(!0),this.id=a.id,this.name(a.name()),this.email(a.email()),this.replyTo(a.replyTo()),this.bcc(a.bcc()),this.owner(this.id===Sb.data().accountEmail()))},S.prototype.onFocus=function(){this.owner()||this.email.focused(!0)},Fb.extendAsViewModel("PopupsLanguagesViewModel",T),T.prototype.languageEnName=function(a){return Fb.convertLangName(a,!0)},T.prototype.resetMainLanguage=function(){var a=Sb.data().mainLanguage();h.each(this.languages(),function(b){b.selected(b.key===a)})},T.prototype.onShow=function(){this.exp(!0),this.resetMainLanguage()},T.prototype.onHide=function(){this.exp(!1)},T.prototype.changeLanguage=function(a){Sb.data().mainLanguage(a),this.cancelCommand()},Fb.extendAsViewModel("PopupsTwoFactorTestViewModel",U),U.prototype.clearPopup=function(){this.code(""),this.code.focused(!1),this.code.status(null),this.testing(!1)},U.prototype.onShow=function(){this.clearPopup()},U.prototype.onFocus=function(){this.code.focused(!0)},Fb.extendAsViewModel("PopupsAskViewModel",V),V.prototype.clearPopup=function(){this.askDesc(""),this.yesButton(Fb.i18n("POPUPS_ASK/BUTTON_YES")),this.noButton(Fb.i18n("POPUPS_ASK/BUTTON_NO")),this.yesFocus(!1),this.noFocus(!1),this.fYesAction=null,this.fNoAction=null},V.prototype.yesClick=function(){this.cancelCommand(),Fb.isFunc(this.fYesAction)&&this.fYesAction.call(null)},V.prototype.noClick=function(){this.cancelCommand(),Fb.isFunc(this.fNoAction)&&this.fNoAction.call(null)},V.prototype.onShow=function(a,b,c,d,e){this.clearPopup(),this.fYesAction=b||null,this.fNoAction=c||null,this.askDesc(a||""),d&&this.yesButton(d),d&&this.yesButton(e)},V.prototype.onFocus=function(){this.yesFocus(!0)},V.prototype.onBuild=function(){j("tab, shift+tab, right, left",Db.KeyState.PopupAsk,h.bind(function(){return this.yesFocus()?this.noFocus(!0):this.yesFocus(!0),!1},this))},Fb.extendAsViewModel("PopupsKeyboardShortcutsHelpViewModel",W),W.prototype.onBuild=function(a){j("tab, shift+tab, left, right",Db.KeyState.PopupKeyboardShortcutsHelp,h.bind(function(b,c){if(b&&c){var d=a.find(".nav.nav-tabs > li"),e=c&&("tab"===c.shortcut||"right"===c.shortcut),f=d.index(d.filter(".active"));return!e&&f>0?f--:e&&f<d.length-1?f++:f=e?0:d.length-1,d.eq(f).find('a[data-toggle="tab"]').tab("show"),!1}},this))},Fb.extendAsViewModel("LoginViewModel",X),X.prototype.onShow=function(){Lb.routeOff(),h.delay(h.bind(function(){""!==this.email()&&""!==this.password()?this.submitFocus(!0):this.emailFocus(!0),Sb.settingsGet("UserLanguage")&&b.cookie("rllang",Sb.data().language(),{expires:30})},this),100)},X.prototype.onHide=function(){this.submitFocus(!1),this.emailFocus(!1)},X.prototype.onBuild=function(){var c=this,d=Sb.settingsGet("JsHash"),e=function(a){a=Fb.pInt(a),0===a?(c.submitRequest(!0),Sb.loginAndLogoutReload()):c.submitError(Fb.getNotification(a))};switch(this.facebookLoginEnabled(!!Sb.settingsGet("AllowFacebookSocial")),this.twitterLoginEnabled(!!Sb.settingsGet("AllowTwitterSocial")),this.googleLoginEnabled(!!Sb.settingsGet("AllowGoogleSocial")),(Sb.settingsGet("SignMe")||"unused").toLowerCase()){case Db.LoginSignMeTypeAsString.DefaultOff:this.signMeType(Db.LoginSignMeType.DefaultOff);break;case Db.LoginSignMeTypeAsString.DefaultOn:this.signMeType(Db.LoginSignMeType.DefaultOn);break;default:case Db.LoginSignMeTypeAsString.Unused:this.signMeType(Db.LoginSignMeType.Unused)}this.email(Sb.data().devEmail),this.login(Sb.data().devLogin),this.password(Sb.data().devPassword),this.googleLoginEnabled()&&(a["rl_"+d+"_google_login_service"]=e),this.facebookLoginEnabled()&&(a["rl_"+d+"_facebook_login_service"]=e),this.twitterLoginEnabled()&&(a["rl_"+d+"_twitter_login_service"]=e),h.delay(function(){Sb.data().language.subscribe(function(a){c.langRequest(!0),b.ajax({url:Sb.link().langLink(a),dataType:"script",cache:!0}).done(function(){c.bSendLanguage=!0,Fb.i18nToDoc(),b.cookie("rllang",Sb.data().language(),{expires:30})
}).always(function(){c.langRequest(!1)})})},50)},X.prototype.selectLanguage=function(){Lb.showScreenPopup(T)},h.extend(Y.prototype,r.prototype),Y.prototype.accountClick=function(a,b){if(a&&b&&!Fb.isUnd(b.which)&&1===b.which){var c=this;this.accountsLoading(!0),h.delay(function(){c.accountsLoading(!1)},1e3)}return!0},Y.prototype.emailTitle=function(){return Sb.data().accountEmail()},Y.prototype.settingsClick=function(){Lb.setHash(Sb.link().settings())},Y.prototype.settingsHelp=function(){Lb.showScreenPopup(W)},Y.prototype.addAccountClick=function(){this.capaAdditionalAccounts&&Lb.showScreenPopup(N)},Y.prototype.logoutClick=function(){Sb.remote().logout(function(){a.__rlah_clear&&a.__rlah_clear(),Sb.loginAndLogoutReload(!0,Sb.settingsGet("ParentEmail")&&0<Sb.settingsGet("ParentEmail").length)})},Y.prototype.onBuild=function(){var a=this;j("`",[Db.KeyState.MessageList,Db.KeyState.MessageView,Db.KeyState.Settings],function(){a.viewModelVisibility()&&a.accountMenuDropdownTrigger(!0)}),j("shift+/",[Db.KeyState.MessageList,Db.KeyState.MessageView,Db.KeyState.Settings],function(){return a.viewModelVisibility()?(Lb.showScreenPopup(W),!1):void 0})},Fb.extendAsViewModel("MailBoxSystemDropDownViewModel",Z,Y),Fb.extendAsViewModel("SettingsSystemDropDownViewModel",$,Y),Fb.extendAsViewModel("MailBoxFolderListViewModel",_),_.prototype.onBuild=function(a){var d=this;a.on("click",".b-folders .e-item .e-link .e-collapsed-sign",function(a){var b=c.dataFor(this),d=!1;b&&a&&(d=b.collapsed(),Fb.setExpandedFolder(b.fullNameHash,d),b.collapsed(!d),a.preventDefault(),a.stopPropagation())}).on("click",".b-folders .e-item .e-link.selectable",function(a){a.preventDefault();var b=Sb.data(),d=c.dataFor(this);d&&(Db.Layout.NoPreview===b.layout()&&b.message(null),d.fullNameRaw===b.currentFolderFullNameRaw()&&Sb.cache().setFolderHash(d.fullNameRaw,""),Lb.setHash(Sb.link().mailBox(d.fullNameHash)))}),j("up, down",Db.KeyState.FolderList,function(c,d){var e=-1,f=d&&"up"===d.shortcut?38:40,g=b(".b-folders .e-item .e-link:not(.hidden):visible",a);return c&&g.length&&(e=g.index(g.filter(".focused")),e>-1&&g.eq(e).removeClass("focused"),38===f&&e>0?e--:40===f&&e<g.length-1&&e++,g.eq(e).addClass("focused")),!1}),j("enter",Db.KeyState.FolderList,function(){var c=b(".b-folders .e-item .e-link:not(.hidden).focused",a);return c.length&&c[0]&&(d.folderList.focused(!1),c.click()),!1}),j("space",Db.KeyState.FolderList,function(){var d=!0,e=null,f=b(".b-folders .e-item .e-link:not(.hidden).focused",a);return f.length&&f[0]&&(e=c.dataFor(f[0]),e&&(d=e.collapsed(),Fb.setExpandedFolder(e.fullNameHash,d),e.collapsed(!d))),!1}),j("esc, tab, shift+tab, right",Db.KeyState.FolderList,function(){return d.folderList.focused(!1),!1}),d.folderList.focused.subscribe(function(c){b(".b-folders .e-item .e-link.focused",a).removeClass("focused"),c&&b(".b-folders .e-item .e-link.selected",a).addClass("focused")})},_.prototype.messagesDropOver=function(b){a.clearTimeout(this.iDropOverTimer),b&&b.collapsed()&&(this.iDropOverTimer=a.setTimeout(function(){b.collapsed(!1),Fb.setExpandedFolder(b.fullNameHash,!0),Fb.windowResize()},500))},_.prototype.messagesDropOut=function(){a.clearTimeout(this.iDropOverTimer)},_.prototype.messagesDrop=function(a,b){if(a&&b&&b.helper){var c=b.helper.data("rl-folder"),d=Ob.hasClass("rl-ctrl-key-pressed"),e=b.helper.data("rl-uids");Fb.isNormal(c)&&""!==c&&Fb.isArray(e)&&Sb.moveMessagesToFolder(c,e,a.fullNameRaw,d)}},_.prototype.composeClick=function(){Lb.showScreenPopup(K)},_.prototype.createFolder=function(){Lb.showScreenPopup(I)},_.prototype.configureFolders=function(){Lb.setHash(Sb.link().settings("folders"))},_.prototype.contactsClick=function(){this.allowContacts&&Lb.showScreenPopup(L)},Fb.extendAsViewModel("MailBoxMessageListViewModel",ab),ab.prototype.emptySubjectValue="",ab.prototype.searchEnterAction=function(){this.mainMessageListSearch(this.sLastSearchValue),this.inputMessageListSearchFocus(!1)},ab.prototype.printableMessageCountForDeletion=function(){var a=this.messageListCheckedOrSelectedUidsWithSubMails().length;return a>1?" ("+(100>a?a:"99+")+")":""},ab.prototype.cancelSearch=function(){this.mainMessageListSearch(""),this.inputMessageListSearchFocus(!1)},ab.prototype.moveSelectedMessagesToFolder=function(a,b){return this.canBeMoved()&&Sb.moveMessagesToFolder(Sb.data().currentFolderFullNameRaw(),Sb.data().messageListCheckedOrSelectedUidsWithSubMails(),a,b),!1},ab.prototype.dragAndDronHelper=function(a){a&&a.checked(!0);var b=Fb.draggeblePlace(),c=Sb.data().messageListCheckedOrSelectedUidsWithSubMails();return b.data("rl-folder",Sb.data().currentFolderFullNameRaw()),b.data("rl-uids",c),b.find(".text").text(""+c.length),h.defer(function(){var a=Sb.data().messageListCheckedOrSelectedUidsWithSubMails();b.data("rl-uids",a),b.find(".text").text(""+a.length)}),b},ab.prototype.onMessageResponse=function(a,b,c){var d=Sb.data();d.hideMessageBodies(),d.messageLoading(!1),Db.StorageResultType.Success===a&&b&&b.Result?d.setMessage(b,c):Db.StorageResultType.Unload===a?(d.message(null),d.messageError("")):Db.StorageResultType.Abort!==a&&(d.message(null),d.messageError(b&&b.ErrorCode?Fb.getNotification(b.ErrorCode):Fb.getNotification(Db.Notification.UnknownError)))},ab.prototype.populateMessageBody=function(a){a&&(Sb.remote().message(this.onMessageResponse,a.folderFullNameRaw,a.uid)?Sb.data().messageLoading(!0):Fb.log("Error: Unknown message request: "+a.folderFullNameRaw+" ~ "+a.uid+" [e-101]"))},ab.prototype.setAction=function(a,b,c){var d=[],e=null,f=Sb.cache(),g=0;if(Fb.isUnd(c)&&(c=Sb.data().messageListChecked()),d=h.map(c,function(a){return a.uid}),""!==a&&0<d.length){switch(b){case Db.MessageSetAction.SetSeen:h.each(c,function(a){a.unseen()&&g++,a.unseen(!1),f.storeMessageFlagsToCache(a)}),e=f.getFolderFromCacheList(a),e&&e.messageCountUnread(e.messageCountUnread()-g),Sb.remote().messageSetSeen(Fb.emptyFunction,a,d,!0);break;case Db.MessageSetAction.UnsetSeen:h.each(c,function(a){a.unseen()&&g++,a.unseen(!0),f.storeMessageFlagsToCache(a)}),e=f.getFolderFromCacheList(a),e&&e.messageCountUnread(e.messageCountUnread()-g+d.length),Sb.remote().messageSetSeen(Fb.emptyFunction,a,d,!1);break;case Db.MessageSetAction.SetFlag:h.each(c,function(a){a.flagged(!0),f.storeMessageFlagsToCache(a)}),Sb.remote().messageSetFlagged(Fb.emptyFunction,a,d,!0);break;case Db.MessageSetAction.UnsetFlag:h.each(c,function(a){a.flagged(!1),f.storeMessageFlagsToCache(a)}),Sb.remote().messageSetFlagged(Fb.emptyFunction,a,d,!1)}Sb.reloadFlagsCurrentMessageListAndMessageFromCache()}},ab.prototype.setActionForAll=function(a,b){var c=null,d=Sb.data().messageList(),e=Sb.cache();if(""!==a&&(c=e.getFolderFromCacheList(a))){switch(b){case Db.MessageSetAction.SetSeen:c=e.getFolderFromCacheList(a),c&&(h.each(d,function(a){a.unseen(!1)}),c.messageCountUnread(0),e.clearMessageFlagsFromCacheByFolder(a)),Sb.remote().messageSetSeenToAll(Fb.emptyFunction,a,!0);break;case Db.MessageSetAction.UnsetSeen:c=e.getFolderFromCacheList(a),c&&(h.each(d,function(a){a.unseen(!0)}),c.messageCountUnread(c.messageCountAll()),e.clearMessageFlagsFromCacheByFolder(a)),Sb.remote().messageSetSeenToAll(Fb.emptyFunction,a,!1)}Sb.reloadFlagsCurrentMessageListAndMessageFromCache()}},ab.prototype.listSetSeen=function(){this.setAction(Sb.data().currentFolderFullNameRaw(),Db.MessageSetAction.SetSeen,Sb.data().messageListCheckedOrSelected())},ab.prototype.listSetAllSeen=function(){this.setActionForAll(Sb.data().currentFolderFullNameRaw(),Db.MessageSetAction.SetSeen)},ab.prototype.listUnsetSeen=function(){this.setAction(Sb.data().currentFolderFullNameRaw(),Db.MessageSetAction.UnsetSeen,Sb.data().messageListCheckedOrSelected())},ab.prototype.listSetFlags=function(){this.setAction(Sb.data().currentFolderFullNameRaw(),Db.MessageSetAction.SetFlag,Sb.data().messageListCheckedOrSelected())},ab.prototype.listUnsetFlags=function(){this.setAction(Sb.data().currentFolderFullNameRaw(),Db.MessageSetAction.UnsetFlag,Sb.data().messageListCheckedOrSelected())},ab.prototype.flagMessages=function(a){var b=this.messageListCheckedOrSelected(),c=[];a&&(0<b.length&&(c=h.map(b,function(a){return a.uid})),0<c.length&&-1<Fb.inArray(a.uid,c)?this.setAction(a.folderFullNameRaw,a.flagged()?Db.MessageSetAction.UnsetFlag:Db.MessageSetAction.SetFlag,b):this.setAction(a.folderFullNameRaw,a.flagged()?Db.MessageSetAction.UnsetFlag:Db.MessageSetAction.SetFlag,[a]))},ab.prototype.flagMessagesFast=function(a){var b=this.messageListCheckedOrSelected(),c=[];0<b.length&&(c=h.filter(b,function(a){return a.flagged()}),Fb.isUnd(a)?this.setAction(b[0].folderFullNameRaw,b.length===c.length?Db.MessageSetAction.UnsetFlag:Db.MessageSetAction.SetFlag,b):this.setAction(b[0].folderFullNameRaw,a?Db.MessageSetAction.SetFlag:Db.MessageSetAction.UnsetFlag,b))},ab.prototype.seenMessagesFast=function(a){var b=this.messageListCheckedOrSelected(),c=[];0<b.length&&(c=h.filter(b,function(a){return a.unseen()}),Fb.isUnd(a)?this.setAction(b[0].folderFullNameRaw,0<c.length?Db.MessageSetAction.SetSeen:Db.MessageSetAction.UnsetSeen,b):this.setAction(b[0].folderFullNameRaw,a?Db.MessageSetAction.SetSeen:Db.MessageSetAction.UnsetSeen,b))},ab.prototype.onBuild=function(a){var d=this,e=Sb.data();this.oContentVisible=b(".b-content",a),this.oContentScrollable=b(".content",this.oContentVisible),this.oContentVisible.on("click",".fullThreadHandle",function(){var a=[],b=c.dataFor(this);return b&&!b.lastInCollapsedThreadLoading()&&(Sb.data().messageListThreadFolder(b.folderFullNameRaw),a=Sb.data().messageListThreadUids(),b.lastInCollapsedThread()?a.push(0<b.parentUid()?b.parentUid():b.uid):a=h.without(a,0<b.parentUid()?b.parentUid():b.uid),Sb.data().messageListThreadUids(h.uniq(a)),b.lastInCollapsedThreadLoading(!0),b.lastInCollapsedThread(!b.lastInCollapsedThread()),Sb.reloadMessageList()),!1}),this.selector.init(this.oContentVisible,this.oContentScrollable,Db.KeyState.MessageList),a.on("click",".messageList .b-message-list-wrapper",function(){d.message.focused()&&d.message.focused(!1)}).on("click",".e-pagenator .e-page",function(){var a=c.dataFor(this);a&&Lb.setHash(Sb.link().mailBox(e.currentFolderFullNameHash(),a.value,e.messageListSearch()))}).on("click",".messageList .checkboxCkeckAll",function(){d.checkAll(!d.checkAll())}).on("click",".messageList .messageListItem .flagParent",function(){d.flagMessages(c.dataFor(this))}),this.initUploaderForAppend(),this.initShortcuts(),!Ib.bMobileDevice&&Sb.capa(Db.Capa.Prefetch)&&i&&(i.setIdleDuration(10),i.idle(function(){d.prefetchNextTick()}))},ab.prototype.initShortcuts=function(){var a=this;j("ctrl+p, command+p",Db.KeyState.MessageList,function(){return!1}),j("z",[Db.KeyState.MessageList,Db.KeyState.MessageView],function(){return a.archiveCommand(),!1}),j("delete, shift+delete",Db.KeyState.MessageList,function(b,c){return b?(0<Sb.data().messageListCheckedOrSelected().length&&(c&&"shift+delete"===c.shortcut?a.deleteWithoutMoveCommand():a.deleteCommand()),!1):void 0}),j("ctrl+r, command+r",[Db.KeyState.FolderList,Db.KeyState.MessageList,Db.KeyState.MessageView],function(){return a.reloadCommand(),!1}),j("ctrl+a, command+a",Db.KeyState.MessageList,function(){return a.checkAll(!(a.checkAll()&&!a.isIncompleteChecked())),!1}),j("w,c",[Db.KeyState.MessageList,Db.KeyState.MessageView],function(){return Lb.showScreenPopup(K),!1}),j("i",[Db.KeyState.MessageList,Db.KeyState.MessageView],function(){return a.flagMessagesFast(),!1}),j("m",Db.KeyState.MessageList,function(){return a.moveDropdownTrigger(!0),!1}),j("q",[Db.KeyState.MessageList,Db.KeyState.MessageView],function(){return a.seenMessagesFast(!0),!1}),j("u",[Db.KeyState.MessageList,Db.KeyState.MessageView],function(){return a.seenMessagesFast(!1),!1}),j("shift+f",[Db.KeyState.MessageList,Db.KeyState.MessageView],function(){return a.multyForwardCommand(),!1}),j("/",[Db.KeyState.MessageList,Db.KeyState.MessageView],function(){return a.inputMessageListSearchFocus(!0),!1}),j("esc",Db.KeyState.MessageList,function(){return""!==a.messageListSearchDesc()?(a.cancelSearch(),!1):void 0}),j("tab, shift+tab, left, right",Db.KeyState.MessageList,function(b,c){return b&&c&&"shift+tab"===c.shortcut||"left"===c.shortcut?a.folderList.focused(!0):a.message()&&a.message.focused(!0),!1}),j("ctrl+left, command+left",Db.KeyState.MessageView,function(){return!1}),j("ctrl+right, command+right",Db.KeyState.MessageView,function(){return!1})},ab.prototype.prefetchNextTick=function(){if(!this.bPrefetch&&!i.now()&&this.viewModelVisibility()){var a=this,b=Sb.cache(),c=h.find(this.messageList(),function(a){return a&&!b.hasRequestedMessage(a.folderFullNameRaw,a.uid)});c&&(this.bPrefetch=!0,Sb.cache().addRequestedMessage(c.folderFullNameRaw,c.uid),Sb.remote().message(function(b,c){var d=!(Db.StorageResultType.Success!==b||!c||!c.Result);h.delay(function(){a.bPrefetch=!1,d&&a.prefetchNextTick()},1e3)},c.folderFullNameRaw,c.uid))}},ab.prototype.composeClick=function(){Lb.showScreenPopup(K)},ab.prototype.advancedSearchClick=function(){Lb.showScreenPopup(M)},ab.prototype.quotaTooltip=function(){return Fb.i18n("MESSAGE_LIST/QUOTA_SIZE",{SIZE:Fb.friendlySize(this.userUsageSize()),PROC:this.userUsageProc(),LIMIT:Fb.friendlySize(this.userQuota())})},ab.prototype.initUploaderForAppend=function(){if(!Sb.settingsGet("AllowAppendMessage")||!this.dragOverArea())return!1;var a=new g({action:Sb.link().append(),name:"AppendFile",queueSize:1,multipleSizeLimit:1,disableFolderDragAndDrop:!0,hidden:{Folder:function(){return Sb.data().currentFolderFullNameRaw()}},dragAndDropElement:this.dragOverArea(),dragAndDropBodyElement:this.dragOverBodyArea()});return a.on("onDragEnter",h.bind(function(){this.dragOverEnter(!0)},this)).on("onDragLeave",h.bind(function(){this.dragOverEnter(!1)},this)).on("onBodyDragEnter",h.bind(function(){this.dragOver(!0)},this)).on("onBodyDragLeave",h.bind(function(){this.dragOver(!1)},this)).on("onSelect",h.bind(function(a,b){return a&&b&&"message/rfc822"===b.Type?(Sb.data().messageListLoading(!0),!0):!1},this)).on("onComplete",h.bind(function(){Sb.reloadMessageList(!0,!0)},this)),!!a},Fb.extendAsViewModel("MailBoxMessageViewViewModel",bb),bb.prototype.isPgpActionVisible=function(){return Db.SignedVerifyStatus.Success!==this.viewPgpSignedVerifyStatus()},bb.prototype.isPgpStatusVerifyVisible=function(){return Db.SignedVerifyStatus.None!==this.viewPgpSignedVerifyStatus()},bb.prototype.isPgpStatusVerifySuccess=function(){return Db.SignedVerifyStatus.Success===this.viewPgpSignedVerifyStatus()},bb.prototype.pgpStatusVerifyMessage=function(){var a="";switch(this.viewPgpSignedVerifyStatus()){case Db.SignedVerifyStatus.UnknownPublicKeys:a=Fb.i18n("PGP_NOTIFICATIONS/NO_PUBLIC_KEYS_FOUND");break;case Db.SignedVerifyStatus.UnknownPrivateKey:a=Fb.i18n("PGP_NOTIFICATIONS/NO_PRIVATE_KEY_FOUND");break;case Db.SignedVerifyStatus.Unverified:a=Fb.i18n("PGP_NOTIFICATIONS/UNVERIFIRED_SIGNATURE");break;case Db.SignedVerifyStatus.Error:a=Fb.i18n("PGP_NOTIFICATIONS/DECRYPTION_ERROR");break;case Db.SignedVerifyStatus.Success:a=Fb.i18n("PGP_NOTIFICATIONS/GOOD_SIGNATURE",{USER:this.viewPgpSignedVerifyUser()})}return a},bb.prototype.scrollToTop=function(){var a=b(".messageItem.nano .content",this.viewModelDom);a&&a[0]?a.scrollTop(0):b(".messageItem",this.viewModelDom).scrollTop(0),Fb.windowResize()},bb.prototype.fullScreen=function(){this.fullScreenMode(!0),Fb.windowResize()},bb.prototype.unFullScreen=function(){this.fullScreenMode(!1),Fb.windowResize()},bb.prototype.toggleFullScreen=function(){Fb.removeSelection(),this.fullScreenMode(!this.fullScreenMode()),Fb.windowResize()},bb.prototype.replyOrforward=function(a){Lb.showScreenPopup(K,[a,Sb.data().message()])},bb.prototype.onBuild=function(a){var d=this,e=Sb.data();this.fullScreenMode.subscribe(function(a){a&&d.message.focused(!0)},this),b(".attachmentsPlace",a).magnificPopup({delegate:".magnificPopupImage:visible",type:"image",gallery:{enabled:!0,preload:[1,1],navigateByImgClick:!0},callbacks:{open:function(){e.useKeyboardShortcuts(!1)},close:function(){e.useKeyboardShortcuts(!0)}},mainClass:"mfp-fade",removalDelay:400}),a.on("click",".messageView .messageItem .messageItemHeader",function(){e.useKeyboardShortcuts()&&d.message()&&d.message.focused(!0)}).on("mousedown","a",function(a){return!(a&&3!==a.which&&Sb.mailToHelper(b(this).attr("href")))}).on("click",".attachmentsPlace .attachmentPreview",function(a){a&&a.stopPropagation&&a.stopPropagation()}).on("click",".attachmentsPlace .attachmentItem",function(){var a=c.dataFor(this);a&&a.download&&Sb.download(a.linkDownload())}),this.message.focused.subscribe(function(a){a&&!Fb.inFocus()?this.messageDomFocused(!0):this.messageDomFocused(!1)},this),this.messageDomFocused.subscribe(function(a){a||Db.KeyState.MessageView!==this.keyScope()||this.message.focused(!1)},this),this.keyScope.subscribe(function(a){Db.KeyState.MessageView===a&&this.message.focused()&&this.messageDomFocused(!0)},this),this.oMessageScrollerDom=a.find(".messageItem .content"),this.oMessageScrollerDom=this.oMessageScrollerDom&&this.oMessageScrollerDom[0]?this.oMessageScrollerDom:null,this.initShortcuts()},bb.prototype.escShortcuts=function(){return this.viewModelVisibility()&&this.message()?(this.fullScreenMode()?this.fullScreenMode(!1):Db.Layout.NoPreview===Sb.data().layout()?this.message(null):this.message.focused(!1),!1):void 0},bb.prototype.initShortcuts=function(){var a=this,b=Sb.data();j("esc",Db.KeyState.MessageView,h.bind(this.escShortcuts,this)),j("enter",Db.KeyState.MessageView,function(){return a.toggleFullScreen(),!1}),j("enter",Db.KeyState.MessageList,function(){return Db.Layout.NoPreview!==b.layout()&&a.message()?(a.toggleFullScreen(),!1):void 0}),j("r",[Db.KeyState.MessageList,Db.KeyState.MessageView],function(){return b.message()?(a.replyCommand(),!1):void 0}),j("a",[Db.KeyState.MessageList,Db.KeyState.MessageView],function(){return b.message()?(a.replyAllCommand(),!1):void 0}),j("f",[Db.KeyState.MessageList,Db.KeyState.MessageView],function(){return b.message()?(a.forwardCommand(),!1):void 0}),j("b",[Db.KeyState.MessageList,Db.KeyState.MessageView],function(){return b.message()&&b.message().body?(Fb.toggleMessageBlockquote(b.message().body),!1):void 0}),j("ctrl+left, command+left, ctrl+up, command+up",Db.KeyState.MessageView,function(){return a.goUpCommand(),!1}),j("ctrl+right, command+right, ctrl+down, command+down",Db.KeyState.MessageView,function(){return a.goDownCommand(),!1}),j("ctrl+p, command+p",Db.KeyState.MessageView,function(){return a.message()&&a.message().printMessage(),!1}),j("delete, shift+delete",Db.KeyState.MessageView,function(b,c){return b?(c&&"shift+delete"===c.shortcut?a.deleteWithoutMoveCommand():a.deleteCommand(),!1):void 0}),j("tab, shift+tab, left",Db.KeyState.MessageView,function(){return!a.fullScreenMode()&&a.message()&&Db.Layout.NoPreview!==b.layout()&&a.message.focused(!1),!1})},bb.prototype.isDraftFolder=function(){return Sb.data().message()&&Sb.data().draftFolder()===Sb.data().message().folderFullNameRaw},bb.prototype.isSentFolder=function(){return Sb.data().message()&&Sb.data().sentFolder()===Sb.data().message().folderFullNameRaw},bb.prototype.isSpamFolder=function(){return Sb.data().message()&&Sb.data().spamFolder()===Sb.data().message().folderFullNameRaw},bb.prototype.isSpamDisabled=function(){return Sb.data().message()&&Sb.data().spamFolder()===Cb.Values.UnuseOptionValue},bb.prototype.isArchiveFolder=function(){return Sb.data().message()&&Sb.data().archiveFolder()===Sb.data().message().folderFullNameRaw},bb.prototype.isArchiveDisabled=function(){return Sb.data().message()&&Sb.data().archiveFolder()===Cb.Values.UnuseOptionValue},bb.prototype.isDraftOrSentFolder=function(){return this.isDraftFolder()||this.isSentFolder()},bb.prototype.composeClick=function(){Lb.showScreenPopup(K)},bb.prototype.editMessage=function(){Sb.data().message()&&Lb.showScreenPopup(K,[Db.ComposeType.Draft,Sb.data().message()])},bb.prototype.scrollMessageToTop=function(){this.oMessageScrollerDom&&this.oMessageScrollerDom.scrollTop(0)},bb.prototype.showImages=function(a){a&&a.showExternalImages&&a.showExternalImages(!0)},bb.prototype.printableCheckedMessageCount=function(){var a=this.messageListCheckedOrSelectedUidsWithSubMails().length;return a>0?100>a?a:"99+":""},bb.prototype.verifyPgpSignedClearMessage=function(a){a&&a.verifyPgpSignedClearMessage()},bb.prototype.decryptPgpEncryptedMessage=function(a){a&&a.decryptPgpEncryptedMessage(this.viewPgpPassword())},bb.prototype.readReceipt=function(a){a&&""!==a.readReceipt()&&(Sb.remote().sendReadReceiptMessage(Fb.emptyFunction,a.folderFullNameRaw,a.uid,a.readReceipt(),Fb.i18n("READ_RECEIPT/SUBJECT",{SUBJECT:a.subject()}),Fb.i18n("READ_RECEIPT/BODY",{"READ-RECEIPT":Sb.data().accountEmail()})),a.isReadReceipt(!0),Sb.cache().storeMessageFlagsToCache(a),Sb.reloadFlagsCurrentMessageListAndMessageFromCache())},Fb.extendAsViewModel("SettingsMenuViewModel",cb),cb.prototype.link=function(a){return Sb.link().settings(a)},cb.prototype.backToMailBoxClick=function(){Lb.setHash(Sb.link().inbox())},Fb.extendAsViewModel("SettingsPaneViewModel",db),db.prototype.onBuild=function(){var a=this;j("esc",Db.KeyState.Settings,function(){a.backToMailBoxClick()})},db.prototype.onShow=function(){Sb.data().message(null)},db.prototype.backToMailBoxClick=function(){Lb.setHash(Sb.link().inbox())},Fb.addSettingsViewModel(eb,"SettingsGeneral","SETTINGS_LABELS/LABEL_GENERAL_NAME","general",!0),eb.prototype.toggleLayout=function(){this.layout(Db.Layout.NoPreview===this.layout()?Db.Layout.SidePreview:Db.Layout.NoPreview)},eb.prototype.onBuild=function(){var a=this;h.delay(function(){var c=Sb.data(),d=Fb.settingsSaveHelperSimpleFunction(a.mppTrigger,a);c.language.subscribe(function(c){a.languageTrigger(Db.SaveSettingsStep.Animate),b.ajax({url:Sb.link().langLink(c),dataType:"script",cache:!0}).done(function(){Fb.i18nToDoc(),a.languageTrigger(Db.SaveSettingsStep.TrueResult)}).fail(function(){a.languageTrigger(Db.SaveSettingsStep.FalseResult)}).always(function(){h.delay(function(){a.languageTrigger(Db.SaveSettingsStep.Idle)},1e3)}),Sb.remote().saveSettings(Fb.emptyFunction,{Language:c})}),c.editorDefaultType.subscribe(function(a){Sb.remote().saveSettings(Fb.emptyFunction,{EditorDefaultType:a})}),c.messagesPerPage.subscribe(function(a){Sb.remote().saveSettings(d,{MPP:a})}),c.showImages.subscribe(function(a){Sb.remote().saveSettings(Fb.emptyFunction,{ShowImages:a?"1":"0"})}),c.interfaceAnimation.subscribe(function(a){Sb.remote().saveSettings(Fb.emptyFunction,{InterfaceAnimation:a})}),c.useDesktopNotifications.subscribe(function(a){Fb.timeOutAction("SaveDesktopNotifications",function(){Sb.remote().saveSettings(Fb.emptyFunction,{DesktopNotifications:a?"1":"0"})},3e3)}),c.replySameFolder.subscribe(function(a){Fb.timeOutAction("SaveReplySameFolder",function(){Sb.remote().saveSettings(Fb.emptyFunction,{ReplySameFolder:a?"1":"0"})},3e3)}),c.useThreads.subscribe(function(a){c.messageList([]),Sb.remote().saveSettings(Fb.emptyFunction,{UseThreads:a?"1":"0"})}),c.layout.subscribe(function(a){c.messageList([]),Sb.remote().saveSettings(Fb.emptyFunction,{Layout:a})}),c.useCheckboxesInList.subscribe(function(a){Sb.remote().saveSettings(Fb.emptyFunction,{UseCheckboxesInList:a?"1":"0"})})},50)},eb.prototype.onShow=function(){Sb.data().desktopNotifications.valueHasMutated()},eb.prototype.selectLanguage=function(){Lb.showScreenPopup(T)},Fb.addSettingsViewModel(fb,"SettingsContacts","SETTINGS_LABELS/LABEL_CONTACTS_NAME","contacts"),fb.prototype.onBuild=function(){Sb.data().contactsAutosave.subscribe(function(a){Sb.remote().saveSettings(Fb.emptyFunction,{ContactsAutosave:a?"1":"0"})})},Fb.addSettingsViewModel(gb,"SettingsAccounts","SETTINGS_LABELS/LABEL_ACCOUNTS_NAME","accounts"),gb.prototype.addNewAccount=function(){Lb.showScreenPopup(N)},gb.prototype.deleteAccount=function(b){if(b&&b.deleteAccess()){this.accountForDeletion(null);var c=function(a){return b===a};b&&(this.accounts.remove(c),Sb.remote().accountDelete(function(b,c){Db.StorageResultType.Success===b&&c&&c.Result&&c.Reload?(Lb.routeOff(),Lb.setHash(Sb.link().root(),!0),Lb.routeOff(),h.defer(function(){a.location.reload()})):Sb.accountsAndIdentities()},b.email))}},Fb.addSettingsViewModel(hb,"SettingsIdentity","SETTINGS_LABELS/LABEL_IDENTITY_NAME","identity"),hb.prototype.onFocus=function(){if(!this.editor&&this.signatureDom()){var a=this,b=Sb.data().signature();this.editor=new l(a.signatureDom(),function(){Sb.data().signature((a.editor.isHtml()?":HTML:":"")+a.editor.getData())},function(){":HTML:"===b.substr(0,6)?a.editor.setHtml(b.substr(6),!1):a.editor.setPlain(b,!1)})}},hb.prototype.onBuild=function(){var a=this;h.delay(function(){var b=Sb.data(),c=Fb.settingsSaveHelperSimpleFunction(a.displayNameTrigger,a),d=Fb.settingsSaveHelperSimpleFunction(a.replyTrigger,a),e=Fb.settingsSaveHelperSimpleFunction(a.signatureTrigger,a);b.displayName.subscribe(function(a){Sb.remote().saveSettings(c,{DisplayName:a})}),b.replyTo.subscribe(function(a){Sb.remote().saveSettings(d,{ReplyTo:a})}),b.signature.subscribe(function(a){Sb.remote().saveSettings(e,{Signature:a})}),b.signatureToAll.subscribe(function(a){Sb.remote().saveSettings(null,{SignatureToAll:a?"1":"0"})})},50)},Fb.addSettingsViewModel(ib,"SettingsIdentities","SETTINGS_LABELS/LABEL_IDENTITIES_NAME","identities"),ib.prototype.addNewIdentity=function(){Lb.showScreenPopup(S)},ib.prototype.editIdentity=function(a){Lb.showScreenPopup(S,[a])},ib.prototype.deleteIdentity=function(a){if(a&&a.deleteAccess()){this.identityForDeletion(null);var b=function(b){return a===b};a&&(this.identities.remove(b),Sb.remote().identityDelete(function(){Sb.accountsAndIdentities()},a.id))}},ib.prototype.onFocus=function(){if(!this.editor&&this.signatureDom()){var a=this,b=Sb.data().signature();this.editor=new l(a.signatureDom(),function(){Sb.data().signature((a.editor.isHtml()?":HTML:":"")+a.editor.getData())},function(){":HTML:"===b.substr(0,6)?a.editor.setHtml(b.substr(6),!1):a.editor.setPlain(b,!1)})}},ib.prototype.onBuild=function(a){var b=this;a.on("click",".identity-item .e-action",function(){var a=c.dataFor(this);a&&b.editIdentity(a)}),h.delay(function(){var a=Sb.data(),c=Fb.settingsSaveHelperSimpleFunction(b.displayNameTrigger,b),d=Fb.settingsSaveHelperSimpleFunction(b.replyTrigger,b),e=Fb.settingsSaveHelperSimpleFunction(b.signatureTrigger,b);a.displayName.subscribe(function(a){Sb.remote().saveSettings(c,{DisplayName:a})}),a.replyTo.subscribe(function(a){Sb.remote().saveSettings(d,{ReplyTo:a})}),a.signature.subscribe(function(a){Sb.remote().saveSettings(e,{Signature:a})}),a.signatureToAll.subscribe(function(a){Sb.remote().saveSettings(null,{SignatureToAll:a?"1":"0"})})},50)},Fb.addSettingsViewModel(jb,"SettingsFilters","SETTINGS_LABELS/LABEL_FILTERS_NAME","filters"),jb.prototype.deleteFilter=function(a){this.filters.remove(a)},jb.prototype.addFilter=function(){var a=new F;a.addCondition(),this.filters.push(a)},Fb.addSettingsViewModel(kb,"SettingsSecurity","SETTINGS_LABELS/LABEL_SECURITY_NAME","security"),kb.prototype.showSecret=function(){this.secreting(!0),Sb.remote().showTwoFactorSecret(this.onSecretResult)},kb.prototype.hideSecret=function(){this.viewSecret(""),this.viewBackupCodes(""),this.viewUrl("")},kb.prototype.createTwoFactor=function(){this.processing(!0),Sb.remote().createTwoFactor(this.onResult)},kb.prototype.enableTwoFactor=function(){this.processing(!0),Sb.remote().enableTwoFactor(this.onResult,this.viewEnable())},kb.prototype.testTwoFactor=function(){Lb.showScreenPopup(U)},kb.prototype.clearTwoFactor=function(){this.viewSecret(""),this.viewBackupCodes(""),this.viewUrl(""),this.clearing(!0),Sb.remote().clearTwoFactor(this.onResult)},kb.prototype.onShow=function(){this.viewSecret(""),this.viewBackupCodes(""),this.viewUrl("")},kb.prototype.onResult=function(a,b){if(this.processing(!1),this.clearing(!1),Db.StorageResultType.Success===a&&b&&b.Result?(this.viewUser(Fb.pString(b.Result.User)),this.viewEnable(!!b.Result.Enable),this.twoFactorStatus(!!b.Result.IsSet),this.viewSecret(Fb.pString(b.Result.Secret)),this.viewBackupCodes(Fb.pString(b.Result.BackupCodes).replace(/[\s]+/g,"  ")),this.viewUrl(Fb.pString(b.Result.Url))):(this.viewUser(""),this.viewEnable(!1),this.twoFactorStatus(!1),this.viewSecret(""),this.viewBackupCodes(""),this.viewUrl("")),this.bFirst){this.bFirst=!1;var c=this;this.viewEnable.subscribe(function(a){this.viewEnable.subs&&Sb.remote().enableTwoFactor(function(a,b){Db.StorageResultType.Success===a&&b&&b.Result||(c.viewEnable.subs=!1,c.viewEnable(!1),c.viewEnable.subs=!0)},a)},this)}},kb.prototype.onSecretResult=function(a,b){this.secreting(!1),Db.StorageResultType.Success===a&&b&&b.Result?(this.viewSecret(Fb.pString(b.Result.Secret)),this.viewUrl(Fb.pString(b.Result.Url))):(this.viewSecret(""),this.viewUrl(""))},kb.prototype.onBuild=function(){this.processing(!0),Sb.remote().getTwoFactor(this.onResult)},Fb.addSettingsViewModel(lb,"SettingsSocial","SETTINGS_LABELS/LABEL_SOCIAL_NAME","social"),Fb.addSettingsViewModel(mb,"SettingsChangePassword","SETTINGS_LABELS/LABEL_CHANGE_PASSWORD_NAME","change-password"),mb.prototype.onHide=function(){this.changeProcess(!1),this.currentPassword(""),this.newPassword(""),this.newPassword2(""),this.errorDescription(""),this.passwordMismatch(!1),this.currentPassword.error(!1)},mb.prototype.onChangePasswordResponse=function(a,b){this.changeProcess(!1),this.passwordMismatch(!1),this.errorDescription(""),this.currentPassword.error(!1),Db.StorageResultType.Success===a&&b&&b.Result?(this.currentPassword(""),this.newPassword(""),this.newPassword2(""),this.passwordUpdateSuccess(!0),this.currentPassword.error(!1)):(b&&Db.Notification.CurrentPasswordIncorrect===b.ErrorCode&&this.currentPassword.error(!0),this.passwordUpdateError(!0),this.errorDescription(b&&b.ErrorCode?Fb.getNotification(b.ErrorCode):Fb.getNotification(Db.Notification.CouldNotSaveNewPassword)))},Fb.addSettingsViewModel(nb,"SettingsFolders","SETTINGS_LABELS/LABEL_FOLDERS_NAME","folders"),nb.prototype.folderEditOnEnter=function(a){var b=a?Fb.trim(a.nameForEdit()):"";""!==b&&a.name()!==b&&(Sb.local().set(Db.ClientSideKeyName.FoldersLashHash,""),Sb.data().foldersRenaming(!0),Sb.remote().folderRename(function(a,b){Sb.data().foldersRenaming(!1),Db.StorageResultType.Success===a&&b&&b.Result||Sb.data().foldersListError(b&&b.ErrorCode?Fb.getNotification(b.ErrorCode):Fb.i18n("NOTIFICATIONS/CANT_RENAME_FOLDER")),Sb.folders()},a.fullNameRaw,b),Sb.cache().removeFolderFromCacheList(a.fullNameRaw),a.name(b)),a.edited(!1)},nb.prototype.folderEditOnEsc=function(a){a&&a.edited(!1)},nb.prototype.onShow=function(){Sb.data().foldersListError("")},nb.prototype.createFolder=function(){Lb.showScreenPopup(I)},nb.prototype.systemFolder=function(){Lb.showScreenPopup(J)},nb.prototype.deleteFolder=function(a){if(a&&a.canBeDeleted()&&a.deleteAccess()&&0===a.privateMessageCountAll()){this.folderForDeletion(null);var b=function(c){return a===c?!0:(c.subFolders.remove(b),!1)};a&&(Sb.local().set(Db.ClientSideKeyName.FoldersLashHash,""),Sb.data().folderList.remove(b),Sb.data().foldersDeleting(!0),Sb.remote().folderDelete(function(a,b){Sb.data().foldersDeleting(!1),Db.StorageResultType.Success===a&&b&&b.Result||Sb.data().foldersListError(b&&b.ErrorCode?Fb.getNotification(b.ErrorCode):Fb.i18n("NOTIFICATIONS/CANT_DELETE_FOLDER")),Sb.folders()},a.fullNameRaw),Sb.cache().removeFolderFromCacheList(a.fullNameRaw))}else 0<a.privateMessageCountAll()&&Sb.data().foldersListError(Fb.getNotification(Db.Notification.CantDeleteNonEmptyFolder))},nb.prototype.subscribeFolder=function(a){Sb.local().set(Db.ClientSideKeyName.FoldersLashHash,""),Sb.remote().folderSetSubscribe(Fb.emptyFunction,a.fullNameRaw,!0),a.subScribed(!0)},nb.prototype.unSubscribeFolder=function(a){Sb.local().set(Db.ClientSideKeyName.FoldersLashHash,""),Sb.remote().folderSetSubscribe(Fb.emptyFunction,a.fullNameRaw,!1),a.subScribed(!1)},Fb.addSettingsViewModel(ob,"SettingsThemes","SETTINGS_LABELS/LABEL_THEMES_NAME","themes"),ob.prototype.onBuild=function(){var a=Sb.data().theme();this.themesObjects(h.map(Sb.data().themes(),function(b){return{name:b,nameDisplay:Fb.convertThemeName(b),selected:c.observable(b===a),themePreviewSrc:Sb.link().themePreviewLink(b)}
}))},Fb.addSettingsViewModel(pb,"SettingsOpenPGP","SETTINGS_LABELS/LABEL_OPEN_PGP_NAME","openpgp"),pb.prototype.addOpenPgpKey=function(){Lb.showScreenPopup(O)},pb.prototype.generateOpenPgpKey=function(){Lb.showScreenPopup(Q)},pb.prototype.viewOpenPgpKey=function(a){a&&Lb.showScreenPopup(P,[a])},pb.prototype.deleteOpenPgpKey=function(a){a&&a.deleteAccess()&&(this.openPgpKeyForDeletion(null),a&&Sb.data().openpgpKeyring&&(this.openpgpkeys.remove(function(b){return a===b}),Sb.data().openpgpKeyring[a.isPrivate?"privateKeys":"publicKeys"].removeForId(a.guid),Sb.data().openpgpKeyring.store(),Sb.reloadOpenPgpKeys()))},qb.prototype.populateDataOnStart=function(){var a=Fb.pInt(Sb.settingsGet("Layout")),b=Sb.settingsGet("Languages"),c=Sb.settingsGet("Themes");Fb.isArray(b)&&this.languages(b),Fb.isArray(c)&&this.themes(c),this.mainLanguage(Sb.settingsGet("Language")),this.mainTheme(Sb.settingsGet("Theme")),this.capaAdditionalAccounts(Sb.capa(Db.Capa.AdditionalAccounts)),this.capaAdditionalIdentities(Sb.capa(Db.Capa.AdditionalIdentities)),this.capaGravatar(Sb.capa(Db.Capa.Gravatar)),this.determineUserLanguage(!!Sb.settingsGet("DetermineUserLanguage")),this.capaThemes(Sb.capa(Db.Capa.Themes)),this.allowCustomLogin(!!Sb.settingsGet("AllowCustomLogin")),this.allowLanguagesOnLogin(!!Sb.settingsGet("AllowLanguagesOnLogin")),this.allowLanguagesOnSettings(!!Sb.settingsGet("AllowLanguagesOnSettings")),this.editorDefaultType(Sb.settingsGet("EditorDefaultType")),this.showImages(!!Sb.settingsGet("ShowImages")),this.contactsAutosave(!!Sb.settingsGet("ContactsAutosave")),this.interfaceAnimation(Sb.settingsGet("InterfaceAnimation")),this.mainMessagesPerPage(Sb.settingsGet("MPP")),this.desktopNotifications(!!Sb.settingsGet("DesktopNotifications")),this.useThreads(!!Sb.settingsGet("UseThreads")),this.replySameFolder(!!Sb.settingsGet("ReplySameFolder")),this.useCheckboxesInList(!!Sb.settingsGet("UseCheckboxesInList")),this.layout(Db.Layout.SidePreview),-1<Fb.inArray(a,[Db.Layout.NoPreview,Db.Layout.SidePreview,Db.Layout.BottomPreview])&&this.layout(a),this.facebookEnable(!!Sb.settingsGet("AllowFacebookSocial")),this.facebookAppID(Sb.settingsGet("FacebookAppID")),this.facebookAppSecret(Sb.settingsGet("FacebookAppSecret")),this.twitterEnable(!!Sb.settingsGet("AllowTwitterSocial")),this.twitterConsumerKey(Sb.settingsGet("TwitterConsumerKey")),this.twitterConsumerSecret(Sb.settingsGet("TwitterConsumerSecret")),this.googleEnable(!!Sb.settingsGet("AllowGoogleSocial")),this.googleClientID(Sb.settingsGet("GoogleClientID")),this.googleClientSecret(Sb.settingsGet("GoogleClientSecret")),this.dropboxEnable(!!Sb.settingsGet("AllowDropboxSocial")),this.dropboxApiKey(Sb.settingsGet("DropboxApiKey")),this.contactsIsAllowed(!!Sb.settingsGet("ContactsIsAllowed"))},h.extend(rb.prototype,qb.prototype),rb.prototype.purgeMessageBodyCache=function(){var a=0,c=null,d=Ib.iMessageBodyCacheCount-Cb.Values.MessageBodyCacheLimit;d>0&&(c=this.messagesBodiesDom(),c&&(c.find(".rl-cache-class").each(function(){var c=b(this);d>c.data("rl-cache-count")&&(c.addClass("rl-cache-purge"),a++)}),a>0&&h.delay(function(){c.find(".rl-cache-purge").remove()},300)))},rb.prototype.populateDataOnStart=function(){qb.prototype.populateDataOnStart.call(this),this.accountEmail(Sb.settingsGet("Email")),this.accountIncLogin(Sb.settingsGet("IncLogin")),this.accountOutLogin(Sb.settingsGet("OutLogin")),this.projectHash(Sb.settingsGet("ProjectHash")),this.displayName(Sb.settingsGet("DisplayName")),this.replyTo(Sb.settingsGet("ReplyTo")),this.signature(Sb.settingsGet("Signature")),this.signatureToAll(!!Sb.settingsGet("SignatureToAll")),this.enableTwoFactor(!!Sb.settingsGet("EnableTwoFactor")),this.lastFoldersHash=Sb.local().get(Db.ClientSideKeyName.FoldersLashHash)||"",this.remoteSuggestions=!!Sb.settingsGet("RemoteSuggestions"),this.devEmail=Sb.settingsGet("DevEmail"),this.devLogin=Sb.settingsGet("DevLogin"),this.devPassword=Sb.settingsGet("DevPassword")},rb.prototype.initUidNextAndNewMessages=function(b,c,d){if("INBOX"===b&&Fb.isNormal(c)&&""!==c){if(Fb.isArray(d)&&0<d.length){var e=Sb.cache(),f=0,g=d.length,i=function(b,c,d){var e=null;Rb&&Sb.data().useDesktopNotifications()&&(e=new Rb(c,{body:d,icon:b}),e&&(e.show&&e.show(),a.setTimeout(function(a){return function(){a.cancel?a.cancel():a.close&&a.close()}}(e),7e3)))};if(h.each(d,function(a){e.addNewMessageCache(b,a.Uid)}),g>3)i(Sb.link().notificationMailIcon(),Sb.data().accountEmail(),Fb.i18n("MESSAGE_LIST/NEW_MESSAGE_NOTIFICATION",{COUNT:g}));else for(;g>f;f++)i(Sb.link().notificationMailIcon(),A.emailsToLine(A.initEmailsFromJson(d[f].From),!1),d[f].Subject)}Sb.cache().setFolderUidNext(b,c)}},rb.prototype.folderResponseParseRec=function(a,b){var c=0,d=0,e=null,f=null,g="",h=[],i=[];for(c=0,d=b.length;d>c;c++)e=b[c],e&&(g=e.FullNameRaw,f=Sb.cache().getFolderFromCacheList(g),f||(f=B.newInstanceFromJson(e),f&&(Sb.cache().setFolderToCacheList(g,f),Sb.cache().setFolderFullNameRaw(f.fullNameHash,g))),f&&(f.collapsed(!Fb.isFolderExpanded(f.fullNameHash)),e.Extended&&(e.Extended.Hash&&Sb.cache().setFolderHash(f.fullNameRaw,e.Extended.Hash),Fb.isNormal(e.Extended.MessageCount)&&f.messageCountAll(e.Extended.MessageCount),Fb.isNormal(e.Extended.MessageUnseenCount)&&f.messageCountUnread(e.Extended.MessageUnseenCount)),h=e.SubFolders,h&&"Collection/FolderCollection"===h["@Object"]&&h["@Collection"]&&Fb.isArray(h["@Collection"])&&f.subFolders(this.folderResponseParseRec(a,h["@Collection"])),i.push(f)));return i},rb.prototype.setFolders=function(a){var b=[],c=!1,d=Sb.data(),e=function(a){return""===a||Cb.Values.UnuseOptionValue===a||null!==Sb.cache().getFolderFromCacheList(a)?a:""};a&&a.Result&&"Collection/FolderCollection"===a.Result["@Object"]&&a.Result["@Collection"]&&Fb.isArray(a.Result["@Collection"])&&(Fb.isUnd(a.Result.Namespace)||(d.namespace=a.Result.Namespace),this.threading(!!Sb.settingsGet("UseImapThread")&&a.Result.IsThreadsSupported&&!0),b=this.folderResponseParseRec(d.namespace,a.Result["@Collection"]),d.folderList(b),a.Result.SystemFolders&&""==""+Sb.settingsGet("SentFolder")+Sb.settingsGet("DraftFolder")+Sb.settingsGet("SpamFolder")+Sb.settingsGet("TrashFolder")+Sb.settingsGet("ArchiveFolder")+Sb.settingsGet("NullFolder")&&(Sb.settingsSet("SentFolder",a.Result.SystemFolders[2]||null),Sb.settingsSet("DraftFolder",a.Result.SystemFolders[3]||null),Sb.settingsSet("SpamFolder",a.Result.SystemFolders[4]||null),Sb.settingsSet("TrashFolder",a.Result.SystemFolders[5]||null),Sb.settingsSet("ArchiveFolder",a.Result.SystemFolders[12]||null),c=!0),d.sentFolder(e(Sb.settingsGet("SentFolder"))),d.draftFolder(e(Sb.settingsGet("DraftFolder"))),d.spamFolder(e(Sb.settingsGet("SpamFolder"))),d.trashFolder(e(Sb.settingsGet("TrashFolder"))),d.archiveFolder(e(Sb.settingsGet("ArchiveFolder"))),c&&Sb.remote().saveSystemFolders(Fb.emptyFunction,{SentFolder:d.sentFolder(),DraftFolder:d.draftFolder(),SpamFolder:d.spamFolder(),TrashFolder:d.trashFolder(),ArchiveFolder:d.archiveFolder(),NullFolder:"NullFolder"}),Sb.local().set(Db.ClientSideKeyName.FoldersLashHash,a.Result.FoldersHash))},rb.prototype.hideMessageBodies=function(){var a=this.messagesBodiesDom();a&&a.find(".b-text-part").hide()},rb.prototype.getNextFolderNames=function(a){a=Fb.isUnd(a)?!1:!!a;var b=[],c=10,d=f().unix(),e=d-300,g=[],i=function(b){h.each(b,function(b){b&&"INBOX"!==b.fullNameRaw&&b.selectable&&b.existen&&e>b.interval&&(!a||b.subScribed())&&g.push([b.interval,b.fullNameRaw]),b&&0<b.subFolders().length&&i(b.subFolders())})};return i(this.folderList()),g.sort(function(a,b){return a[0]<b[0]?-1:a[0]>b[0]?1:0}),h.find(g,function(a){var e=Sb.cache().getFolderFromCacheList(a[1]);return e&&(e.interval=d,b.push(a[1])),c<=b.length}),h.uniq(b)},rb.prototype.removeMessagesFromList=function(a,b,c,d){c=Fb.isNormal(c)?c:"",d=Fb.isUnd(d)?!1:!!d,b=h.map(b,function(a){return Fb.pInt(a)});var e=0,f=Sb.data(),g=Sb.cache(),i=f.messageList(),j=Sb.cache().getFolderFromCacheList(a),k=""===c?null:g.getFolderFromCacheList(c||""),l=f.currentFolderFullNameRaw(),m=f.message(),n=l===a?h.filter(i,function(a){return a&&-1<Fb.inArray(Fb.pInt(a.uid),b)}):[];h.each(n,function(a){a&&a.unseen()&&e++}),j&&!d&&(j.messageCountAll(0<=j.messageCountAll()-b.length?j.messageCountAll()-b.length:0),e>0&&j.messageCountUnread(0<=j.messageCountUnread()-e?j.messageCountUnread()-e:0)),k&&(k.messageCountAll(k.messageCountAll()+b.length),e>0&&k.messageCountUnread(k.messageCountUnread()+e),k.actionBlink(!0)),0<n.length&&(d?h.each(n,function(a){a.checked(!1)}):(f.messageListIsNotCompleted(!0),h.each(n,function(a){m&&m.hash===a.hash&&(m=null,f.message(null)),a.deleted(!0)}),h.delay(function(){h.each(n,function(a){f.messageList.remove(a)})},400))),""!==a&&g.setFolderHash(a,""),""!==c&&g.setFolderHash(c,"")},rb.prototype.setMessage=function(a,c){var d=!1,e=!1,f=!1,g=null,h=null,i="",j="",k=!1,l=!1,m=this.messagesBodiesDom(),n=this.message();a&&n&&a.Result&&"Object/Message"===a.Result["@Object"]&&n.folderFullNameRaw===a.Result.Folder&&n.uid===a.Result.Uid&&(this.messageError(""),n.initUpdateByMessageJson(a.Result),Sb.cache().addRequestedMessage(n.folderFullNameRaw,n.uid),c||n.initFlagsByJson(a.Result),m=m&&m[0]?m:null,m&&(i="rl-mgs-"+n.hash.replace(/[^a-zA-Z0-9]/g,""),h=m.find("#"+i),h&&h[0]?(n.body=h,n.body&&(n.body.data("rl-cache-count",++Ib.iMessageBodyCacheCount),n.fetchDataToDom())):(e=!!a.Result.HasExternals,f=!!a.Result.HasInternals,g=b('<div id="'+i+'" />').hide().addClass("rl-cache-class"),g.data("rl-cache-count",++Ib.iMessageBodyCacheCount),Fb.isNormal(a.Result.Html)&&""!==a.Result.Html?(d=!0,g.html(a.Result.Html.toString()).addClass("b-text-part html")):Fb.isNormal(a.Result.Plain)&&""!==a.Result.Plain?(d=!1,j=a.Result.Plain.toString(),(n.isPgpSigned()||n.isPgpEncrypted())&&Sb.data().capaOpenPGP()&&Fb.isNormal(a.Result.PlainRaw)&&(n.plainRaw=Fb.pString(a.Result.PlainRaw),l=/---BEGIN PGP MESSAGE---/.test(n.plainRaw),l||(k=/-----BEGIN PGP SIGNED MESSAGE-----/.test(n.plainRaw)&&/-----BEGIN PGP SIGNATURE-----/.test(n.plainRaw)),Tb.empty(),k&&n.isPgpSigned()?j=Tb.append(b('<pre class="b-plain-openpgp signed"></pre>').text(n.plainRaw)).html():l&&n.isPgpEncrypted()&&(j=Tb.append(b('<pre class="b-plain-openpgp encrypted"></pre>').text(n.plainRaw)).html()),Tb.empty(),n.isPgpSigned(k),n.isPgpEncrypted(l)),g.html(j).addClass("b-text-part plain")):d=!1,n.isHtml(!!d),n.hasImages(!!e),n.pgpSignedVerifyStatus(Db.SignedVerifyStatus.None),n.pgpSignedVerifyUser(""),a.Result.Rtl&&(n.isRtl(!0),g.addClass("rtl-text-part")),n.body=g,n.body&&m.append(n.body),n.storeDataToDom(),f&&n.showInternalImages(!0),n.hasImages()&&this.showImages()&&n.showExternalImages(!0),this.purgeMessageBodyCacheThrottle()),this.messageActiveDom(n.body),this.hideMessageBodies(),n.body.show(),g&&Fb.initBlockquoteSwitcher(g)),Sb.cache().initMessageFlagsFromCache(n),n.unseen()&&Sb.setMessageSeen(n),Fb.windowResize())},rb.prototype.calculateMessageListHash=function(a){return h.map(a,function(a){return""+a.hash+"_"+a.threadsLen()+"_"+a.flagHash()}).join("|")},rb.prototype.setMessageList=function(a,b){if(a&&a.Result&&"Collection/MessageCollection"===a.Result["@Object"]&&a.Result["@Collection"]&&Fb.isArray(a.Result["@Collection"])){var c=Sb.data(),d=Sb.cache(),e=null,g=0,h=0,i=0,j=0,k=[],l=f().unix(),m=c.staticMessageList,n=null,o=null,p=null,q=0,r=!1;for(i=Fb.pInt(a.Result.MessageResultCount),j=Fb.pInt(a.Result.Offset),Fb.isNonEmptyArray(a.Result.LastCollapsedThreadUids)&&(e=a.Result.LastCollapsedThreadUids),p=Sb.cache().getFolderFromCacheList(Fb.isNormal(a.Result.Folder)?a.Result.Folder:""),p&&!b&&(p.interval=l,Sb.cache().setFolderHash(a.Result.Folder,a.Result.FolderHash),Fb.isNormal(a.Result.MessageCount)&&p.messageCountAll(a.Result.MessageCount),Fb.isNormal(a.Result.MessageUnseenCount)&&(Fb.pInt(p.messageCountUnread())!==Fb.pInt(a.Result.MessageUnseenCount)&&(r=!0),p.messageCountUnread(a.Result.MessageUnseenCount)),this.initUidNextAndNewMessages(p.fullNameRaw,a.Result.UidNext,a.Result.NewMessages)),r&&p&&Sb.cache().clearMessageFlagsFromCacheByFolder(p.fullNameRaw),g=0,h=a.Result["@Collection"].length;h>g;g++)n=a.Result["@Collection"][g],n&&"Object/Message"===n["@Object"]&&(o=m[g],o&&o.initByJson(n)||(o=A.newInstanceFromJson(n)),o&&(d.hasNewMessageAndRemoveFromCache(o.folderFullNameRaw,o.uid)&&5>=q&&(q++,o.newForAnimation(!0)),o.deleted(!1),b?Sb.cache().initMessageFlagsFromCache(o):Sb.cache().storeMessageFlagsToCache(o),o.lastInCollapsedThread(e&&-1<Fb.inArray(Fb.pInt(o.uid),e)?!0:!1),k.push(o)));c.messageListCount(i),c.messageListSearch(Fb.isNormal(a.Result.Search)?a.Result.Search:""),c.messageListPage(Math.ceil(j/c.messagesPerPage()+1)),c.messageListEndFolder(Fb.isNormal(a.Result.Folder)?a.Result.Folder:""),c.messageListEndSearch(Fb.isNormal(a.Result.Search)?a.Result.Search:""),c.messageListEndPage(c.messageListPage()),c.messageList(k),c.messageListIsNotCompleted(!1),m.length<k.length&&(c.staticMessageList=k),d.clearNewMessageCache(),p&&(b||r||Sb.data().useThreads())&&Sb.folderInformation(p.fullNameRaw,k)}else Sb.data().messageListCount(0),Sb.data().messageList([]),Sb.data().messageListError(Fb.getNotification(a&&a.ErrorCode?a.ErrorCode:Db.Notification.CantGetMessageList))},rb.prototype.findPublicKeyByHex=function(a){return h.find(this.openpgpkeysPublic(),function(b){return b&&a===b.id})},rb.prototype.findPublicKeysByEmail=function(b){return h.compact(h.map(this.openpgpkeysPublic(),function(c){var d=null;if(c&&b===c.email)try{if(d=a.openpgp.key.readArmored(c.armor),d&&!d.err&&d.keys&&d.keys[0])return d.keys[0]}catch(e){}return null}))},rb.prototype.findPrivateKeyByEmail=function(b,c){var d=null,e=h.find(this.openpgpkeysPrivate(),function(a){return a&&b===a.email});if(e)try{d=a.openpgp.key.readArmored(e.armor),d&&!d.err&&d.keys&&d.keys[0]?(d=d.keys[0],d.decrypt(Fb.pString(c))):d=null}catch(f){d=null}return d},rb.prototype.findSelfPrivateKey=function(a){return this.findPrivateKeyByEmail(this.accountEmail(),a)},sb.prototype.oRequests={},sb.prototype.defaultResponse=function(b,c,d,e,f,g){var i=function(){Db.StorageResultType.Success!==d&&Ib.bUnload&&(d=Db.StorageResultType.Unload),Db.StorageResultType.Success===d&&e&&!e.Result?(e&&-1<Fb.inArray(e.ErrorCode,[Db.Notification.AuthError,Db.Notification.AccessError,Db.Notification.ConnectionError,Db.Notification.DomainNotAllowed,Db.Notification.AccountNotAllowed,Db.Notification.MailServerError,Db.Notification.UnknownNotification,Db.Notification.UnknownError])&&Ib.iAjaxErrorCount++,e&&Db.Notification.InvalidToken===e.ErrorCode&&Ib.iTokenErrorCount++,Cb.Values.TokenErrorLimit<Ib.iTokenErrorCount&&Sb.loginAndLogoutReload(!0),(e.Logout||Cb.Values.AjaxErrorLimit<Ib.iAjaxErrorCount)&&(a.__rlah_clear&&a.__rlah_clear(),Sb.loginAndLogoutReload(!0))):Db.StorageResultType.Success===d&&e&&e.Result&&(Ib.iAjaxErrorCount=0,Ib.iTokenErrorCount=0),b&&(Gb.runHook("ajax-default-response",[c,Db.StorageResultType.Success===d?e:null,d,f,g]),b(d,Db.StorageResultType.Success===d?e:null,f,c,g))};switch(d){case"success":d=Db.StorageResultType.Success;break;case"abort":d=Db.StorageResultType.Abort;break;default:d=Db.StorageResultType.Error}Db.StorageResultType.Error===d?h.delay(i,300):i()},sb.prototype.ajaxRequest=function(c,d,e,f,g){var i=this,j=""===f,k={},l=(new a.Date).getTime(),m=null,n="";return d=d||{},e=Fb.isNormal(e)?e:2e4,f=Fb.isUnd(f)?"":Fb.pString(f),g=Fb.isArray(g)?g:[],n=d.Action||"",n&&0<g.length&&h.each(g,function(a){i.oRequests[a]&&(i.oRequests[a].__aborted=!0,i.oRequests[a].abort&&i.oRequests[a].abort(),i.oRequests[a]=null)}),j&&(d.XToken=Sb.settingsGet("Token")),m=b.ajax({type:j?"POST":"GET",url:Sb.link().ajax(f),async:!0,dataType:"json",data:j?d:{},headers:k,timeout:e,global:!0}),m.always(function(b,e){var f=!1;b&&b.Time&&(f=Fb.pInt(b.Time)>(new a.Date).getTime()-l),n&&i.oRequests[n]&&(i.oRequests[n].__aborted&&(e="abort"),i.oRequests[n]=null),i.defaultResponse(c,n,e,b,f,d)}),n&&0<g.length&&-1<Fb.inArray(n,g)&&(this.oRequests[n]&&(this.oRequests[n].__aborted=!0,this.oRequests[n].abort&&this.oRequests[n].abort(),this.oRequests[n]=null),this.oRequests[n]=m),m},sb.prototype.defaultRequest=function(a,b,c,d,e,f){c=c||{},c.Action=b,e=Fb.pString(e),Gb.runHook("ajax-default-request",[b,c,e]),this.ajaxRequest(a,c,Fb.isUnd(d)?Cb.Defaults.DefaultAjaxTimeout:Fb.pInt(d),e,f)},sb.prototype.noop=function(a){this.defaultRequest(a,"Noop")},sb.prototype.jsError=function(a,b,c,d,e,f,g){this.defaultRequest(a,"JsError",{Message:b,FileName:c,LineNo:d,Location:e,HtmlCapa:f,TimeOnPage:g})},sb.prototype.jsInfo=function(a,b,c,d){this.defaultRequest(a,"JsInfo",{Type:b,Data:c,IsError:(Fb.isUnd(d)?1:!d)?"0":"1"})},sb.prototype.jsVersion=function(a,b){this.defaultRequest(a,"Version",{Version:b})},h.extend(tb.prototype,sb.prototype),tb.prototype.folders=function(a){this.defaultRequest(a,"Folders",{SentFolder:Sb.settingsGet("SentFolder"),DraftFolder:Sb.settingsGet("DraftFolder"),SpamFolder:Sb.settingsGet("SpamFolder"),TrashFolder:Sb.settingsGet("TrashFolder"),ArchiveFolder:Sb.settingsGet("ArchiveFolder")},null,"",["Folders"])},tb.prototype.login=function(a,b,c,d,e,f,g,h){this.defaultRequest(a,"Login",{Email:b,Login:c,Password:d,Language:f||"",AdditionalCode:g||"",AdditionalCodeSignMe:h?"1":"0",SignMe:e?"1":"0"})},tb.prototype.getTwoFactor=function(a){this.defaultRequest(a,"GetTwoFactorInfo")},tb.prototype.createTwoFactor=function(a){this.defaultRequest(a,"CreateTwoFactorSecret")},tb.prototype.clearTwoFactor=function(a){this.defaultRequest(a,"ClearTwoFactorInfo")},tb.prototype.showTwoFactorSecret=function(a){this.defaultRequest(a,"ShowTwoFactorSecret")},tb.prototype.testTwoFactor=function(a,b){this.defaultRequest(a,"TestTwoFactorInfo",{Code:b})},tb.prototype.enableTwoFactor=function(a,b){this.defaultRequest(a,"EnableTwoFactor",{Enable:b?"1":"0"})},tb.prototype.clearTwoFactorInfo=function(a){this.defaultRequest(a,"ClearTwoFactorInfo")},tb.prototype.contactsSync=function(a){this.defaultRequest(a,"ContactsSync",null,Cb.Defaults.ContactsSyncAjaxTimeout)},tb.prototype.saveContactsSyncData=function(a,b,c,d,e){this.defaultRequest(a,"SaveContactsSyncData",{Enable:b?"1":"0",Url:c,User:d,Password:e})},tb.prototype.accountAdd=function(a,b,c,d){this.defaultRequest(a,"AccountAdd",{Email:b,Login:c,Password:d})},tb.prototype.accountDelete=function(a,b){this.defaultRequest(a,"AccountDelete",{EmailToDelete:b})},tb.prototype.identityUpdate=function(a,b,c,d,e,f){this.defaultRequest(a,"IdentityUpdate",{Id:b,Email:c,Name:d,ReplyTo:e,Bcc:f})},tb.prototype.identityDelete=function(a,b){this.defaultRequest(a,"IdentityDelete",{IdToDelete:b})},tb.prototype.accountsAndIdentities=function(a){this.defaultRequest(a,"AccountsAndIdentities")},tb.prototype.messageList=function(a,b,c,d,e,f){b=Fb.pString(b);var g=Sb.data(),h=Sb.cache().getFolderHash(b);f=Fb.isUnd(f)?!1:!!f,c=Fb.isUnd(c)?0:Fb.pInt(c),d=Fb.isUnd(c)?20:Fb.pInt(d),e=Fb.pString(e),""===h||""!==e&&-1!==e.indexOf("has:")?this.defaultRequest(a,"MessageList",{Folder:b,Offset:c,Limit:d,Search:e,UidNext:"INBOX"===b?Sb.cache().getFolderUidNext(b):"",UseThreads:Sb.data().threading()&&Sb.data().useThreads()?"1":"0",ExpandedThreadUid:g.threading()&&b===g.messageListThreadFolder()?g.messageListThreadUids().join(","):""},""===e?Cb.Defaults.DefaultAjaxTimeout:Cb.Defaults.SearchAjaxTimeout,"",f?[]:["MessageList"]):this.defaultRequest(a,"MessageList",{},""===e?Cb.Defaults.DefaultAjaxTimeout:Cb.Defaults.SearchAjaxTimeout,"MessageList/"+Hb.urlsafe_encode([b,c,d,e,g.projectHash(),h,"INBOX"===b?Sb.cache().getFolderUidNext(b):"",g.threading()&&g.useThreads()?"1":"0",g.threading()&&b===g.messageListThreadFolder()?g.messageListThreadUids().join(","):""].join(String.fromCharCode(0))),f?[]:["MessageList"])},tb.prototype.messageUploadAttachments=function(a,b){this.defaultRequest(a,"MessageUploadAttachments",{Attachments:b},999e3)},tb.prototype.message=function(a,b,c){return b=Fb.pString(b),c=Fb.pInt(c),Sb.cache().getFolderFromCacheList(b)&&c>0?(this.defaultRequest(a,"Message",{},null,"Message/"+Hb.urlsafe_encode([b,c,Sb.data().projectHash(),Sb.data().threading()&&Sb.data().useThreads()?"1":"0"].join(String.fromCharCode(0))),["Message"]),!0):!1},tb.prototype.composeUploadExternals=function(a,b){this.defaultRequest(a,"ComposeUploadExternals",{Externals:b},999e3)},tb.prototype.folderInformation=function(a,b,c){var d=!0,e=Sb.cache(),f=[];Fb.isArray(c)&&0<c.length&&(d=!1,h.each(c,function(a){e.getMessageFlagsFromCache(a.folderFullNameRaw,a.uid)||f.push(a.uid),0<a.threads().length&&h.each(a.threads(),function(b){e.getMessageFlagsFromCache(a.folderFullNameRaw,b)||f.push(b)})}),0<f.length&&(d=!0)),d?this.defaultRequest(a,"FolderInformation",{Folder:b,FlagsUids:Fb.isArray(f)?f.join(","):"",UidNext:"INBOX"===b?Sb.cache().getFolderUidNext(b):""}):Sb.data().useThreads()&&Sb.reloadFlagsCurrentMessageListAndMessageFromCache()},tb.prototype.folderInformationMultiply=function(a,b){this.defaultRequest(a,"FolderInformationMultiply",{Folders:b})},tb.prototype.logout=function(a){this.defaultRequest(a,"Logout")},tb.prototype.messageSetFlagged=function(a,b,c,d){this.defaultRequest(a,"MessageSetFlagged",{Folder:b,Uids:c.join(","),SetAction:d?"1":"0"})},tb.prototype.messageSetSeen=function(a,b,c,d){this.defaultRequest(a,"MessageSetSeen",{Folder:b,Uids:c.join(","),SetAction:d?"1":"0"})},tb.prototype.messageSetSeenToAll=function(a,b,c){this.defaultRequest(a,"MessageSetSeenToAll",{Folder:b,SetAction:c?"1":"0"})},tb.prototype.saveMessage=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){this.defaultRequest(a,"SaveMessage",{MessageFolder:b,MessageUid:c,DraftFolder:d,From:e,To:f,Cc:g,Bcc:h,Subject:i,TextIsHtml:j?"1":"0",Text:k,DraftInfo:m,InReplyTo:n,References:o,Attachments:l},Cb.Defaults.SaveMessageAjaxTimeout)},tb.prototype.sendReadReceiptMessage=function(a,b,c,d,e,f){this.defaultRequest(a,"SendReadReceiptMessage",{MessageFolder:b,MessageUid:c,ReadReceipt:d,Subject:e,Text:f})},tb.prototype.sendMessage=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.defaultRequest(a,"SendMessage",{MessageFolder:b,MessageUid:c,SentFolder:d,From:e,To:f,Cc:g,Bcc:h,Subject:i,TextIsHtml:j?"1":"0",Text:k,DraftInfo:m,InReplyTo:n,References:o,ReadReceiptRequest:p?"1":"0",Attachments:l},Cb.Defaults.SendMessageAjaxTimeout)},tb.prototype.saveSystemFolders=function(a,b){this.defaultRequest(a,"SystemFoldersUpdate",b)},tb.prototype.saveSettings=function(a,b){this.defaultRequest(a,"SettingsUpdate",b)},tb.prototype.changePassword=function(a,b,c){this.defaultRequest(a,"ChangePassword",{PrevPassword:b,NewPassword:c})},tb.prototype.folderCreate=function(a,b,c){this.defaultRequest(a,"FolderCreate",{Folder:b,Parent:c},null,"",["Folders"])},tb.prototype.folderDelete=function(a,b){this.defaultRequest(a,"FolderDelete",{Folder:b},null,"",["Folders"])},tb.prototype.folderRename=function(a,b,c){this.defaultRequest(a,"FolderRename",{Folder:b,NewFolderName:c},null,"",["Folders"])},tb.prototype.folderClear=function(a,b){this.defaultRequest(a,"FolderClear",{Folder:b})},tb.prototype.folderSetSubscribe=function(a,b,c){this.defaultRequest(a,"FolderSubscribe",{Folder:b,Subscribe:c?"1":"0"})},tb.prototype.messagesMove=function(a,b,c,d,e){this.defaultRequest(a,"MessageMove",{FromFolder:b,ToFolder:c,Uids:d.join(","),Learning:e||""},null,"",["MessageList"])},tb.prototype.messagesCopy=function(a,b,c,d){this.defaultRequest(a,"MessageCopy",{FromFolder:b,ToFolder:c,Uids:d.join(",")})},tb.prototype.messagesDelete=function(a,b,c){this.defaultRequest(a,"MessageDelete",{Folder:b,Uids:c.join(",")},null,"",["MessageList"])},tb.prototype.appDelayStart=function(a){this.defaultRequest(a,"AppDelayStart")},tb.prototype.quota=function(a){this.defaultRequest(a,"Quota")},tb.prototype.contacts=function(a,b,c,d){this.defaultRequest(a,"Contacts",{Offset:b,Limit:c,Search:d},null,"",["Contacts"])},tb.prototype.contactSave=function(a,b,c,d,e){this.defaultRequest(a,"ContactSave",{RequestUid:b,Uid:Fb.trim(c),Tags:Fb.trim(d),Properties:e})},tb.prototype.contactsDelete=function(a,b){this.defaultRequest(a,"ContactsDelete",{Uids:b.join(",")})},tb.prototype.suggestions=function(a,b,c){this.defaultRequest(a,"Suggestions",{Query:b,Page:c},null,"",["Suggestions"])},tb.prototype.servicesPics=function(a){this.defaultRequest(a,"ServicesPics")},tb.prototype.emailsPicsHashes=function(a){this.defaultRequest(a,"EmailsPicsHashes")},tb.prototype.facebookUser=function(a){this.defaultRequest(a,"SocialFacebookUserInformation")},tb.prototype.facebookDisconnect=function(a){this.defaultRequest(a,"SocialFacebookDisconnect")},tb.prototype.twitterUser=function(a){this.defaultRequest(a,"SocialTwitterUserInformation")},tb.prototype.twitterDisconnect=function(a){this.defaultRequest(a,"SocialTwitterDisconnect")},tb.prototype.googleUser=function(a){this.defaultRequest(a,"SocialGoogleUserInformation")},tb.prototype.googleDisconnect=function(a){this.defaultRequest(a,"SocialGoogleDisconnect")},tb.prototype.socialUsers=function(a){this.defaultRequest(a,"SocialUsers")},ub.prototype.oEmailsPicsHashes={},ub.prototype.oServices={},ub.prototype.bCapaGravatar=!1,ub.prototype.clear=function(){this.oServices={},this.oEmailsPicsHashes={}},ub.prototype.getUserPic=function(a,b){a=Fb.trim(a);var c="",d="",e=a.toLowerCase(),f=Fb.isUnd(this.oEmailsPicsHashes[e])?"":this.oEmailsPicsHashes[e];""!==f?c=Sb.link().getUserPicUrlFromHash(f):(d=e.substr(a.indexOf("@")+1),c=""!==d&&this.oServices[d]?this.oServices[d]:""),this.bCapaGravatar&&""===c&&""!==e?b("//secure.gravatar.com/avatar/"+Fb.md5(e)+".jpg?s=80&d=mm",a):b(c,a)},ub.prototype.setServicesData=function(a){this.oServices=a},ub.prototype.setEmailsPicsHashesData=function(a){this.oEmailsPicsHashes=a},h.extend(vb.prototype,ub.prototype),vb.prototype.oFoldersCache={},vb.prototype.oFoldersNamesCache={},vb.prototype.oFolderHashCache={},vb.prototype.oFolderUidNextCache={},vb.prototype.oMessageListHashCache={},vb.prototype.oMessageFlagsCache={},vb.prototype.oBodies={},vb.prototype.oNewMessage={},vb.prototype.oRequestedMessage={},vb.prototype.clear=function(){ub.prototype.clear.call(this),this.oFoldersCache={},this.oFoldersNamesCache={},this.oFolderHashCache={},this.oFolderUidNextCache={},this.oMessageListHashCache={},this.oMessageFlagsCache={},this.oBodies={}},vb.prototype.getMessageKey=function(a,b){return a+"#"+b},vb.prototype.addRequestedMessage=function(a,b){this.oRequestedMessage[this.getMessageKey(a,b)]=!0},vb.prototype.hasRequestedMessage=function(a,b){return!0===this.oRequestedMessage[this.getMessageKey(a,b)]},vb.prototype.addNewMessageCache=function(a,b){this.oNewMessage[this.getMessageKey(a,b)]=!0},vb.prototype.hasNewMessageAndRemoveFromCache=function(a,b){return this.oNewMessage[this.getMessageKey(a,b)]?(this.oNewMessage[this.getMessageKey(a,b)]=null,!0):!1},vb.prototype.clearNewMessageCache=function(){this.oNewMessage={}},vb.prototype.getFolderFullNameRaw=function(a){return""!==a&&this.oFoldersNamesCache[a]?this.oFoldersNamesCache[a]:""},vb.prototype.setFolderFullNameRaw=function(a,b){this.oFoldersNamesCache[a]=b},vb.prototype.getFolderHash=function(a){return""!==a&&this.oFolderHashCache[a]?this.oFolderHashCache[a]:""},vb.prototype.setFolderHash=function(a,b){this.oFolderHashCache[a]=b},vb.prototype.getFolderUidNext=function(a){return""!==a&&this.oFolderUidNextCache[a]?this.oFolderUidNextCache[a]:""},vb.prototype.setFolderUidNext=function(a,b){this.oFolderUidNextCache[a]=b},vb.prototype.getFolderFromCacheList=function(a){return""!==a&&this.oFoldersCache[a]?this.oFoldersCache[a]:null},vb.prototype.setFolderToCacheList=function(a,b){this.oFoldersCache[a]=b},vb.prototype.removeFolderFromCacheList=function(a){this.setFolderToCacheList(a,null)},vb.prototype.getMessageFlagsFromCache=function(a,b){return this.oMessageFlagsCache[a]&&this.oMessageFlagsCache[a][b]?this.oMessageFlagsCache[a][b]:null},vb.prototype.setMessageFlagsToCache=function(a,b,c){this.oMessageFlagsCache[a]||(this.oMessageFlagsCache[a]={}),this.oMessageFlagsCache[a][b]=c},vb.prototype.clearMessageFlagsFromCacheByFolder=function(a){this.oMessageFlagsCache[a]={}},vb.prototype.initMessageFlagsFromCache=function(a){if(a){var b=this,c=this.getMessageFlagsFromCache(a.folderFullNameRaw,a.uid),d=null,e=null;c&&0<c.length&&(a.unseen(!!c[0]),a.flagged(!!c[1]),a.answered(!!c[2]),a.forwarded(!!c[3]),a.isReadReceipt(!!c[4])),0<a.threads().length&&(d=h.find(a.threads(),function(c){var d=b.getMessageFlagsFromCache(a.folderFullNameRaw,c);return d&&0<d.length&&!!d[0]}),e=h.find(a.threads(),function(c){var d=b.getMessageFlagsFromCache(a.folderFullNameRaw,c);return d&&0<d.length&&!!d[1]}),a.hasUnseenSubMessage(d&&0<Fb.pInt(d)),a.hasFlaggedSubMessage(e&&0<Fb.pInt(e)))}},vb.prototype.storeMessageFlagsToCache=function(a){a&&this.setMessageFlagsToCache(a.folderFullNameRaw,a.uid,[a.unseen(),a.flagged(),a.answered(),a.forwarded(),a.isReadReceipt()])},vb.prototype.storeMessageFlagsToCacheByFolderAndUid=function(a,b,c){Fb.isArray(c)&&0<c.length&&this.setMessageFlagsToCache(a,b,c)},h.extend(wb.prototype,s.prototype),wb.prototype.onRoute=function(a){var d=this,e=null,f=null,g=null,i=null;f=h.find(Jb.settings,function(b){return b&&b.__rlSettingsData&&a===b.__rlSettingsData.Route}),f&&(h.find(Jb["settings-removed"],function(a){return a&&a===f})&&(f=null),f&&h.find(Jb["settings-disabled"],function(a){return a&&a===f})&&(f=null)),f?(f.__builded&&f.__vm?e=f.__vm:(g=this.oViewModelPlace,g&&1===g.length?(f=f,e=new f,i=b("<div></div>").addClass("rl-settings-view-model").hide(),i.appendTo(g),e.data=Sb.data(),e.viewModelDom=i,e.__rlSettingsData=f.__rlSettingsData,f.__dom=i,f.__builded=!0,f.__vm=e,c.applyBindingAccessorsToNode(i[0],{i18nInit:!0,template:function(){return{name:f.__rlSettingsData.Template}}},e),Fb.delegateRun(e,"onBuild",[i])):Fb.log("Cannot find sub settings view model position: SettingsSubScreen")),e&&h.defer(function(){d.oCurrentSubScreen&&(Fb.delegateRun(d.oCurrentSubScreen,"onHide"),d.oCurrentSubScreen.viewModelDom.hide()),d.oCurrentSubScreen=e,d.oCurrentSubScreen&&(d.oCurrentSubScreen.viewModelDom.show(),Fb.delegateRun(d.oCurrentSubScreen,"onShow"),Fb.delegateRun(d.oCurrentSubScreen,"onFocus",[],200),h.each(d.menu(),function(a){a.selected(e&&e.__rlSettingsData&&a.route===e.__rlSettingsData.Route)}),b("#rl-content .b-settings .b-content .content").scrollTop(0)),Fb.windowResize()})):Lb.setHash(Sb.link().settings(),!1,!0)},wb.prototype.onHide=function(){this.oCurrentSubScreen&&this.oCurrentSubScreen.viewModelDom&&(Fb.delegateRun(this.oCurrentSubScreen,"onHide"),this.oCurrentSubScreen.viewModelDom.hide())},wb.prototype.onBuild=function(){h.each(Jb.settings,function(a){a&&a.__rlSettingsData&&!h.find(Jb["settings-removed"],function(b){return b&&b===a})&&this.menu.push({route:a.__rlSettingsData.Route,label:a.__rlSettingsData.Label,selected:c.observable(!1),disabled:!!h.find(Jb["settings-disabled"],function(b){return b&&b===a})})},this),this.oViewModelPlace=b("#rl-content #rl-settings-subscreen")},wb.prototype.routes=function(){var a=h.find(Jb.settings,function(a){return a&&a.__rlSettingsData&&a.__rlSettingsData.IsDefault}),b=a?a.__rlSettingsData.Route:"general",c={subname:/^(.*)$/,normalize_:function(a,c){return c.subname=Fb.isUnd(c.subname)?b:Fb.pString(c.subname),[c.subname]}};return[["{subname}/",c],["{subname}",c],["",c]]},h.extend(xb.prototype,s.prototype),xb.prototype.onShow=function(){Sb.setTitle("")},h.extend(yb.prototype,s.prototype),yb.prototype.oLastRoute={},yb.prototype.setNewTitle=function(){var a=Sb.data().accountEmail(),b=Sb.data().foldersInboxUnreadCount();Sb.setTitle((""===a?"":(b>0?"("+b+") ":" ")+a+" - ")+Fb.i18n("TITLES/MAILBOX"))},yb.prototype.onShow=function(){this.setNewTitle(),Sb.data().keyScope(Db.KeyState.MessageList)},yb.prototype.onRoute=function(a,b,c,d){if(Fb.isUnd(d)?1:!d){var e=Sb.data(),f=Sb.cache().getFolderFullNameRaw(a),g=Sb.cache().getFolderFromCacheList(f);g&&(e.currentFolder(g).messageListPage(b).messageListSearch(c),Db.Layout.NoPreview===e.layout()&&e.message()&&(e.message(null),e.messageFullScreenMode(!1)),Sb.reloadMessageList())}else Db.Layout.NoPreview!==Sb.data().layout()||Sb.data().message()||Sb.historyBack()},yb.prototype.onStart=function(){var a=Sb.data(),b=function(){Fb.windowResize()};(Sb.capa(Db.Capa.AdditionalAccounts)||Sb.capa(Db.Capa.AdditionalIdentities))&&Sb.accountsAndIdentities(),h.delay(function(){"INBOX"!==a.currentFolderFullNameRaw()&&Sb.folderInformation("INBOX")
},1e3),h.delay(function(){Sb.quota()},5e3),h.delay(function(){Sb.remote().appDelayStart(Fb.emptyFunction)},35e3),Ob.toggleClass("rl-no-preview-pane",Db.Layout.NoPreview===a.layout()),a.folderList.subscribe(b),a.messageList.subscribe(b),a.message.subscribe(b),a.layout.subscribe(function(a){Ob.toggleClass("rl-no-preview-pane",Db.Layout.NoPreview===a)}),a.foldersInboxUnreadCount.subscribe(function(){this.setNewTitle()},this)},yb.prototype.routes=function(){var a=function(){return["Inbox",1,"",!0]},b=function(a,b){return b[0]=Fb.pString(b[0]),b[1]=Fb.pInt(b[1]),b[1]=0>=b[1]?1:b[1],b[2]=Fb.pString(b[2]),""===a&&(b[0]="Inbox",b[1]=1),[decodeURI(b[0]),b[1],decodeURI(b[2]),!1]},c=function(a,b){return b[0]=Fb.pString(b[0]),b[1]=Fb.pString(b[1]),""===a&&(b[0]="Inbox"),[decodeURI(b[0]),1,decodeURI(b[1]),!1]};return[[/^([a-zA-Z0-9]+)\/p([1-9][0-9]*)\/(.+)\/?$/,{normalize_:b}],[/^([a-zA-Z0-9]+)\/p([1-9][0-9]*)$/,{normalize_:b}],[/^([a-zA-Z0-9]+)\/(.+)\/?$/,{normalize_:c}],[/^message-preview$/,{normalize_:a}],[/^([^\/]*)$/,{normalize_:b}]]},h.extend(zb.prototype,wb.prototype),zb.prototype.onShow=function(){Sb.setTitle(this.sSettingsTitle),Sb.data().keyScope(Db.KeyState.Settings)},h.extend(Ab.prototype,q.prototype),Ab.prototype.oSettings=null,Ab.prototype.oPlugins=null,Ab.prototype.oLocal=null,Ab.prototype.oLink=null,Ab.prototype.oSubs={},Ab.prototype.download=function(b){var c=null,d=null,e=navigator.userAgent.toLowerCase();return e&&(e.indexOf("chrome")>-1||e.indexOf("chrome")>-1)&&(c=document.createElement("a"),c.href=b,document.createEvent&&(d=document.createEvent("MouseEvents"),d&&d.initEvent&&c.dispatchEvent))?(d.initEvent("click",!0,!0),c.dispatchEvent(d),!0):(Ib.bMobileDevice?(a.open(b,"_self"),a.focus()):this.iframe.attr("src",b),!0)},Ab.prototype.link=function(){return null===this.oLink&&(this.oLink=new k),this.oLink},Ab.prototype.local=function(){return null===this.oLocal&&(this.oLocal=new p),this.oLocal},Ab.prototype.settingsGet=function(a){return null===this.oSettings&&(this.oSettings=Fb.isNormal(Mb)?Mb:{}),Fb.isUnd(this.oSettings[a])?null:this.oSettings[a]},Ab.prototype.settingsSet=function(a,b){null===this.oSettings&&(this.oSettings=Fb.isNormal(Mb)?Mb:{}),this.oSettings[a]=b},Ab.prototype.setTitle=function(b){b=(Fb.isNormal(b)&&0<b.length?b+" - ":"")+Sb.settingsGet("Title")||"",a.document.title="_",a.document.title=b},Ab.prototype.loginAndLogoutReload=function(b,c){var d=Fb.pString(Sb.settingsGet("CustomLogoutLink")),e=!!Sb.settingsGet("InIframe");b=Fb.isUnd(b)?!1:!!b,c=Fb.isUnd(c)?!1:!!c,b&&c&&a.close&&a.close(),b&&""!==d&&a.location.href!==d?h.delay(function(){e&&a.parent?a.parent.location.href=d:a.location.href=d},100):(Lb.routeOff(),Lb.setHash(Sb.link().root(),!0),Lb.routeOff(),h.delay(function(){e&&a.parent?a.parent.location.reload():a.location.reload()},100))},Ab.prototype.historyBack=function(){a.history.back()},Ab.prototype.getAutocomplete=function(a,b){b([],a)},Ab.prototype.sub=function(a,b,c){return Fb.isUnd(this.oSubs[a])&&(this.oSubs[a]=[]),this.oSubs[a].push([b,c]),this},Ab.prototype.pub=function(a,b){return Gb.runHook("rl-pub",[a,b]),Fb.isUnd(this.oSubs[a])||h.each(this.oSubs[a],function(a){a[0]&&a[0].apply(a[1]||null,b||[])}),this},Ab.prototype.capa=function(a){var b=this.settingsGet("Capa");return Fb.isArray(b)&&Fb.isNormal(a)&&-1<Fb.inArray(a,b)},Ab.prototype.bootstart=function(){var a=this;Fb.initOnStartOrLangChange(function(){Fb.initNotificationLanguage()},null),h.delay(function(){Fb.windowResize()},1e3),ssm.addState({id:"mobile",maxWidth:767,onEnter:function(){Ob.addClass("ssm-state-mobile"),a.pub("ssm.mobile-enter")},onLeave:function(){Ob.removeClass("ssm-state-mobile"),a.pub("ssm.mobile-leave")}}),ssm.addState({id:"tablet",minWidth:768,maxWidth:999,onEnter:function(){Ob.addClass("ssm-state-tablet")},onLeave:function(){Ob.removeClass("ssm-state-tablet")}}),ssm.addState({id:"desktop",minWidth:1e3,maxWidth:1400,onEnter:function(){Ob.addClass("ssm-state-desktop")},onLeave:function(){Ob.removeClass("ssm-state-desktop")}}),ssm.addState({id:"desktop-large",minWidth:1400,onEnter:function(){Ob.addClass("ssm-state-desktop-large")},onLeave:function(){Ob.removeClass("ssm-state-desktop-large")}}),Sb.sub("ssm.mobile-enter",function(){Sb.data().leftPanelDisabled(!0)}),Sb.sub("ssm.mobile-leave",function(){Sb.data().leftPanelDisabled(!1)}),Sb.data().leftPanelDisabled.subscribe(function(a){Ob.toggleClass("rl-left-panel-disabled",a)}),ssm.ready()},h.extend(Bb.prototype,Ab.prototype),Bb.prototype.oData=null,Bb.prototype.oRemote=null,Bb.prototype.oCache=null,Bb.prototype.data=function(){return null===this.oData&&(this.oData=new rb),this.oData},Bb.prototype.remote=function(){return null===this.oRemote&&(this.oRemote=new tb),this.oRemote},Bb.prototype.cache=function(){return null===this.oCache&&(this.oCache=new vb),this.oCache},Bb.prototype.reloadFlagsCurrentMessageListAndMessageFromCache=function(){var a=Sb.cache();h.each(Sb.data().messageList(),function(b){a.initMessageFlagsFromCache(b)}),a.initMessageFlagsFromCache(Sb.data().message())},Bb.prototype.reloadMessageList=function(a,b){var c=Sb.data(),d=(c.messageListPage()-1)*c.messagesPerPage();(Fb.isUnd(b)?1:!b)||Sb.cache().setFolderHash(c.currentFolderFullNameRaw(),""),(Fb.isUnd(a)?1:!a)||(c.messageListPage(1),d=0),c.messageListLoading(!0),Sb.remote().messageList(function(a,b,d){Db.StorageResultType.Success===a&&b&&b.Result?(c.messageListError(""),c.messageListLoading(!1),c.setMessageList(b,d)):Db.StorageResultType.Unload===a?(c.messageListError(""),c.messageListLoading(!1)):Db.StorageResultType.Abort!==a&&(c.messageList([]),c.messageListLoading(!1),c.messageListError(b&&b.ErrorCode?Fb.getNotification(b.ErrorCode):Fb.i18n("NOTIFICATIONS/CANT_GET_MESSAGE_LIST")))},c.currentFolderFullNameRaw(),d,c.messagesPerPage(),c.messageListSearch())},Bb.prototype.recacheInboxMessageList=function(){Sb.remote().messageList(Fb.emptyFunction,"INBOX",0,Sb.data().messagesPerPage(),"",!0)},Bb.prototype.reloadMessageListHelper=function(a){Sb.reloadMessageList(a)},Bb.prototype.contactsSync=function(a){var b=Sb.data().contacts;return b.importing()||b.syncing()||!Sb.data().enableContactsSync()||!Sb.data().allowContactsSync()?!1:(b.syncing(!0),Sb.remote().contactsSync(function(c,d){b.syncing(!1),a&&a(c,d)}),!0)},Bb.prototype.messagesMoveTrigger=function(){var a=this,b=Sb.data().spamFolder();h.each(this.oMoveCache,function(c){var d=b===c.To,e=!d&&b===c.From&&"INBOX"===c.To;Sb.remote().messagesMove(a.moveOrDeleteResponseHelper,c.From,c.To,c.Uid,d?"SPAM":e?"HAM":"")}),this.oMoveCache={}},Bb.prototype.messagesMoveHelper=function(a,b,c){var d="$$"+a+"$$"+b+"$$";this.oMoveCache[d]||(this.oMoveCache[d]={From:a,To:b,Uid:[]}),this.oMoveCache[d].Uid=h.union(this.oMoveCache[d].Uid,c),this.messagesMoveTrigger()},Bb.prototype.messagesCopyHelper=function(a,b,c){Sb.remote().messagesCopy(this.moveOrDeleteResponseHelper,a,b,c)},Bb.prototype.messagesDeleteHelper=function(a,b){Sb.remote().messagesDelete(this.moveOrDeleteResponseHelper,a,b)},Bb.prototype.moveOrDeleteResponseHelper=function(b,c){Db.StorageResultType.Success===b&&Sb.data().currentFolder()&&(c&&Fb.isArray(c.Result)&&2===c.Result.length?Sb.cache().setFolderHash(c.Result[0],c.Result[1]):(Sb.cache().setFolderHash(Sb.data().currentFolderFullNameRaw(),""),c&&-1<Fb.inArray(c.ErrorCode,[Db.Notification.CantMoveMessage,Db.Notification.CantCopyMessage])&&a.alert(Fb.getNotification(c.ErrorCode))),Sb.reloadMessageListHelper(0===Sb.data().messageList().length),Sb.quotaDebounce())},Bb.prototype.deleteMessagesFromFolderWithoutCheck=function(a,b){this.messagesDeleteHelper(a,b),Sb.data().removeMessagesFromList(a,b)},Bb.prototype.deleteMessagesFromFolder=function(a,b,c,d){var e=this,f=Sb.data(),g=Sb.cache(),h=null,i=null;switch(a){case Db.FolderType.Spam:h=g.getFolderFromCacheList(f.spamFolder()),i=Db.SetSystemFoldersNotification.Spam;break;case Db.FolderType.NotSpam:h=g.getFolderFromCacheList("INBOX");break;case Db.FolderType.Trash:h=g.getFolderFromCacheList(f.trashFolder()),i=Db.SetSystemFoldersNotification.Trash;break;case Db.FolderType.Archive:h=g.getFolderFromCacheList(f.archiveFolder()),i=Db.SetSystemFoldersNotification.Archive}d=Fb.isUnd(d)?!0:!!d,d&&(Db.FolderType.Spam===a&&Cb.Values.UnuseOptionValue===f.spamFolder()||Db.FolderType.Trash===a&&Cb.Values.UnuseOptionValue===f.trashFolder()||Db.FolderType.Archive===a&&Cb.Values.UnuseOptionValue===f.archiveFolder())&&(d=!1),!h&&d?Lb.showScreenPopup(J,[i]):d&&(Db.FolderType.Trash!==a||b!==f.spamFolder()&&b!==f.trashFolder())?h&&(this.messagesMoveHelper(b,h.fullNameRaw,c),f.removeMessagesFromList(b,c,h.fullNameRaw)):Lb.showScreenPopup(V,[Fb.i18n("POPUPS_ASK/DESC_WANT_DELETE_MESSAGES"),function(){e.messagesDeleteHelper(b,c),f.removeMessagesFromList(b,c)}])},Bb.prototype.moveMessagesToFolder=function(a,b,c,d){if(a!==c&&Fb.isArray(b)&&0<b.length){var e=Sb.cache().getFolderFromCacheList(a),f=Sb.cache().getFolderFromCacheList(c);if(e&&f)return(Fb.isUnd(d)?1:!d)?this.messagesMoveHelper(e.fullNameRaw,f.fullNameRaw,b):this.messagesCopyHelper(e.fullNameRaw,f.fullNameRaw,b),Sb.data().removeMessagesFromList(e.fullNameRaw,b,f.fullNameRaw,d),!0}return!1},Bb.prototype.folders=function(a){this.data().foldersLoading(!0),this.remote().folders(h.bind(function(b,c){Sb.data().foldersLoading(!1),Db.StorageResultType.Success===b?(this.data().setFolders(c),a&&a(!0)):a&&a(!1)},this))},Bb.prototype.reloadOpenPgpKeys=function(){if(Sb.data().capaOpenPGP()){var a=[],b=new u,c=Sb.data().openpgpKeyring,d=c?c.getAllKeys():[];h.each(d,function(c,d){if(c&&c.primaryKey){var e=c.getPrimaryUser(),f=e&&e.user?e.user.userId.userid:c.users&&c.users[0]?c.users[0].userId.userid:"";b.clear(),b.mailsoParse(f),b.validate()&&a.push(new G(d,c.primaryKey.getFingerprint(),c.primaryKey.getKeyId().toHex().toLowerCase(),f,b.email,c.isPrivate(),c.armor()))}}),Sb.data().openpgpkeys(a)}},Bb.prototype.accountsAndIdentities=function(){var a=Sb.data();a.accountsLoading(!0),a.identitiesLoading(!0),Sb.remote().accountsAndIdentities(function(b,c){if(a.accountsLoading(!1),a.identitiesLoading(!1),Db.StorageResultType.Success===b&&c.Result){var d=Sb.settingsGet("ParentEmail"),e=a.accountEmail();d=""===d?e:d,Fb.isArray(c.Result.Accounts)&&a.accounts(h.map(c.Result.Accounts,function(a){return new C(a,a!==d)})),Fb.isArray(c.Result.Identities)&&a.identities(h.map(c.Result.Identities,function(a){var b=Fb.pString(a.Id),c=Fb.pString(a.Email),d=new D(b,c,b!==e);return d.name(Fb.pString(a.Name)),d.replyTo(Fb.pString(a.ReplyTo)),d.bcc(Fb.pString(a.Bcc)),d}))}})},Bb.prototype.quota=function(){this.remote().quota(function(a,b){Db.StorageResultType.Success===a&&b&&b.Result&&Fb.isArray(b.Result)&&1<b.Result.length&&Fb.isPosNumeric(b.Result[0],!0)&&Fb.isPosNumeric(b.Result[1],!0)&&(Sb.data().userQuota(1024*Fb.pInt(b.Result[1])),Sb.data().userUsageSize(1024*Fb.pInt(b.Result[0])))})},Bb.prototype.folderInformation=function(a,b){""!==Fb.trim(a)&&this.remote().folderInformation(function(a,b){if(Db.StorageResultType.Success===a&&b&&b.Result&&b.Result.Hash&&b.Result.Folder){var c=f().unix(),d=Sb.cache().getFolderHash(b.Result.Folder),e=Sb.cache().getFolderFromCacheList(b.Result.Folder),g=!1,h="",i=[],j=!1,k=null;if(e){if(e.interval=c,b.Result.Hash&&Sb.cache().setFolderHash(b.Result.Folder,b.Result.Hash),Fb.isNormal(b.Result.MessageCount)&&e.messageCountAll(b.Result.MessageCount),Fb.isNormal(b.Result.MessageUnseenCount)&&(Fb.pInt(e.messageCountUnread())!==Fb.pInt(b.Result.MessageUnseenCount)&&(j=!0),e.messageCountUnread(b.Result.MessageUnseenCount)),j&&Sb.cache().clearMessageFlagsFromCacheByFolder(e.fullNameRaw),b.Result.Flags){for(h in b.Result.Flags)b.Result.Flags.hasOwnProperty(h)&&(g=!0,k=b.Result.Flags[h],Sb.cache().storeMessageFlagsToCacheByFolderAndUid(e.fullNameRaw,h.toString(),[!k.IsSeen,!!k.IsFlagged,!!k.IsAnswered,!!k.IsForwarded,!!k.IsReadReceipt]));g&&Sb.reloadFlagsCurrentMessageListAndMessageFromCache()}Sb.data().initUidNextAndNewMessages(e.fullNameRaw,b.Result.UidNext,b.Result.NewMessages),b.Result.Hash!==d||""===d?e.fullNameRaw===Sb.data().currentFolderFullNameRaw()?Sb.reloadMessageList():"INBOX"===e.fullNameRaw&&Sb.recacheInboxMessageList():j&&e.fullNameRaw===Sb.data().currentFolderFullNameRaw()&&(i=Sb.data().messageList(),Fb.isNonEmptyArray(i)&&Sb.folderInformation(e.fullNameRaw,i))}}},a,b)},Bb.prototype.folderInformationMultiply=function(a){a=Fb.isUnd(a)?!1:!!a;var b=f().unix(),c=Sb.data().getNextFolderNames(a);Fb.isNonEmptyArray(c)&&this.remote().folderInformationMultiply(function(c,d){Db.StorageResultType.Success===c&&d&&d.Result&&d.Result.List&&Fb.isNonEmptyArray(d.Result.List)&&(h.each(d.Result.List,function(a){var c=[],d=Sb.cache().getFolderHash(a.Folder),e=Sb.cache().getFolderFromCacheList(a.Folder),f=!1;e&&(e.interval=b,a.Hash&&Sb.cache().setFolderHash(a.Folder,a.Hash),Fb.isNormal(a.MessageCount)&&e.messageCountAll(a.MessageCount),Fb.isNormal(a.MessageUnseenCount)&&(Fb.pInt(e.messageCountUnread())!==Fb.pInt(a.MessageUnseenCount)&&(f=!0),e.messageCountUnread(a.MessageUnseenCount)),f&&Sb.cache().clearMessageFlagsFromCacheByFolder(e.fullNameRaw),a.Hash!==d||""===d?e.fullNameRaw===Sb.data().currentFolderFullNameRaw()&&Sb.reloadMessageList():f&&e.fullNameRaw===Sb.data().currentFolderFullNameRaw()&&(c=Sb.data().messageList(),Fb.isNonEmptyArray(c)&&Sb.folderInformation(e.fullNameRaw,c)))}),a&&Sb.folderInformationMultiply(!0))},c)},Bb.prototype.setMessageSeen=function(a){if(a.unseen()){a.unseen(!1);var b=Sb.cache().getFolderFromCacheList(a.folderFullNameRaw);b&&b.messageCountUnread(0<=b.messageCountUnread()-1?b.messageCountUnread()-1:0),Sb.cache().storeMessageFlagsToCache(a),Sb.reloadFlagsCurrentMessageListAndMessageFromCache()}Sb.remote().messageSetSeen(Fb.emptyFunction,a.folderFullNameRaw,[a.uid],!0)},Bb.prototype.googleConnect=function(){a.open(Sb.link().socialGoogle(),"Google","left=200,top=100,width=650,height=600,menubar=no,status=no,resizable=yes,scrollbars=yes")},Bb.prototype.twitterConnect=function(){a.open(Sb.link().socialTwitter(),"Twitter","left=200,top=100,width=650,height=350,menubar=no,status=no,resizable=yes,scrollbars=yes")},Bb.prototype.facebookConnect=function(){a.open(Sb.link().socialFacebook(),"Facebook","left=200,top=100,width=650,height=335,menubar=no,status=no,resizable=yes,scrollbars=yes")},Bb.prototype.socialUsers=function(a){var b=Sb.data();a&&(b.googleActions(!0),b.facebookActions(!0),b.twitterActions(!0)),Sb.remote().socialUsers(function(a,c){Db.StorageResultType.Success===a&&c&&c.Result?(b.googleUserName(c.Result.Google||""),b.facebookUserName(c.Result.Facebook||""),b.twitterUserName(c.Result.Twitter||"")):(b.googleUserName(""),b.facebookUserName(""),b.twitterUserName("")),b.googleLoggined(""!==b.googleUserName()),b.facebookLoggined(""!==b.facebookUserName()),b.twitterLoggined(""!==b.twitterUserName()),b.googleActions(!1),b.facebookActions(!1),b.twitterActions(!1)})},Bb.prototype.googleDisconnect=function(){Sb.data().googleActions(!0),Sb.remote().googleDisconnect(function(){Sb.socialUsers()})},Bb.prototype.facebookDisconnect=function(){Sb.data().facebookActions(!0),Sb.remote().facebookDisconnect(function(){Sb.socialUsers()})},Bb.prototype.twitterDisconnect=function(){Sb.data().twitterActions(!0),Sb.remote().twitterDisconnect(function(){Sb.socialUsers()})},Bb.prototype.folderListOptionsBuilder=function(b,c,d,e,f,g,h,i,j,k){var l=0,m=0,n=null,o=!1,p="   ",q=[];for(j=Fb.isNormal(j)?j:0<b.length,k=Fb.isUnd(k)?!1:!!k,f=Fb.isNormal(f)?f:0,g=Fb.isNormal(g)?g:null,h=Fb.isNormal(h)?h:null,i=Fb.isNormal(i)?i:null,Fb.isArray(d)||(d=[]),Fb.isArray(e)||(e=[]),l=0,m=e.length;m>l;l++)q.push({id:e[l][0],name:e[l][1],system:!1,seporator:!1,disabled:!1});for(o=!0,l=0,m=b.length;m>l;l++)n=b[l],(h?h.call(null,n):!0)&&(o&&0<q.length&&q.push({id:"---",name:"---",system:!1,seporator:!0,disabled:!0}),o=!1,q.push({id:n.fullNameRaw,name:i?i.call(null,n):n.name(),system:!0,seporator:!1,disabled:!n.selectable||-1<Fb.inArray(n.fullNameRaw,d)||(g?g.call(null,n):!1)}));for(o=!0,l=0,m=c.length;m>l;l++)n=c[l],(n.subScribed()||!n.existen)&&(h?h.call(null,n):!0)&&(Db.FolderType.User===n.type()||!j||0<n.subFolders().length)&&(o&&0<q.length&&q.push({id:"---",name:"---",system:!1,seporator:!0,disabled:!0}),o=!1,q.push({id:n.fullNameRaw,name:new a.Array(n.deep+1-f).join(p)+(i?i.call(null,n):n.name()),system:!1,seporator:!1,disabled:!n.selectable||-1<Fb.inArray(n.fullNameRaw,d)||(g?g.call(null,n):!1)})),n.subScribed()&&0<n.subFolders().length&&(q=q.concat(Sb.folderListOptionsBuilder([],n.subFolders(),d,[],f,g,h,i,j,k)));return q},Bb.prototype.getAutocomplete=function(a,b){var c=[];Sb.remote().suggestions(function(a,d){Db.StorageResultType.Success===a&&d&&Fb.isArray(d.Result)?(c=h.map(d.Result,function(a){return a&&a[0]?new u(a[0],a[1]):null}),b(h.compact(c))):Db.StorageResultType.Abort!==a&&b([])},a)},Bb.prototype.getContactsTagsAutocomplete=function(a,b){b(h.filter(Sb.data().contactTags(),function(b){return b&&b.filterHelper(a)}))},Bb.prototype.emailsPicsHashes=function(){Sb.remote().emailsPicsHashes(function(a,b){Db.StorageResultType.Success===a&&b&&b.Result&&Sb.cache().setEmailsPicsHashesData(b.Result)})},Bb.prototype.mailToHelper=function(b){if(b&&"mailto:"===b.toString().toLowerCase().substr(0,7)){var c=null;if(c=new u,c.parse(a.decodeURI(b.toString().substr(7).replace(/\?.+$/,""))),c&&c.email)return Lb.showScreenPopup(K,[Db.ComposeType.Empty,null,[c]]),!0}return!1},Bb.prototype.bootstart=function(){Sb.pub("rl.bootstart"),Ab.prototype.bootstart.call(this),Sb.data().populateDataOnStart();var c="",d=Sb.settingsGet("JsHash"),e=Fb.pInt(Sb.settingsGet("ContactsSyncInterval")),f=Sb.settingsGet("AllowGoogleSocial"),g=Sb.settingsGet("AllowFacebookSocial"),i=Sb.settingsGet("AllowTwitterSocial");Sb.settingsGet("ChangePasswordIsAllowed")||Fb.removeSettingsViewModel(mb),Sb.settingsGet("ContactsIsAllowed")||Fb.removeSettingsViewModel(fb),Sb.capa(Db.Capa.AdditionalAccounts)||Fb.removeSettingsViewModel(gb),Sb.capa(Db.Capa.AdditionalIdentities)?Fb.removeSettingsViewModel(hb):Fb.removeSettingsViewModel(ib),Sb.capa(Db.Capa.OpenPGP)||Fb.removeSettingsViewModel(pb),Sb.capa(Db.Capa.TwoFactor)||Fb.removeSettingsViewModel(kb),Sb.capa(Db.Capa.Themes)||Fb.removeSettingsViewModel(ob),Sb.capa(Db.Capa.Filters)||Fb.removeSettingsViewModel(jb),f||g||i||Fb.removeSettingsViewModel(lb),Fb.initOnStartOrLangChange(function(){b.extend(!0,b.magnificPopup.defaults,{tClose:Fb.i18n("MAGNIFIC_POPUP/CLOSE"),tLoading:Fb.i18n("MAGNIFIC_POPUP/LOADING"),gallery:{tPrev:Fb.i18n("MAGNIFIC_POPUP/GALLERY_PREV"),tNext:Fb.i18n("MAGNIFIC_POPUP/GALLERY_NEXT"),tCounter:Fb.i18n("MAGNIFIC_POPUP/GALLERY_COUNTER")},image:{tError:Fb.i18n("MAGNIFIC_POPUP/IMAGE_ERROR")},ajax:{tError:Fb.i18n("MAGNIFIC_POPUP/AJAX_ERROR")}})},this),a.SimplePace&&(a.SimplePace.set(70),a.SimplePace.sleep()),Sb.settingsGet("Auth")?(this.setTitle(Fb.i18n("TITLES/LOADING")),this.folders(h.bind(function(c){Lb.hideLoading(),c?(a.crypto&&a.crypto.getRandomValues&&Sb.capa(Db.Capa.OpenPGP)?b.ajax({url:Sb.link().openPgpJs(),dataType:"script",cache:!0,success:function(){a.openpgp&&(Sb.data().openpgpKeyring=new a.openpgp.Keyring,Sb.data().capaOpenPGP(!0),Sb.pub("openpgp.init"),Sb.reloadOpenPgpKeys())}}):Sb.data().capaOpenPGP(!1),Lb.startScreens([yb,zb]),(f||g||i)&&Sb.socialUsers(!0),Sb.sub("interval.2m",function(){Sb.folderInformation("INBOX")}),Sb.sub("interval.2m",function(){var a=Sb.data().currentFolderFullNameRaw();"INBOX"!==a&&Sb.folderInformation(a)}),Sb.sub("interval.3m",function(){Sb.folderInformationMultiply()}),Sb.sub("interval.5m",function(){Sb.quota()}),Sb.sub("interval.10m",function(){Sb.folders()}),e=e>=5?e:20,e=320>=e?e:320,a.setInterval(function(){Sb.contactsSync()},6e4*e+5e3),h.delay(function(){Sb.contactsSync()},5e3),h.delay(function(){Sb.folderInformationMultiply(!0)},500),h.delay(function(){Sb.emailsPicsHashes(),Sb.remote().servicesPics(function(a,b){Db.StorageResultType.Success===a&&b&&b.Result&&Sb.cache().setServicesData(b.Result)})},2e3),Gb.runHook("rl-start-user-screens"),Sb.pub("rl.bootstart-user-screens"),Sb.settingsGet("AccountSignMe")&&a.navigator.registerProtocolHandler&&h.delay(function(){try{a.navigator.registerProtocolHandler("mailto",a.location.protocol+"//"+a.location.host+a.location.pathname+"?mailto&to=%s",""+(Sb.settingsGet("Title")||"RainLoop"))}catch(b){}Sb.settingsGet("MailToEmail")&&Sb.mailToHelper(Sb.settingsGet("MailToEmail"))},500)):(Lb.startScreens([xb]),Gb.runHook("rl-start-login-screens"),Sb.pub("rl.bootstart-login-screens")),a.SimplePace&&a.SimplePace.set(100),Ib.bMobileDevice||h.defer(function(){Fb.initLayoutResizer("#rl-left","#rl-right",Db.ClientSideKeyName.FolderListSize)})},this))):(c=Fb.pString(Sb.settingsGet("CustomLoginLink")),c?(Lb.routeOff(),Lb.setHash(Sb.link().root(),!0),Lb.routeOff(),h.defer(function(){a.location.href=c})):(Lb.hideLoading(),Lb.startScreens([xb]),Gb.runHook("rl-start-login-screens"),Sb.pub("rl.bootstart-login-screens"),a.SimplePace&&a.SimplePace.set(100))),f&&(a["rl_"+d+"_google_service"]=function(){Sb.data().googleActions(!0),Sb.socialUsers()}),g&&(a["rl_"+d+"_facebook_service"]=function(){Sb.data().facebookActions(!0),Sb.socialUsers()}),i&&(a["rl_"+d+"_twitter_service"]=function(){Sb.data().twitterActions(!0),Sb.socialUsers()}),Sb.sub("interval.1m",function(){Ib.momentTrigger(!Ib.momentTrigger())}),Gb.runHook("rl-start-screens"),Sb.pub("rl.bootstart-end")},Sb=new Bb,Ob.addClass(Ib.bMobileDevice?"mobile":"no-mobile"),Pb.keydown(Fb.killCtrlAandS).keyup(Fb.killCtrlAandS),Pb.unload(function(){Ib.bUnload=!0}),Ob.on("click.dropdown.data-api",function(){Fb.detectDropdownVisibility()}),a.rl=a.rl||{},a.rl.addHook=Gb.addHook,a.rl.settingsGet=Gb.mainSettingsGet,a.rl.remoteRequest=Gb.remoteRequest,a.rl.pluginSettingsGet=Gb.settingsGet,a.rl.addSettingsViewModel=Fb.addSettingsViewModel,a.rl.createCommand=Fb.createCommand,a.rl.EmailModel=u,a.rl.Enums=Db,a.__RLBOOT=function(c){b(function(){a.rainloopTEMPLATES&&a.rainloopTEMPLATES[0]?(b("#rl-templates").html(a.rainloopTEMPLATES[0]),h.delay(function(){a.rainloopAppData={},a.rainloopI18N={},a.rainloopTEMPLATES={},Lb.setBoot(Sb).bootstart(),Ob.removeClass("no-js rl-booted-trigger").addClass("rl-booted")},50)):c(!1),a.__RLBOOT=null})},a.SimplePace&&a.SimplePace.add(10)}(window,jQuery,ko,crossroads,hasher,moment,Jua,_,ifvisible,key);