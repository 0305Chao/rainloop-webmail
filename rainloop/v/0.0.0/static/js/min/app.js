/* RainLoop Webmail (c) RainLoop Team | Licensed under CC BY-NC-SA 3.0 */
webpackJsonp([3],{0:function(e,t,s){var i;!function(){"use strict";s(35)(s(4))}(i)},4:function(e,t,s){!function(){"use strict";function t(){w.call(this,F),this.oMoveCache={},this.quotaDebounce=o.debounce(this.quota,3e4),this.moveOrDeleteResponseHelper=o.bind(this.moveOrDeleteResponseHelper,this),this.messagesMoveTrigger=o.debounce(this.messagesMoveTrigger,500),i.setInterval(function(){p.pub("interval.30s")},3e4),i.setInterval(function(){p.pub("interval.1m")},6e4),i.setInterval(function(){p.pub("interval.2m")},12e4),i.setInterval(function(){p.pub("interval.3m")},18e4),i.setInterval(function(){p.pub("interval.5m")},3e5),i.setInterval(function(){p.pub("interval.10m")},6e5),i.setTimeout(function(){i.setInterval(function(){p.pub("interval.10m-after5m")},6e5)},3e5),a.wakeUp(function(){F.jsVersion(function(e,t){n.StorageResultType.Success===e&&t&&!t.Result&&(i.parent&&f.settingsGet("InIframe")?i.parent.location.reload():i.location.reload())},f.settingsGet("Version"))},{},36e5),this.socialUsers=o.bind(this.socialUsers,this)}var i=s(12),o=s(2),a=s(14),r=s(25),n=s(6),l=s(7),h=s(17),d=s(26),u=s(1),c=s(11),p=s(22),g=s(5),m=s(30),f=s(10),y=s(8),b=s(20),F=s(13),S=s(23),v=s(58),C=s(38),R=s(51),L=s(59),T=s(60),w=s(34);o.extend(t.prototype,w.prototype),t.prototype.remote=function(){return F},t.prototype.data=function(){return y},t.prototype.reloadFlagsCurrentMessageListAndMessageFromCache=function(){o.each(y.messageList(),function(e){b.initMessageFlagsFromCache(e)}),b.initMessageFlagsFromCache(y.message())},t.prototype.reloadMessageList=function(e,t){var s=this,i=(y.messageListPage()-1)*y.messagesPerPage();(u.isUnd(t)?1:!t)||b.setFolderHash(y.currentFolderFullNameRaw(),""),(u.isUnd(e)?1:!e)||(y.messageListPage(1),i=0),y.messageListLoading(!0),F.messageList(function(e,t,i){n.StorageResultType.Success===e&&t&&t.Result?(y.messageListError(""),y.messageListLoading(!1),s.setMessageList(t,i)):n.StorageResultType.Unload===e?(y.messageListError(""),y.messageListLoading(!1)):n.StorageResultType.Abort!==e&&(y.messageList([]),y.messageListLoading(!1),y.messageListError(t&&t.ErrorCode?u.getNotification(t.ErrorCode):u.i18n("NOTIFICATIONS/CANT_GET_MESSAGE_LIST")))},y.currentFolderFullNameRaw(),i,y.messagesPerPage(),y.messageListSearch())},t.prototype.recacheInboxMessageList=function(){F.messageList(u.emptyFunction,"INBOX",0,y.messagesPerPage(),"",!0)},t.prototype.reloadMessageListHelper=function(e){this.reloadMessageList(e)},t.prototype.contactsSync=function(e){var t=y.contacts;return t.importing()||t.syncing()||!y.enableContactsSync()||!y.allowContactsSync()?!1:(t.syncing(!0),F.contactsSync(function(s,i){t.syncing(!1),e&&e(s,i)}),!0)},t.prototype.messagesMoveTrigger=function(){var e=this,t=y.spamFolder();o.each(this.oMoveCache,function(s){var i=t===s.To,o=!i&&t===s.From&&"INBOX"===s.To;F.messagesMove(e.moveOrDeleteResponseHelper,s.From,s.To,s.Uid,i?"SPAM":o?"HAM":"")}),this.oMoveCache={}},t.prototype.messagesMoveHelper=function(e,t,s){var i="$$"+e+"$$"+t+"$$";this.oMoveCache[i]||(this.oMoveCache[i]={From:e,To:t,Uid:[]}),this.oMoveCache[i].Uid=o.union(this.oMoveCache[i].Uid,s),this.messagesMoveTrigger()},t.prototype.messagesCopyHelper=function(e,t,s){F.messagesCopy(this.moveOrDeleteResponseHelper,e,t,s)},t.prototype.messagesDeleteHelper=function(e,t){F.messagesDelete(this.moveOrDeleteResponseHelper,e,t)},t.prototype.moveOrDeleteResponseHelper=function(e,t){n.StorageResultType.Success===e&&y.currentFolder()&&(t&&u.isArray(t.Result)&&2===t.Result.length?b.setFolderHash(t.Result[0],t.Result[1]):(b.setFolderHash(y.currentFolderFullNameRaw(),""),t&&-1<u.inArray(t.ErrorCode,[n.Notification.CantMoveMessage,n.Notification.CantCopyMessage])&&i.alert(u.getNotification(t.ErrorCode))),this.reloadMessageListHelper(0===y.messageList().length),this.quotaDebounce())},t.prototype.deleteMessagesFromFolderWithoutCheck=function(e,t){this.messagesDeleteHelper(e,t),y.removeMessagesFromList(e,t)},t.prototype.deleteMessagesFromFolder=function(e,t,i,o){var a=this,r=null,l=null;switch(e){case n.FolderType.Spam:r=b.getFolderFromCacheList(y.spamFolder()),l=n.SetSystemFoldersNotification.Spam;break;case n.FolderType.NotSpam:r=b.getFolderFromCacheList("INBOX");break;case n.FolderType.Trash:r=b.getFolderFromCacheList(y.trashFolder()),l=n.SetSystemFoldersNotification.Trash;break;case n.FolderType.Archive:r=b.getFolderFromCacheList(y.archiveFolder()),l=n.SetSystemFoldersNotification.Archive}o=u.isUnd(o)?!0:!!o,o&&(n.FolderType.Spam===e&&h.Values.UnuseOptionValue===y.spamFolder()||n.FolderType.Trash===e&&h.Values.UnuseOptionValue===y.trashFolder()||n.FolderType.Archive===e&&h.Values.UnuseOptionValue===y.archiveFolder())&&(o=!1),!r&&o?g.showScreenPopup(s(27),[l]):o&&(n.FolderType.Trash!==e||t!==y.spamFolder()&&t!==y.trashFolder())?r&&(this.messagesMoveHelper(t,r.fullNameRaw,i),y.removeMessagesFromList(t,i,r.fullNameRaw)):g.showScreenPopup(s(31),[u.i18n("POPUPS_ASK/DESC_WANT_DELETE_MESSAGES"),function(){a.messagesDeleteHelper(t,i),y.removeMessagesFromList(t,i)}])},t.prototype.moveMessagesToFolder=function(e,t,s,i){if(e!==s&&u.isArray(t)&&0<t.length){var o=b.getFolderFromCacheList(e),a=b.getFolderFromCacheList(s);if(o&&a)return(u.isUnd(i)?1:!i)?this.messagesMoveHelper(o.fullNameRaw,a.fullNameRaw,t):this.messagesCopyHelper(o.fullNameRaw,a.fullNameRaw,t),y.removeMessagesFromList(o.fullNameRaw,t,a.fullNameRaw,i),!0}return!1},t.prototype.folders=function(e){y.foldersLoading(!0),F.folders(o.bind(function(t,s){y.foldersLoading(!1),n.StorageResultType.Success===t?(this.setFolders(s),e&&e(!0)):e&&e(!1)},this))},t.prototype.reloadOpenPgpKeys=function(){if(y.capaOpenPGP()){var e=[],t=new S,s=y.openpgpKeyring,i=s?s.getAllKeys():[];o.each(i,function(s,i){if(s&&s.primaryKey){var o=s.getPrimaryUser(),a=o&&o.user?o.user.userId.userid:s.users&&s.users[0]?s.users[0].userId.userid:"";t.clear(),t.mailsoParse(a),t.validate()&&e.push(new T(i,s.primaryKey.getFingerprint(),s.primaryKey.getKeyId().toHex().toLowerCase(),a,t.email,s.isPrivate(),s.armor()))}}),y.openpgpkeys(e)}},t.prototype.accountsAndIdentities=function(){y.accountsLoading(!0),y.identitiesLoading(!0),F.accountsAndIdentities(function(e,t){if(y.accountsLoading(!1),y.identitiesLoading(!1),n.StorageResultType.Success===e&&t.Result){var s=f.settingsGet("ParentEmail"),i=y.accountEmail();s=""===s?i:s,u.isArray(t.Result.Accounts)&&y.accounts(o.map(t.Result.Accounts,function(e){return new R(e,e!==s)})),u.isArray(t.Result.Identities)&&y.identities(o.map(t.Result.Identities,function(e){var t=u.pString(e.Id),s=u.pString(e.Email),o=new L(t,s,t!==i);return o.name(u.pString(e.Name)),o.replyTo(u.pString(e.ReplyTo)),o.bcc(u.pString(e.Bcc)),o}))}})},t.prototype.quota=function(){F.quota(function(e,t){n.StorageResultType.Success===e&&t&&t.Result&&u.isArray(t.Result)&&1<t.Result.length&&u.isPosNumeric(t.Result[0],!0)&&u.isPosNumeric(t.Result[1],!0)&&(y.userQuota(1024*u.pInt(t.Result[1])),y.userUsageSize(1024*u.pInt(t.Result[0])))})},t.prototype.folderInformation=function(e,t){if(""!==u.trim(e)){var s=this;F.folderInformation(function(e,t){if(n.StorageResultType.Success===e&&t&&t.Result&&t.Result.Hash&&t.Result.Folder){var i=r().unix(),o=b.getFolderHash(t.Result.Folder),a=b.getFolderFromCacheList(t.Result.Folder),l=!1,h="",d=[],c=!1,p=null;if(a){if(a.interval=i,t.Result.Hash&&b.setFolderHash(t.Result.Folder,t.Result.Hash),u.isNormal(t.Result.MessageCount)&&a.messageCountAll(t.Result.MessageCount),u.isNormal(t.Result.MessageUnseenCount)&&(u.pInt(a.messageCountUnread())!==u.pInt(t.Result.MessageUnseenCount)&&(c=!0),a.messageCountUnread(t.Result.MessageUnseenCount)),c&&b.clearMessageFlagsFromCacheByFolder(a.fullNameRaw),t.Result.Flags){for(h in t.Result.Flags)t.Result.Flags.hasOwnProperty(h)&&(l=!0,p=t.Result.Flags[h],b.storeMessageFlagsToCacheByFolderAndUid(a.fullNameRaw,h.toString(),[!p.IsSeen,!!p.IsFlagged,!!p.IsAnswered,!!p.IsForwarded,!!p.IsReadReceipt]));l&&s.reloadFlagsCurrentMessageListAndMessageFromCache()}y.initUidNextAndNewMessages(a.fullNameRaw,t.Result.UidNext,t.Result.NewMessages),t.Result.Hash!==o||""===o?a.fullNameRaw===y.currentFolderFullNameRaw()?s.reloadMessageList():"INBOX"===a.fullNameRaw&&s.recacheInboxMessageList():c&&a.fullNameRaw===y.currentFolderFullNameRaw()&&(d=y.messageList(),u.isNonEmptyArray(d)&&s.folderInformation(a.fullNameRaw,d))}}},e,t)}},t.prototype.folderInformationMultiply=function(e){e=u.isUnd(e)?!1:!!e;var t=this,s=r().unix(),i=y.getNextFolderNames(e);u.isNonEmptyArray(i)&&F.folderInformationMultiply(function(i,a){n.StorageResultType.Success===i&&a&&a.Result&&a.Result.List&&u.isNonEmptyArray(a.Result.List)&&(o.each(a.Result.List,function(e){var i=[],o=b.getFolderHash(e.Folder),a=b.getFolderFromCacheList(e.Folder),r=!1;a&&(a.interval=s,e.Hash&&b.setFolderHash(e.Folder,e.Hash),u.isNormal(e.MessageCount)&&a.messageCountAll(e.MessageCount),u.isNormal(e.MessageUnseenCount)&&(u.pInt(a.messageCountUnread())!==u.pInt(e.MessageUnseenCount)&&(r=!0),a.messageCountUnread(e.MessageUnseenCount)),r&&b.clearMessageFlagsFromCacheByFolder(a.fullNameRaw),e.Hash!==o||""===o?a.fullNameRaw===y.currentFolderFullNameRaw()&&t.reloadMessageList():r&&a.fullNameRaw===y.currentFolderFullNameRaw()&&(i=y.messageList(),u.isNonEmptyArray(i)&&t.folderInformation(a.fullNameRaw,i)))}),e&&t.folderInformationMultiply(!0))},i)},t.prototype.setMessageSeen=function(e){if(e.unseen()){e.unseen(!1);var t=b.getFolderFromCacheList(e.folderFullNameRaw);t&&t.messageCountUnread(0<=t.messageCountUnread()-1?t.messageCountUnread()-1:0),b.storeMessageFlagsToCache(e),this.reloadFlagsCurrentMessageListAndMessageFromCache()}F.messageSetSeen(u.emptyFunction,e.folderFullNameRaw,[e.uid],!0)},t.prototype.googleConnect=function(){i.open(c.socialGoogle(),"Google","left=200,top=100,width=650,height=600,menubar=no,status=no,resizable=yes,scrollbars=yes")},t.prototype.twitterConnect=function(){i.open(c.socialTwitter(),"Twitter","left=200,top=100,width=650,height=350,menubar=no,status=no,resizable=yes,scrollbars=yes")},t.prototype.facebookConnect=function(){i.open(c.socialFacebook(),"Facebook","left=200,top=100,width=650,height=335,menubar=no,status=no,resizable=yes,scrollbars=yes")},t.prototype.socialUsers=function(e){e&&(y.googleActions(!0),y.facebookActions(!0),y.twitterActions(!0)),F.socialUsers(function(e,t){n.StorageResultType.Success===e&&t&&t.Result?(y.googleUserName(t.Result.Google||""),y.facebookUserName(t.Result.Facebook||""),y.twitterUserName(t.Result.Twitter||"")):(y.googleUserName(""),y.facebookUserName(""),y.twitterUserName("")),y.googleLoggined(""!==y.googleUserName()),y.facebookLoggined(""!==y.facebookUserName()),y.twitterLoggined(""!==y.twitterUserName()),y.googleActions(!1),y.facebookActions(!1),y.twitterActions(!1)})},t.prototype.googleDisconnect=function(){y.googleActions(!0),F.googleDisconnect(this.socialUsers)},t.prototype.facebookDisconnect=function(){y.facebookActions(!0),F.facebookDisconnect(this.socialUsers)},t.prototype.twitterDisconnect=function(){y.twitterActions(!0),F.twitterDisconnect(this.socialUsers)},t.prototype.getAutocomplete=function(e,t){var s=[];F.suggestions(function(e,i){n.StorageResultType.Success===e&&i&&u.isArray(i.Result)?(s=o.map(i.Result,function(e){return e&&e[0]?new S(e[0],e[1]):null}),t(o.compact(s))):n.StorageResultType.Abort!==e&&t([])},e)},t.prototype.getContactTagsAutocomplete=function(e,t){t(o.filter(y.contactTags(),function(t){return t&&t.filterHelper(e)}))},t.prototype.setMessageList=function(e,t){if(e&&e.Result&&"Collection/MessageCollection"===e.Result["@Object"]&&e.Result["@Collection"]&&u.isArray(e.Result["@Collection"])){var s=null,o=0,a=0,l=0,h=0,d=[],c=r().unix(),p=y.staticMessageList,g=null,m=null,f=null,F=0,S=!1;for(l=u.pInt(e.Result.MessageResultCount),h=u.pInt(e.Result.Offset),u.isNonEmptyArray(e.Result.LastCollapsedThreadUids)&&(s=e.Result.LastCollapsedThreadUids),f=b.getFolderFromCacheList(u.isNormal(e.Result.Folder)?e.Result.Folder:""),f&&!t&&(f.interval=c,b.setFolderHash(e.Result.Folder,e.Result.FolderHash),u.isNormal(e.Result.MessageCount)&&f.messageCountAll(e.Result.MessageCount),u.isNormal(e.Result.MessageUnseenCount)&&(u.pInt(f.messageCountUnread())!==u.pInt(e.Result.MessageUnseenCount)&&(S=!0),f.messageCountUnread(e.Result.MessageUnseenCount)),y.initUidNextAndNewMessages(f.fullNameRaw,e.Result.UidNext,e.Result.NewMessages)),S&&f&&b.clearMessageFlagsFromCacheByFolder(f.fullNameRaw),o=0,a=e.Result["@Collection"].length;a>o;o++)g=e.Result["@Collection"][o],g&&"Object/Message"===g["@Object"]&&(m=p[o],m&&m.initByJson(g)||(m=C.newInstanceFromJson(g)),m&&(b.hasNewMessageAndRemoveFromCache(m.folderFullNameRaw,m.uid)&&5>=F&&(F++,m.newForAnimation(!0)),m.deleted(!1),t?b.initMessageFlagsFromCache(m):b.storeMessageFlagsToCache(m),m.lastInCollapsedThread(s&&-1<u.inArray(u.pInt(m.uid),s)?!0:!1),d.push(m)));y.messageListCount(l),y.messageListSearch(u.isNormal(e.Result.Search)?e.Result.Search:""),y.messageListPage(i.Math.ceil(h/y.messagesPerPage()+1)),y.messageListEndFolder(u.isNormal(e.Result.Folder)?e.Result.Folder:""),y.messageListEndSearch(u.isNormal(e.Result.Search)?e.Result.Search:""),y.messageListEndPage(y.messageListPage()),y.messageList(d),y.messageListIsNotCompleted(!1),p.length<d.length&&(y.staticMessageList=d),b.clearNewMessageCache(),f&&(t||S||y.useThreads())&&this.folderInformation(f.fullNameRaw,d)}else y.messageListCount(0),y.messageList([]),y.messageListError(u.getNotification(e&&e.ErrorCode?e.ErrorCode:n.Notification.CantGetMessageList))},t.prototype.folderResponseParseRec=function(e,t){var s=this,i=0,o=0,a=null,r=null,n="",l=[],h=[];for(i=0,o=t.length;o>i;i++)a=t[i],a&&(n=a.FullNameRaw,r=b.getFolderFromCacheList(n),r||(r=v.newInstanceFromJson(a),r&&(b.setFolderToCacheList(n,r),b.setFolderFullNameRaw(r.fullNameHash,n))),r&&(r.collapsed(!s.isFolderExpanded(r.fullNameHash)),a.Extended&&(a.Extended.Hash&&b.setFolderHash(r.fullNameRaw,a.Extended.Hash),u.isNormal(a.Extended.MessageCount)&&r.messageCountAll(a.Extended.MessageCount),u.isNormal(a.Extended.MessageUnseenCount)&&r.messageCountUnread(a.Extended.MessageUnseenCount)),l=a.SubFolders,l&&"Collection/FolderCollection"===l["@Object"]&&l["@Collection"]&&u.isArray(l["@Collection"])&&r.subFolders(this.folderResponseParseRec(e,l["@Collection"])),h.push(r)));return h},t.prototype.setFolders=function(e){var t=[],s=!1,i=function(e){return""===e||h.Values.UnuseOptionValue===e||null!==b.getFolderFromCacheList(e)?e:""};e&&e.Result&&"Collection/FolderCollection"===e.Result["@Object"]&&e.Result["@Collection"]&&u.isArray(e.Result["@Collection"])&&(u.isUnd(e.Result.Namespace)||(y.namespace=e.Result.Namespace),y.threading(!!f.settingsGet("UseImapThread")&&e.Result.IsThreadsSupported&&!0),t=this.folderResponseParseRec(y.namespace,e.Result["@Collection"]),y.folderList(t),e.Result.SystemFolders&&""==""+f.settingsGet("SentFolder")+f.settingsGet("DraftFolder")+f.settingsGet("SpamFolder")+f.settingsGet("TrashFolder")+f.settingsGet("ArchiveFolder")+f.settingsGet("NullFolder")&&(f.settingsSet("SentFolder",e.Result.SystemFolders[2]||null),f.settingsSet("DraftFolder",e.Result.SystemFolders[3]||null),f.settingsSet("SpamFolder",e.Result.SystemFolders[4]||null),f.settingsSet("TrashFolder",e.Result.SystemFolders[5]||null),f.settingsSet("ArchiveFolder",e.Result.SystemFolders[12]||null),s=!0),y.sentFolder(i(f.settingsGet("SentFolder"))),y.draftFolder(i(f.settingsGet("DraftFolder"))),y.spamFolder(i(f.settingsGet("SpamFolder"))),y.trashFolder(i(f.settingsGet("TrashFolder"))),y.archiveFolder(i(f.settingsGet("ArchiveFolder"))),s&&F.saveSystemFolders(u.emptyFunction,{SentFolder:y.sentFolder(),DraftFolder:y.draftFolder(),SpamFolder:y.spamFolder(),TrashFolder:y.trashFolder(),ArchiveFolder:y.archiveFolder(),NullFolder:"NullFolder"}),m.set(n.ClientSideKeyName.FoldersLashHash,e.Result.FoldersHash))},t.prototype.isFolderExpanded=function(e){var t=m.get(n.ClientSideKeyName.ExpandedFolders);return u.isArray(t)&&-1!==o.indexOf(t,e)},t.prototype.setExpandedFolder=function(e,t){var s=m.get(n.ClientSideKeyName.ExpandedFolders);u.isArray(s)||(s=[]),t?(s.push(e),s=o.uniq(s)):s=o.without(s,e),m.set(n.ClientSideKeyName.ExpandedFolders,s)},t.prototype.initLayoutResizer=function(e,t,s){var i=60,o=155,r=a(e),n=a(t),l=m.get(s)||null,h=function(e){e&&(r.css({width:""+e+"px"}),n.css({left:""+e+"px"}))},d=function(e){if(e)r.resizable("disable"),h(i);else{r.resizable("enable");var t=u.pInt(m.get(s))||o;h(t>o?t:o)}},c=function(e,t){t&&t.size&&t.size.width&&(m.set(s,t.size.width),n.css({left:""+t.size.width+"px"}))};null!==l&&h(l>o?l:o),r.resizable({helper:"ui-resizable-helper",minWidth:o,maxWidth:350,handles:"e",stop:c}),p.sub("left-panel.off",function(){d(!0)}),p.sub("left-panel.on",function(){d(!1)})},t.prototype.bootstartLoginScreen=function(){var e=u.pString(f.settingsGet("CustomLoginLink"));e?(g.routeOff(),g.setHash(c.root(),!0),g.routeOff(),o.defer(function(){i.location.href=e})):(g.hideLoading(),g.startScreens([s(64)]),d.runHook("rl-start-login-screens"),p.pub("rl.bootstart-login-screens"))},t.prototype.bootstart=function(){w.prototype.bootstart.call(this),y.populateDataOnStart();var e=this,t=f.settingsGet("JsHash"),r=u.pInt(f.settingsGet("ContactsSyncInterval")),h=f.settingsGet("AllowGoogleSocial"),m=f.settingsGet("AllowFacebookSocial"),b=f.settingsGet("AllowTwitterSocial");u.initOnStartOrLangChange(function(){a.extend(!0,a.magnificPopup.defaults,{tClose:u.i18n("MAGNIFIC_POPUP/CLOSE"),tLoading:u.i18n("MAGNIFIC_POPUP/LOADING"),gallery:{tPrev:u.i18n("MAGNIFIC_POPUP/GALLERY_PREV"),tNext:u.i18n("MAGNIFIC_POPUP/GALLERY_NEXT"),tCounter:u.i18n("MAGNIFIC_POPUP/GALLERY_COUNTER")},image:{tError:u.i18n("MAGNIFIC_POPUP/IMAGE_ERROR")},ajax:{tError:u.i18n("MAGNIFIC_POPUP/AJAX_ERROR")}})},this),i.SimplePace&&(i.SimplePace.set(70),i.SimplePace.sleep()),l.leftPanelDisabled.subscribe(function(e){p.pub("left-panel."+(e?"off":"on"))}),f.settingsGet("Auth")?(this.setTitle(u.i18n("TITLES/LOADING")),this.folders(o.bind(function(t){t?s.e(0,function(){g.hideLoading(),i.$LAB&&i.crypto&&i.crypto.getRandomValues&&f.capa(n.Capa.OpenPGP)?i.$LAB.script(i.openpgp?"":c.openPgpJs()).wait(function(){i.openpgp&&(y.openpgpKeyring=new i.openpgp.Keyring,y.capaOpenPGP(!0),p.pub("openpgp.init"),e.reloadOpenPgpKeys())}):y.capaOpenPGP(!1),g.startScreens([s(65),s(66),s(61)]),(h||m||b)&&e.socialUsers(!0),p.sub("interval.2m",function(){e.folderInformation("INBOX")}),p.sub("interval.2m",function(){var t=y.currentFolderFullNameRaw();"INBOX"!==t&&e.folderInformation(t)}),p.sub("interval.3m",function(){e.folderInformationMultiply()}),p.sub("interval.5m",function(){e.quota()}),p.sub("interval.10m",function(){e.folders()}),r=r>=5?r:20,r=320>=r?r:320,i.setInterval(function(){e.contactsSync()},6e4*r+5e3),o.delay(function(){e.contactsSync()},5e3),o.delay(function(){e.folderInformationMultiply(!0)},500),d.runHook("rl-start-user-screens"),p.pub("rl.bootstart-user-screens"),f.settingsGet("AccountSignMe")&&i.navigator.registerProtocolHandler&&o.delay(function(){try{i.navigator.registerProtocolHandler("mailto",i.location.protocol+"//"+i.location.host+i.location.pathname+"?mailto&to=%s",""+(f.settingsGet("Title")||"RainLoop"))}catch(e){}f.settingsGet("MailToEmail")&&u.mailToHelper(f.settingsGet("MailToEmail"),s(21))},500),l.bMobileDevice||o.defer(function(){e.initLayoutResizer("#rl-left","#rl-right",n.ClientSideKeyName.FolderListSize)})}):(g.hideLoading(),e.bootstartLoginScreen()),i.SimplePace&&i.SimplePace.set(100)},this))):(this.bootstartLoginScreen(),i.SimplePace&&i.SimplePace.set(100)),h&&(i["rl_"+t+"_google_service"]=function(){y.googleActions(!0),e.socialUsers()}),m&&(i["rl_"+t+"_facebook_service"]=function(){y.facebookActions(!0),e.socialUsers()}),b&&(i["rl_"+t+"_twitter_service"]=function(){y.twitterActions(!0),e.socialUsers()}),p.sub("interval.1m",function(){l.momentTrigger(!l.momentTrigger())}),d.runHook("rl-start-screens"),p.pub("rl.bootstart-end")},e.exports=new t}()},8:function(e,t,s){!function(){"use strict";function t(){b.call(this);var e=function(e){return function(){var t=g.getFolderFromCacheList(e());t&&t.type(h.FolderType.User)}},t=function(e){return function(t){var s=g.getFolderFromCacheList(t);s&&s.type(e)}};this.devEmail="",this.devPassword="",this.accountEmail=r.observable(""),this.accountIncLogin=r.observable(""),this.accountOutLogin=r.observable(""),this.projectHash=r.observable(""),this.threading=r.observable(!1),this.lastFoldersHash="",this.remoteSuggestions=!1,this.sentFolder=r.observable(""),this.draftFolder=r.observable(""),this.spamFolder=r.observable(""),this.trashFolder=r.observable(""),this.archiveFolder=r.observable(""),this.sentFolder.subscribe(e(this.sentFolder),this,"beforeChange"),this.draftFolder.subscribe(e(this.draftFolder),this,"beforeChange"),this.spamFolder.subscribe(e(this.spamFolder),this,"beforeChange"),this.trashFolder.subscribe(e(this.trashFolder),this,"beforeChange"),this.archiveFolder.subscribe(e(this.archiveFolder),this,"beforeChange"),this.sentFolder.subscribe(t(h.FolderType.SentItems),this),this.draftFolder.subscribe(t(h.FolderType.Draft),this),this.spamFolder.subscribe(t(h.FolderType.Spam),this),this.trashFolder.subscribe(t(h.FolderType.Trash),this),this.archiveFolder.subscribe(t(h.FolderType.Archive),this),this.draftFolderNotEnabled=r.computed(function(){return""===this.draftFolder()||l.Values.UnuseOptionValue===this.draftFolder()},this),this.displayName=r.observable(""),this.signature=r.observable(""),this.signatureToAll=r.observable(!1),this.replyTo=r.observable(""),this.enableTwoFactor=r.observable(!1),this.accounts=r.observableArray([]),this.accountsLoading=r.observable(!1).extend({throttle:100}),this.defaultIdentityID=r.observable(""),this.identities=r.observableArray([]),this.identitiesLoading=r.observable(!1).extend({throttle:100}),this.contactTags=r.observableArray([]),this.contacts=r.observableArray([]),this.contacts.loading=r.observable(!1).extend({throttle:200}),this.contacts.importing=r.observable(!1).extend({throttle:200}),this.contacts.syncing=r.observable(!1).extend({throttle:200}),this.contacts.exportingVcf=r.observable(!1).extend({throttle:200}),this.contacts.exportingCsv=r.observable(!1).extend({throttle:200}),this.allowContactsSync=r.observable(!1),this.enableContactsSync=r.observable(!1),this.contactsSyncUrl=r.observable(""),this.contactsSyncUser=r.observable(""),this.contactsSyncPass=r.observable(""),this.allowContactsSync=r.observable(!!p.settingsGet("ContactsSyncIsAllowed")),this.enableContactsSync=r.observable(!!p.settingsGet("EnableContactsSync")),this.contactsSyncUrl=r.observable(p.settingsGet("ContactsSyncUrl")),this.contactsSyncUser=r.observable(p.settingsGet("ContactsSyncUser")),this.contactsSyncPass=r.observable(p.settingsGet("ContactsSyncPassword")),this.namespace="",this.folderList=r.observableArray([]),this.folderList.focused=r.observable(!1),this.foldersListError=r.observable(""),this.foldersLoading=r.observable(!1),this.foldersCreating=r.observable(!1),this.foldersDeleting=r.observable(!1),this.foldersRenaming=r.observable(!1),this.foldersChanging=r.computed(function(){var e=this.foldersLoading(),t=this.foldersCreating(),s=this.foldersDeleting(),i=this.foldersRenaming();return e||t||s||i},this),this.foldersInboxUnreadCount=r.observable(0),this.currentFolder=r.observable(null).extend({toggleSubscribe:[null,function(e){e&&e.selected(!1)},function(e){e&&e.selected(!0)}]}),this.currentFolderFullNameRaw=r.computed(function(){return this.currentFolder()?this.currentFolder().fullNameRaw:""},this),this.currentFolderFullName=r.computed(function(){return this.currentFolder()?this.currentFolder().fullName:""},this),this.currentFolderFullNameHash=r.computed(function(){return this.currentFolder()?this.currentFolder().fullNameHash:""},this),this.currentFolderName=r.computed(function(){return this.currentFolder()?this.currentFolder().name():""},this),this.folderListSystemNames=r.computed(function(){var e=["INBOX"],t=this.folderList(),s=this.sentFolder(),i=this.draftFolder(),o=this.spamFolder(),a=this.trashFolder(),r=this.archiveFolder();return u.isArray(t)&&0<t.length&&(""!==s&&l.Values.UnuseOptionValue!==s&&e.push(s),""!==i&&l.Values.UnuseOptionValue!==i&&e.push(i),""!==o&&l.Values.UnuseOptionValue!==o&&e.push(o),""!==a&&l.Values.UnuseOptionValue!==a&&e.push(a),""!==r&&l.Values.UnuseOptionValue!==r&&e.push(r)),e},this),this.folderListSystem=r.computed(function(){return o.compact(o.map(this.folderListSystemNames(),function(e){return g.getFolderFromCacheList(e)}))},this),this.folderMenuForMove=r.computed(function(){return u.folderListOptionsBuilder(this.folderListSystem(),this.folderList(),[this.currentFolderFullNameRaw()],null,null,null,null,function(e){return e?e.localName():""})},this),this.staticMessageList=[],this.messageList=r.observableArray([]).extend({rateLimit:0}),this.messageListCount=r.observable(0),this.messageListSearch=r.observable(""),this.messageListPage=r.observable(1),this.messageListThreadFolder=r.observable(""),this.messageListThreadUids=r.observableArray([]),this.messageListThreadFolder.subscribe(function(){this.messageListThreadUids([])},this),this.messageListEndFolder=r.observable(""),this.messageListEndSearch=r.observable(""),this.messageListEndPage=r.observable(1),this.messageListEndHash=r.computed(function(){return this.messageListEndFolder()+"|"+this.messageListEndSearch()+"|"+this.messageListEndPage()},this),this.messageListPageCount=r.computed(function(){var e=i.Math.ceil(this.messageListCount()/this.messagesPerPage());return 0>=e?1:e},this),this.mainMessageListSearch=r.computed({read:this.messageListSearch,write:function(e){m.setHash(c.mailBox(this.currentFolderFullNameHash(),1,u.trim(e.toString())))},owner:this}),this.messageListError=r.observable(""),this.messageListLoading=r.observable(!1),this.messageListIsNotCompleted=r.observable(!1),this.messageListCompleteLoadingThrottle=r.observable(!1).extend({throttle:200}),this.messageListCompleteLoading=r.computed(function(){var e=this.messageListLoading(),t=this.messageListIsNotCompleted();return e||t},this),this.messageListCompleteLoading.subscribe(function(e){this.messageListCompleteLoadingThrottle(e)},this),this.messageList.subscribe(o.debounce(function(e){o.each(e,function(e){e.newForAnimation()&&e.newForAnimation(!1)})},500)),this.staticMessageList=new f,this.message=r.observable(null),this.messageLoading=r.observable(!1),this.messageLoadingThrottle=r.observable(!1).extend({throttle:50}),this.message.focused=r.observable(!1),this.message.subscribe(function(e){e?h.Layout.NoPreview===this.layout()&&this.message.focused(!0):(this.message.focused(!1),this.messageFullScreenMode(!1),this.hideMessageBodies(),h.Layout.NoPreview===this.layout()&&-1<i.location.hash.indexOf("message-preview")&&d.__APP&&d.__APP.historyBack())},this),this.message.focused.subscribe(function(e){e?(this.folderList.focused(!1),d.keyScope(h.KeyState.MessageView)):h.KeyState.MessageView===d.keyScope()&&d.keyScope(h.Layout.NoPreview===this.layout()&&this.message()?h.KeyState.MessageView:h.KeyState.MessageList)},this),this.folderList.focused.subscribe(function(e){e?d.keyScope(h.KeyState.FolderList):h.KeyState.FolderList===d.keyScope()&&d.keyScope(h.KeyState.MessageList)}),this.messageLoading.subscribe(function(e){this.messageLoadingThrottle(e)},this),this.messageFullScreenMode=r.observable(!1),this.messageError=r.observable(""),this.messagesBodiesDom=r.observable(null),this.messagesBodiesDom.subscribe(function(e){!e||e instanceof a||this.messagesBodiesDom(a(e))},this),this.messageActiveDom=r.observable(null),this.isMessageSelected=r.computed(function(){return null!==this.message()},this),this.currentMessage=r.observable(null),this.messageListChecked=r.computed(function(){return o.filter(this.messageList(),function(e){return e.checked()})},this).extend({rateLimit:0}),this.hasCheckedMessages=r.computed(function(){return 0<this.messageListChecked().length},this).extend({rateLimit:0}),this.messageListCheckedOrSelected=r.computed(function(){var e=this.messageListChecked(),t=this.currentMessage();return o.union(e,t?[t]:[])},this),this.messageListCheckedOrSelectedUidsWithSubMails=r.computed(function(){var e=[];return o.each(this.messageListCheckedOrSelected(),function(t){t&&(e.push(t.uid),0<t.threadsLen()&&0===t.parentUid()&&t.lastInCollapsedThread()&&(e=o.union(e,t.threads())))}),e},this),this.userQuota=r.observable(0),this.userUsageSize=r.observable(0),this.userUsageProc=r.computed(function(){var e=this.userQuota(),t=this.userUsageSize();return e>0?i.Math.ceil(t/e*100):0},this),this.capaOpenPGP=r.observable(!1),this.openpgpkeys=r.observableArray([]),this.openpgpKeyring=null,this.openpgpkeysPublic=this.openpgpkeys.filter(function(e){return!(!e||e.isPrivate)}),this.openpgpkeysPrivate=this.openpgpkeys.filter(function(e){return!(!e||!e.isPrivate)}),this.googleActions=r.observable(!1),this.googleLoggined=r.observable(!1),this.googleUserName=r.observable(""),this.facebookActions=r.observable(!1),this.facebookLoggined=r.observable(!1),this.facebookUserName=r.observable(""),this.twitterActions=r.observable(!1),this.twitterLoggined=r.observable(!1),this.twitterUserName=r.observable(""),this.customThemeType=r.observable(h.CustomThemeType.Light),this.purgeMessageBodyCacheThrottle=o.throttle(this.purgeMessageBodyCache,3e4)}var i=s(12),o=s(2),a=s(14),r=s(3),n=s(25),l=s(17),h=s(6),d=s(7),u=s(1),c=s(11),p=s(10),g=s(20),m=s(5),f=s(38),y=s(30),b=s(39);o.extend(t.prototype,b.prototype),t.prototype.purgeMessageBodyCache=function(){var e=0,t=null,s=d.iMessageBodyCacheCount-l.Values.MessageBodyCacheLimit;s>0&&(t=this.messagesBodiesDom(),t&&(t.find(".rl-cache-class").each(function(){var t=a(this);s>t.data("rl-cache-count")&&(t.addClass("rl-cache-purge"),e++)}),e>0&&o.delay(function(){t.find(".rl-cache-purge").remove()},300)))},t.prototype.populateDataOnStart=function(){b.prototype.populateDataOnStart.call(this),this.accountEmail(p.settingsGet("Email")),this.accountIncLogin(p.settingsGet("IncLogin")),this.accountOutLogin(p.settingsGet("OutLogin")),this.projectHash(p.settingsGet("ProjectHash")),this.defaultIdentityID(p.settingsGet("DefaultIdentityID")),this.displayName(p.settingsGet("DisplayName")),this.replyTo(p.settingsGet("ReplyTo")),this.signature(p.settingsGet("Signature")),this.signatureToAll(!!p.settingsGet("SignatureToAll")),this.enableTwoFactor(!!p.settingsGet("EnableTwoFactor")),this.lastFoldersHash=y.get(h.ClientSideKeyName.FoldersLashHash)||"",this.remoteSuggestions=!!p.settingsGet("RemoteSuggestions"),this.devEmail=p.settingsGet("DevEmail"),this.devPassword=p.settingsGet("DevPassword")},t.prototype.initUidNextAndNewMessages=function(e,t,s){if("INBOX"===e&&u.isNormal(t)&&""!==t){if(u.isArray(s)&&0<s.length){var a=this,r=0,n=s.length,l=function(e,t,s){var o=u.notificationClass(),r=null;o&&a.useDesktopNotifications()&&(r=new o(t,{body:s,icon:e}),r&&(r.show&&r.show(),i.setTimeout(function(e){return function(){e.cancel?e.cancel():e.close&&e.close()}}(r),7e3)))};if(o.each(s,function(t){g.addNewMessageCache(e,t.Uid)}),n>3)l(c.notificationMailIcon(),this.accountEmail(),u.i18n("MESSAGE_LIST/NEW_MESSAGE_NOTIFICATION",{COUNT:n}));else for(;n>r;r++)l(c.notificationMailIcon(),f.emailsToLine(f.initEmailsFromJson(s[r].From),!1),s[r].Subject)}g.setFolderUidNext(e,t)}},t.prototype.hideMessageBodies=function(){var e=this.messagesBodiesDom();e&&e.find(".b-text-part").hide()},t.prototype.getNextFolderNames=function(e){e=u.isUnd(e)?!1:!!e;var t=[],s=10,i=n().unix(),a=i-300,r=[],l=function(t){o.each(t,function(t){t&&"INBOX"!==t.fullNameRaw&&t.selectable&&t.existen&&a>t.interval&&(!e||t.subScribed())&&r.push([t.interval,t.fullNameRaw]),t&&0<t.subFolders().length&&l(t.subFolders())})};return l(this.folderList()),r.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),o.find(r,function(e){var o=g.getFolderFromCacheList(e[1]);return o&&(o.interval=i,t.push(e[1])),s<=t.length}),o.uniq(t)},t.prototype.removeMessagesFromList=function(e,t,s,i){s=u.isNormal(s)?s:"",i=u.isUnd(i)?!1:!!i,t=o.map(t,function(e){return u.pInt(e)});var a=this,r=0,n=this.messageList(),l=g.getFolderFromCacheList(e),h=""===s?null:g.getFolderFromCacheList(s||""),d=this.currentFolderFullNameRaw(),c=this.message(),p=d===e?o.filter(n,function(e){return e&&-1<u.inArray(u.pInt(e.uid),t)
}):[];o.each(p,function(e){e&&e.unseen()&&r++}),l&&!i&&(l.messageCountAll(0<=l.messageCountAll()-t.length?l.messageCountAll()-t.length:0),r>0&&l.messageCountUnread(0<=l.messageCountUnread()-r?l.messageCountUnread()-r:0)),h&&(h.messageCountAll(h.messageCountAll()+t.length),r>0&&h.messageCountUnread(h.messageCountUnread()+r),h.actionBlink(!0)),0<p.length&&(i?o.each(p,function(e){e.checked(!1)}):(this.messageListIsNotCompleted(!0),o.each(p,function(e){c&&c.hash===e.hash&&(c=null,a.message(null)),e.deleted(!0)}),o.delay(function(){o.each(p,function(e){a.messageList.remove(e)})},400))),""!==e&&g.setFolderHash(e,""),""!==s&&g.setFolderHash(s,"")},t.prototype.initBlockquoteSwitcher=function(e){if(e){var t=a("blockquote:not(.rl-bq-switcher)",e).filter(function(){return 0===a(this).parent().closest("blockquote",e).length});t&&0<t.length&&t.each(function(){var e=a(this),t=e.height();(0===t||t>100)&&(e.addClass("rl-bq-switcher hidden-bq"),a('<span class="rlBlockquoteSwitcher"><i class="icon-ellipsis" /></span>').insertBefore(e).click(function(){e.toggleClass("hidden-bq"),u.windowResize()}).after("<br />").before("<br />"))})}},t.prototype.setMessage=function(e,t){var s=!1,i=!1,o=!1,r=null,n=null,l="",c="",p=!1,m=!1,f=this.messagesBodiesDom(),y=this.message();e&&y&&e.Result&&"Object/Message"===e.Result["@Object"]&&y.folderFullNameRaw===e.Result.Folder&&y.uid===e.Result.Uid&&(this.messageError(""),y.initUpdateByMessageJson(e.Result),g.addRequestedMessage(y.folderFullNameRaw,y.uid),t||y.initFlagsByJson(e.Result),f=f&&f[0]?f:null,f&&(l="rl-mgs-"+y.hash.replace(/[^a-zA-Z0-9]/g,""),n=f.find("#"+l),n&&n[0]?(y.body=n,y.body&&(y.body.data("rl-cache-count",++d.iMessageBodyCacheCount),y.fetchDataToDom())):(i=!!e.Result.HasExternals,o=!!e.Result.HasInternals,r=a('<div id="'+l+'" />').hide().addClass("rl-cache-class"),r.data("rl-cache-count",++d.iMessageBodyCacheCount),u.isNormal(e.Result.Html)&&""!==e.Result.Html?(s=!0,c=e.Result.Html.toString()):u.isNormal(e.Result.Plain)&&""!==e.Result.Plain?(s=!1,c=u.plainToHtml(e.Result.Plain.toString(),!1),(y.isPgpSigned()||y.isPgpEncrypted())&&this.capaOpenPGP()&&(y.plainRaw=u.pString(e.Result.Plain),m=/---BEGIN PGP MESSAGE---/.test(y.plainRaw),m||(p=/-----BEGIN PGP SIGNED MESSAGE-----/.test(y.plainRaw)&&/-----BEGIN PGP SIGNATURE-----/.test(y.plainRaw)),d.$div.empty(),p&&y.isPgpSigned()?c=d.$div.append(a('<pre class="b-plain-openpgp signed"></pre>').text(y.plainRaw)).html():m&&y.isPgpEncrypted()&&(c=d.$div.append(a('<pre class="b-plain-openpgp encrypted"></pre>').text(y.plainRaw)).html()),d.$div.empty(),y.isPgpSigned(p),y.isPgpEncrypted(m))):s=!1,r.html(u.linkify(c)).addClass("b-text-part "+(s?"html":"plain")),y.isHtml(!!s),y.hasImages(!!i),y.pgpSignedVerifyStatus(h.SignedVerifyStatus.None),y.pgpSignedVerifyUser(""),y.body=r,y.body&&f.append(y.body),y.storeDataToDom(),o&&y.showInternalImages(!0),y.hasImages()&&this.showImages()&&y.showExternalImages(!0),this.purgeMessageBodyCacheThrottle()),this.messageActiveDom(y.body),this.hideMessageBodies(),y.body.show(),r&&this.initBlockquoteSwitcher(r)),g.initMessageFlagsFromCache(y),y.unseen()&&d.__APP&&d.__APP.setMessageSeen(y),u.windowResize())},t.prototype.calculateMessageListHash=function(e){return o.map(e,function(e){return""+e.hash+"_"+e.threadsLen()+"_"+e.flagHash()}).join("|")},t.prototype.findPublicKeyByHex=function(e){return o.find(this.openpgpkeysPublic(),function(t){return t&&e===t.id})},t.prototype.findPublicKeysByEmail=function(e){return o.compact(o.map(this.openpgpkeysPublic(),function(t){var s=null;if(t&&e===t.email)try{if(s=i.openpgp.key.readArmored(t.armor),s&&!s.err&&s.keys&&s.keys[0])return s.keys[0]}catch(o){}return null}))},t.prototype.findPrivateKeyByEmail=function(e,t){var s=null,a=o.find(this.openpgpkeysPrivate(),function(t){return t&&e===t.email});if(a)try{s=i.openpgp.key.readArmored(a.armor),s&&!s.err&&s.keys&&s.keys[0]?(s=s.keys[0],s.decrypt(u.pString(t))):s=null}catch(r){s=null}return s},t.prototype.findSelfPrivateKey=function(e){return this.findPrivateKeyByEmail(this.accountEmail(),e)},e.exports=new t}()},13:function(e,t,s){!function(){"use strict";function t(){u.call(this),this.oRequests={}}var i=s(2),o=s(1),a=s(17),r=s(7),n=s(49),l=s(10),h=s(20),d=s(8),u=s(40);i.extend(t.prototype,u.prototype),t.prototype.folders=function(e){this.defaultRequest(e,"Folders",{SentFolder:l.settingsGet("SentFolder"),DraftFolder:l.settingsGet("DraftFolder"),SpamFolder:l.settingsGet("SpamFolder"),TrashFolder:l.settingsGet("TrashFolder"),ArchiveFolder:l.settingsGet("ArchiveFolder")},null,"",["Folders"])},t.prototype.login=function(e,t,s,i,o,a,r,n){this.defaultRequest(e,"Login",{Email:t,Login:s,Password:i,Language:a||"",AdditionalCode:r||"",AdditionalCodeSignMe:n?"1":"0",SignMe:o?"1":"0"})},t.prototype.getTwoFactor=function(e){this.defaultRequest(e,"GetTwoFactorInfo")},t.prototype.createTwoFactor=function(e){this.defaultRequest(e,"CreateTwoFactorSecret")},t.prototype.clearTwoFactor=function(e){this.defaultRequest(e,"ClearTwoFactorInfo")},t.prototype.showTwoFactorSecret=function(e){this.defaultRequest(e,"ShowTwoFactorSecret")},t.prototype.testTwoFactor=function(e,t){this.defaultRequest(e,"TestTwoFactorInfo",{Code:t})},t.prototype.enableTwoFactor=function(e,t){this.defaultRequest(e,"EnableTwoFactor",{Enable:t?"1":"0"})},t.prototype.clearTwoFactorInfo=function(e){this.defaultRequest(e,"ClearTwoFactorInfo")},t.prototype.contactsSync=function(e){this.defaultRequest(e,"ContactsSync",null,a.Defaults.ContactsSyncAjaxTimeout)},t.prototype.saveContactsSyncData=function(e,t,s,i,o){this.defaultRequest(e,"SaveContactsSyncData",{Enable:t?"1":"0",Url:s,User:i,Password:o})},t.prototype.accountAdd=function(e,t,s,i){this.defaultRequest(e,"AccountAdd",{Email:t,Login:s,Password:i})},t.prototype.accountDelete=function(e,t){this.defaultRequest(e,"AccountDelete",{EmailToDelete:t})},t.prototype.identityUpdate=function(e,t,s,i,o,a){this.defaultRequest(e,"IdentityUpdate",{Id:t,Email:s,Name:i,ReplyTo:o,Bcc:a})},t.prototype.identityDelete=function(e,t){this.defaultRequest(e,"IdentityDelete",{IdToDelete:t})},t.prototype.accountsAndIdentities=function(e){this.defaultRequest(e,"AccountsAndIdentities")},t.prototype.messageList=function(e,t,s,i,r,l){t=o.pString(t);var u=h.getFolderHash(t);l=o.isUnd(l)?!1:!!l,s=o.isUnd(s)?0:o.pInt(s),i=o.isUnd(s)?20:o.pInt(i),r=o.pString(r),""===u||""!==r&&-1!==r.indexOf("is:")?this.defaultRequest(e,"MessageList",{Folder:t,Offset:s,Limit:i,Search:r,UidNext:"INBOX"===t?h.getFolderUidNext(t):"",UseThreads:d.threading()&&d.useThreads()?"1":"0",ExpandedThreadUid:d.threading()&&t===d.messageListThreadFolder()?d.messageListThreadUids().join(","):""},""===r?a.Defaults.DefaultAjaxTimeout:a.Defaults.SearchAjaxTimeout,"",l?[]:["MessageList"]):this.defaultRequest(e,"MessageList",{},""===r?a.Defaults.DefaultAjaxTimeout:a.Defaults.SearchAjaxTimeout,"MessageList/"+n.urlsafe_encode([t,s,i,r,d.projectHash(),u,"INBOX"===t?h.getFolderUidNext(t):"",d.threading()&&d.useThreads()?"1":"0",d.threading()&&t===d.messageListThreadFolder()?d.messageListThreadUids().join(","):""].join(String.fromCharCode(0))),l?[]:["MessageList"])},t.prototype.messageUploadAttachments=function(e,t){this.defaultRequest(e,"MessageUploadAttachments",{Attachments:t},999e3)},t.prototype.message=function(e,t,s){return t=o.pString(t),s=o.pInt(s),h.getFolderFromCacheList(t)&&s>0?(this.defaultRequest(e,"Message",{},null,"Message/"+n.urlsafe_encode([t,s,d.projectHash(),d.threading()&&d.useThreads()?"1":"0"].join(String.fromCharCode(0))),["Message"]),!0):!1},t.prototype.composeUploadExternals=function(e,t){this.defaultRequest(e,"ComposeUploadExternals",{Externals:t},999e3)},t.prototype.composeUploadDrive=function(e,t,s){this.defaultRequest(e,"ComposeUploadDrive",{AccessToken:s,Url:t},999e3)},t.prototype.folderInformation=function(e,t,s){var a=!0,n=[];o.isArray(s)&&0<s.length&&(a=!1,i.each(s,function(e){h.getMessageFlagsFromCache(e.folderFullNameRaw,e.uid)||n.push(e.uid),0<e.threads().length&&i.each(e.threads(),function(t){h.getMessageFlagsFromCache(e.folderFullNameRaw,t)||n.push(t)})}),0<n.length&&(a=!0)),a?this.defaultRequest(e,"FolderInformation",{Folder:t,FlagsUids:o.isArray(n)?n.join(","):"",UidNext:"INBOX"===t?h.getFolderUidNext(t):""}):d.useThreads()&&r.__APP&&r.__APP.reloadFlagsCurrentMessageListAndMessageFromCache()},t.prototype.folderInformationMultiply=function(e,t){this.defaultRequest(e,"FolderInformationMultiply",{Folders:t})},t.prototype.logout=function(e){this.defaultRequest(e,"Logout")},t.prototype.messageSetFlagged=function(e,t,s,i){this.defaultRequest(e,"MessageSetFlagged",{Folder:t,Uids:s.join(","),SetAction:i?"1":"0"})},t.prototype.messageSetSeen=function(e,t,s,i){this.defaultRequest(e,"MessageSetSeen",{Folder:t,Uids:s.join(","),SetAction:i?"1":"0"})},t.prototype.messageSetSeenToAll=function(e,t,s){this.defaultRequest(e,"MessageSetSeenToAll",{Folder:t,SetAction:s?"1":"0"})},t.prototype.saveMessage=function(e,t,s,i,o,r,n,l,h,d,u,c,p,g,m){this.defaultRequest(e,"SaveMessage",{MessageFolder:t,MessageUid:s,DraftFolder:i,From:o,To:r,Cc:n,Bcc:l,Subject:h,TextIsHtml:d?"1":"0",Text:u,DraftInfo:p,InReplyTo:g,References:m,Attachments:c},a.Defaults.SaveMessageAjaxTimeout)},t.prototype.sendReadReceiptMessage=function(e,t,s,i,o,a){this.defaultRequest(e,"SendReadReceiptMessage",{MessageFolder:t,MessageUid:s,ReadReceipt:i,Subject:o,Text:a})},t.prototype.sendMessage=function(e,t,s,i,o,r,n,l,h,d,u,c,p,g,m,f){this.defaultRequest(e,"SendMessage",{MessageFolder:t,MessageUid:s,SentFolder:i,From:o,To:r,Cc:n,Bcc:l,Subject:h,TextIsHtml:d?"1":"0",Text:u,DraftInfo:p,InReplyTo:g,References:m,ReadReceiptRequest:f?"1":"0",Attachments:c},a.Defaults.SendMessageAjaxTimeout)},t.prototype.saveSystemFolders=function(e,t){this.defaultRequest(e,"SystemFoldersUpdate",t)},t.prototype.saveSettings=function(e,t){this.defaultRequest(e,"SettingsUpdate",t)},t.prototype.changePassword=function(e,t,s){this.defaultRequest(e,"ChangePassword",{PrevPassword:t,NewPassword:s})},t.prototype.folderCreate=function(e,t,s){this.defaultRequest(e,"FolderCreate",{Folder:t,Parent:s},null,"",["Folders"])},t.prototype.folderDelete=function(e,t){this.defaultRequest(e,"FolderDelete",{Folder:t},null,"",["Folders"])},t.prototype.folderRename=function(e,t,s){this.defaultRequest(e,"FolderRename",{Folder:t,NewFolderName:s},null,"",["Folders"])},t.prototype.folderClear=function(e,t){this.defaultRequest(e,"FolderClear",{Folder:t})},t.prototype.folderSetSubscribe=function(e,t,s){this.defaultRequest(e,"FolderSubscribe",{Folder:t,Subscribe:s?"1":"0"})},t.prototype.messagesMove=function(e,t,s,i,o){this.defaultRequest(e,"MessageMove",{FromFolder:t,ToFolder:s,Uids:i.join(","),Learning:o||""},null,"",["MessageList"])},t.prototype.messagesCopy=function(e,t,s,i){this.defaultRequest(e,"MessageCopy",{FromFolder:t,ToFolder:s,Uids:i.join(",")})},t.prototype.messagesDelete=function(e,t,s){this.defaultRequest(e,"MessageDelete",{Folder:t,Uids:s.join(",")},null,"",["MessageList"])},t.prototype.appDelayStart=function(e){this.defaultRequest(e,"AppDelayStart")},t.prototype.quota=function(e){this.defaultRequest(e,"Quota")},t.prototype.contacts=function(e,t,s,i){this.defaultRequest(e,"Contacts",{Offset:t,Limit:s,Search:i},null,"",["Contacts"])},t.prototype.contactSave=function(e,t,s,i,a){this.defaultRequest(e,"ContactSave",{RequestUid:t,Uid:o.trim(s),Tags:o.trim(i),Properties:a})},t.prototype.contactsDelete=function(e,t){this.defaultRequest(e,"ContactsDelete",{Uids:t.join(",")})},t.prototype.suggestions=function(e,t,s){this.defaultRequest(e,"Suggestions",{Query:t,Page:s},null,"",["Suggestions"])},t.prototype.facebookUser=function(e){this.defaultRequest(e,"SocialFacebookUserInformation")},t.prototype.facebookDisconnect=function(e){this.defaultRequest(e,"SocialFacebookDisconnect")},t.prototype.twitterUser=function(e){this.defaultRequest(e,"SocialTwitterUserInformation")},t.prototype.twitterDisconnect=function(e){this.defaultRequest(e,"SocialTwitterDisconnect")},t.prototype.googleUser=function(e){this.defaultRequest(e,"SocialGoogleUserInformation")},t.prototype.googleDisconnect=function(e){this.defaultRequest(e,"SocialGoogleDisconnect")},t.prototype.socialUsers=function(e){this.defaultRequest(e,"SocialUsers")},e.exports=new t}()},20:function(e,t,s){!function(){"use strict";function t(){this.oFoldersCache={},this.oFoldersNamesCache={},this.oFolderHashCache={},this.oFolderUidNextCache={},this.oMessageListHashCache={},this.oMessageFlagsCache={},this.oNewMessage={},this.oRequestedMessage={},this.bCapaGravatar=n.capa(o.Capa.Gravatar)}var i=s(2),o=s(6),a=s(1),r=s(11),n=s(10);t.prototype.bCapaGravatar=!1,t.prototype.oFoldersCache={},t.prototype.oFoldersNamesCache={},t.prototype.oFolderHashCache={},t.prototype.oFolderUidNextCache={},t.prototype.oMessageListHashCache={},t.prototype.oMessageFlagsCache={},t.prototype.oBodies={},t.prototype.oNewMessage={},t.prototype.oRequestedMessage={},t.prototype.clear=function(){this.oFoldersCache={},this.oFoldersNamesCache={},this.oFolderHashCache={},this.oFolderUidNextCache={},this.oMessageListHashCache={},this.oMessageFlagsCache={},this.oBodies={}},t.prototype.getUserPic=function(e,t){e=a.trim(e),t(this.bCapaGravatar&&""!==e?r.avatarLink(e):"",e)},t.prototype.getMessageKey=function(e,t){return e+"#"+t},t.prototype.addRequestedMessage=function(e,t){this.oRequestedMessage[this.getMessageKey(e,t)]=!0},t.prototype.hasRequestedMessage=function(e,t){return!0===this.oRequestedMessage[this.getMessageKey(e,t)]},t.prototype.addNewMessageCache=function(e,t){this.oNewMessage[this.getMessageKey(e,t)]=!0},t.prototype.hasNewMessageAndRemoveFromCache=function(e,t){return this.oNewMessage[this.getMessageKey(e,t)]?(this.oNewMessage[this.getMessageKey(e,t)]=null,!0):!1},t.prototype.clearNewMessageCache=function(){this.oNewMessage={}},t.prototype.getFolderFullNameRaw=function(e){return""!==e&&this.oFoldersNamesCache[e]?this.oFoldersNamesCache[e]:""},t.prototype.setFolderFullNameRaw=function(e,t){this.oFoldersNamesCache[e]=t},t.prototype.getFolderHash=function(e){return""!==e&&this.oFolderHashCache[e]?this.oFolderHashCache[e]:""},t.prototype.setFolderHash=function(e,t){this.oFolderHashCache[e]=t},t.prototype.getFolderUidNext=function(e){return""!==e&&this.oFolderUidNextCache[e]?this.oFolderUidNextCache[e]:""},t.prototype.setFolderUidNext=function(e,t){this.oFolderUidNextCache[e]=t},t.prototype.getFolderFromCacheList=function(e){return""!==e&&this.oFoldersCache[e]?this.oFoldersCache[e]:null},t.prototype.setFolderToCacheList=function(e,t){this.oFoldersCache[e]=t},t.prototype.removeFolderFromCacheList=function(e){this.setFolderToCacheList(e,null)},t.prototype.getMessageFlagsFromCache=function(e,t){return this.oMessageFlagsCache[e]&&this.oMessageFlagsCache[e][t]?this.oMessageFlagsCache[e][t]:null},t.prototype.setMessageFlagsToCache=function(e,t,s){this.oMessageFlagsCache[e]||(this.oMessageFlagsCache[e]={}),this.oMessageFlagsCache[e][t]=s},t.prototype.clearMessageFlagsFromCacheByFolder=function(e){this.oMessageFlagsCache[e]={}},t.prototype.initMessageFlagsFromCache=function(e){if(e){var t=this,s=this.getMessageFlagsFromCache(e.folderFullNameRaw,e.uid),o=null,r=null;s&&0<s.length&&(e.unseen(!!s[0]),e.flagged(!!s[1]),e.answered(!!s[2]),e.forwarded(!!s[3]),e.isReadReceipt(!!s[4])),0<e.threads().length&&(o=i.find(e.threads(),function(s){var i=t.getMessageFlagsFromCache(e.folderFullNameRaw,s);return i&&0<i.length&&!!i[0]}),r=i.find(e.threads(),function(s){var i=t.getMessageFlagsFromCache(e.folderFullNameRaw,s);return i&&0<i.length&&!!i[1]}),e.hasUnseenSubMessage(o&&0<a.pInt(o)),e.hasFlaggedSubMessage(r&&0<a.pInt(r)))}},t.prototype.storeMessageFlagsToCache=function(e){e&&this.setMessageFlagsToCache(e.folderFullNameRaw,e.uid,[e.unseen(),e.flagged(),e.answered(),e.forwarded(),e.isReadReceipt()])},t.prototype.storeMessageFlagsToCacheByFolderAndUid=function(e,t,s){a.isArray(s)&&0<s.length&&this.setMessageFlagsToCache(e,t,s)},e.exports=new t}()},27:function(e,t,s){!function(){"use strict";function t(){c.call(this,"Popups","PopupsFolderSystem"),n.initOnStartOrLangChange(function(){this.sChooseOnText=n.i18n("POPUPS_SYSTEM_FOLDERS/SELECT_CHOOSE_ONE"),this.sUnuseText=n.i18n("POPUPS_SYSTEM_FOLDERS/SELECT_UNUSE_NAME")},this),this.notification=o.observable(""),this.folderSelectList=o.computed(function(){return n.folderListOptionsBuilder([],h.folderList(),h.folderListSystemNames(),[["",this.sChooseOnText],[r.Values.UnuseOptionValue,this.sUnuseText]])},this);var e=this,t=null,s=null;this.sentFolder=h.sentFolder,this.draftFolder=h.draftFolder,this.spamFolder=h.spamFolder,this.trashFolder=h.trashFolder,this.archiveFolder=h.archiveFolder,t=i.debounce(function(){l.settingsSet("SentFolder",e.sentFolder()),l.settingsSet("DraftFolder",e.draftFolder()),l.settingsSet("SpamFolder",e.spamFolder()),l.settingsSet("TrashFolder",e.trashFolder()),l.settingsSet("ArchiveFolder",e.archiveFolder()),d.saveSystemFolders(n.emptyFunction,{SentFolder:e.sentFolder(),DraftFolder:e.draftFolder(),SpamFolder:e.spamFolder(),TrashFolder:e.trashFolder(),ArchiveFolder:e.archiveFolder(),NullFolder:"NullFolder"})},1e3),s=function(){l.settingsSet("SentFolder",e.sentFolder()),l.settingsSet("DraftFolder",e.draftFolder()),l.settingsSet("SpamFolder",e.spamFolder()),l.settingsSet("TrashFolder",e.trashFolder()),l.settingsSet("ArchiveFolder",e.archiveFolder()),t()},this.sentFolder.subscribe(s),this.draftFolder.subscribe(s),this.spamFolder.subscribe(s),this.trashFolder.subscribe(s),this.archiveFolder.subscribe(s),this.defautOptionsAfterRender=n.defautOptionsAfterRender,u.constructorEnd(this)}var i=s(2),o=s(3),a=s(6),r=s(17),n=s(1),l=s(10),h=s(8),d=s(13),u=s(5),c=s(9);u.extendAsViewModel(["View:Popup:FolderSystem","PopupsFolderSystemViewModel"],t),i.extend(t.prototype,c.prototype),t.prototype.sChooseOnText="",t.prototype.sUnuseText="",t.prototype.onShow=function(e){var t="";switch(e=n.isUnd(e)?a.SetSystemFoldersNotification.None:e){case a.SetSystemFoldersNotification.Sent:t=n.i18n("POPUPS_SYSTEM_FOLDERS/NOTIFICATION_SENT");break;case a.SetSystemFoldersNotification.Draft:t=n.i18n("POPUPS_SYSTEM_FOLDERS/NOTIFICATION_DRAFTS");break;case a.SetSystemFoldersNotification.Spam:t=n.i18n("POPUPS_SYSTEM_FOLDERS/NOTIFICATION_SPAM");break;case a.SetSystemFoldersNotification.Trash:t=n.i18n("POPUPS_SYSTEM_FOLDERS/NOTIFICATION_TRASH");break;case a.SetSystemFoldersNotification.Archive:t=n.i18n("POPUPS_SYSTEM_FOLDERS/NOTIFICATION_ARCHIVE")}this.notification(t)},e.exports=t}()},30:function(e,t,s){!function(){"use strict";function t(){var e=s(2).find([s(91),s(90)],function(e){return e&&e.supported()});this.oDriver=null,e&&(this.oDriver=new e)}t.prototype.oDriver=null,t.prototype.set=function(e,t){return this.oDriver?this.oDriver.set("p"+e,t):!1},t.prototype.get=function(e){return this.oDriver?this.oDriver.get("p"+e):null},e.exports=new t}()},33:function(e){e.exports=JSON},38:function(e,t,s){!function(){"use strict";function t(){this.folderFullNameRaw="",this.uid="",this.hash="",this.requestHash="",this.subject=r.observable(""),this.subjectPrefix=r.observable(""),this.subjectSuffix=r.observable(""),this.size=r.observable(0),this.dateTimeStampInUTC=r.observable(0),this.priority=r.observable(l.MessagePriority.Normal),this.proxy=!1,this.fromEmailString=r.observable(""),this.fromClearEmailString=r.observable(""),this.toEmailsString=r.observable(""),this.toClearEmailsString=r.observable(""),this.senderEmailsString=r.observable(""),this.senderClearEmailsString=r.observable(""),this.emails=[],this.from=[],this.to=[],this.cc=[],this.bcc=[],this.replyTo=[],this.deliveredTo=[],this.newForAnimation=r.observable(!1),this.deleted=r.observable(!1),this.unseen=r.observable(!1),this.flagged=r.observable(!1),this.answered=r.observable(!1),this.forwarded=r.observable(!1),this.isReadReceipt=r.observable(!1),this.focused=r.observable(!1),this.selected=r.observable(!1),this.checked=r.observable(!1),this.hasAttachments=r.observable(!1),this.attachmentsMainType=r.observable(""),this.moment=r.observable(n(n.unix(0))),this.attachmentIconClass=r.computed(function(){var e="";if(this.hasAttachments())switch(e="icon-attachment",this.attachmentsMainType()){case"image":e="icon-image";break;case"archive":e="icon-file-zip";break;case"doc":e="icon-file-text"}return e},this),this.fullFormatDateValue=r.computed(function(){return t.calculateFullFromatDateValue(this.dateTimeStampInUTC())},this),this.momentDate=h.createMomentDate(this),this.momentShortDate=h.createMomentShortDate(this),this.dateTimeStampInUTC.subscribe(function(e){var t=n().unix();this.moment(n.unix(e>t?t:e))},this),this.body=null,this.plainRaw="",this.isHtml=r.observable(!1),this.hasImages=r.observable(!1),this.attachments=r.observableArray([]),this.isPgpSigned=r.observable(!1),this.isPgpEncrypted=r.observable(!1),this.pgpSignedVerifyStatus=r.observable(l.SignedVerifyStatus.None),this.pgpSignedVerifyUser=r.observable(""),this.priority=r.observable(l.MessagePriority.Normal),this.readReceipt=r.observable(""),this.aDraftInfo=[],this.sMessageId="",this.sInReplyTo="",this.sReferences="",this.parentUid=r.observable(0),this.threads=r.observableArray([]),this.threadsLen=r.observable(0),this.hasUnseenSubMessage=r.observable(!1),this.hasFlaggedSubMessage=r.observable(!1),this.lastInCollapsedThread=r.observable(!1),this.lastInCollapsedThreadLoading=r.observable(!1),this.threadsLenResult=r.computed(function(){var e=this.threadsLen();return 0===this.parentUid()&&e>0?e+1:""},this)}var i=s(12),o=s(2),a=s(14),r=s(3),n=s(25),l=s(6),h=s(1),d=s(7),u=s(11),c=s(23),p=s(52);t.newInstanceFromJson=function(e){var s=new t;return s.initByJson(e)?s:null},t.calculateFullFromatDateValue=function(e){return e>0?n.unix(e).format("LLL"):""},t.emailsToLine=function(e,t,s){var i=[],o=0,a=0;if(h.isNonEmptyArray(e))for(o=0,a=e.length;a>o;o++)i.push(e[o].toLine(t,s));return i.join(", ")},t.emailsToLineClear=function(e){var t=[],s=0,i=0;if(h.isNonEmptyArray(e))for(s=0,i=e.length;i>s;s++)e[s]&&e[s].email&&""!==e[s].name&&t.push(e[s].email);return t.join(", ")},t.initEmailsFromJson=function(e){var t=0,s=0,i=null,o=[];if(h.isNonEmptyArray(e))for(t=0,s=e.length;s>t;t++)i=c.newInstanceFromJson(e[t]),i&&o.push(i);return o},t.replyHelper=function(e,t,s){if(e&&0<e.length)for(var i=0,o=e.length;o>i;i++)h.isUnd(t[e[i].email])&&(t[e[i].email]=!0,s.push(e[i]))},t.prototype.clear=function(){this.folderFullNameRaw="",this.uid="",this.hash="",this.requestHash="",this.subject(""),this.subjectPrefix(""),this.subjectSuffix(""),this.size(0),this.dateTimeStampInUTC(0),this.priority(l.MessagePriority.Normal),this.proxy=!1,this.fromEmailString(""),this.fromClearEmailString(""),this.toEmailsString(""),this.toClearEmailsString(""),this.senderEmailsString(""),this.senderClearEmailsString(""),this.emails=[],this.from=[],this.to=[],this.cc=[],this.bcc=[],this.replyTo=[],this.deliveredTo=[],this.newForAnimation(!1),this.deleted(!1),this.unseen(!1),this.flagged(!1),this.answered(!1),this.forwarded(!1),this.isReadReceipt(!1),this.selected(!1),this.checked(!1),this.hasAttachments(!1),this.attachmentsMainType(""),this.body=null,this.isHtml(!1),this.hasImages(!1),this.attachments([]),this.isPgpSigned(!1),this.isPgpEncrypted(!1),this.pgpSignedVerifyStatus(l.SignedVerifyStatus.None),this.pgpSignedVerifyUser(""),this.priority(l.MessagePriority.Normal),this.readReceipt(""),this.aDraftInfo=[],this.sMessageId="",this.sInReplyTo="",this.sReferences="",this.parentUid(0),this.threads([]),this.threadsLen(0),this.hasUnseenSubMessage(!1),this.hasFlaggedSubMessage(!1),this.lastInCollapsedThread(!1),this.lastInCollapsedThreadLoading(!1)},t.prototype.friendlySize=function(){return h.friendlySize(this.size())},t.prototype.computeSenderEmail=function(){var e=s(8),t=e.sentFolder(),i=e.draftFolder();this.senderEmailsString(this.folderFullNameRaw===t||this.folderFullNameRaw===i?this.toEmailsString():this.fromEmailString()),this.senderClearEmailsString(this.folderFullNameRaw===t||this.folderFullNameRaw===i?this.toClearEmailsString():this.fromClearEmailString())},t.prototype.initByJson=function(e){var s=!1;return e&&"Object/Message"===e["@Object"]&&(this.folderFullNameRaw=e.Folder,this.uid=e.Uid,this.hash=e.Hash,this.requestHash=e.RequestHash,this.proxy=!!e.ExternalProxy,this.size(h.pInt(e.Size)),this.from=t.initEmailsFromJson(e.From),this.to=t.initEmailsFromJson(e.To),this.cc=t.initEmailsFromJson(e.Cc),this.bcc=t.initEmailsFromJson(e.Bcc),this.replyTo=t.initEmailsFromJson(e.ReplyTo),this.deliveredTo=t.initEmailsFromJson(e.DeliveredTo),this.subject(e.Subject),h.isArray(e.SubjectParts)?(this.subjectPrefix(e.SubjectParts[0]),this.subjectSuffix(e.SubjectParts[1])):(this.subjectPrefix(""),this.subjectSuffix(this.subject())),this.dateTimeStampInUTC(h.pInt(e.DateTimeStampInUTC)),this.hasAttachments(!!e.HasAttachments),this.attachmentsMainType(e.AttachmentsMainType),this.fromEmailString(t.emailsToLine(this.from,!0)),this.fromClearEmailString(t.emailsToLineClear(this.from)),this.toEmailsString(t.emailsToLine(this.to,!0)),this.toClearEmailsString(t.emailsToLineClear(this.to)),this.parentUid(h.pInt(e.ParentThread)),this.threads(h.isArray(e.Threads)?e.Threads:[]),this.threadsLen(h.pInt(e.ThreadsLen)),this.initFlagsByJson(e),this.computeSenderEmail(),s=!0),s},t.prototype.initUpdateByMessageJson=function(e){var t=s(8),i=!1,o=l.MessagePriority.Normal;return e&&"Object/Message"===e["@Object"]&&(o=h.pInt(e.Priority),this.priority(-1<h.inArray(o,[l.MessagePriority.High,l.MessagePriority.Low])?o:l.MessagePriority.Normal),this.aDraftInfo=e.DraftInfo,this.sMessageId=e.MessageId,this.sInReplyTo=e.InReplyTo,this.sReferences=e.References,this.proxy=!!e.ExternalProxy,t.capaOpenPGP()&&(this.isPgpSigned(!!e.PgpSigned),this.isPgpEncrypted(!!e.PgpEncrypted)),this.hasAttachments(!!e.HasAttachments),this.attachmentsMainType(e.AttachmentsMainType),this.foundedCIDs=h.isArray(e.FoundedCIDs)?e.FoundedCIDs:[],this.attachments(this.initAttachmentsFromJson(e.Attachments)),this.readReceipt(e.ReadReceipt||""),this.computeSenderEmail(),i=!0),i},t.prototype.initAttachmentsFromJson=function(e){var t=0,s=0,i=null,o=[];if(e&&"Collection/AttachmentCollection"===e["@Object"]&&h.isNonEmptyArray(e["@Collection"]))for(t=0,s=e["@Collection"].length;s>t;t++)i=p.newInstanceFromJson(e["@Collection"][t]),i&&(""!==i.cidWithOutTags&&0<this.foundedCIDs.length&&0<=h.inArray(i.cidWithOutTags,this.foundedCIDs)&&(i.isLinked=!0),o.push(i));return o},t.prototype.initFlagsByJson=function(e){var t=!1;return e&&"Object/Message"===e["@Object"]&&(this.unseen(!e.IsSeen),this.flagged(!!e.IsFlagged),this.answered(!!e.IsAnswered),this.forwarded(!!e.IsForwarded),this.isReadReceipt(!!e.IsReadReceipt),t=!0),t},t.prototype.fromToLine=function(e,s){return t.emailsToLine(this.from,e,s)},t.prototype.toToLine=function(e,s){return t.emailsToLine(this.to,e,s)},t.prototype.ccToLine=function(e,s){return t.emailsToLine(this.cc,e,s)},t.prototype.bccToLine=function(e,s){return t.emailsToLine(this.bcc,e,s)},t.prototype.lineAsCcc=function(){var e=[];if(this.deleted()&&e.push("deleted"),this.selected()&&e.push("selected"),this.checked()&&e.push("checked"),this.flagged()&&e.push("flagged"),this.unseen()&&e.push("unseen"),this.answered()&&e.push("answered"),this.forwarded()&&e.push("forwarded"),this.focused()&&e.push("focused"),this.hasAttachments())switch(e.push("withAttachments"),this.attachmentsMainType()){case"image":e.push("imageOnlyAttachments");break;case"archive":e.push("archiveOnlyAttachments")}return this.newForAnimation()&&e.push("new"),""===this.subject()&&e.push("emptySubject"),0<this.parentUid()&&e.push("hasParentMessage"),0<this.threadsLen()&&0===this.parentUid()&&e.push("hasChildrenMessage"),this.hasUnseenSubMessage()&&e.push("hasUnseenSubMessage"),this.hasFlaggedSubMessage()&&e.push("hasFlaggedSubMessage"),e.join(" ")},t.prototype.hasVisibleAttachments=function(){return!!o.find(this.attachments(),function(e){return!e.isLinked})},t.prototype.findAttachmentByCid=function(e){var t=null,s=this.attachments();return h.isNonEmptyArray(s)&&(e=e.replace(/^<+/,"").replace(/>+$/,""),t=o.find(s,function(t){return e===t.cidWithOutTags})),t||null},t.prototype.findAttachmentByContentLocation=function(e){var t=null,s=this.attachments();return h.isNonEmptyArray(s)&&(t=o.find(s,function(t){return e===t.contentLocation})),t||null},t.prototype.messageId=function(){return this.sMessageId},t.prototype.inReplyTo=function(){return this.sInReplyTo},t.prototype.references=function(){return this.sReferences},t.prototype.fromAsSingleEmail=function(){return h.isArray(this.from)&&this.from[0]?this.from[0].email:""},t.prototype.viewLink=function(){return u.messageViewLink(this.requestHash)},t.prototype.downloadLink=function(){return u.messageDownloadLink(this.requestHash)},t.prototype.replyEmails=function(e){var s=[],i=h.isUnd(e)?{}:e;return t.replyHelper(this.replyTo,i,s),0===s.length&&t.replyHelper(this.from,i,s),s},t.prototype.replyAllEmails=function(e){var s=[],i=[],o=h.isUnd(e)?{}:e;return t.replyHelper(this.replyTo,o,s),0===s.length&&t.replyHelper(this.from,o,s),t.replyHelper(this.to,o,s),t.replyHelper(this.cc,o,i),[s,i]},t.prototype.textBodyToString=function(){return this.body?this.body.html():""},t.prototype.attachmentsToStringLine=function(){var e=o.map(this.attachments(),function(e){return e.fileName+" ("+e.friendlySize+")"});return e&&0<e.length?e.join(", "):""},t.prototype.getDataForWindowPopup=function(){return{popupFrom:this.fromToLine(!1),popupTo:this.toToLine(!1),popupCc:this.ccToLine(!1),popupBcc:this.bccToLine(!1),popupSubject:this.subject(),popupIsHtml:this.isHtml(),popupDate:this.fullFormatDateValue(),popupAttachments:this.attachmentsToStringLine(),popupBody:this.textBodyToString()}},t.prototype.viewPopupMessage=function(e){h.windowPopupKnockout(this.getDataForWindowPopup(),"PopupsWindowSimpleMessage",this.subject(),function(t){t&&t.document&&t.document.body&&(a("img.lazy",t.document.body).each(function(e,t){var s=a(t),i=s.data("original"),o=s.attr("src");e>=0&&i&&!o&&s.attr("src",i)}),e&&i.setTimeout(function(){t.print()},100))})},t.prototype.printMessage=function(){this.viewPopupMessage(!0)},t.prototype.generateUid=function(){return this.folderFullNameRaw+"/"+this.uid},t.prototype.populateByMessageListItem=function(e){return this.folderFullNameRaw=e.folderFullNameRaw,this.uid=e.uid,this.hash=e.hash,this.requestHash=e.requestHash,this.subject(e.subject()),this.subjectPrefix(this.subjectPrefix()),this.subjectSuffix(this.subjectSuffix()),this.size(e.size()),this.dateTimeStampInUTC(e.dateTimeStampInUTC()),this.priority(e.priority()),this.proxy=e.proxy,this.fromEmailString(e.fromEmailString()),this.fromClearEmailString(e.fromClearEmailString()),this.toEmailsString(e.toEmailsString()),this.toClearEmailsString(e.toClearEmailsString()),this.emails=e.emails,this.from=e.from,this.to=e.to,this.cc=e.cc,this.bcc=e.bcc,this.replyTo=e.replyTo,this.deliveredTo=e.deliveredTo,this.unseen(e.unseen()),this.flagged(e.flagged()),this.answered(e.answered()),this.forwarded(e.forwarded()),this.isReadReceipt(e.isReadReceipt()),this.selected(e.selected()),this.checked(e.checked()),this.hasAttachments(e.hasAttachments()),this.attachmentsMainType(e.attachmentsMainType()),this.moment(e.moment()),this.body=null,this.priority(l.MessagePriority.Normal),this.aDraftInfo=[],this.sMessageId="",this.sInReplyTo="",this.sReferences="",this.parentUid(e.parentUid()),this.threads(e.threads()),this.threadsLen(e.threadsLen()),this.computeSenderEmail(),this},t.prototype.showExternalImages=function(e){if(this.body&&this.body.data("rl-has-images")){var t="";e=h.isUnd(e)?!1:e,this.hasImages(!1),this.body.data("rl-has-images",!1),t=this.proxy?"data-x-additional-src":"data-x-src",a("["+t+"]",this.body).each(function(){e&&a(this).is("img")?a(this).addClass("lazy").attr("data-original",a(this).attr(t)).removeAttr(t):a(this).attr("src",a(this).attr(t)).removeAttr(t)}),t=this.proxy?"data-x-additional-style-url":"data-x-style-url",a("["+t+"]",this.body).each(function(){var e=h.trim(a(this).attr("style"));e=""===e?"":";"===e.substr(-1)?e+" ":e+"; ",a(this).attr("style",e+a(this).attr(t)).removeAttr(t)}),e&&(a("img.lazy",this.body).addClass("lazy-inited").lazyload({threshold:400,effect:"fadeIn",skip_invisible:!1,container:a(".RL-MailMessageView .messageView .messageItem .content")[0]}),d.$win.resize()),h.windowResize(500)
}},t.prototype.showInternalImages=function(e){if(this.body&&!this.body.data("rl-init-internal-images")){this.body.data("rl-init-internal-images",!0),e=h.isUnd(e)?!1:e;var t=this;a("[data-x-src-cid]",this.body).each(function(){var s=t.findAttachmentByCid(a(this).attr("data-x-src-cid"));s&&s.download&&(e&&a(this).is("img")?a(this).addClass("lazy").attr("data-original",s.linkPreview()):a(this).attr("src",s.linkPreview()))}),a("[data-x-src-location]",this.body).each(function(){var s=t.findAttachmentByContentLocation(a(this).attr("data-x-src-location"));s||(s=t.findAttachmentByCid(a(this).attr("data-x-src-location"))),s&&s.download&&(e&&a(this).is("img")?a(this).addClass("lazy").attr("data-original",s.linkPreview()):a(this).attr("src",s.linkPreview()))}),a("[data-x-style-cid]",this.body).each(function(){var e="",s="",i=t.findAttachmentByCid(a(this).attr("data-x-style-cid"));i&&i.linkPreview&&(s=a(this).attr("data-x-style-cid-name"),""!==s&&(e=h.trim(a(this).attr("style")),e=""===e?"":";"===e.substr(-1)?e+" ":e+"; ",a(this).attr("style",e+s+": url('"+i.linkPreview()+"')")))}),e&&!function(e,t){o.delay(function(){e.addClass("lazy-inited").lazyload({threshold:400,effect:"fadeIn",skip_invisible:!1,container:t})},300)}(a("img.lazy",t.body),a(".RL-MailMessageView .messageView .messageItem .content")[0]),h.windowResize(500)}},t.prototype.storeDataToDom=function(){if(this.body){this.body.data("rl-is-html",!!this.isHtml()),this.body.data("rl-has-images",!!this.hasImages()),this.body.data("rl-plain-raw",this.plainRaw);var e=s(8);e.capaOpenPGP()&&(this.body.data("rl-plain-pgp-signed",!!this.isPgpSigned()),this.body.data("rl-plain-pgp-encrypted",!!this.isPgpEncrypted()),this.body.data("rl-pgp-verify-status",this.pgpSignedVerifyStatus()),this.body.data("rl-pgp-verify-user",this.pgpSignedVerifyUser()))}},t.prototype.storePgpVerifyDataToDom=function(){var e=s(8);this.body&&e.capaOpenPGP()&&(this.body.data("rl-pgp-verify-status",this.pgpSignedVerifyStatus()),this.body.data("rl-pgp-verify-user",this.pgpSignedVerifyUser()))},t.prototype.fetchDataToDom=function(){if(this.body){this.isHtml(!!this.body.data("rl-is-html")),this.hasImages(!!this.body.data("rl-has-images")),this.plainRaw=h.pString(this.body.data("rl-plain-raw"));var e=s(8);e.capaOpenPGP()?(this.isPgpSigned(!!this.body.data("rl-plain-pgp-signed")),this.isPgpEncrypted(!!this.body.data("rl-plain-pgp-encrypted")),this.pgpSignedVerifyStatus(this.body.data("rl-pgp-verify-status")),this.pgpSignedVerifyUser(this.body.data("rl-pgp-verify-user"))):(this.isPgpSigned(!1),this.isPgpEncrypted(!1),this.pgpSignedVerifyStatus(l.SignedVerifyStatus.None),this.pgpSignedVerifyUser(""))}},t.prototype.verifyPgpSignedClearMessage=function(){if(this.isPgpSigned()){var e=[],t=null,r=s(8),n=this.from&&this.from[0]&&this.from[0].email?this.from[0].email:"",h=r.findPublicKeysByEmail(n),u=null,c=null,p="";this.pgpSignedVerifyStatus(l.SignedVerifyStatus.Error),this.pgpSignedVerifyUser("");try{t=i.openpgp.cleartext.readArmored(this.plainRaw),t&&t.getText&&(this.pgpSignedVerifyStatus(h.length?l.SignedVerifyStatus.Unverified:l.SignedVerifyStatus.UnknownPublicKeys),e=t.verify(h),e&&0<e.length&&(u=o.find(e,function(e){return e&&e.keyid&&e.valid}),u&&(c=r.findPublicKeyByHex(u.keyid.toHex()),c&&(p=t.getText(),this.pgpSignedVerifyStatus(l.SignedVerifyStatus.Success),this.pgpSignedVerifyUser(c.user),p=d.$div.empty().append(a('<pre class="b-plain-openpgp signed verified"></pre>').text(p)).html(),d.$div.empty(),this.replacePlaneTextBody(p)))))}catch(g){}this.storePgpVerifyDataToDom()}},t.prototype.decryptPgpEncryptedMessage=function(e){if(this.isPgpEncrypted()){var t=[],r=null,n=null,h=s(8),u=this.from&&this.from[0]&&this.from[0].email?this.from[0].email:"",c=h.findPublicKeysByEmail(u),p=h.findSelfPrivateKey(e),g=null,m=null,f="";this.pgpSignedVerifyStatus(l.SignedVerifyStatus.Error),this.pgpSignedVerifyUser(""),p||this.pgpSignedVerifyStatus(l.SignedVerifyStatus.UnknownPrivateKey);try{r=i.openpgp.message.readArmored(this.plainRaw),r&&p&&r.decrypt&&(this.pgpSignedVerifyStatus(l.SignedVerifyStatus.Unverified),n=r.decrypt(p),n&&(t=n.verify(c),t&&0<t.length&&(g=o.find(t,function(e){return e&&e.keyid&&e.valid}),g&&(m=h.findPublicKeyByHex(g.keyid.toHex()),m&&(this.pgpSignedVerifyStatus(l.SignedVerifyStatus.Success),this.pgpSignedVerifyUser(m.user)))),f=n.getText(),f=d.$div.empty().append(a('<pre class="b-plain-openpgp signed verified"></pre>').text(f)).html(),d.$div.empty(),this.replacePlaneTextBody(f)))}catch(y){}this.storePgpVerifyDataToDom()}},t.prototype.replacePlaneTextBody=function(e){this.body&&this.body.html(e).addClass("b-text-part plain")},t.prototype.flagHash=function(){return[this.deleted(),this.unseen(),this.flagged(),this.answered(),this.forwarded(),this.isReadReceipt()].join("")},e.exports=t}()},49:function(e){!function(){"use strict";var t={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",urlsafe_encode:function(e){return t.encode(e).replace(/[+]/g,"-").replace(/[\/]/g,"_").replace(/[=]/g,".")},encode:function(e){var s,i,o,a,r,n,l,h="",d=0;for(e=t._utf8_encode(e);d<e.length;)s=e.charCodeAt(d++),i=e.charCodeAt(d++),o=e.charCodeAt(d++),a=s>>2,r=(3&s)<<4|i>>4,n=(15&i)<<2|o>>6,l=63&o,isNaN(i)?n=l=64:isNaN(o)&&(l=64),h=h+this._keyStr.charAt(a)+this._keyStr.charAt(r)+this._keyStr.charAt(n)+this._keyStr.charAt(l);return h},decode:function(e){var s,i,o,a,r,n,l,h="",d=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<e.length;)a=this._keyStr.indexOf(e.charAt(d++)),r=this._keyStr.indexOf(e.charAt(d++)),n=this._keyStr.indexOf(e.charAt(d++)),l=this._keyStr.indexOf(e.charAt(d++)),s=a<<2|r>>4,i=(15&r)<<4|n>>2,o=(3&n)<<6|l,h+=String.fromCharCode(s),64!==n&&(h+=String.fromCharCode(i)),64!==l&&(h+=String.fromCharCode(o));return t._utf8_decode(h)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",s=0,i=e.length,o=0;i>s;s++)o=e.charCodeAt(s),128>o?t+=String.fromCharCode(o):o>127&&2048>o?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128));return t},_utf8_decode:function(e){for(var t="",s=0,i=0,o=0,a=0;s<e.length;)i=e.charCodeAt(s),128>i?(t+=String.fromCharCode(i),s++):i>191&&224>i?(o=e.charCodeAt(s+1),t+=String.fromCharCode((31&i)<<6|63&o),s+=2):(o=e.charCodeAt(s+1),a=e.charCodeAt(s+2),t+=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a),s+=3);return t}};e.exports=t}()},51:function(e,t,s){!function(){"use strict";function t(e,t){this.email=e,this.deleteAccess=i.observable(!1),this.canBeDalete=i.observable(o.isUnd(t)?!0:!!t)}var i=s(3),o=s(1);t.prototype.email="",t.prototype.changeAccountLink=function(){return s(11).change(this.email)},e.exports=t}()},52:function(e,t,s){!function(){"use strict";function t(){this.mimeType="",this.fileName="",this.estimatedSize=0,this.friendlySize="",this.isInline=!1,this.isLinked=!1,this.cid="",this.cidWithOutTags="",this.contentLocation="",this.download="",this.folder="",this.uid="",this.mimeIndex=""}var i=s(12),o=s(7),a=s(1),r=s(11);t.newInstanceFromJson=function(e){var s=new t;return s.initByJson(e)?s:null},t.prototype.mimeType="",t.prototype.fileName="",t.prototype.estimatedSize=0,t.prototype.friendlySize="",t.prototype.isInline=!1,t.prototype.isLinked=!1,t.prototype.cid="",t.prototype.cidWithOutTags="",t.prototype.contentLocation="",t.prototype.download="",t.prototype.folder="",t.prototype.uid="",t.prototype.mimeIndex="",t.prototype.initByJson=function(e){var t=!1;return e&&"Object/Attachment"===e["@Object"]&&(this.mimeType=(e.MimeType||"").toLowerCase(),this.fileName=e.FileName,this.estimatedSize=a.pInt(e.EstimatedSize),this.isInline=!!e.IsInline,this.isLinked=!!e.IsLinked,this.cid=e.CID,this.contentLocation=e.ContentLocation,this.download=e.Download,this.folder=e.Folder,this.uid=e.Uid,this.mimeIndex=e.MimeIndex,this.friendlySize=a.friendlySize(this.estimatedSize),this.cidWithOutTags=this.cid.replace(/^<+/,"").replace(/>+$/,""),t=!0),t},t.prototype.isImage=function(){return-1<a.inArray(this.mimeType.toLowerCase(),["image/png","image/jpg","image/jpeg","image/gif"])},t.prototype.isText=function(){return"text/"===this.mimeType.substr(0,5)&&-1===a.inArray(this.mimeType,["text/html"])},t.prototype.isPdf=function(){return o.bAllowPdfPreview&&"application/pdf"===this.mimeType},t.prototype.linkDownload=function(){return r.attachmentDownload(this.download)},t.prototype.linkPreview=function(){return r.attachmentPreview(this.download)},t.prototype.linkPreviewAsPlain=function(){return r.attachmentPreviewAsPlain(this.download)},t.prototype.generateTransferDownloadUrl=function(){var e=this.linkDownload();return"http"!==e.substr(0,4)&&(e=i.location.protocol+"//"+i.location.host+i.location.pathname+e),this.mimeType+":"+this.fileName+":"+e},t.prototype.eventDragStart=function(e,t){var s=t.originalEvent||t;return e&&s&&s.dataTransfer&&s.dataTransfer.setData&&s.dataTransfer.setData("DownloadURL",this.generateTransferDownloadUrl()),!0},t.prototype.iconClass=function(){var e=this.mimeType.toLocaleString().split("/"),t="icon-file";return e&&e[1]&&("image"===e[0]?t="icon-file-image":"text"===e[0]?t="icon-file-text":"audio"===e[0]?t="icon-file-music":"video"===e[0]?t="icon-file-movie":-1<a.inArray(e[1],["zip","7z","tar","rar","gzip","bzip","bzip2","x-zip","x-7z","x-rar","x-tar","x-gzip","x-bzip","x-bzip2","x-zip-compressed","x-7z-compressed","x-rar-compressed"])?t="icon-file-zip":-1<a.inArray(e[1],["rtf","msword","vnd.msword","vnd.openxmlformats-officedocument.wordprocessingml.document","vnd.openxmlformats-officedocument.wordprocessingml.template","vnd.ms-word.document.macroEnabled.12","vnd.ms-word.template.macroEnabled.12"])?t="icon-file-text":-1<a.inArray(e[1],["excel","ms-excel","vnd.ms-excel","vnd.openxmlformats-officedocument.spreadsheetml.sheet","vnd.openxmlformats-officedocument.spreadsheetml.template","vnd.ms-excel.sheet.macroEnabled.12","vnd.ms-excel.template.macroEnabled.12","vnd.ms-excel.addin.macroEnabled.12","vnd.ms-excel.sheet.binary.macroEnabled.12"])?t="icon-file-excel":-1<a.inArray(e[1],["powerpoint","ms-powerpoint","vnd.ms-powerpoint","vnd.openxmlformats-officedocument.presentationml.presentation","vnd.openxmlformats-officedocument.presentationml.template","vnd.openxmlformats-officedocument.presentationml.slideshow","vnd.ms-powerpoint.addin.macroEnabled.12","vnd.ms-powerpoint.presentation.macroEnabled.12","vnd.ms-powerpoint.template.macroEnabled.12","vnd.ms-powerpoint.slideshow.macroEnabled.12"])&&(t="icon-file-chart-graph")),t},e.exports=t}()},58:function(e,t,s){!function(){"use strict";function t(){this.name=o.observable(""),this.fullName="",this.fullNameRaw="",this.fullNameHash="",this.delimiter="",this.namespace="",this.deep=0,this.interval=0,this.selectable=!1,this.existen=!0,this.type=o.observable(a.FolderType.User),this.focused=o.observable(!1),this.selected=o.observable(!1),this.edited=o.observable(!1),this.collapsed=o.observable(!0),this.subScribed=o.observable(!0),this.subFolders=o.observableArray([]),this.deleteAccess=o.observable(!1),this.actionBlink=o.observable(!1).extend({falseTimeout:1e3}),this.nameForEdit=o.observable(""),this.privateMessageCountAll=o.observable(0),this.privateMessageCountUnread=o.observable(0),this.collapsedPrivate=o.observable(!0)}var i=s(2),o=s(3),a=s(6),r=s(7),n=s(1),l=s(22);t.newInstanceFromJson=function(e){var s=new t;return s.initByJson(e)?s.initComputed():null},t.prototype.initComputed=function(){return this.hasSubScribedSubfolders=o.computed(function(){return!!i.find(this.subFolders(),function(e){return e.subScribed()&&!e.isSystemFolder()})},this),this.canBeEdited=o.computed(function(){return a.FolderType.User===this.type()&&this.existen&&this.selectable},this),this.visible=o.computed(function(){var e=this.subScribed(),t=this.hasSubScribedSubfolders();return e||t&&(!this.existen||!this.selectable)},this),this.isSystemFolder=o.computed(function(){return a.FolderType.User!==this.type()},this),this.hidden=o.computed(function(){var e=this.isSystemFolder(),t=this.hasSubScribedSubfolders();return e&&!t||!this.selectable&&!t},this),this.selectableForFolderList=o.computed(function(){return!this.isSystemFolder()&&this.selectable},this),this.messageCountAll=o.computed({read:this.privateMessageCountAll,write:function(e){n.isPosNumeric(e,!0)?this.privateMessageCountAll(e):this.privateMessageCountAll.valueHasMutated()},owner:this}),this.messageCountUnread=o.computed({read:this.privateMessageCountUnread,write:function(e){n.isPosNumeric(e,!0)?this.privateMessageCountUnread(e):this.privateMessageCountUnread.valueHasMutated()},owner:this}),this.printableUnreadCount=o.computed(function(){var e=this.messageCountAll(),t=this.messageCountUnread(),s=this.type();if(e>0){if(a.FolderType.Draft===s)return""+e;if(t>0&&a.FolderType.Trash!==s&&a.FolderType.Archive!==s&&a.FolderType.SentItems!==s)return""+t}return""},this),this.canBeDeleted=o.computed(function(){var e=this.isSystemFolder();return!e&&0===this.subFolders().length&&"INBOX"!==this.fullNameRaw},this),this.canBeSubScribed=o.computed(function(){return!this.isSystemFolder()&&this.selectable&&"INBOX"!==this.fullNameRaw},this),this.localName=o.computed(function(){r.langChangeTrigger();var e=this.type(),t=this.name();if(this.isSystemFolder())switch(e){case a.FolderType.Inbox:t=n.i18n("FOLDER_LIST/INBOX_NAME");break;case a.FolderType.SentItems:t=n.i18n("FOLDER_LIST/SENT_NAME");break;case a.FolderType.Draft:t=n.i18n("FOLDER_LIST/DRAFTS_NAME");break;case a.FolderType.Spam:t=n.i18n("FOLDER_LIST/SPAM_NAME");break;case a.FolderType.Trash:t=n.i18n("FOLDER_LIST/TRASH_NAME");break;case a.FolderType.Archive:t=n.i18n("FOLDER_LIST/ARCHIVE_NAME")}return t},this),this.manageFolderSystemName=o.computed(function(){r.langChangeTrigger();var e="",t=this.type(),s=this.name();if(this.isSystemFolder())switch(t){case a.FolderType.Inbox:e="("+n.i18n("FOLDER_LIST/INBOX_NAME")+")";break;case a.FolderType.SentItems:e="("+n.i18n("FOLDER_LIST/SENT_NAME")+")";break;case a.FolderType.Draft:e="("+n.i18n("FOLDER_LIST/DRAFTS_NAME")+")";break;case a.FolderType.Spam:e="("+n.i18n("FOLDER_LIST/SPAM_NAME")+")";break;case a.FolderType.Trash:e="("+n.i18n("FOLDER_LIST/TRASH_NAME")+")";break;case a.FolderType.Archive:e="("+n.i18n("FOLDER_LIST/ARCHIVE_NAME")+")"}return(""!==e&&"("+s+")"===e||"(inbox)"===e.toLowerCase())&&(e=""),e},this),this.collapsed=o.computed({read:function(){return!this.hidden()&&this.collapsedPrivate()},write:function(e){this.collapsedPrivate(e)},owner:this}),this.hasUnreadMessages=o.computed(function(){return 0<this.messageCountUnread()},this),this.hasSubScribedUnreadMessagesSubfolders=o.computed(function(){return!!i.find(this.subFolders(),function(e){return e.hasUnreadMessages()||e.hasSubScribedUnreadMessagesSubfolders()})},this),this.name.subscribe(function(e){this.nameForEdit(e)},this),this.edited.subscribe(function(e){e&&this.nameForEdit(this.name())},this),this.messageCountUnread.subscribe(function(e){a.FolderType.Inbox===this.type()&&l.pub("mailbox.inbox-unread-count",[e])},this),this},t.prototype.fullName="",t.prototype.fullNameRaw="",t.prototype.fullNameHash="",t.prototype.delimiter="",t.prototype.namespace="",t.prototype.deep=0,t.prototype.interval=0,t.prototype.collapsedCss=function(){return this.hasSubScribedSubfolders()?this.collapsed()?"icon-right-mini e-collapsed-sign":"icon-down-mini e-collapsed-sign":"icon-none e-collapsed-sign"},t.prototype.initByJson=function(e){var t=!1;return e&&"Object/Folder"===e["@Object"]&&(this.name(e.Name),this.delimiter=e.Delimiter,this.fullName=e.FullName,this.fullNameRaw=e.FullNameRaw,this.fullNameHash=e.FullNameHash,this.deep=e.FullNameRaw.split(this.delimiter).length-1,this.selectable=!!e.IsSelectable,this.existen=!!e.IsExists,this.subScribed(!!e.IsSubscribed),this.type("INBOX"===this.fullNameRaw?a.FolderType.Inbox:a.FolderType.User),t=!0),t},t.prototype.printableFullName=function(){return this.fullName.split(this.delimiter).join(" / ")},e.exports=t}()},59:function(e,t,s){!function(){"use strict";function t(e,t,s){this.id=e,this.email=i.observable(t),this.name=i.observable(""),this.replyTo=i.observable(""),this.bcc=i.observable(""),this.deleteAccess=i.observable(!1),this.canBeDalete=i.observable(s)}var i=s(3),o=s(1);t.prototype.formattedName=function(){var e=this.name();return""===e?this.email():e+" <"+this.email()+">"},t.prototype.formattedNameForCompose=function(){var e=this.name();return""===e?this.email():e+" ("+this.email()+")"},t.prototype.formattedNameForEmail=function(){var e=this.name();return""===e?this.email():'"'+o.quoteName(e)+'" <'+this.email()+">"},e.exports=t}()},60:function(e,t,s){!function(){"use strict";function t(e,t,s,o,a,r,n){this.index=e,this.id=s,this.guid=t,this.user=o,this.email=a,this.armor=n,this.isPrivate=!!r,this.deleteAccess=i.observable(!1)}var i=s(3);t.prototype.index=0,t.prototype.id="",t.prototype.guid="",t.prototype.user="",t.prototype.email="",t.prototype.armor="",t.prototype.isPrivate=!1,e.exports=t}()},64:function(e,t,s){!function(){"use strict";function t(){o.call(this,"login",[s(96)])}var i=s(2),o=s(24);i.extend(t.prototype,o.prototype),t.prototype.onShow=function(){s(4).setTitle("")},e.exports=t}()},90:function(e,t,s){!function(){"use strict";function t(){}var i=s(14),o=s(33),a=s(17),r=s(1);t.supported=function(){return!(!window.navigator||!window.navigator.cookieEnabled)},t.prototype.set=function(e,t){var s=i.cookie(a.Values.ClientSideStorageIndexName),r=!1,n=null;try{n=null===s?null:o.parse(s)}catch(l){}n||(n={}),n[e]=t;try{i.cookie(a.Values.ClientSideStorageIndexName,o.stringify(n),{expires:30}),r=!0}catch(l){}return r},t.prototype.get=function(e){var t=i.cookie(a.Values.ClientSideStorageIndexName),s=null;try{s=null===t?null:o.parse(t),s=s&&!r.isUnd(s[e])?s[e]:null}catch(n){}return s},e.exports=t}()},91:function(e,t,s){!function(){"use strict";function t(){}var i=s(12),o=s(33),a=s(17),r=s(1);t.supported=function(){return!!i.localStorage},t.prototype.set=function(e,t){var s=i.localStorage[a.Values.ClientSideStorageIndexName]||null,r=!1,n=null;try{n=null===s?null:o.parse(s)}catch(l){}n||(n={}),n[e]=t;try{i.localStorage[a.Values.ClientSideStorageIndexName]=o.stringify(n),r=!0}catch(l){}return r},t.prototype.get=function(e){var t=i.localStorage[a.Values.ClientSideStorageIndexName]||null,s=null;try{s=null===t?null:o.parse(t),s=s&&!r.isUnd(s[e])?s[e]:null}catch(n){}return s},e.exports=t}()},96:function(e,t,s){!function(){"use strict";function t(){g.call(this,"Center","Login"),this.email=r.observable(""),this.password=r.observable(""),this.signMe=r.observable(!1),this.additionalCode=r.observable(""),this.additionalCode.error=r.observable(!1),this.additionalCode.focused=r.observable(!1),this.additionalCode.visibility=r.observable(!1),this.additionalCodeSignMe=r.observable(!1),this.logoImg=l.trim(d.settingsGet("LoginLogo")),this.loginDescription=l.trim(d.settingsGet("LoginDescription")),this.logoCss=l.trim(d.settingsGet("LoginCss")),this.emailError=r.observable(!1),this.passwordError=r.observable(!1),this.emailFocus=r.observable(!1),this.submitFocus=r.observable(!1),this.email.subscribe(function(){this.emailError(!1),this.additionalCode(""),this.additionalCode.visibility(!1)},this),this.password.subscribe(function(){this.passwordError(!1)},this),this.additionalCode.subscribe(function(){this.additionalCode.error(!1)},this),this.additionalCode.visibility.subscribe(function(){this.additionalCode.error(!1)},this),this.submitRequest=r.observable(!1),this.submitError=r.observable(""),this.allowLanguagesOnLogin=u.allowLanguagesOnLogin,this.langRequest=r.observable(!1),this.mainLanguage=u.mainLanguage,this.bSendLanguage=!1,this.mainLanguageFullName=r.computed(function(){return l.convertLangName(this.mainLanguage())},this),this.signMeType=r.observable(n.LoginSignMeType.Unused),this.signMeType.subscribe(function(e){this.signMe(n.LoginSignMeType.DefaultOn===e)},this),this.signMeVisibility=r.computed(function(){return n.LoginSignMeType.Unused!==this.signMeType()},this),this.submitCommand=l.createCommand(this,function(){if(l.triggerAutocompleteInputChange(),this.emailError(""===l.trim(this.email())),this.passwordError(""===l.trim(this.password())),this.additionalCode.visibility()&&this.additionalCode.error(""===l.trim(this.additionalCode())),this.emailError()||this.passwordError()||this.additionalCode.error())return!1;this.submitRequest(!0);var e=this.password(),t=o.bind(function(e){c.login(o.bind(function(e,t){n.StorageResultType.Success===e&&t&&"Login"===t.Action?t.Result?t.TwoFactorAuth?(this.additionalCode(""),this.additionalCode.visibility(!0),this.additionalCode.focused(!0),this.submitRequest(!1)):s(4).loginAndLogoutReload():t.ErrorCode?(this.submitRequest(!1),this.submitError(l.getNotification(t.ErrorCode)),""===this.submitError()&&this.submitError(l.getNotification(n.Notification.UnknownError))):this.submitRequest(!1):(this.submitRequest(!1),this.submitError(l.getNotification(n.Notification.UnknownError)))},this),this.email(),"",e,!!this.signMe(),this.bSendLanguage?this.mainLanguage():"",this.additionalCode.visibility()?this.additionalCode():"",this.additionalCode.visibility()?!!this.additionalCodeSignMe():!1)},this);return d.settingsGet("UseRsaEncryption")&&l.rsaEncode.supported?c.getPublicKey(o.bind(function(s,i){var o=!1;if(n.StorageResultType.Success===s&&i&&i.Result&&l.isArray(i.Result)&&i.Result[0]&&i.Result[1]&&i.Result[2]){var a=l.rsaEncode(e,i.Result[0],i.Result[1],i.Result[2]);a&&(t(a),o=!0)}o||(this.submitRequest(!1),this.submitError(l.getNotification(n.Notification.UnknownError)))},this)):t(e),!0},function(){return!this.submitRequest()}),this.facebookLoginEnabled=r.observable(!1),this.facebookCommand=l.createCommand(this,function(){return i.open(h.socialFacebook(),"Facebook","left=200,top=100,width=650,height=335,menubar=no,status=no,resizable=yes,scrollbars=yes"),!0},function(){return!this.submitRequest()&&this.facebookLoginEnabled()}),this.googleLoginEnabled=r.observable(!1),this.googleCommand=l.createCommand(this,function(){return i.open(h.socialGoogle(),"Google","left=200,top=100,width=650,height=335,menubar=no,status=no,resizable=yes,scrollbars=yes"),!0},function(){return!this.submitRequest()&&this.googleLoginEnabled()}),this.twitterLoginEnabled=r.observable(!1),this.twitterCommand=l.createCommand(this,function(){return i.open(h.socialTwitter(),"Twitter","left=200,top=100,width=650,height=335,menubar=no,status=no,resizable=yes,scrollbars=yes"),!0},function(){return!this.submitRequest()&&this.twitterLoginEnabled()}),this.socialLoginEnabled=r.computed(function(){var e=this.facebookLoginEnabled(),t=this.googleLoginEnabled(),s=this.twitterLoginEnabled();return e||t||s},this),p.constructorEnd(this)}var i=s(12),o=s(2),a=s(14),r=s(3),n=s(6),l=s(1),h=s(11),d=s(10),u=s(8),c=s(13),p=s(5),g=s(9);p.extendAsViewModel(["View:RainLoop:Login","LoginViewModel"],t),o.extend(t.prototype,g.prototype),t.prototype.onShow=function(){p.routeOff(),o.delay(o.bind(function(){""!==this.email()&&""!==this.password()?this.submitFocus(!0):this.emailFocus(!0),d.settingsGet("UserLanguage")&&a.cookie("rllang",u.language(),{expires:30})},this),100)},t.prototype.onHide=function(){this.submitFocus(!1),this.emailFocus(!1)},t.prototype.onBuild=function(){var e=this,t=d.settingsGet("JsHash"),r=function(t){t=l.pInt(t),0===t?(e.submitRequest(!0),s(4).loginAndLogoutReload()):e.submitError(l.getNotification(t))};switch(this.facebookLoginEnabled(!!d.settingsGet("AllowFacebookSocial")),this.twitterLoginEnabled(!!d.settingsGet("AllowTwitterSocial")),this.googleLoginEnabled(!!d.settingsGet("AllowGoogleSocial")),(d.settingsGet("SignMe")||"unused").toLowerCase()){case n.LoginSignMeTypeAsString.DefaultOff:this.signMeType(n.LoginSignMeType.DefaultOff);break;case n.LoginSignMeTypeAsString.DefaultOn:this.signMeType(n.LoginSignMeType.DefaultOn);break;default:case n.LoginSignMeTypeAsString.Unused:this.signMeType(n.LoginSignMeType.Unused)}this.email(u.devEmail),this.password(u.devPassword),this.googleLoginEnabled()&&(i["rl_"+t+"_google_login_service"]=r),this.facebookLoginEnabled()&&(i["rl_"+t+"_facebook_login_service"]=r),this.twitterLoginEnabled()&&(i["rl_"+t+"_twitter_login_service"]=r),o.delay(function(){u.language.subscribe(function(t){e.langRequest(!0),a.ajax({url:h.langLink(t),dataType:"script",cache:!0}).done(function(){e.bSendLanguage=!0,l.i18nReload(),a.cookie("rllang",u.language(),{expires:30})}).always(function(){e.langRequest(!1)})})},50),l.triggerAutocompleteInputChange(!0)},t.prototype.submitForm=function(){this.submitCommand()},t.prototype.selectLanguage=function(){p.showScreenPopup(s(32))},e.exports=t}()}});