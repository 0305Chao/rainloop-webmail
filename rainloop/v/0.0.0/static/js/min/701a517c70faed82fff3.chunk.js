/* RainLoop Webmail (c) RainLoop Team | Licensed under CC BY-NC-SA 3.0 */
webpackJsonp([0],Array(21).concat([function(e,t,s){!function(){"use strict";function t(){T.call(this,"Popups","PopupsCompose"),this.oEditor=null,this.aDraftInfo=null,this.sInReplyTo="",this.bFromDraft=!1,this.bSkipNext=!1,this.sReferences="",this.bCapaAdditionalIdentities=y.capa(u.Capa.AdditionalIdentities);var e=this,n=function(t){!1===e.showCcAndBcc()&&0<t.length&&e.showCcAndBcc(!0)};this.capaOpenPGP=b.capaOpenPGP,this.resizer=r.observable(!1).extend({throttle:50}),this.identitiesDropdownTrigger=r.observable(!1),this.to=r.observable(""),this.to.focusTrigger=r.observable(!1),this.cc=r.observable(""),this.bcc=r.observable(""),this.replyTo=r.observable(""),this.subject=r.observable(""),this.isHtml=r.observable(!1),this.requestReadReceipt=r.observable(!1),this.sendError=r.observable(!1),this.sendSuccessButSaveError=r.observable(!1),this.savedError=r.observable(!1),this.savedTime=r.observable(0),this.savedOrSendingText=r.observable(""),this.emptyToError=r.observable(!1),this.attachmentsInProcessError=r.observable(!1),this.showCcAndBcc=r.observable(!1),this.cc.subscribe(n,this),this.bcc.subscribe(n,this),this.draftFolder=r.observable(""),this.draftUid=r.observable(""),this.sending=r.observable(!1),this.saving=r.observable(!1),this.attachments=r.observableArray([]),this.attachmentsInProcess=this.attachments.filter(function(e){return e&&""===e.tempName()}),this.attachmentsInReady=this.attachments.filter(function(e){return e&&""!==e.tempName()}),this.attachments.subscribe(function(){this.triggerForResize()},this),this.isDraftFolderMessage=r.computed(function(){return""!==this.draftFolder()&&""!==this.draftUid()},this),this.composeUploaderButton=r.observable(null),this.composeUploaderDropPlace=r.observable(null),this.dragAndDropEnabled=r.observable(!1),this.dragAndDropOver=r.observable(!1).extend({throttle:1}),this.dragAndDropVisible=r.observable(!1).extend({throttle:1}),this.attacheMultipleAllowed=r.observable(!1),this.addAttachmentEnabled=r.observable(!1),this.composeEditorArea=r.observable(null),this.identities=b.identities,this.defaultIdentityID=b.defaultIdentityID,this.currentIdentityID=r.observable(""),this.currentIdentityString=r.observable(""),this.currentIdentityResultEmail=r.observable(""),this.identitiesOptions=r.computed(function(){var e=[{optValue:b.accountEmail(),optText:this.formattedFrom(!1)}];return o.each(b.identities(),function(t){e.push({optValue:t.id,optText:t.formattedNameForCompose()})}),e},this),r.computed(function(){var e="",t="",s=null,i=this.identities(),n=this.currentIdentityID();return this.bCapaAdditionalIdentities&&n&&n!==b.accountEmail()&&(s=o.find(i,function(e){return e&&n===e.id}),e=s?s.formattedNameForCompose():"",t=s?s.formattedNameForEmail():"",""===e&&i[0])?(this.currentIdentityID(i[0].id),""):(""===e&&(e=this.formattedFrom(!1),t=this.formattedFrom(!0)),this.currentIdentityString(e),this.currentIdentityResultEmail(t),e)},this),this.to.subscribe(function(e){this.emptyToError()&&0<e.length&&this.emptyToError(!1)},this),this.attachmentsInProcess.subscribe(function(e){this.attachmentsInProcessError()&&d.isArray(e)&&0===e.length&&this.attachmentsInProcessError(!1)},this),this.editorResizeThrottle=o.throttle(o.bind(this.editorResize,this),100),this.resizer.subscribe(function(){this.editorResizeThrottle()},this),this.canBeSendedOrSaved=r.computed(function(){return!this.sending()&&!this.saving()},this),this.deleteCommand=d.createCommand(this,function(){s(4).deleteMessagesFromFolderWithoutCheck(this.draftFolder(),[this.draftUid()]),C.hideScreenPopup(t)},function(){return this.isDraftFolderMessage()}),this.sendMessageResponse=o.bind(this.sendMessageResponse,this),this.saveMessageResponse=o.bind(this.saveMessageResponse,this),this.sendCommand=d.createCommand(this,function(){var e=d.trim(this.to()),t=b.sentFolder(),i=[];0<this.attachmentsInProcess().length?this.attachmentsInProcessError(!0):0===e.length?this.emptyToError(!0):(b.replySameFolder()&&d.isArray(this.aDraftInfo)&&3===this.aDraftInfo.length&&d.isNormal(this.aDraftInfo[2])&&0<this.aDraftInfo[2].length&&(t=this.aDraftInfo[2]),""===t?C.showScreenPopup(s(27),[u.SetSystemFoldersNotification.Sent]):(this.sendError(!1),this.sending(!0),d.isArray(this.aDraftInfo)&&3===this.aDraftInfo.length&&(i=S.getMessageFlagsFromCache(this.aDraftInfo[2],this.aDraftInfo[1]),i&&("forward"===this.aDraftInfo[0]?i[3]=!0:i[2]=!0,S.setMessageFlagsToCache(this.aDraftInfo[2],this.aDraftInfo[1],i),s(4).reloadFlagsCurrentMessageListAndMessageFromCache(),S.setFolderHash(this.aDraftInfo[2],""))),t=h.Values.UnuseOptionValue===t?"":t,S.setFolderHash(this.draftFolder(),""),S.setFolderHash(t,""),v.sendMessage(this.sendMessageResponse,this.draftFolder(),this.draftUid(),t,this.currentIdentityResultEmail(),e,this.cc(),this.bcc(),this.subject(),this.oEditor?this.oEditor.isHtml():!1,this.oEditor?this.oEditor.getData(!0):"",this.prepearAttachmentsForSendOrSave(),this.aDraftInfo,this.sInReplyTo,this.sReferences,this.requestReadReceipt())))},this.canBeSendedOrSaved),this.saveCommand=d.createCommand(this,function(){b.draftFolderNotEnabled()?C.showScreenPopup(s(27),[u.SetSystemFoldersNotification.Draft]):(this.savedError(!1),this.saving(!0),this.bSkipNext=!0,S.setFolderHash(b.draftFolder(),""),v.saveMessage(this.saveMessageResponse,this.draftFolder(),this.draftUid(),b.draftFolder(),this.currentIdentityResultEmail(),this.to(),this.cc(),this.bcc(),this.subject(),this.oEditor?this.oEditor.isHtml():!1,this.oEditor?this.oEditor.getData(!0):"",this.prepearAttachmentsForSendOrSave(),this.aDraftInfo,this.sInReplyTo,this.sReferences))},this.canBeSendedOrSaved),m.sub("interval.1m",function(){!this.modalVisibility()||b.draftFolderNotEnabled()||this.isEmptyForm(!1)||this.bSkipNext||this.saving()||this.sending()||this.savedError()||(this.bSkipNext=!1,this.saveCommand())},this),this.showCcAndBcc.subscribe(function(){this.triggerForResize()},this),this.dropboxEnabled=r.observable(!!y.settingsGet("DropboxApiKey")),this.dropboxCommand=d.createCommand(this,function(){return i.Dropbox&&i.Dropbox.choose({success:function(t){t&&t[0]&&t[0].link&&e.addDropboxAttachment(t[0])},linkType:"direct",multiselect:!1}),!0},function(){return this.dropboxEnabled()}),this.driveEnabled=r.observable(p.bXMLHttpRequestSupported&&!!y.settingsGet("GoogleClientID")&&!!y.settingsGet("GoogleApiKey")),this.driveVisible=r.observable(!1),this.driveCommand=d.createCommand(this,function(){return this.driveOpenPopup(),!0},function(){return this.driveEnabled()}),this.driveCallback=o.bind(this.driveCallback,this),this.bDisabeCloseOnEsc=!0,this.sDefaultKeyScope=u.KeyState.Compose,this.tryToClosePopup=o.debounce(o.bind(this.tryToClosePopup,this),200),this.emailsSource=o.bind(this.emailsSource,this),C.constructorEnd(this)}var i=s(12),o=s(2),n=s(14),r=s(3),a=s(25),c=s(33),l=s(47),u=s(6),h=s(17),d=s(1),p=s(7),m=s(22),f=s(11),g=s(28),y=s(10),b=s(8),S=s(20),v=s(13),w=s(53),C=s(5),T=s(9);C.extendAsViewModel(["View:Popup:Compose","PopupsComposeViewModel"],t),o.extend(t.prototype,T.prototype),t.prototype.emailsSource=function(e,t){s(4).getAutocomplete(e.term,function(e){t(o.map(e,function(e){return e.toLine(!1)}))})},t.prototype.openOpenPgpPopup=function(){if(this.capaOpenPGP()&&this.oEditor&&!this.oEditor.isHtml()){var e=this;C.showScreenPopup(s(104),[function(t){e.editor(function(e){e.setPlain(t)})},this.oEditor.getData(),this.currentIdentityResultEmail(),this.to(),this.cc(),this.bcc()])}},t.prototype.reloadDraftFolder=function(){var e=b.draftFolder();""!==e&&(S.setFolderHash(e,""),b.currentFolderFullNameRaw()===e?s(4).reloadMessageList(!0):s(4).folderInformation(e))},t.prototype.findIdentityIdByMessage=function(e,t){var s={},i="",n=function(e){return e&&e.email&&s[e.email]?(i=s[e.email],!0):!1};if(this.bCapaAdditionalIdentities&&o.each(this.identities(),function(e){s[e.email()]=e.id}),s[b.accountEmail()]=b.accountEmail(),t)switch(e){case u.ComposeType.Empty:break;case u.ComposeType.Reply:case u.ComposeType.ReplyAll:case u.ComposeType.Forward:case u.ComposeType.ForwardAsAttachment:o.find(o.union(t.to,t.cc,t.bcc,t.deliveredTo),n);break;case u.ComposeType.Draft:o.find(o.union(t.from,t.replyTo),n)}return""===i&&(i=this.defaultIdentityID()),""===i&&(i=b.accountEmail()),i},t.prototype.selectIdentity=function(e){e&&this.currentIdentityID(e.optValue)},t.prototype.formattedFrom=function(e){var t=b.displayName(),s=b.accountEmail();return""===t?s:(d.isUnd(e)?1:!e)?t+" ("+s+")":'"'+d.quoteName(t)+'" <'+s+">"},t.prototype.sendMessageResponse=function(e,t){var s=!1,o="";this.sending(!1),u.StorageResultType.Success===e&&t&&t.Result&&(s=!0,this.modalVisibility()&&d.delegateRun(this,"closeCommand")),this.modalVisibility()&&!s&&(t&&u.Notification.CantSaveMessage===t.ErrorCode?(this.sendSuccessButSaveError(!0),i.alert(d.trim(d.i18n("COMPOSE/SAVED_ERROR_ON_SEND")))):(o=d.getNotification(t&&t.ErrorCode?t.ErrorCode:u.Notification.CantSendMessage,t&&t.ErrorMessage?t.ErrorMessage:""),this.sendError(!0),i.alert(o||d.getNotification(u.Notification.CantSendMessage)))),this.reloadDraftFolder()},t.prototype.saveMessageResponse=function(e,t){var s=!1,o=null;this.saving(!1),u.StorageResultType.Success===e&&t&&t.Result&&t.Result.NewFolder&&t.Result.NewUid&&(this.bFromDraft&&(o=b.message(),o&&this.draftFolder()===o.folderFullNameRaw&&this.draftUid()===o.uid&&b.message(null)),this.draftFolder(t.Result.NewFolder),this.draftUid(t.Result.NewUid),this.modalVisibility()&&(this.savedTime(i.Math.round((new i.Date).getTime()/1e3)),this.savedOrSendingText(0<this.savedTime()?d.i18n("COMPOSE/SAVED_TIME",{TIME:a.unix(this.savedTime()-1).format("LT")}):""),s=!0,this.bFromDraft&&S.setFolderHash(this.draftFolder(),""))),this.modalVisibility()||s||(this.savedError(!0),this.savedOrSendingText(d.getNotification(u.Notification.CantSaveMessage))),this.reloadDraftFolder()},t.prototype.onHide=function(){this.reset(),C.routeOn()},t.prototype.convertSignature=function(e,t,s,i){var o=!1,n=!1;if(""!==e&&(":HTML:"===e.substr(0,6)&&(o=!0,e=e.substr(6)),e=e.replace(/[\r]/g,""),t=d.pString(t),""!==t&&(e=e.replace(/{{FROM}}/g,t)),e=e.replace(/[\s]{1,2}{{FROM}}/g,"{{FROM}}"),e=e.replace(/{{FROM}}/g,""),e=e.replace(/{{DATE}}/g,a().format("llll")),s&&u.ComposeType.Empty===i&&-1<e.indexOf("{{DATA}}")&&(n=!0,e=e.replace("{{DATA}}",s)),e=e.replace(/{{DATA}}/g,""),o||(e=d.convertPlainTextToHtml(e))),s&&!n)switch(i){case u.ComposeType.Empty:e=s+"<br />"+e;break;default:e=e+"<br />"+s}return e},t.prototype.editor=function(e){if(e){var t=this;!this.oEditor&&this.composeEditorArea()?o.delay(function(){t.oEditor=new g(t.composeEditorArea(),null,function(){e(t.oEditor)},function(e){t.isHtml(!!e)})},300):this.oEditor&&e(this.oEditor)}},t.prototype.onShow=function(e,t,s,i,r){C.routeOff();var a=this,c="",l="",h="",p="",m="",f=null,g="",y="",S=[],w={},T=b.accountEmail(),E=b.signature(),F=b.signatureToAll(),P=[],A=null,L=null,R=e||u.ComposeType.Empty,M=function(e,t){for(var s=0,i=e.length,o=[];i>s;s++)o.push(e[s].toLine(!!t));return o.join(", ")};if(t=t||null,t&&d.isNormal(t)&&(L=d.isArray(t)&&1===t.length?t[0]:d.isArray(t)?null:t),null!==T&&(w[T]=!0),this.currentIdentityID(this.findIdentityIdByMessage(R,L)),this.reset(),d.isNonEmptyArray(s)&&this.to(M(s)),""!==R&&L){switch(p=L.fullFormatDateValue(),m=L.subject(),A=L.aDraftInfo,f=n(L.body).clone(),f&&(f.find("blockquote.rl-bq-switcher").each(function(){n(this).removeClass("rl-bq-switcher hidden-bq")}),f.find(".rlBlockquoteSwitcher").each(function(){n(this).remove()})),f.find("[data-html-editor-font-wrapper]").removeAttr("data-html-editor-font-wrapper"),g=f.html(),R){case u.ComposeType.Empty:break;case u.ComposeType.Reply:this.to(M(L.replyEmails(w))),this.subject(d.replySubjectAdd("Re",m)),this.prepearMessageAttachments(L,R),this.aDraftInfo=["reply",L.uid,L.folderFullNameRaw],this.sInReplyTo=L.sMessageId,this.sReferences=d.trim(this.sInReplyTo+" "+L.sReferences);break;case u.ComposeType.ReplyAll:S=L.replyAllEmails(w),this.to(M(S[0])),this.cc(M(S[1])),this.subject(d.replySubjectAdd("Re",m)),this.prepearMessageAttachments(L,R),this.aDraftInfo=["reply",L.uid,L.folderFullNameRaw],this.sInReplyTo=L.sMessageId,this.sReferences=d.trim(this.sInReplyTo+" "+L.references());break;case u.ComposeType.Forward:this.subject(d.replySubjectAdd("Fwd",m)),this.prepearMessageAttachments(L,R),this.aDraftInfo=["forward",L.uid,L.folderFullNameRaw],this.sInReplyTo=L.sMessageId,this.sReferences=d.trim(this.sInReplyTo+" "+L.sReferences);break;case u.ComposeType.ForwardAsAttachment:this.subject(d.replySubjectAdd("Fwd",m)),this.prepearMessageAttachments(L,R),this.aDraftInfo=["forward",L.uid,L.folderFullNameRaw],this.sInReplyTo=L.sMessageId,this.sReferences=d.trim(this.sInReplyTo+" "+L.sReferences);break;case u.ComposeType.Draft:this.to(M(L.to)),this.cc(M(L.cc)),this.bcc(M(L.bcc)),this.bFromDraft=!0,this.draftFolder(L.folderFullNameRaw),this.draftUid(L.uid),this.subject(m),this.prepearMessageAttachments(L,R),this.aDraftInfo=d.isNonEmptyArray(A)&&3===A.length?A:null,this.sInReplyTo=L.sInReplyTo,this.sReferences=L.sReferences;break;case u.ComposeType.EditAsNew:this.to(M(L.to)),this.cc(M(L.cc)),this.bcc(M(L.bcc)),this.subject(m),this.prepearMessageAttachments(L,R),this.aDraftInfo=d.isNonEmptyArray(A)&&3===A.length?A:null,this.sInReplyTo=L.sInReplyTo,this.sReferences=L.sReferences}switch(R){case u.ComposeType.Reply:case u.ComposeType.ReplyAll:c=L.fromToLine(!1,!0),y=d.i18n("COMPOSE/REPLY_MESSAGE_TITLE",{DATETIME:p,EMAIL:c}),g="<br /><br />"+y+":<blockquote><p>"+g+"</p></blockquote>";break;case u.ComposeType.Forward:c=L.fromToLine(!1,!0),l=L.toToLine(!1,!0),h=L.ccToLine(!1,!0),g="<br /><br /><br />"+d.i18n("COMPOSE/FORWARD_MESSAGE_TOP_TITLE")+"<br />"+d.i18n("COMPOSE/FORWARD_MESSAGE_TOP_FROM")+": "+c+"<br />"+d.i18n("COMPOSE/FORWARD_MESSAGE_TOP_TO")+": "+l+(0<h.length?"<br />"+d.i18n("COMPOSE/FORWARD_MESSAGE_TOP_CC")+": "+h:"")+"<br />"+d.i18n("COMPOSE/FORWARD_MESSAGE_TOP_SENT")+": "+d.encodeHtml(p)+"<br />"+d.i18n("COMPOSE/FORWARD_MESSAGE_TOP_SUBJECT")+": "+d.encodeHtml(m)+"<br /><br />"+g;break;case u.ComposeType.ForwardAsAttachment:g=""}F&&""!==E&&u.ComposeType.EditAsNew!==R&&u.ComposeType.Draft!==R&&(g=this.convertSignature(E,M(L.from,!0),g,R)),this.editor(function(e){e.setHtml(g,!1),L.isHtml()||e.modeToggle(!1)})}else u.ComposeType.Empty===R?(this.subject(d.isNormal(i)?""+i:""),g=d.isNormal(r)?""+r:"",F&&""!==E&&(g=this.convertSignature(E,"",d.convertPlainTextToHtml(g),R)),this.editor(function(e){e.setHtml(g,!1),u.EditorDefaultType.Html!==b.editorDefaultType()&&e.modeToggle(!1)})):d.isNonEmptyArray(t)&&o.each(t,function(e){a.addMessageAsAttachment(e)});P=this.getAttachmentsDownloadsForUpload(),d.isNonEmptyArray(P)&&v.messageUploadAttachments(function(e,t){if(u.StorageResultType.Success===e&&t&&t.Result){var s=null,i="";if(!a.viewModelVisibility())for(i in t.Result)t.Result.hasOwnProperty(i)&&(s=a.getAttachmentById(t.Result[i]),s&&s.tempName(i))}else a.setMessageAttachmentFailedDowbloadText()},P),this.triggerForResize()},t.prototype.onFocus=function(){""===this.to()?this.to.focusTrigger(!this.to.focusTrigger()):this.oEditor&&this.oEditor.focus(),this.triggerForResize()},t.prototype.editorResize=function(){this.oEditor&&this.oEditor.resize()},t.prototype.tryToClosePopup=function(){var e=this,t=s(31);C.isPopupVisible(t)||C.showScreenPopup(t,[d.i18n("POPUPS_ASK/DESC_WANT_CLOSE_THIS_WINDOW"),function(){e.modalVisibility()&&d.delegateRun(e,"closeCommand")}])},t.prototype.onBuild=function(){this.initUploader();var e=this,t=null;key("ctrl+q, command+q",u.KeyState.Compose,function(){return e.identitiesDropdownTrigger(!0),!1}),key("ctrl+s, command+s",u.KeyState.Compose,function(){return e.saveCommand(),!1}),key("ctrl+enter, command+enter",u.KeyState.Compose,function(){return e.sendCommand(),!1}),key("esc",u.KeyState.Compose,function(){return e.modalVisibility()&&e.tryToClosePopup(),!1}),p.$win.on("resize",function(){e.triggerForResize()}),this.dropboxEnabled()&&(t=i.document.createElement("script"),t.type="text/javascript",t.src="https://www.dropbox.com/static/api/1/dropins.js",n(t).attr("id","dropboxjs").attr("data-app-key",y.settingsGet("DropboxApiKey")),i.document.body.appendChild(t)),this.driveEnabled()&&n.getScript("https://apis.google.com/js/api.js",function(){i.gapi&&e.driveVisible(!0)})},t.prototype.driveCallback=function(e,t){if(t&&i.XMLHttpRequest&&i.google&&t[i.google.picker.Response.ACTION]===i.google.picker.Action.PICKED&&t[i.google.picker.Response.DOCUMENTS]&&t[i.google.picker.Response.DOCUMENTS][0]&&t[i.google.picker.Response.DOCUMENTS][0].id){var s=this,o=new i.XMLHttpRequest;o.open("GET","https://www.googleapis.com/drive/v2/files/"+t[i.google.picker.Response.DOCUMENTS][0].id),o.setRequestHeader("Authorization","Bearer "+e),o.addEventListener("load",function(){if(o&&o.responseText){var t=c.parse(o.responseText),i=function(e,t,s){e&&e.exportLinks&&(e.exportLinks[t]?(e.downloadUrl=e.exportLinks[t],e.title=e.title+"."+s,e.mimeType=t):e.exportLinks["application/pdf"]&&(e.downloadUrl=e.exportLinks["application/pdf"],e.title=e.title+".pdf",e.mimeType="application/pdf"))};if(t&&!t.downloadUrl&&t.mimeType&&t.exportLinks)switch(t.mimeType.toString().toLowerCase()){case"application/vnd.google-apps.document":i(t,"application/vnd.openxmlformats-officedocument.wordprocessingml.document","docx");break;case"application/vnd.google-apps.spreadsheet":i(t,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","xlsx");break;case"application/vnd.google-apps.drawing":i(t,"image/png","png");break;case"application/vnd.google-apps.presentation":i(t,"application/vnd.openxmlformats-officedocument.presentationml.presentation","pptx");break;default:i(t,"application/pdf","pdf")}t&&t.downloadUrl&&s.addDriveAttachment(t,e)}}),o.send()}},t.prototype.driveCreatePiker=function(e){if(i.gapi&&e&&e.access_token){var t=this;i.gapi.load("picker",{callback:function(){if(i.google&&i.google.picker){var s=(new i.google.picker.PickerBuilder).addView((new i.google.picker.DocsView).setIncludeFolders(!0)).setAppId(y.settingsGet("GoogleClientID")).setOAuthToken(e.access_token).setCallback(o.bind(t.driveCallback,t,e.access_token)).enableFeature(i.google.picker.Feature.NAV_HIDDEN).build();s.setVisible(!0)}}})}},t.prototype.driveOpenPopup=function(){if(i.gapi){var e=this;i.gapi.load("auth",{callback:function(){var t=i.gapi.auth.getToken();t?e.driveCreatePiker(t):i.gapi.auth.authorize({client_id:y.settingsGet("GoogleClientID"),scope:"https://www.googleapis.com/auth/drive.readonly",immediate:!0},function(t){if(t&&!t.error){var s=i.gapi.auth.getToken();s&&e.driveCreatePiker(s)}else i.gapi.auth.authorize({client_id:y.settingsGet("GoogleClientID"),scope:"https://www.googleapis.com/auth/drive.readonly",immediate:!1},function(t){if(t&&!t.error){var s=i.gapi.auth.getToken();s&&e.driveCreatePiker(s)}})})}})}},t.prototype.getAttachmentById=function(e){for(var t=this.attachments(),s=0,i=t.length;i>s;s++)if(t[s]&&e===t[s].id)return t[s];return null},t.prototype.initUploader=function(){if(this.composeUploaderButton()){var e={},t=d.pInt(y.settingsGet("AttachmentLimit")),s=new l({action:f.upload(),name:"uploader",queueSize:2,multipleSizeLimit:50,disableFolderDragAndDrop:!1,clickElement:this.composeUploaderButton(),dragAndDropElement:this.composeUploaderDropPlace()});s?(s.on("onDragEnter",o.bind(function(){this.dragAndDropOver(!0)},this)).on("onDragLeave",o.bind(function(){this.dragAndDropOver(!1)},this)).on("onBodyDragEnter",o.bind(function(){this.dragAndDropVisible(!0)},this)).on("onBodyDragLeave",o.bind(function(){this.dragAndDropVisible(!1)},this)).on("onProgress",o.bind(function(t,s,o){var n=null;d.isUnd(e[t])?(n=this.getAttachmentById(t),n&&(e[t]=n)):n=e[t],n&&n.progress(" - "+i.Math.floor(s/o*100)+"%")},this)).on("onSelect",o.bind(function(e,i){this.dragAndDropOver(!1);var o=this,n=d.isUnd(i.FileName)?"":i.FileName.toString(),r=d.isNormal(i.Size)?d.pInt(i.Size):null,a=new w(e,n,r);return a.cancel=function(e){return function(){o.attachments.remove(function(t){return t&&t.id===e}),s&&s.cancel(e)}}(e),this.attachments.push(a),r>0&&t>0&&r>t?(a.error(d.i18n("UPLOAD/ERROR_FILE_IS_TOO_BIG")),!1):!0},this)).on("onStart",o.bind(function(t){var s=null;d.isUnd(e[t])?(s=this.getAttachmentById(t),s&&(e[t]=s)):s=e[t],s&&(s.waiting(!1),s.uploading(!0))},this)).on("onComplete",o.bind(function(t,s,i){var o="",n=null,r=null,a=this.getAttachmentById(t);r=s&&i&&i.Result&&i.Result.Attachment?i.Result.Attachment:null,n=i&&i.Result&&i.Result.ErrorCode?i.Result.ErrorCode:null,null!==n?o=d.getUploadErrorDescByCode(n):r||(o=d.i18n("UPLOAD/ERROR_UNKNOWN")),a&&(""!==o&&0<o.length?a.waiting(!1).uploading(!1).error(o):r&&(a.waiting(!1).uploading(!1),a.initByUploadJson(r)),d.isUnd(e[t])&&delete e[t])},this)),this.addAttachmentEnabled(!0).dragAndDropEnabled(s.isDragAndDropSupported())):this.addAttachmentEnabled(!1).dragAndDropEnabled(!1)}},t.prototype.prepearAttachmentsForSendOrSave=function(){var e={};return o.each(this.attachmentsInReady(),function(t){t&&""!==t.tempName()&&t.enabled()&&(e[t.tempName()]=[t.fileName(),t.isInline?"1":"0",t.CID,t.contentLocation])}),e},t.prototype.addMessageAsAttachment=function(e){if(e){var t=this,s=null,i=e.subject(),o=function(e){return function(){t.attachments.remove(function(t){return t&&t.id===e})}};i=".eml"===i.substr(-4).toLowerCase()?i:i+".eml",s=new w(e.requestHash,i,e.size()),s.fromMessage=!0,s.cancel=o(e.requestHash),s.waiting(!1).uploading(!0),this.attachments.push(s)}},t.prototype.addDropboxAttachment=function(e){var t=this,s=null,i=function(e){return function(){t.attachments.remove(function(t){return t&&t.id===e})}},o=d.pInt(y.settingsGet("AttachmentLimit")),n=e.bytes;return s=new w(e.link,e.name,n),s.fromMessage=!1,s.cancel=i(e.link),s.waiting(!1).uploading(!0),this.attachments.push(s),n>0&&o>0&&n>o?(s.uploading(!1),s.error(d.i18n("UPLOAD/ERROR_FILE_IS_TOO_BIG")),!1):(v.composeUploadExternals(function(e,t){var i=!1;s.uploading(!1),u.StorageResultType.Success===e&&t&&t.Result&&t.Result[s.id]&&(i=!0,s.tempName(t.Result[s.id])),i||s.error(d.getUploadErrorDescByCode(u.UploadErrorCode.FileNoUploaded))},[e.link]),!0)},t.prototype.addDriveAttachment=function(e,t){var s=this,i=function(e){return function(){s.attachments.remove(function(t){return t&&t.id===e})}},o=d.pInt(y.settingsGet("AttachmentLimit")),n=null,r=e.fileSize?d.pInt(e.fileSize):0;return n=new w(e.downloadUrl,e.title,r),n.fromMessage=!1,n.cancel=i(e.downloadUrl),n.waiting(!1).uploading(!0),this.attachments.push(n),r>0&&o>0&&r>o?(n.uploading(!1),n.error(d.i18n("UPLOAD/ERROR_FILE_IS_TOO_BIG")),!1):(v.composeUploadDrive(function(e,t){var s=!1;n.uploading(!1),u.StorageResultType.Success===e&&t&&t.Result&&t.Result[n.id]&&(s=!0,n.tempName(t.Result[n.id][0]),n.size(d.pInt(t.Result[n.id][1]))),s||n.error(d.getUploadErrorDescByCode(u.UploadErrorCode.FileNoUploaded))},e.downloadUrl,t),!0)},t.prototype.prepearMessageAttachments=function(e,t){if(e){var s=this,i=d.isNonEmptyArray(e.attachments())?e.attachments():[],o=0,n=i.length,r=null,a=null,c=!1,l=function(e){return function(){s.attachments.remove(function(t){return t&&t.id===e})}};if(u.ComposeType.ForwardAsAttachment===t)this.addMessageAsAttachment(e);else for(;n>o;o++){switch(a=i[o],c=!1,t){case u.ComposeType.Reply:case u.ComposeType.ReplyAll:c=a.isLinked;break;case u.ComposeType.Forward:case u.ComposeType.Draft:case u.ComposeType.EditAsNew:c=!0}c&&(r=new w(a.download,a.fileName,a.estimatedSize,a.isInline,a.isLinked,a.cid,a.contentLocation),r.fromMessage=!0,r.cancel=l(a.download),r.waiting(!1).uploading(!0),this.attachments.push(r))}}},t.prototype.removeLinkedAttachments=function(){this.attachments.remove(function(e){return e&&e.isLinked})},t.prototype.setMessageAttachmentFailedDowbloadText=function(){o.each(this.attachments(),function(e){e&&e.fromMessage&&e.waiting(!1).uploading(!1).error(d.getUploadErrorDescByCode(u.UploadErrorCode.FileNoUploaded))},this)},t.prototype.isEmptyForm=function(e){e=d.isUnd(e)?!0:!!e;var t=e?0===this.attachments().length:0===this.attachmentsInReady().length;return 0===this.to().length&&0===this.cc().length&&0===this.bcc().length&&0===this.subject().length&&t&&(!this.oEditor||""===this.oEditor.getData())},t.prototype.reset=function(){this.to(""),this.cc(""),this.bcc(""),this.replyTo(""),this.subject(""),this.requestReadReceipt(!1),this.aDraftInfo=null,this.sInReplyTo="",this.bFromDraft=!1,this.sReferences="",this.sendError(!1),this.sendSuccessButSaveError(!1),this.savedError(!1),this.savedTime(0),this.savedOrSendingText(""),this.emptyToError(!1),this.attachmentsInProcessError(!1),this.showCcAndBcc(!1),this.attachments([]),this.dragAndDropOver(!1),this.dragAndDropVisible(!1),this.draftFolder(""),this.draftUid(""),this.sending(!1),this.saving(!1),this.oEditor&&this.oEditor.clear(!1)},t.prototype.getAttachmentsDownloadsForUpload=function(){return o.map(o.filter(this.attachments(),function(e){return e&&""===e.tempName()}),function(e){return e.id})},t.prototype.triggerForResize=function(){this.resizer(!this.resizer()),this.editorResizeThrottle()},e.exports=t}()},,,,,,,function(e,t,s){!function(){"use strict";function t(e,t,s,i){this.editor=null,this.iBlurTimer=0,this.fOnBlur=t||null,this.fOnReady=s||null,this.fOnModeChange=i||null,this.$element=$(e),this.resize=o.throttle(o.bind(this.resize,this),100),this.init()}var i=s(12),o=s(2),n=s(7),r=s(10);t.prototype.blurTrigger=function(){if(this.fOnBlur){var e=this;i.clearTimeout(this.iBlurTimer),this.iBlurTimer=i.setTimeout(function(){e.fOnBlur()},200)}},t.prototype.focusTrigger=function(){this.fOnBlur&&i.clearTimeout(this.iBlurTimer)},t.prototype.isHtml=function(){return this.editor?"wysiwyg"===this.editor.mode:!1},t.prototype.checkDirty=function(){return this.editor?this.editor.checkDirty():!1},t.prototype.resetDirty=function(){this.editor&&this.editor.resetDirty()},t.prototype.getData=function(e){return this.editor?"plain"===this.editor.mode&&this.editor.plugins.plain&&this.editor.__plain?this.editor.__plain.getRawData():e?'<div data-html-editor-font-wrapper="true" style="font-family: arial, sans-serif; font-size: 13px;">'+this.editor.getData()+"</div>":this.editor.getData():""},t.prototype.modeToggle=function(e){this.editor&&(e?"plain"===this.editor.mode&&this.editor.setMode("wysiwyg"):"wysiwyg"===this.editor.mode&&this.editor.setMode("plain"),this.resize())},t.prototype.setHtml=function(e,t){this.editor&&(this.modeToggle(!0),this.editor.setData(e),t&&this.focus())},t.prototype.setPlain=function(e,t){if(this.editor){if(this.modeToggle(!1),"plain"===this.editor.mode&&this.editor.plugins.plain&&this.editor.__plain)return this.editor.__plain.setRawData(e);this.editor.setData(e),t&&this.focus()}},t.prototype.init=function(){if(this.$element&&this.$element[0]){var e=this,t=function(){var t=n.oHtmlEditorDefaultConfig,s=r.settingsGet("Language"),o=!!r.settingsGet("AllowHtmlEditorSourceButton");o&&t.toolbarGroups&&!t.toolbarGroups.__SourceInited&&(t.toolbarGroups.__SourceInited=!0,t.toolbarGroups.push({name:"document",groups:["mode","document","doctools"]})),t.enterMode=i.CKEDITOR.ENTER_BR,t.shiftEnterMode=i.CKEDITOR.ENTER_BR,t.language=n.oHtmlEditorLangsMap[s]||"en",i.CKEDITOR.env&&(i.CKEDITOR.env.isCompatible=!0),e.editor=i.CKEDITOR.appendTo(e.$element[0],t),e.editor.on("key",function(e){return e&&e.data&&9===e.data.keyCode?!1:void 0}),e.editor.on("blur",function(){e.blurTrigger()}),e.editor.on("mode",function(){e.blurTrigger(),e.fOnModeChange&&e.fOnModeChange("plain"!==e.editor.mode)}),e.editor.on("focus",function(){e.focusTrigger()}),e.fOnReady&&e.editor.on("instanceReady",function(){e.editor.setKeystroke(i.CKEDITOR.CTRL+65,"selectAll"),e.fOnReady(),e.__resizable=!0,e.resize()})};i.CKEDITOR?t():i.__initEditor=t}},t.prototype.focus=function(){this.editor&&this.editor.focus()},t.prototype.blur=function(){this.editor&&this.editor.focusManager.blur(!0)},t.prototype.resize=function(){if(this.editor&&this.__resizable)try{this.editor.resize(this.$element.width(),this.$element.innerHeight())}catch(e){}},t.prototype.clear=function(e){this.setHtml("",e)},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(e){u.call(this,"settings",e),this.menu=n.observableArray([]),this.oCurrentSubScreen=null,this.oViewModelPlace=null,this.setupSettings()}var i=s(2),o=s(14),n=s(3),r=s(7),a=s(1),c=s(11),l=s(5),u=s(24);i.extend(t.prototype,u.prototype),t.prototype.setupSettings=function(e){e&&e()},t.prototype.onRoute=function(e){var t=this,s=null,u=null,h=null,d=null;u=i.find(r.aViewModels.settings,function(t){return t&&t.__rlSettingsData&&e===t.__rlSettingsData.Route}),u&&(i.find(r.aViewModels["settings-removed"],function(e){return e&&e===u})&&(u=null),u&&i.find(r.aViewModels["settings-disabled"],function(e){return e&&e===u})&&(u=null)),u?(u.__builded&&u.__vm?s=u.__vm:(h=this.oViewModelPlace,h&&1===h.length?(s=new u,d=o("<div></div>").addClass("rl-settings-view-model").hide(),d.appendTo(h),s.viewModelDom=d,s.__rlSettingsData=u.__rlSettingsData,u.__dom=d,u.__builded=!0,u.__vm=s,n.applyBindingAccessorsToNode(d[0],{i18nInit:!0,template:function(){return{name:u.__rlSettingsData.Template}}},s),a.delegateRun(s,"onBuild",[d])):a.log("Cannot find sub settings view model position: SettingsSubScreen")),s&&i.defer(function(){t.oCurrentSubScreen&&(a.delegateRun(t.oCurrentSubScreen,"onHide"),t.oCurrentSubScreen.viewModelDom.hide()),t.oCurrentSubScreen=s,t.oCurrentSubScreen&&(t.oCurrentSubScreen.viewModelDom.show(),a.delegateRun(t.oCurrentSubScreen,"onShow"),a.delegateRun(t.oCurrentSubScreen,"onFocus",[],200),i.each(t.menu(),function(e){e.selected(s&&s.__rlSettingsData&&e.route===s.__rlSettingsData.Route)}),o("#rl-content .b-settings .b-content .content").scrollTop(0)),a.windowResize()})):l.setHash(c.settings(),!1,!0)},t.prototype.onHide=function(){this.oCurrentSubScreen&&this.oCurrentSubScreen.viewModelDom&&(a.delegateRun(this.oCurrentSubScreen,"onHide"),this.oCurrentSubScreen.viewModelDom.hide())},t.prototype.onBuild=function(){i.each(r.aViewModels.settings,function(e){e&&e.__rlSettingsData&&!i.find(r.aViewModels["settings-removed"],function(t){return t&&t===e})&&this.menu.push({route:e.__rlSettingsData.Route,label:e.__rlSettingsData.Label,selected:n.observable(!1),disabled:!!i.find(r.aViewModels["settings-disabled"],function(t){return t&&t===e})})},this),this.oViewModelPlace=o("#rl-content #rl-settings-subscreen")},t.prototype.routes=function(){var e=i.find(r.aViewModels.settings,function(e){return e&&e.__rlSettingsData&&e.__rlSettingsData.IsDefault}),t=e?e.__rlSettingsData.Route:"general",s={subname:/^(.*)$/,normalize_:function(e,s){return s.subname=a.isUnd(s.subname)?t:a.pString(s.subname),[s.subname]}};return[["{subname}/",s],["{subname}",s],["",s]]},e.exports=t}()},,,,,,,function(e,t,s){!function(){"use strict";function t(e,t,s,o,r,a){this.list=e,this.listChecked=n.computed(function(){return i.filter(this.list(),function(e){return e.checked()})},this).extend({rateLimit:0}),this.isListChecked=n.computed(function(){return 0<this.listChecked().length},this),this.focusedItem=n.observable(null),this.selectedItem=t,this.selectedItemUseCallback=!0,this.itemSelectedThrottle=i.debounce(i.bind(this.itemSelected,this),300),this.listChecked.subscribe(function(e){0<e.length?null===this.selectedItem()?this.selectedItem.valueHasMutated():this.selectedItem(null):this.bAutoSelect&&this.focusedItem()&&this.selectedItem(this.focusedItem())},this),this.selectedItem.subscribe(function(e){e?(this.isListChecked()&&i.each(this.listChecked(),function(e){e.checked(!1)}),this.selectedItemUseCallback&&this.itemSelectedThrottle(e)):this.selectedItemUseCallback&&this.itemSelected(null)},this),this.selectedItem.extend({toggleSubscribe:[null,function(e){e&&e.selected(!1)},function(e){e&&e.selected(!0)}]}),this.focusedItem.extend({toggleSubscribe:[null,function(e){e&&e.focused(!1)},function(e){e&&e.focused(!0)}]}),this.oContentVisible=null,this.oContentScrollable=null,this.sItemSelector=s,this.sItemSelectedSelector=o,this.sItemCheckedSelector=r,this.sItemFocusedSelector=a,this.sLastUid="",this.bAutoSelect=!0,this.oCallbacks={},this.emptyFunction=function(){},this.focusedItem.subscribe(function(e){e&&(this.sLastUid=this.getItemUid(e))
},this);var l=[],u=[],h=null,d=null;this.list.subscribe(function(e){var t=this;c.isArray(e)&&i.each(e,function(e){if(e){var s=t.getItemUid(e);l.push(s),e.checked()&&u.push(s),null===h&&e.focused()&&(h=s),null===d&&e.selected()&&(d=s)}})},this,"beforeChange"),this.list.subscribe(function(e){var t=this,s=null,o=!1,n=[],r=h,a=!1,p=!1,m=0;this.selectedItemUseCallback=!1,this.focusedItem(null),this.selectedItem(null),c.isArray(e)&&(m=u.length,i.each(e,function(e){var s=t.getItemUid(e);n.push(s),null!==h&&h===s&&(t.focusedItem(e),h=null),m>0&&-1<c.inArray(s,u)&&(a=!0,e.checked(!0),m--),a||null===d||d!==s||(p=!0,t.selectedItem(e),d=null)}),this.selectedItemUseCallback=!0,a||p||!this.bAutoSelect||(t.focusedItem()?t.selectedItem(t.focusedItem()):0<e.length&&(null!==r&&(o=!1,r=i.find(l,function(e){return o&&-1<c.inArray(e,n)?e:(r===e&&(o=!0),!1)}),r&&(s=i.find(e,function(e){return r===t.getItemUid(e)}))),t.selectedItem(s||null),t.focusedItem(t.selectedItem())))),l=[],u=[],h=null,d=null},this)}var i=s(2),o=s(14),n=s(3),r=s(19),a=s(6),c=s(1);t.prototype.itemSelected=function(e){this.isListChecked()?e||(this.oCallbacks.onItemSelect||this.emptyFunction)(e||null):e&&(this.oCallbacks.onItemSelect||this.emptyFunction)(e)},t.prototype.goDown=function(e){this.newSelectPosition(a.EventKeyCode.Down,!1,e)},t.prototype.goUp=function(e){this.newSelectPosition(a.EventKeyCode.Up,!1,e)},t.prototype.init=function(e,t,s){if(this.oContentVisible=e,this.oContentScrollable=t,s=s||"all",this.oContentVisible&&this.oContentScrollable){var i=this;o(this.oContentVisible).on("selectstart",function(e){e&&e.preventDefault&&e.preventDefault()}).on("click",this.sItemSelector,function(e){i.actionClick(n.dataFor(this),e)}).on("click",this.sItemCheckedSelector,function(e){var t=n.dataFor(this);t&&(e&&e.shiftKey?i.actionClick(t,e):(i.focusedItem(t),t.checked(!t.checked())))}),r("enter",s,function(){return i.focusedItem()&&!i.focusedItem().selected()?(i.actionClick(i.focusedItem()),!1):!0}),r("ctrl+up, command+up, ctrl+down, command+down",s,function(){return!1}),r("up, shift+up, down, shift+down, home, end, pageup, pagedown, insert, space",s,function(e,t){if(e&&t&&t.shortcut){var s=0;switch(t.shortcut){case"up":case"shift+up":s=a.EventKeyCode.Up;break;case"down":case"shift+down":s=a.EventKeyCode.Down;break;case"insert":s=a.EventKeyCode.Insert;break;case"space":s=a.EventKeyCode.Space;break;case"home":s=a.EventKeyCode.Home;break;case"end":s=a.EventKeyCode.End;break;case"pageup":s=a.EventKeyCode.PageUp;break;case"pagedown":s=a.EventKeyCode.PageDown}if(s>0)return i.newSelectPosition(s,r.shift),!1}})}},t.prototype.autoSelect=function(e){this.bAutoSelect=!!e},t.prototype.getItemUid=function(e){var t="",s=this.oCallbacks.onItemGetUid||null;return s&&e&&(t=s(e)),t.toString()},t.prototype.newSelectPosition=function(e,t,s){var o=0,n=10,r=!1,c=!1,l=null,u=this.list(),h=u?u.length:0,d=this.focusedItem();if(h>0)if(d){if(d)if(a.EventKeyCode.Down===e||a.EventKeyCode.Up===e||a.EventKeyCode.Insert===e||a.EventKeyCode.Space===e)i.each(u,function(t){if(!c)switch(e){case a.EventKeyCode.Up:d===t?c=!0:l=t;break;case a.EventKeyCode.Down:case a.EventKeyCode.Insert:r?(l=t,c=!0):d===t&&(r=!0)}});else if(a.EventKeyCode.Home===e||a.EventKeyCode.End===e)a.EventKeyCode.Home===e?l=u[0]:a.EventKeyCode.End===e&&(l=u[u.length-1]);else if(a.EventKeyCode.PageDown===e){for(;h>o;o++)if(d===u[o]){o+=n,o=o>h-1?h-1:o,l=u[o];break}}else if(a.EventKeyCode.PageUp===e)for(o=h;o>=0;o--)if(d===u[o]){o-=n,o=0>o?0:o,l=u[o];break}}else a.EventKeyCode.Down===e||a.EventKeyCode.Insert===e||a.EventKeyCode.Space===e||a.EventKeyCode.Home===e||a.EventKeyCode.PageUp===e?l=u[0]:(a.EventKeyCode.Up===e||a.EventKeyCode.End===e||a.EventKeyCode.PageDown===e)&&(l=u[u.length-1]);l?(this.focusedItem(l),d&&(t?(a.EventKeyCode.Up===e||a.EventKeyCode.Down===e)&&d.checked(!d.checked()):(a.EventKeyCode.Insert===e||a.EventKeyCode.Space===e)&&d.checked(!d.checked())),!this.bAutoSelect&&!s||this.isListChecked()||a.EventKeyCode.Space===e||this.selectedItem(l),this.scrollToFocused()):d&&(!t||a.EventKeyCode.Up!==e&&a.EventKeyCode.Down!==e?(a.EventKeyCode.Insert===e||a.EventKeyCode.Space===e)&&d.checked(!d.checked()):d.checked(!d.checked()),this.focusedItem(d))},t.prototype.scrollToFocused=function(){if(!this.oContentVisible||!this.oContentScrollable)return!1;var e=20,t=o(this.sItemFocusedSelector,this.oContentScrollable),s=t.position(),i=this.oContentVisible.height(),n=t.outerHeight();return s&&(s.top<0||s.top+n>i)?(this.oContentScrollable.scrollTop(s.top<0?this.oContentScrollable.scrollTop()+s.top-e:this.oContentScrollable.scrollTop()+s.top-i+n+e),!0):!1},t.prototype.scrollToTop=function(e){return this.oContentVisible&&this.oContentScrollable?(e?this.oContentScrollable.scrollTop(0):this.oContentScrollable.stop().animate({scrollTop:0},200),!0):!1},t.prototype.eventClickFunction=function(e,t){var s=this.getItemUid(e),i=0,o=0,n=null,r="",a=!1,c=!1,l=[],u=!1;if(t&&t.shiftKey&&""!==s&&""!==this.sLastUid&&s!==this.sLastUid)for(l=this.list(),u=e.checked(),i=0,o=l.length;o>i;i++)n=l[i],r=this.getItemUid(n),a=!1,(r===this.sLastUid||r===s)&&(a=!0),a&&(c=!c),(c||a)&&n.checked(u);this.sLastUid=""===s?"":s},t.prototype.actionClick=function(e,t){if(e){var s=!0,i=this.getItemUid(e);t&&(!t.shiftKey||t.ctrlKey||t.altKey?!t.ctrlKey||t.shiftKey||t.altKey||(s=!1,this.focusedItem(e),this.selectedItem()&&e!==this.selectedItem()&&this.selectedItem().checked(!0),e.checked(!e.checked())):(s=!1,""===this.sLastUid&&(this.sLastUid=i),e.checked(!e.checked()),this.eventClickFunction(e,t),this.focusedItem(e))),s&&(this.focusedItem(e),this.selectedItem(e),this.scrollToFocused())}},t.prototype.on=function(e,t){this.oCallbacks[e]=t},e.exports=t}()},,,,,function(e,t,s){!function(){"use strict";function t(){p.call(this,"Right","SystemDropDown"),this.accounts=h.accounts,this.accountEmail=h.accountEmail,this.accountsLoading=h.accountsLoading,this.accountMenuDropdownTrigger=n.observable(!1),this.capaAdditionalAccounts=u.capa(a.Capa.AdditionalAccounts),this.loading=n.computed(function(){return this.accountsLoading()},this),this.accountClick=o.bind(this.accountClick,this)}var i=s(12),o=s(2),n=s(3),r=s(19),a=s(6),c=s(1),l=s(11),u=s(10),h=s(8),d=s(13),p=s(9);o.extend(t.prototype,p.prototype),t.prototype.accountClick=function(e,t){if(e&&t&&!c.isUnd(t.which)&&1===t.which){var s=this;this.accountsLoading(!0),o.delay(function(){s.accountsLoading(!1)},1e3)}return!0},t.prototype.emailTitle=function(){return h.accountEmail()},t.prototype.settingsClick=function(){s(5).setHash(l.settings())},t.prototype.settingsHelp=function(){s(5).showScreenPopup(s(46))},t.prototype.addAccountClick=function(){this.capaAdditionalAccounts&&s(5).showScreenPopup(s(42))},t.prototype.logoutClick=function(){d.logout(function(){i.__rlah_clear&&i.__rlah_clear(),s(4).loginAndLogoutReload(!0,u.settingsGet("ParentEmail")&&0<u.settingsGet("ParentEmail").length)})},t.prototype.onBuild=function(){var e=this;r("`",[a.KeyState.MessageList,a.KeyState.MessageView,a.KeyState.Settings],function(){e.viewModelVisibility()&&e.accountMenuDropdownTrigger(!0)}),r("shift+/",[a.KeyState.MessageList,a.KeyState.MessageView,a.KeyState.Settings],function(){return e.viewModelVisibility()?(s(5).showScreenPopup(s(46)),!1):void 0})},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){l.call(this,"Popups","PopupsAddAccount"),this.email=o.observable(""),this.password=o.observable(""),this.emailError=o.observable(!1),this.passwordError=o.observable(!1),this.email.subscribe(function(){this.emailError(!1)},this),this.password.subscribe(function(){this.passwordError(!1)},this),this.submitRequest=o.observable(!1),this.submitError=o.observable(""),this.emailFocus=o.observable(!1),this.addAccountCommand=r.createCommand(this,function(){return this.emailError(""===r.trim(this.email())),this.passwordError(""===r.trim(this.password())),this.emailError()||this.passwordError()?!1:(this.submitRequest(!0),a.accountAdd(i.bind(function(e,t){this.submitRequest(!1),n.StorageResultType.Success===e&&t&&"AccountAdd"===t.Action?t.Result?(s(4).accountsAndIdentities(),this.cancelCommand()):t.ErrorCode&&this.submitError(r.getNotification(t.ErrorCode)):this.submitError(r.getNotification(n.Notification.UnknownError))},this),this.email(),"",this.password()),!0)},function(){return!this.submitRequest()}),c.constructorEnd(this)}var i=s(2),o=s(3),n=s(6),r=s(1),a=s(13),c=s(5),l=s(9);c.extendAsViewModel(["View:Popup:AddAccount","PopupsAddAccountViewModel"],t),i.extend(t.prototype,l.prototype),t.prototype.clearPopup=function(){this.email(""),this.password(""),this.emailError(!1),this.passwordError(!1),this.submitRequest(!1),this.submitError("")},t.prototype.onShow=function(){this.clearPopup()},t.prototype.onFocus=function(){this.emailFocus(!0)},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){w.call(this,"Popups","PopupsContacts");var e=this,t=function(t){t&&0<t.length&&e.viewProperties.removeAll(t)};this.allowContactsSync=m.allowContactsSync,this.enableContactsSync=m.enableContactsSync,this.allowExport=!u.bMobileDevice,this.search=r.observable(""),this.contactsCount=r.observable(0),this.contacts=m.contacts,this.contactTags=m.contactTags,this.currentContact=r.observable(null),this.importUploaderButton=r.observable(null),this.contactsPage=r.observable(1),this.contactsPageCount=r.computed(function(){var e=i.Math.ceil(this.contactsCount()/l.Defaults.ContactsPerPage);return 0>=e?1:e},this),this.contactsPagenator=r.computed(h.computedPagenatorHelper(this.contactsPage,this.contactsPageCount)),this.emptySelection=r.observable(!0),this.viewClearSearch=r.observable(!1),this.viewID=r.observable(""),this.viewReadOnly=r.observable(!1),this.viewProperties=r.observableArray([]),this.viewTags=r.observable(""),this.viewTags.visibility=r.observable(!1),this.viewTags.focusTrigger=r.observable(!1),this.viewTags.focusTrigger.subscribe(function(e){e||""!==this.viewTags()?e&&this.viewTags.visibility(!0):this.viewTags.visibility(!1)},this),this.viewSaveTrigger=r.observable(c.SaveSettingsStep.Idle),this.viewPropertiesNames=this.viewProperties.filter(function(e){return-1<h.inArray(e.type(),[c.ContactPropertyType.FirstName,c.ContactPropertyType.LastName])}),this.viewPropertiesOther=this.viewProperties.filter(function(e){return-1<h.inArray(e.type(),[c.ContactPropertyType.Note])}),this.viewPropertiesOther=r.computed(function(){var e=o.filter(this.viewProperties(),function(e){return-1<h.inArray(e.type(),[c.ContactPropertyType.Nick])});return o.sortBy(e,function(e){return e.type()})},this),this.viewPropertiesEmails=this.viewProperties.filter(function(e){return c.ContactPropertyType.Email===e.type()}),this.viewPropertiesWeb=this.viewProperties.filter(function(e){return c.ContactPropertyType.Web===e.type()}),this.viewHasNonEmptyRequaredProperties=r.computed(function(){var e=this.viewPropertiesNames(),t=this.viewPropertiesEmails(),s=function(e){return""!==h.trim(e.value())};return!(!o.find(e,s)&&!o.find(t,s))},this),this.viewPropertiesPhones=this.viewProperties.filter(function(e){return c.ContactPropertyType.Phone===e.type()}),this.viewPropertiesEmailsNonEmpty=this.viewPropertiesNames.filter(function(e){return""!==h.trim(e.value())}),this.viewPropertiesEmailsEmptyAndOnFocused=this.viewPropertiesEmails.filter(function(e){var t=e.focused();return""===h.trim(e.value())&&!t}),this.viewPropertiesPhonesEmptyAndOnFocused=this.viewPropertiesPhones.filter(function(e){var t=e.focused();return""===h.trim(e.value())&&!t}),this.viewPropertiesWebEmptyAndOnFocused=this.viewPropertiesWeb.filter(function(e){var t=e.focused();return""===h.trim(e.value())&&!t}),this.viewPropertiesOtherEmptyAndOnFocused=r.computed(function(){return o.filter(this.viewPropertiesOther(),function(e){var t=e.focused();return""===h.trim(e.value())&&!t})},this),this.viewPropertiesEmailsEmptyAndOnFocused.subscribe(function(e){t(e)}),this.viewPropertiesPhonesEmptyAndOnFocused.subscribe(function(e){t(e)}),this.viewPropertiesWebEmptyAndOnFocused.subscribe(function(e){t(e)}),this.viewPropertiesOtherEmptyAndOnFocused.subscribe(function(e){t(e)}),this.viewSaving=r.observable(!1),this.useCheckboxesInList=m.useCheckboxesInList,this.search.subscribe(function(){this.reloadContactList()},this),this.contacts.subscribe(function(){h.windowResize()},this),this.viewProperties.subscribe(function(){h.windowResize()},this),this.contactsChecked=r.computed(function(){return o.filter(this.contacts(),function(e){return e.checked()})},this),this.contactsCheckedOrSelected=r.computed(function(){var e=this.contactsChecked(),t=this.currentContact();return o.union(e,t?[t]:[])},this),this.contactsCheckedOrSelectedUids=r.computed(function(){return o.map(this.contactsCheckedOrSelected(),function(e){return e.idContact})},this),this.selector=new d(this.contacts,this.currentContact,".e-contact-item .actionHandle",".e-contact-item.selected",".e-contact-item .checkboxItem",".e-contact-item.focused"),this.selector.on("onItemSelect",o.bind(function(e){this.populateViewContact(e?e:null),e||this.emptySelection(!0)},this)),this.selector.on("onItemGetUid",function(e){return e?e.generateUid():""}),this.newCommand=h.createCommand(this,function(){this.populateViewContact(null),this.currentContact(null)}),this.deleteCommand=h.createCommand(this,function(){this.deleteSelectedContacts(),this.emptySelection(!0)},function(){return 0<this.contactsCheckedOrSelected().length}),this.newMessageCommand=h.createCommand(this,function(){var e=this.contactsCheckedOrSelected(),t=[];h.isNonEmptyArray(e)&&(t=o.map(e,function(e){if(e){var t=e.getNameAndEmailHelper(),s=t?new g(t[0],t[1]):null;if(s&&s.validate())return s}return null}),t=o.compact(t)),h.isNonEmptyArray(t)&&(v.hideScreenPopup(s(43)),v.showScreenPopup(s(21),[c.ComposeType.Empty,null,t]))},function(){return 0<this.contactsCheckedOrSelected().length}),this.clearCommand=h.createCommand(this,function(){this.search("")}),this.saveCommand=h.createCommand(this,function(){this.viewSaving(!0),this.viewSaveTrigger(c.SaveSettingsStep.Animate);var t=h.fakeMd5(),s=[];o.each(this.viewProperties(),function(e){e.type()&&""!==h.trim(e.value())&&s.push([e.type(),e.value(),e.typeStr()])}),f.contactSave(function(s,i){var n=!1;e.viewSaving(!1),c.StorageResultType.Success===s&&i&&i.Result&&i.Result.RequestUid===t&&0<h.pInt(i.Result.ResultID)&&(""===e.viewID()&&e.viewID(h.pInt(i.Result.ResultID)),e.reloadContactList(),n=!0),o.delay(function(){e.viewSaveTrigger(n?c.SaveSettingsStep.TrueResult:c.SaveSettingsStep.FalseResult)},300),n&&(e.watchDirty(!1),o.delay(function(){e.viewSaveTrigger(c.SaveSettingsStep.Idle)},1e3))},t,this.viewID(),this.viewTags(),s)},function(){var e=this.viewHasNonEmptyRequaredProperties(),t=this.viewReadOnly();return!this.viewSaving()&&e&&!t}),this.syncCommand=h.createCommand(this,function(){var e=this;s(4).contactsSync(function(t,s){c.StorageResultType.Success===t&&s&&s.Result||i.alert(h.getNotification(s&&s.ErrorCode?s.ErrorCode:c.Notification.ContactsSyncError)),e.reloadContactList(!0)})},function(){return!this.contacts.syncing()&&!this.contacts.importing()}),this.bDropPageAfterDelete=!1,this.watchDirty=r.observable(!1),this.watchHash=r.observable(!1),this.viewHash=r.computed(function(){return""+e.viewTags()+"|"+o.map(e.viewProperties(),function(e){return e.value()}).join("")}),this.viewHash.subscribe(function(){!this.watchHash()||this.viewReadOnly()||this.watchDirty()||this.watchDirty(!0)},this),this.sDefaultKeyScope=c.KeyState.ContactList,this.contactTagsSource=o.bind(this.contactTagsSource,this),v.constructorEnd(this)}var i=s(12),o=s(2),n=s(14),r=s(3),a=s(19),c=s(6),l=s(17),u=s(7),h=s(1),d=s(36),p=s(11),m=s(8),f=s(13),g=s(23),y=s(54),b=s(37),S=s(55),v=s(5),w=s(9);v.extendAsViewModel(["View:Popup:Contacts","PopupsContactsViewModel"],t),o.extend(t.prototype,w.prototype),t.prototype.contactTagsSource=function(e,t){s(4).getContactTagsAutocomplete(e.term,function(e){t(o.map(e,function(e){return e.toLine(!1)}))})},t.prototype.getPropertyPlceholder=function(e){var t="";switch(e){case c.ContactPropertyType.LastName:t="CONTACTS/PLACEHOLDER_ENTER_LAST_NAME";break;case c.ContactPropertyType.FirstName:t="CONTACTS/PLACEHOLDER_ENTER_FIRST_NAME";break;case c.ContactPropertyType.Nick:t="CONTACTS/PLACEHOLDER_ENTER_NICK_NAME"}return t},t.prototype.addNewProperty=function(e,t){this.viewProperties.push(new S(e,t||"","",!0,this.getPropertyPlceholder(e)))},t.prototype.addNewOrFocusProperty=function(e,t){var s=o.find(this.viewProperties(),function(t){return e===t.type()});s?s.focused(!0):this.addNewProperty(e,t)},t.prototype.addNewTag=function(){this.viewTags.visibility(!0),this.viewTags.focusTrigger(!0)},t.prototype.addNewEmail=function(){this.addNewProperty(c.ContactPropertyType.Email,"Home")},t.prototype.addNewPhone=function(){this.addNewProperty(c.ContactPropertyType.Phone,"Mobile")},t.prototype.addNewWeb=function(){this.addNewProperty(c.ContactPropertyType.Web)},t.prototype.addNewNickname=function(){this.addNewOrFocusProperty(c.ContactPropertyType.Nick)},t.prototype.addNewNotes=function(){this.addNewOrFocusProperty(c.ContactPropertyType.Note)},t.prototype.addNewBirthday=function(){this.addNewOrFocusProperty(c.ContactPropertyType.Birthday)},t.prototype.exportVcf=function(){s(4).download(p.exportContactsVcf())},t.prototype.exportCsv=function(){s(4).download(p.exportContactsCsv())},t.prototype.initUploader=function(){if(this.importUploaderButton()){var e=new Jua({action:p.uploadContacts(),name:"uploader",queueSize:1,multipleSizeLimit:1,disableFolderDragAndDrop:!0,disableDragAndDrop:!0,disableMultiple:!0,disableDocumentDropPrevent:!0,clickElement:this.importUploaderButton()});e&&e.on("onStart",o.bind(function(){this.contacts.importing(!0)},this)).on("onComplete",o.bind(function(e,t,s){this.contacts.importing(!1),this.reloadContactList(),e&&t&&s&&s.Result||i.alert(h.i18n("CONTACTS/ERROR_IMPORT_FILE"))},this))}},t.prototype.removeCheckedOrSelectedContactsFromList=function(){var e=this,t=this.contacts,s=this.currentContact(),i=this.contacts().length,n=this.contactsCheckedOrSelected();0<n.length&&(o.each(n,function(t){s&&s.idContact===t.idContact&&(s=null,e.currentContact(null)),t.deleted(!0),i--}),0>=i&&(this.bDropPageAfterDelete=!0),o.delay(function(){o.each(n,function(e){t.remove(e)})},500))},t.prototype.deleteSelectedContacts=function(){0<this.contactsCheckedOrSelected().length&&(f.contactsDelete(o.bind(this.deleteResponse,this),this.contactsCheckedOrSelectedUids()),this.removeCheckedOrSelectedContactsFromList())},t.prototype.deleteResponse=function(e,t){500<(c.StorageResultType.Success===e&&t&&t.Time?h.pInt(t.Time):0)?this.reloadContactList(this.bDropPageAfterDelete):o.delay(function(e){return function(){e.reloadContactList(e.bDropPageAfterDelete)}}(this),500)},t.prototype.removeProperty=function(e){this.viewProperties.remove(e)},t.prototype.populateViewContact=function(e){var t="",s="",i="",n=[];this.watchHash(!1),this.emptySelection(!1),this.viewReadOnly(!1),this.viewTags(""),e&&(t=e.idContact,h.isNonEmptyArray(e.properties)&&o.each(e.properties,function(e){e&&e[0]&&(c.ContactPropertyType.LastName===e[0]?s=e[1]:c.ContactPropertyType.FirstName===e[0]?i=e[1]:n.push(new S(e[0],e[2]||"",e[1])))}),this.viewTags(e.tags),this.viewReadOnly(!!e.readOnly)),this.viewTags.focusTrigger.valueHasMutated(),this.viewTags.visibility(""!==this.viewTags()),n.unshift(new S(c.ContactPropertyType.LastName,"",s,!1,this.getPropertyPlceholder(c.ContactPropertyType.LastName))),n.unshift(new S(c.ContactPropertyType.FirstName,"",i,!e,this.getPropertyPlceholder(c.ContactPropertyType.FirstName))),this.viewID(t),this.viewProperties([]),this.viewProperties(n),this.watchDirty(!1),this.watchHash(!0)},t.prototype.reloadContactList=function(e){var t=this,s=(this.contactsPage()-1)*l.Defaults.ContactsPerPage;this.bDropPageAfterDelete=!1,(h.isUnd(e)?1:!e)||(this.contactsPage(1),s=0),this.contacts.loading(!0),f.contacts(function(e,s){var i=0,n=[],r=[];c.StorageResultType.Success===e&&s&&s.Result&&s.Result.List&&(h.isNonEmptyArray(s.Result.List)&&(n=o.map(s.Result.List,function(e){var t=new y;return t.parse(e)?t:null}),n=o.compact(n),i=h.pInt(s.Result.Count),i=i>0?i:0),h.isNonEmptyArray(s.Result.Tags)&&(r=o.map(s.Result.Tags,function(e){var t=new b;return t.parse(e)?t:null}),r=o.compact(r))),t.contactsCount(i),t.contacts(n),t.contacts.loading(!1),t.contactTags(r),t.viewClearSearch(""!==t.search())},s,l.Defaults.ContactsPerPage,this.search())},t.prototype.onBuild=function(e){this.oContentVisible=n(".b-list-content",e),this.oContentScrollable=n(".content",this.oContentVisible),this.selector.init(this.oContentVisible,this.oContentScrollable,c.KeyState.ContactList);var t=this;a("delete",c.KeyState.ContactList,function(){return t.deleteCommand(),!1}),e.on("click",".e-pagenator .e-page",function(){var e=r.dataFor(this);e&&(t.contactsPage(h.pInt(e.value)),t.reloadContactList())}),this.initUploader()},t.prototype.onShow=function(){v.routeOff(),this.reloadContactList(!0)},t.prototype.onHide=function(){v.routeOn(),this.currentContact(null),this.emptySelection(!0),this.search(""),this.contactsCount(0),this.contacts([])},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){h.call(this,"Popups","PopupsFolderCreate"),a.initOnStartOrLangChange(function(){this.sNoParentText=a.i18n("POPUPS_CREATE_FOLDER/SELECT_NO_PARENT")},this),this.folderName=o.observable(""),this.folderName.focused=o.observable(!1),this.selectedParentValue=o.observable(r.Values.UnuseOptionValue),this.parentFolderSelectList=o.computed(function(){var e=[],t=null,s=null,i=c.folderList(),o=function(e){return e?e.isSystemFolder()?e.name()+" "+e.manageFolderSystemName():e.name():""};return e.push(["",this.sNoParentText]),""!==c.namespace&&(t=function(e){return c.namespace!==e.fullNameRaw.substr(0,c.namespace.length)}),a.folderListOptionsBuilder([],i,[],e,null,t,s,o)},this),this.createFolder=a.createCommand(this,function(){var e=this.selectedParentValue();""===e&&1<c.namespace.length&&(e=c.namespace.substr(0,c.namespace.length-1)),c.foldersCreating(!0),l.folderCreate(function(e,t){c.foldersCreating(!1),n.StorageResultType.Success===e&&t&&t.Result?s(4).folders():c.foldersListError(t&&t.ErrorCode?a.getNotification(t.ErrorCode):a.i18n("NOTIFICATIONS/CANT_CREATE_FOLDER"))},this.folderName(),e),this.cancelCommand()},function(){return this.simpleFolderNameValidation(this.folderName())}),this.defautOptionsAfterRender=a.defautOptionsAfterRender,u.constructorEnd(this)}var i=s(2),o=s(3),n=s(6),r=s(17),a=s(1),c=s(8),l=s(13),u=s(5),h=s(9);u.extendAsViewModel(["View:Popup:FolderCreate","PopupsFolderCreateViewModel"],t),i.extend(t.prototype,h.prototype),t.prototype.sNoParentText="",t.prototype.simpleFolderNameValidation=function(e){return/^[^\\\/]+$/g.test(a.trim(e))},t.prototype.clearPopup=function(){this.folderName(""),this.selectedParentValue(""),this.folderName.focused(!1)},t.prototype.onShow=function(){this.clearPopup()},t.prototype.onFocus=function(){this.folderName.focused(!0)},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){u.call(this,"Popups","PopupsIdentity"),this.id="",this.edit=o.observable(!1),this.owner=o.observable(!1),this.email=o.observable("").validateEmail(),this.email.focused=o.observable(!1),this.name=o.observable(""),this.name.focused=o.observable(!1),this.replyTo=o.observable("").validateSimpleEmail(),this.replyTo.focused=o.observable(!1),this.bcc=o.observable("").validateSimpleEmail(),this.bcc.focused=o.observable(!1),this.submitRequest=o.observable(!1),this.submitError=o.observable(""),this.addOrEditIdentityCommand=r.createCommand(this,function(){return this.email.hasError()||this.email.hasError(""===r.trim(this.email())),this.email.hasError()?(this.owner()||this.email.focused(!0),!1):this.replyTo.hasError()?(this.replyTo.focused(!0),!1):this.bcc.hasError()?(this.bcc.focused(!0),!1):(this.submitRequest(!0),a.identityUpdate(i.bind(function(e,t){this.submitRequest(!1),n.StorageResultType.Success===e&&t?t.Result?(s(4).accountsAndIdentities(),this.cancelCommand()):t.ErrorCode&&this.submitError(r.getNotification(t.ErrorCode)):this.submitError(r.getNotification(n.Notification.UnknownError))},this),this.id,this.email(),this.name(),this.replyTo(),this.bcc()),!0)},function(){return!this.submitRequest()}),this.label=o.computed(function(){return r.i18n("POPUPS_IDENTITIES/"+(this.edit()?"TITLE_UPDATE_IDENTITY":"TITLE_ADD_IDENTITY"))},this),this.button=o.computed(function(){return r.i18n("POPUPS_IDENTITIES/"+(this.edit()?"BUTTON_UPDATE_IDENTITY":"BUTTON_ADD_IDENTITY"))},this),l.constructorEnd(this)}var i=s(2),o=s(3),n=s(6),r=s(1),a=s(13),c=s(8),l=s(5),u=s(9);l.extendAsViewModel(["View:Popup:Identity","PopupsIdentityViewModel"],t),i.extend(t.prototype,u.prototype),t.prototype.clearPopup=function(){this.id="",this.edit(!1),this.owner(!1),this.name(""),this.email(""),this.replyTo(""),this.bcc(""),this.email.hasError(!1),this.replyTo.hasError(!1),this.bcc.hasError(!1),this.submitRequest(!1),this.submitError("")},t.prototype.onShow=function(e){this.clearPopup(),e&&(this.edit(!0),this.id=e.id,this.name(e.name()),this.email(e.email()),this.replyTo(e.replyTo()),this.bcc(e.bcc()),this.owner(this.id===c.accountEmail()))},t.prototype.onFocus=function(){this.owner()||this.email.focused(!0)},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){a.call(this,"Popups","PopupsKeyboardShortcutsHelp"),this.sDefaultKeyScope=n.KeyState.PopupKeyboardShortcutsHelp,r.constructorEnd(this)}var i=s(2),o=s(19),n=s(6),r=s(5),a=s(9);r.extendAsViewModel(["View:Popup:KeyboardShortcutsHelp","PopupsKeyboardShortcutsHelpViewModel"],t),i.extend(t.prototype,a.prototype),t.prototype.onBuild=function(e){o("tab, shift+tab, left, right",n.KeyState.PopupKeyboardShortcutsHelp,i.bind(function(t,s){if(t&&s){var i=e.find(".nav.nav-tabs > li"),o=s&&("tab"===s.shortcut||"right"===s.shortcut),n=i.index(i.filter(".active"));return!o&&n>0?n--:o&&n<i.length-1?n++:n=o?0:i.length-1,i.eq(n).find('a[data-toggle="tab"]').tab("show"),!1}},this))},e.exports=t}()},function(e){e.exports=Jua},,,,,,function(e,t,s){!function(){"use strict";function t(e,t,s,n,r,a,c){this.id=e,this.isInline=o.isUnd(n)?!1:!!n,this.isLinked=o.isUnd(r)?!1:!!r,this.CID=o.isUnd(a)?"":a,this.contentLocation=o.isUnd(c)?"":c,this.fromMessage=!1,this.fileName=i.observable(t),this.size=i.observable(o.isUnd(s)?null:s),this.tempName=i.observable(""),this.progress=i.observable(""),this.error=i.observable(""),this.waiting=i.observable(!0),this.uploading=i.observable(!1),this.enabled=i.observable(!0),this.friendlySize=i.computed(function(){var e=this.size();return null===e?"":o.friendlySize(this.size())},this)}var i=s(3),o=s(1);t.prototype.id="",t.prototype.isInline=!1,t.prototype.isLinked=!1,t.prototype.CID="",t.prototype.contentLocation="",t.prototype.fromMessage=!1,t.prototype.cancel=o.emptyFunction,t.prototype.initByUploadJson=function(e){var t=!1;return e&&(this.fileName(e.Name),this.size(o.isUnd(e.Size)?0:o.pInt(e.Size)),this.tempName(o.isUnd(e.TempName)?"":e.TempName),this.isInline=!1,t=!0),t},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){this.idContact=0,this.display="",this.properties=[],this.tags="",this.readOnly=!1,this.focused=o.observable(!1),this.selected=o.observable(!1),this.checked=o.observable(!1),this.deleted=o.observable(!1)}var i=s(2),o=s(3),n=s(6),r=s(1),a=s(11);t.prototype.getNameAndEmailHelper=function(){var e="",t="";return r.isNonEmptyArray(this.properties)&&i.each(this.properties,function(s){s&&(n.ContactPropertyType.FirstName===s[0]?e=r.trim(s[1]+" "+e):n.ContactPropertyType.LastName===s[0]?e=r.trim(e+" "+s[1]):""===t&&n.ContactPropertyType.Email===s[0]&&(t=s[1]))},this),""===t?null:[t,e]},t.prototype.parse=function(e){var t=!1;return e&&"Object/Contact"===e["@Object"]&&(this.idContact=r.pInt(e.IdContact),this.display=r.pString(e.Display),this.readOnly=!!e.ReadOnly,this.tags="",r.isNonEmptyArray(e.Properties)&&i.each(e.Properties,function(e){e&&e.Type&&r.isNormal(e.Value)&&r.isNormal(e.TypeStr)&&this.properties.push([r.pInt(e.Type),r.pString(e.Value),r.pString(e.TypeStr)])},this),r.isNonEmptyArray(e.Tags)&&(this.tags=e.Tags.join(",")),t=!0),t},t.prototype.srcAttr=function(){return a.emptyContactPic()},t.prototype.generateUid=function(){return""+this.idContact},t.prototype.lineAsCcc=function(){var e=[];return this.deleted()&&e.push("deleted"),this.selected()&&e.push("selected"),this.checked()&&e.push("checked"),this.focused()&&e.push("focused"),e.join(" ")},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(e,t,s,r,a){this.type=i.observable(n.isUnd(e)?o.ContactPropertyType.Unknown:e),this.typeStr=i.observable(n.isUnd(t)?"":t),this.focused=i.observable(n.isUnd(r)?!1:!!r),this.value=i.observable(n.pString(s)),this.placeholder=i.observable(a||""),this.placeholderValue=i.computed(function(){var e=this.placeholder();return e?n.i18n(e):""},this),this.largeValue=i.computed(function(){return o.ContactPropertyType.Note===this.type()},this)}var i=s(3),o=s(6),n=s(1);e.exports=t}()},function(e,t,s){!function(){"use strict";function t(e){this.parentList=e,this.field=i.observable(o.FilterConditionField.From),this.fieldOptions=[{id:o.FilterConditionField.From,name:"From"},{id:o.FilterConditionField.Recipient,name:"Recipient (To or CC)"},{id:o.FilterConditionField.To,name:"To"},{id:o.FilterConditionField.Subject,name:"Subject"}],this.type=i.observable(o.FilterConditionType.EqualTo),this.typeOptions=[{id:o.FilterConditionType.EqualTo,name:"Equal To"},{id:o.FilterConditionType.NotEqualTo,name:"Not Equal To"},{id:o.FilterConditionType.Contains,name:"Contains"},{id:o.FilterConditionType.NotContains,name:"Not Contains"}],this.value=i.observable(""),this.template=i.computed(function(){var e="";switch(this.type()){default:e="SettingsFiltersConditionDefault"}return e},this)}var i=s(3),o=s(6);t.prototype.removeSelf=function(){this.parentList.remove(this)},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){this.isNew=i.observable(!0),this.enabled=i.observable(!0),this.name=i.observable(""),this.conditionsType=i.observable(o.FilterRulesType.And),this.conditions=i.observableArray([]),this.conditions.subscribe(function(){n.windowResize()}),this.actionMarkAsRead=i.observable(!1),this.actionSkipOtherFilters=i.observable(!0),this.actionValue=i.observable(""),this.actionType=i.observable(o.FiltersAction.Move),this.actionTypeOptions=[{id:o.FiltersAction.None,name:"Action - None"},{id:o.FiltersAction.Move,name:"Action - Move to"},{id:o.FiltersAction.Discard,name:"Action - Discard"}],this.actionMarkAsReadVisiblity=i.computed(function(){return-1<n.inArray(this.actionType(),[o.FiltersAction.None,o.FiltersAction.Forward,o.FiltersAction.Move])},this),this.actionTemplate=i.computed(function(){var e="";switch(this.actionType()){default:case o.FiltersAction.Move:e="SettingsFiltersActionValueAsFolders";break;case o.FiltersAction.Forward:e="SettingsFiltersActionWithValue";break;case o.FiltersAction.None:case o.FiltersAction.Discard:e="SettingsFiltersActionNoValue"}return e},this)}var i=s(3),o=s(6),n=s(1),r=s(56);t.prototype.addCondition=function(){this.conditions.push(new r(this.conditions))},t.prototype.parse=function(e){var t=!1;return e&&"Object/Filter"===e["@Object"]&&(this.name(n.pString(e.Name)),t=!0),t},e.exports=t}()},,,,function(e,t,s){!function(){"use strict";function t(){o.call(this,"about",[s(92)])}var i=s(2),o=s(24);i.extend(t.prototype,o.prototype),t.prototype.onShow=function(){s(4).setTitle("RainLoop")},e.exports=t}()},,,,function(e,t,s){!function(){"use strict";function t(){c.call(this,"mailbox",[s(100),s(97),s(98),s(99)]),this.oLastRoute={}}var i=s(2),o=s(6),n=s(7),r=s(1),a=s(22),c=s(24),l=s(10),u=s(8),h=s(20),d=s(13);i.extend(t.prototype,c.prototype),t.prototype.oLastRoute={},t.prototype.setNewTitle=function(){var e=u.accountEmail(),t=u.foldersInboxUnreadCount();s(4).setTitle((""===e?"":(t>0?"("+t+") ":" ")+e+" - ")+r.i18n("TITLES/MAILBOX"))},t.prototype.onShow=function(){this.setNewTitle(),n.keyScope(o.KeyState.MessageList)},t.prototype.onRoute=function(e,t,i,n){if(r.isUnd(n)?1:!n){var a=h.getFolderFullNameRaw(e),c=h.getFolderFromCacheList(a);
c&&(u.currentFolder(c).messageListPage(t).messageListSearch(i),o.Layout.NoPreview===u.layout()&&u.message()&&u.message(null),s(4).reloadMessageList())}else o.Layout.NoPreview!==u.layout()||u.message()||s(4).historyBack()},t.prototype.onStart=function(){var e=function(){r.windowResize()};(l.capa(o.Capa.AdditionalAccounts)||l.capa(o.Capa.AdditionalIdentities))&&s(4).accountsAndIdentities(),i.delay(function(){"INBOX"!==u.currentFolderFullNameRaw()&&s(4).folderInformation("INBOX")},1e3),i.delay(function(){s(4).quota()},5e3),i.delay(function(){d.appDelayStart(r.emptyFunction)},35e3),n.$html.toggleClass("rl-no-preview-pane",o.Layout.NoPreview===u.layout()),u.folderList.subscribe(e),u.messageList.subscribe(e),u.message.subscribe(e),u.layout.subscribe(function(e){n.$html.toggleClass("rl-no-preview-pane",o.Layout.NoPreview===e)}),a.sub("mailbox.inbox-unread-count",function(e){u.foldersInboxUnreadCount(e)}),u.foldersInboxUnreadCount.subscribe(function(){this.setNewTitle()},this)},t.prototype.routes=function(){var e=function(){return["Inbox",1,"",!0]},t=function(e,t){return t[0]=r.pString(t[0]),t[1]=r.pInt(t[1]),t[1]=0>=t[1]?1:t[1],t[2]=r.pString(t[2]),""===e&&(t[0]="Inbox",t[1]=1),[decodeURI(t[0]),t[1],decodeURI(t[2]),!1]},s=function(e,t){return t[0]=r.pString(t[0]),t[1]=r.pString(t[1]),""===e&&(t[0]="Inbox"),[decodeURI(t[0]),1,decodeURI(t[1]),!1]};return[[/^([a-zA-Z0-9]+)\/p([1-9][0-9]*)\/(.+)\/?$/,{normalize_:t}],[/^([a-zA-Z0-9]+)\/p([1-9][0-9]*)$/,{normalize_:t}],[/^([a-zA-Z0-9]+)\/(.+)\/?$/,{normalize_:s}],[/^message-preview$/,{normalize_:e}],[/^([^\/]*)$/,{normalize_:t}]]},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){l.call(this,[s(114),s(112),s(113)]),n.initOnStartOrLangChange(function(){this.sSettingsTitle=n.i18n("TITLES/SETTINGS")},this,function(){this.setSettingsTitle()})}var i=s(2),o=s(6),n=s(1),r=s(7),a=s(10),c=s(5),l=s(29);i.extend(t.prototype,l.prototype),t.prototype.setupSettings=function(e){c.addSettingsViewModel(s(83),"SettingsGeneral","SETTINGS_LABELS/LABEL_GENERAL_NAME","general",!0),a.settingsGet("ContactsIsAllowed")&&c.addSettingsViewModel(s(80),"SettingsContacts","SETTINGS_LABELS/LABEL_CONTACTS_NAME","contacts"),a.capa(o.Capa.AdditionalAccounts)&&c.addSettingsViewModel(s(78),"SettingsAccounts","SETTINGS_LABELS/LABEL_ACCOUNTS_NAME","accounts"),a.capa(o.Capa.AdditionalIdentities)?c.addSettingsViewModel(s(84),"SettingsIdentities","SETTINGS_LABELS/LABEL_IDENTITIES_NAME","identities"):c.addSettingsViewModel(s(85),"SettingsIdentity","SETTINGS_LABELS/LABEL_IDENTITY_NAME","identity"),a.capa(o.Capa.Filters)&&c.addSettingsViewModel(s(81),"SettingsFilters","SETTINGS_LABELS/LABEL_FILTERS_NAME","filters"),a.capa(o.Capa.TwoFactor)&&c.addSettingsViewModel(s(87),"SettingsSecurity","SETTINGS_LABELS/LABEL_SECURITY_NAME","security"),(a.settingsGet("AllowGoogleSocial")||a.settingsGet("AllowFacebookSocial")||a.settingsGet("AllowTwitterSocial"))&&c.addSettingsViewModel(s(88),"SettingsSocial","SETTINGS_LABELS/LABEL_SOCIAL_NAME","social"),a.settingsGet("ChangePasswordIsAllowed")&&c.addSettingsViewModel(s(79),"SettingsChangePassword","SETTINGS_LABELS/LABEL_CHANGE_PASSWORD_NAME","change-password"),c.addSettingsViewModel(s(82),"SettingsFolders","SETTINGS_LABELS/LABEL_FOLDERS_NAME","folders"),a.capa(o.Capa.Themes)&&c.addSettingsViewModel(s(89),"SettingsThemes","SETTINGS_LABELS/LABEL_THEMES_NAME","themes"),a.capa(o.Capa.OpenPGP)&&c.addSettingsViewModel(s(86),"SettingsOpenPGP","SETTINGS_LABELS/LABEL_OPEN_PGP_NAME","openpgp"),e&&e()},t.prototype.onShow=function(){this.setSettingsTitle(),r.keyScope(o.KeyState.Settings)},t.prototype.setSettingsTitle=function(){s(4).setTitle(this.sSettingsTitle)},e.exports=t}()},,,,,,,,,,,,function(e,t,s){!function(){"use strict";function t(){this.accounts=l.accounts,this.processText=n.computed(function(){return l.accountsLoading()?a.i18n("SETTINGS_ACCOUNTS/LOADING_PROCESS"):""},this),this.visibility=n.computed(function(){return""===this.processText()?"hidden":"visible"},this),this.accountForDeletion=n.observable(null).extend({falseTimeout:3e3}).extend({toggleSubscribe:[this,function(e){e&&e.deleteAccess(!1)},function(e){e&&e.deleteAccess(!0)}]})}var i=s(12),o=s(2),n=s(3),r=s(6),a=s(1),c=s(11),l=s(8),u=s(13);t.prototype.addNewAccount=function(){s(5).showScreenPopup(s(42))},t.prototype.deleteAccount=function(e){if(e&&e.deleteAccess()){this.accountForDeletion(null);var t=s(5),n=function(t){return e===t};e&&(this.accounts.remove(n),u.accountDelete(function(e,n){r.StorageResultType.Success===e&&n&&n.Result&&n.Reload?(t.routeOff(),t.setHash(c.root(),!0),t.routeOff(),o.defer(function(){i.location.reload()})):s(4).accountsAndIdentities()},e.email))}},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){this.changeProcess=o.observable(!1),this.errorDescription=o.observable(""),this.passwordMismatch=o.observable(!1),this.passwordUpdateError=o.observable(!1),this.passwordUpdateSuccess=o.observable(!1),this.currentPassword=o.observable(""),this.currentPassword.error=o.observable(!1),this.newPassword=o.observable(""),this.newPassword2=o.observable(""),this.currentPassword.subscribe(function(){this.passwordUpdateError(!1),this.passwordUpdateSuccess(!1),this.currentPassword.error(!1)},this),this.newPassword.subscribe(function(){this.passwordUpdateError(!1),this.passwordUpdateSuccess(!1),this.passwordMismatch(!1)},this),this.newPassword2.subscribe(function(){this.passwordUpdateError(!1),this.passwordUpdateSuccess(!1),this.passwordMismatch(!1)},this),this.saveNewPasswordCommand=r.createCommand(this,function(){this.newPassword()!==this.newPassword2()?(this.passwordMismatch(!0),this.errorDescription(r.i18n("SETTINGS_CHANGE_PASSWORD/ERROR_PASSWORD_MISMATCH"))):(this.changeProcess(!0),this.passwordUpdateError(!1),this.passwordUpdateSuccess(!1),this.currentPassword.error(!1),this.passwordMismatch(!1),this.errorDescription(""),a.changePassword(this.onChangePasswordResponse,this.currentPassword(),this.newPassword()))},function(){return!this.changeProcess()&&""!==this.currentPassword()&&""!==this.newPassword()&&""!==this.newPassword2()}),this.onChangePasswordResponse=i.bind(this.onChangePasswordResponse,this)}var i=s(2),o=s(3),n=s(6),r=s(1),a=s(13);t.prototype.onHide=function(){this.changeProcess(!1),this.currentPassword(""),this.newPassword(""),this.newPassword2(""),this.errorDescription(""),this.passwordMismatch(!1),this.currentPassword.error(!1)},t.prototype.onChangePasswordResponse=function(e,t){this.changeProcess(!1),this.passwordMismatch(!1),this.errorDescription(""),this.currentPassword.error(!1),n.StorageResultType.Success===e&&t&&t.Result?(this.currentPassword(""),this.newPassword(""),this.newPassword2(""),this.passwordUpdateSuccess(!0),this.currentPassword.error(!1)):(t&&n.Notification.CurrentPasswordIncorrect===t.ErrorCode&&this.currentPassword.error(!0),this.passwordUpdateError(!0),this.errorDescription(r.getNotification(t&&t.ErrorCode?t.ErrorCode:n.Notification.CouldNotSaveNewPassword)))},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){this.contactsAutosave=r.contactsAutosave,this.allowContactsSync=r.allowContactsSync,this.enableContactsSync=r.enableContactsSync,this.contactsSyncUrl=r.contactsSyncUrl,this.contactsSyncUser=r.contactsSyncUser,this.contactsSyncPass=r.contactsSyncPass,this.saveTrigger=i.computed(function(){return[this.enableContactsSync()?"1":"0",this.contactsSyncUrl(),this.contactsSyncUser(),this.contactsSyncPass()].join("|")},this).extend({throttle:500}),this.saveTrigger.subscribe(function(){n.saveContactsSyncData(null,this.enableContactsSync(),this.contactsSyncUrl(),this.contactsSyncUser(),this.contactsSyncPass())},this)}var i=s(3),o=s(1),n=s(13),r=s(8);t.prototype.onBuild=function(){r.contactsAutosave.subscribe(function(e){n.saveSettings(o.emptyFunction,{ContactsAutosave:e?"1":"0"})})},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){this.filters=i.observableArray([]),this.filters.loading=i.observable(!1),this.filters.subscribe(function(){o.windowResize()})}var i=s(3),o=s(1);t.prototype.deleteFilter=function(e){this.filters.remove(e)},t.prototype.addFilter=function(){var e=s(57);s(5).showScreenPopup(s(106),[new e])},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){this.foldersListError=a.foldersListError,this.folderList=a.folderList,this.processText=i.computed(function(){var e=a.foldersLoading(),t=a.foldersCreating(),s=a.foldersDeleting(),i=a.foldersRenaming();return t?n.i18n("SETTINGS_FOLDERS/CREATING_PROCESS"):s?n.i18n("SETTINGS_FOLDERS/DELETING_PROCESS"):i?n.i18n("SETTINGS_FOLDERS/RENAMING_PROCESS"):e?n.i18n("SETTINGS_FOLDERS/LOADING_PROCESS"):""},this),this.visibility=i.computed(function(){return""===this.processText()?"hidden":"visible"},this),this.folderForDeletion=i.observable(null).extend({falseTimeout:3e3}).extend({toggleSubscribe:[this,function(e){e&&e.deleteAccess(!1)},function(e){e&&e.deleteAccess(!0)}]}),this.folderForEdit=i.observable(null).extend({toggleSubscribe:[this,function(e){e&&e.edited(!1)},function(e){e&&e.canBeEdited()&&e.edited(!0)}]}),this.useImapSubscribe=!!r.settingsGet("UseImapSubscribe")}var i=s(3),o=s(6),n=s(1),r=s(10),a=s(8),c=s(20),l=s(13),u=s(30);t.prototype.folderEditOnEnter=function(e){var t=e?n.trim(e.nameForEdit()):"";""!==t&&e.name()!==t&&(u.set(o.ClientSideKeyName.FoldersLashHash,""),a.foldersRenaming(!0),l.folderRename(function(e,t){a.foldersRenaming(!1),o.StorageResultType.Success===e&&t&&t.Result||a.foldersListError(t&&t.ErrorCode?n.getNotification(t.ErrorCode):n.i18n("NOTIFICATIONS/CANT_RENAME_FOLDER")),s(4).folders()},e.fullNameRaw,t),c.removeFolderFromCacheList(e.fullNameRaw),e.name(t)),e.edited(!1)},t.prototype.folderEditOnEsc=function(e){e&&e.edited(!1)},t.prototype.onShow=function(){a.foldersListError("")},t.prototype.createFolder=function(){s(5).showScreenPopup(s(44))},t.prototype.systemFolder=function(){s(5).showScreenPopup(s(27))},t.prototype.deleteFolder=function(e){if(e&&e.canBeDeleted()&&e.deleteAccess()&&0===e.privateMessageCountAll()){this.folderForDeletion(null);var t=function(s){return e===s?!0:(s.subFolders.remove(t),!1)};e&&(u.set(o.ClientSideKeyName.FoldersLashHash,""),a.folderList.remove(t),a.foldersDeleting(!0),l.folderDelete(function(e,t){a.foldersDeleting(!1),o.StorageResultType.Success===e&&t&&t.Result||a.foldersListError(t&&t.ErrorCode?n.getNotification(t.ErrorCode):n.i18n("NOTIFICATIONS/CANT_DELETE_FOLDER")),s(4).folders()},e.fullNameRaw),c.removeFolderFromCacheList(e.fullNameRaw))}else 0<e.privateMessageCountAll()&&a.foldersListError(n.getNotification(o.Notification.CantDeleteNonEmptyFolder))},t.prototype.subscribeFolder=function(e){u.set(o.ClientSideKeyName.FoldersLashHash,""),l.folderSetSubscribe(n.emptyFunction,e.fullNameRaw,!0),e.subScribed(!0)},t.prototype.unSubscribeFolder=function(e){u.set(o.ClientSideKeyName.FoldersLashHash,""),l.folderSetSubscribe(n.emptyFunction,e.fullNameRaw,!1),e.subScribed(!1)},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){this.mainLanguage=h.mainLanguage,this.mainMessagesPerPage=h.mainMessagesPerPage,this.mainMessagesPerPageArray=a.Defaults.MessagesPerPageArray,this.editorDefaultType=h.editorDefaultType,this.showImages=h.showImages,this.interfaceAnimation=h.interfaceAnimation,this.useDesktopNotifications=h.useDesktopNotifications,this.threading=h.threading,this.useThreads=h.useThreads,this.replySameFolder=h.replySameFolder,this.layout=h.layout,this.usePreviewPane=h.usePreviewPane,this.useCheckboxesInList=h.useCheckboxesInList,this.allowLanguagesOnSettings=h.allowLanguagesOnSettings,this.isDesktopNotificationsSupported=n.computed(function(){return r.DesktopNotifications.NotSupported!==h.desktopNotificationsPermisions()}),this.isDesktopNotificationsDenied=n.computed(function(){return r.DesktopNotifications.NotSupported===h.desktopNotificationsPermisions()||r.DesktopNotifications.Denied===h.desktopNotificationsPermisions()}),this.mainLanguageFullName=n.computed(function(){return l.convertLangName(this.mainLanguage())},this),this.languageTrigger=n.observable(r.SaveSettingsStep.Idle).extend({throttle:100}),this.mppTrigger=n.observable(r.SaveSettingsStep.Idle),this.isAnimationSupported=c.bAnimationSupported}var i=s(2),o=s(14),n=s(3),r=s(6),a=s(17),c=s(7),l=s(1),u=s(11),h=s(8),d=s(13);t.prototype.toggleLayout=function(){this.layout(r.Layout.NoPreview===this.layout()?r.Layout.SidePreview:r.Layout.NoPreview)},t.prototype.onBuild=function(){var e=this;i.delay(function(){var t=l.settingsSaveHelperSimpleFunction(e.mppTrigger,e);h.language.subscribe(function(t){e.languageTrigger(r.SaveSettingsStep.Animate),o.ajax({url:u.langLink(t),dataType:"script",cache:!0}).done(function(){l.i18nReload(),e.languageTrigger(r.SaveSettingsStep.TrueResult)}).fail(function(){e.languageTrigger(r.SaveSettingsStep.FalseResult)}).always(function(){i.delay(function(){e.languageTrigger(r.SaveSettingsStep.Idle)},1e3)}),d.saveSettings(l.emptyFunction,{Language:t})}),h.editorDefaultType.subscribe(function(e){d.saveSettings(l.emptyFunction,{EditorDefaultType:e})}),h.messagesPerPage.subscribe(function(e){d.saveSettings(t,{MPP:e})}),h.showImages.subscribe(function(e){d.saveSettings(l.emptyFunction,{ShowImages:e?"1":"0"})}),h.interfaceAnimation.subscribe(function(e){d.saveSettings(l.emptyFunction,{InterfaceAnimation:e})}),h.useDesktopNotifications.subscribe(function(e){l.timeOutAction("SaveDesktopNotifications",function(){d.saveSettings(l.emptyFunction,{DesktopNotifications:e?"1":"0"})},3e3)}),h.replySameFolder.subscribe(function(e){l.timeOutAction("SaveReplySameFolder",function(){d.saveSettings(l.emptyFunction,{ReplySameFolder:e?"1":"0"})},3e3)}),h.useThreads.subscribe(function(e){h.messageList([]),d.saveSettings(l.emptyFunction,{UseThreads:e?"1":"0"})}),h.layout.subscribe(function(e){h.messageList([]),d.saveSettings(l.emptyFunction,{Layout:e})}),h.useCheckboxesInList.subscribe(function(e){d.saveSettings(l.emptyFunction,{UseCheckboxesInList:e?"1":"0"})})},50)},t.prototype.onShow=function(){h.desktopNotifications.valueHasMutated()},t.prototype.selectLanguage=function(){s(5).showScreenPopup(s(32))},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){this.editor=null,this.defautOptionsAfterRender=r.defautOptionsAfterRender,this.accountEmail=c.accountEmail,this.displayName=c.displayName,this.signature=c.signature,this.signatureToAll=c.signatureToAll,this.replyTo=c.replyTo,this.signatureDom=o.observable(null),this.defaultIdentityIDTrigger=o.observable(n.SaveSettingsStep.Idle),this.displayNameTrigger=o.observable(n.SaveSettingsStep.Idle),this.replyTrigger=o.observable(n.SaveSettingsStep.Idle),this.signatureTrigger=o.observable(n.SaveSettingsStep.Idle),this.identities=c.identities,this.defaultIdentityID=c.defaultIdentityID,this.identitiesOptions=o.computed(function(){var e=this.identities(),t=[];return 0<e.length&&(t.push({id:this.accountEmail.peek(),name:this.formattedAccountIdentity(),seporator:!1}),t.push({id:"---",name:"---",seporator:!0,disabled:!0}),i.each(e,function(e){t.push({id:e.id,name:e.formattedNameForEmail(),seporator:!1})})),t},this),this.processText=o.computed(function(){return c.identitiesLoading()?r.i18n("SETTINGS_IDENTITIES/LOADING_PROCESS"):""},this),this.visibility=o.computed(function(){return""===this.processText()?"hidden":"visible"},this),this.identityForDeletion=o.observable(null).extend({falseTimeout:3e3}).extend({toggleSubscribe:[this,function(e){e&&e.deleteAccess(!1)},function(e){e&&e.deleteAccess(!0)}]})}var i=s(2),o=s(3),n=s(6),r=s(1),a=s(28),c=s(8),l=s(13);t.prototype.formattedAccountIdentity=function(){var e=this.displayName.peek(),t=this.accountEmail.peek();return""===e?t:'"'+r.quoteName(e)+'" <'+t+">"},t.prototype.addNewIdentity=function(){s(5).showScreenPopup(s(45))},t.prototype.editIdentity=function(e){s(5).showScreenPopup(s(45),[e])},t.prototype.deleteIdentity=function(e){if(e&&e.deleteAccess()){this.identityForDeletion(null);var t=function(t){return e===t};e&&(this.identities.remove(t),l.identityDelete(function(){s(4).accountsAndIdentities()},e.id))}},t.prototype.onFocus=function(){if(!this.editor&&this.signatureDom()){var e=this,t=c.signature();this.editor=new a(e.signatureDom(),function(){c.signature((e.editor.isHtml()?":HTML:":"")+e.editor.getData())},function(){":HTML:"===t.substr(0,6)?e.editor.setHtml(t.substr(6),!1):e.editor.setPlain(t,!1)})}},t.prototype.onBuild=function(e){var t=this;e.on("click",".identity-item .e-action",function(){var e=o.dataFor(this);e&&t.editIdentity(e)}),i.delay(function(){var e=r.settingsSaveHelperSimpleFunction(t.displayNameTrigger,t),s=r.settingsSaveHelperSimpleFunction(t.replyTrigger,t),i=r.settingsSaveHelperSimpleFunction(t.signatureTrigger,t),o=r.settingsSaveHelperSimpleFunction(t.defaultIdentityIDTrigger,t);c.defaultIdentityID.subscribe(function(e){l.saveSettings(o,{DefaultIdentityID:e})}),c.displayName.subscribe(function(t){l.saveSettings(e,{DisplayName:t})}),c.replyTo.subscribe(function(e){l.saveSettings(s,{ReplyTo:e})}),c.signature.subscribe(function(e){l.saveSettings(i,{Signature:e})}),c.signatureToAll.subscribe(function(e){l.saveSettings(null,{SignatureToAll:e?"1":"0"})})},50)},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){this.editor=null,this.displayName=c.displayName,this.signature=c.signature,this.signatureToAll=c.signatureToAll,this.replyTo=c.replyTo,this.signatureDom=o.observable(null),this.displayNameTrigger=o.observable(n.SaveSettingsStep.Idle),this.replyTrigger=o.observable(n.SaveSettingsStep.Idle),this.signatureTrigger=o.observable(n.SaveSettingsStep.Idle)}var i=s(2),o=s(3),n=s(6),r=s(1),a=s(28),c=s(8),l=s(13);t.prototype.onFocus=function(){if(!this.editor&&this.signatureDom()){var e=this,t=c.signature();this.editor=new a(e.signatureDom(),function(){c.signature((e.editor.isHtml()?":HTML:":"")+e.editor.getData())},function(){":HTML:"===t.substr(0,6)?e.editor.setHtml(t.substr(6),!1):e.editor.setPlain(t,!1)})}},t.prototype.onBuild=function(){var e=this;i.delay(function(){var t=r.settingsSaveHelperSimpleFunction(e.displayNameTrigger,e),s=r.settingsSaveHelperSimpleFunction(e.replyTrigger,e),i=r.settingsSaveHelperSimpleFunction(e.signatureTrigger,e);c.displayName.subscribe(function(e){l.saveSettings(t,{DisplayName:e})}),c.replyTo.subscribe(function(e){l.saveSettings(s,{ReplyTo:e})}),c.signature.subscribe(function(e){l.saveSettings(i,{Signature:e})}),c.signatureToAll.subscribe(function(e){l.saveSettings(null,{SignatureToAll:e?"1":"0"})})},50)},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){this.openpgpkeys=n.openpgpkeys,this.openpgpkeysPublic=n.openpgpkeysPublic,this.openpgpkeysPrivate=n.openpgpkeysPrivate,this.openPgpKeyForDeletion=i.observable(null).extend({falseTimeout:3e3}).extend({toggleSubscribe:[this,function(e){e&&e.deleteAccess(!1)},function(e){e&&e.deleteAccess(!0)}]})}var i=s(3),o=s(5),n=s(8);t.prototype.addOpenPgpKey=function(){o.showScreenPopup(s(102))},t.prototype.generateOpenPgpKey=function(){o.showScreenPopup(s(108))},t.prototype.viewOpenPgpKey=function(e){e&&o.showScreenPopup(s(111),[e])},t.prototype.deleteOpenPgpKey=function(e){e&&e.deleteAccess()&&(this.openPgpKeyForDeletion(null),e&&n.openpgpKeyring&&(this.openpgpkeys.remove(function(t){return e===t}),n.openpgpKeyring[e.isPrivate?"privateKeys":"publicKeys"].removeForId(e.guid),n.openpgpKeyring.store(),s(4).reloadOpenPgpKeys()))},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){this.processing=i.observable(!1),this.clearing=i.observable(!1),this.secreting=i.observable(!1),this.viewUser=i.observable(""),this.viewEnable=i.observable(!1),this.viewEnable.subs=!0,this.twoFactorStatus=i.observable(!1),this.viewSecret=i.observable(""),this.viewBackupCodes=i.observable(""),this.viewUrl=i.observable(""),this.bFirst=!0,this.viewTwoFactorStatus=i.computed(function(){return n.langChangeTrigger(),r.i18n(this.twoFactorStatus()?"SETTINGS_SECURITY/TWO_FACTOR_SECRET_CONFIGURED_DESC":"SETTINGS_SECURITY/TWO_FACTOR_SECRET_NOT_CONFIGURED_DESC")},this),this.onResult=_.bind(this.onResult,this),this.onSecretResult=_.bind(this.onSecretResult,this)}var i=s(3),o=s(6),n=s(7),r=s(1),a=s(13);t.prototype.showSecret=function(){this.secreting(!0),a.showTwoFactorSecret(this.onSecretResult)},t.prototype.hideSecret=function(){this.viewSecret(""),this.viewBackupCodes(""),this.viewUrl("")},t.prototype.createTwoFactor=function(){this.processing(!0),a.createTwoFactor(this.onResult)},t.prototype.enableTwoFactor=function(){this.processing(!0),a.enableTwoFactor(this.onResult,this.viewEnable())},t.prototype.testTwoFactor=function(){s(5).showScreenPopup(s(110))},t.prototype.clearTwoFactor=function(){this.viewSecret(""),this.viewBackupCodes(""),this.viewUrl(""),this.clearing(!0),a.clearTwoFactor(this.onResult)},t.prototype.onShow=function(){this.viewSecret(""),this.viewBackupCodes(""),this.viewUrl("")},t.prototype.onResult=function(e,t){if(this.processing(!1),this.clearing(!1),o.StorageResultType.Success===e&&t&&t.Result?(this.viewUser(r.pString(t.Result.User)),this.viewEnable(!!t.Result.Enable),this.twoFactorStatus(!!t.Result.IsSet),this.viewSecret(r.pString(t.Result.Secret)),this.viewBackupCodes(r.pString(t.Result.BackupCodes).replace(/[\s]+/g,"  ")),this.viewUrl(r.pString(t.Result.Url))):(this.viewUser(""),this.viewEnable(!1),this.twoFactorStatus(!1),this.viewSecret(""),this.viewBackupCodes(""),this.viewUrl("")),this.bFirst){this.bFirst=!1;var s=this;this.viewEnable.subscribe(function(e){this.viewEnable.subs&&a.enableTwoFactor(function(e,t){o.StorageResultType.Success===e&&t&&t.Result||(s.viewEnable.subs=!1,s.viewEnable(!1),s.viewEnable.subs=!0)},e)},this)}},t.prototype.onSecretResult=function(e,t){this.secreting(!1),o.StorageResultType.Success===e&&t&&t.Result?(this.viewSecret(r.pString(t.Result.Secret)),this.viewUrl(r.pString(t.Result.Url))):(this.viewSecret(""),this.viewUrl(""))},t.prototype.onBuild=function(){this.processing(!0),a.getTwoFactor(this.onResult)},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){var e=s(1),t=s(8);this.googleEnable=t.googleEnable,this.googleActions=t.googleActions,this.googleLoggined=t.googleLoggined,this.googleUserName=t.googleUserName,this.facebookEnable=t.facebookEnable,this.facebookActions=t.facebookActions,this.facebookLoggined=t.facebookLoggined,this.facebookUserName=t.facebookUserName,this.twitterEnable=t.twitterEnable,this.twitterActions=t.twitterActions,this.twitterLoggined=t.twitterLoggined,this.twitterUserName=t.twitterUserName,this.connectGoogle=e.createCommand(this,function(){this.googleLoggined()||s(4).googleConnect()},function(){return!this.googleLoggined()&&!this.googleActions()}),this.disconnectGoogle=e.createCommand(this,function(){s(4).googleDisconnect()}),this.connectFacebook=e.createCommand(this,function(){this.facebookLoggined()||s(4).facebookConnect()},function(){return!this.facebookLoggined()&&!this.facebookActions()}),this.disconnectFacebook=e.createCommand(this,function(){s(4).facebookDisconnect()}),this.connectTwitter=e.createCommand(this,function(){this.twitterLoggined()||s(4).twitterConnect()},function(){return!this.twitterLoggined()&&!this.twitterActions()}),this.disconnectTwitter=e.createCommand(this,function(){s(4).twitterDisconnect()})}e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){var e=this;this.mainTheme=u.mainTheme,this.themesObjects=r.observableArray([]),this.themeTrigger=r.observable(a.SaveSettingsStep.Idle).extend({throttle:100}),this.oLastAjax=null,this.iTimer=0,u.theme.subscribe(function(t){o.each(this.themesObjects(),function(e){e.selected(t===e.name)});var s=n("#rlThemeLink"),r=n("#rlThemeStyle"),l=s.attr("href");l||(l=r.attr("data-href")),l&&(l=l.toString().replace(/\/-\/[^\/]+\/\-\//,"/-/"+t+"/-/"),l=l.toString().replace(/\/Css\/[^\/]+\/User\//,"/Css/0/User/"),"Json/"!==l.substring(l.length-5,l.length)&&(l+="Json/"),i.clearTimeout(e.iTimer),e.themeTrigger(a.SaveSettingsStep.Animate),this.oLastAjax&&this.oLastAjax.abort&&this.oLastAjax.abort(),this.oLastAjax=n.ajax({url:l,dataType:"json"}).done(function(t){t&&c.isArray(t)&&2===t.length&&(!s||!s[0]||r&&r[0]||(r=n('<style id="rlThemeStyle"></style>'),s.after(r),s.remove()),r&&r[0]&&(r.attr("data-href",l).attr("data-theme",t[0]),r&&r[0]&&r[0].styleSheet&&!c.isUnd(r[0].styleSheet.cssText)?r[0].styleSheet.cssText=t[1]:r.text(t[1])),e.themeTrigger(a.SaveSettingsStep.TrueResult))}).always(function(){e.iTimer=i.setTimeout(function(){e.themeTrigger(a.SaveSettingsStep.Idle)},1e3),e.oLastAjax=null})),h.saveSettings(null,{Theme:t})},this)}var i=s(12),o=s(2),n=s(14),r=s(3),a=s(6),c=s(1),l=s(11),u=s(8),h=s(13);t.prototype.onBuild=function(){var e=u.theme();this.themesObjects(o.map(u.themes(),function(t){return{name:t,nameDisplay:c.convertThemeName(t),selected:r.observable(t===e),themePreviewSrc:l.themePreviewLink(t)}}))},e.exports=t}()},,,function(e,t,s){!function(){"use strict";function t(){a.call(this,"Center","About"),this.version=o.observable(r.settingsGet("Version")),n.constructorEnd(this)}var i=s(2),o=s(3),n=s(5),r=s(10),a=s(9);n.extendAsViewModel(["View:RainLoop:About","AboutViewModel"],t),i.extend(t.prototype,a.prototype),e.exports=t}()},,,,,function(e,t,s){!function(){"use strict";function t(){g.call(this,"Left","MailFolderList"),this.oContentVisible=null,this.oContentScrollable=null,this.messageList=m.messageList,this.folderList=m.folderList,this.folderListSystem=m.folderListSystem,this.foldersChanging=m.foldersChanging,this.leftPanelDisabled=u.leftPanelDisabled,this.iDropOverTimer=0,this.allowContacts=!!d.settingsGet("ContactsIsAllowed"),f.constructorEnd(this)}var i=s(12),o=s(2),n=s(14),r=s(3),a=s(19),c=s(1),l=s(6),u=s(7),h=s(11),d=s(10),p=s(20),m=s(8),f=s(5),g=s(9);f.extendAsViewModel(["View:RainLoop:MailBoxFolderList","MailBoxFolderListViewModel"],t),o.extend(t.prototype,g.prototype),t.prototype.onBuild=function(e){this.oContentVisible=n(".b-content",e),this.oContentScrollable=n(".content",this.oContentVisible);var t=this;e.on("click",".b-folders .e-item .e-link .e-collapsed-sign",function(e){var t=r.dataFor(this),i=!1;t&&e&&(i=t.collapsed(),s(4).setExpandedFolder(t.fullNameHash,i),t.collapsed(!i),e.preventDefault(),e.stopPropagation())}).on("click",".b-folders .e-item .e-link.selectable",function(e){e.preventDefault();var t=r.dataFor(this);t&&(l.Layout.NoPreview===m.layout()&&m.message(null),t.fullNameRaw===m.currentFolderFullNameRaw()&&p.setFolderHash(t.fullNameRaw,""),f.setHash(h.mailBox(t.fullNameHash)))}),a("up, down",l.KeyState.FolderList,function(s,i){var o=-1,r=i&&"up"===i.shortcut?38:40,a=n(".b-folders .e-item .e-link:not(.hidden):visible",e);return s&&a.length&&(o=a.index(a.filter(".focused")),o>-1&&a.eq(o).removeClass("focused"),38===r&&o>0?o--:40===r&&o<a.length-1&&o++,a.eq(o).addClass("focused"),t.scrollToFocused()),!1}),a("enter",l.KeyState.FolderList,function(){var s=n(".b-folders .e-item .e-link:not(.hidden).focused",e);return s.length&&s[0]&&(t.folderList.focused(!1),s.click()),!1}),a("space",l.KeyState.FolderList,function(){var t=!0,i=null,o=n(".b-folders .e-item .e-link:not(.hidden).focused",e);return o.length&&o[0]&&(i=r.dataFor(o[0]),i&&(t=i.collapsed(),s(4).setExpandedFolder(i.fullNameHash,t),i.collapsed(!t))),!1}),a("esc, tab, shift+tab, right",l.KeyState.FolderList,function(){return t.folderList.focused(!1),!1}),t.folderList.focused.subscribe(function(t){n(".b-folders .e-item .e-link.focused",e).removeClass("focused"),t&&n(".b-folders .e-item .e-link.selected",e).addClass("focused")})},t.prototype.messagesDropOver=function(e){i.clearTimeout(this.iDropOverTimer),e&&e.collapsed()&&(this.iDropOverTimer=i.setTimeout(function(){e.collapsed(!1),s(4).setExpandedFolder(e.fullNameHash,!0),c.windowResize()},500))},t.prototype.messagesDropOut=function(){i.clearTimeout(this.iDropOverTimer)},t.prototype.scrollToFocused=function(){if(!this.oContentVisible||!this.oContentScrollable)return!1;var e=20,t=n(".e-item .e-link.focused",this.oContentScrollable),s=t.position(),i=this.oContentVisible.height(),o=t.outerHeight();return s&&(s.top<0||s.top+o>i)?(this.oContentScrollable.scrollTop(s.top<0?this.oContentScrollable.scrollTop()+s.top-e:this.oContentScrollable.scrollTop()+s.top-i+o+e),!0):!1},t.prototype.messagesDrop=function(e,t){if(e&&t&&t.helper){var i=t.helper.data("rl-folder"),o=u.$html.hasClass("rl-ctrl-key-pressed"),n=t.helper.data("rl-uids");c.isNormal(i)&&""!==i&&c.isArray(n)&&s(4).moveMessagesToFolder(i,n,e.fullNameRaw,o)}},t.prototype.composeClick=function(){f.showScreenPopup(s(21))},t.prototype.createFolder=function(){f.showScreenPopup(s(44))},t.prototype.configureFolders=function(){f.setHash(h.settings("folders"))},t.prototype.contactsClick=function(){this.allowContacts&&f.showScreenPopup(s(43))},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){w.call(this,"Right","MailMessageList"),this.sLastUid=null,this.bPrefetch=!1,this.emptySubjectValue="",this.hideDangerousActions=!!g.settingsGet("HideDangerousActions"),this.popupVisibility=h.popupVisibility,this.message=b.message,this.messageList=b.messageList,this.folderList=b.folderList,this.currentMessage=b.currentMessage,this.isMessageSelected=b.isMessageSelected,this.messageListSearch=b.messageListSearch,this.messageListError=b.messageListError,this.folderMenuForMove=b.folderMenuForMove,this.useCheckboxesInList=b.useCheckboxesInList,this.mainMessageListSearch=b.mainMessageListSearch,this.messageListEndFolder=b.messageListEndFolder,this.messageListChecked=b.messageListChecked,this.messageListCheckedOrSelected=b.messageListCheckedOrSelected,this.messageListCheckedOrSelectedUidsWithSubMails=b.messageListCheckedOrSelectedUidsWithSubMails,this.messageListCompleteLoadingThrottle=b.messageListCompleteLoadingThrottle,d.initOnStartOrLangChange(function(){this.emptySubjectValue=d.i18n("MESSAGE_LIST/EMPTY_SUBJECT_TEXT")},this),this.userQuota=b.userQuota,this.userUsageSize=b.userUsageSize,this.userUsageProc=b.userUsageProc,this.moveDropdownTrigger=n.observable(!1),this.moreDropdownTrigger=n.observable(!1),this.dragOver=n.observable(!1).extend({throttle:1}),this.dragOverEnter=n.observable(!1).extend({throttle:1}),this.dragOverArea=n.observable(null),this.dragOverBodyArea=n.observable(null),this.messageListItemTemplate=n.computed(function(){return l.Layout.NoPreview!==b.layout()?"MailMessageListItem":"MailMessageListItemNoPreviewPane"}),this.messageListSearchDesc=n.computed(function(){var e=b.messageListEndSearch();return""===e?"":d.i18n("MESSAGE_LIST/SEARCH_RESULT_FOR",{SEARCH:e})}),this.messageListPagenator=n.computed(d.computedPagenatorHelper(b.messageListPage,b.messageListPageCount)),this.checkAll=n.computed({read:function(){return 0<b.messageListChecked().length},write:function(e){e=!!e,i.each(b.messageList(),function(t){t.checked(e)})}}),this.inputMessageListSearchFocus=n.observable(!1),this.sLastSearchValue="",this.inputProxyMessageListSearch=n.computed({read:this.mainMessageListSearch,write:function(e){this.sLastSearchValue=e},owner:this}),this.isIncompleteChecked=n.computed(function(){var e=b.messageList().length,t=b.messageListChecked().length;return e>0&&t>0&&e>t},this),this.hasMessages=n.computed(function(){return 0<this.messageList().length},this),this.hasCheckedOrSelectedLines=n.computed(function(){return 0<this.messageListCheckedOrSelected().length},this),this.isSpamFolder=n.computed(function(){return b.spamFolder()===this.messageListEndFolder()&&""!==b.spamFolder()},this),this.isSpamDisabled=n.computed(function(){return u.Values.UnuseOptionValue===b.spamFolder()},this),this.isTrashFolder=n.computed(function(){return b.trashFolder()===this.messageListEndFolder()&&""!==b.trashFolder()},this),this.isDraftFolder=n.computed(function(){return b.draftFolder()===this.messageListEndFolder()&&""!==b.draftFolder()},this),this.isSentFolder=n.computed(function(){return b.sentFolder()===this.messageListEndFolder()&&""!==b.sentFolder()},this),this.isArchiveFolder=n.computed(function(){return b.archiveFolder()===this.messageListEndFolder()&&""!==b.archiveFolder()},this),this.isArchiveDisabled=n.computed(function(){return u.Values.UnuseOptionValue===b.archiveFolder()
},this),this.canBeMoved=this.hasCheckedOrSelectedLines,this.clearCommand=d.createCommand(this,function(){v.showScreenPopup(s(107),[b.currentFolder()])}),this.multyForwardCommand=d.createCommand(this,function(){v.showScreenPopup(s(21),[l.ComposeType.ForwardAsAttachment,b.messageListCheckedOrSelected()])},this.canBeMoved),this.deleteWithoutMoveCommand=d.createCommand(this,function(){s(4).deleteMessagesFromFolder(l.FolderType.Trash,b.currentFolderFullNameRaw(),b.messageListCheckedOrSelectedUidsWithSubMails(),!1)},this.canBeMoved),this.deleteCommand=d.createCommand(this,function(){s(4).deleteMessagesFromFolder(l.FolderType.Trash,b.currentFolderFullNameRaw(),b.messageListCheckedOrSelectedUidsWithSubMails(),!0)},this.canBeMoved),this.archiveCommand=d.createCommand(this,function(){s(4).deleteMessagesFromFolder(l.FolderType.Archive,b.currentFolderFullNameRaw(),b.messageListCheckedOrSelectedUidsWithSubMails(),!0)},this.canBeMoved),this.spamCommand=d.createCommand(this,function(){s(4).deleteMessagesFromFolder(l.FolderType.Spam,b.currentFolderFullNameRaw(),b.messageListCheckedOrSelectedUidsWithSubMails(),!0)},this.canBeMoved),this.notSpamCommand=d.createCommand(this,function(){s(4).deleteMessagesFromFolder(l.FolderType.NotSpam,b.currentFolderFullNameRaw(),b.messageListCheckedOrSelectedUidsWithSubMails(),!0)},this.canBeMoved),this.moveCommand=d.createCommand(this,d.emptyFunction,this.canBeMoved),this.reloadCommand=d.createCommand(this,function(){b.messageListCompleteLoadingThrottle()||s(4).reloadMessageList(!1,!0)}),this.quotaTooltip=i.bind(this.quotaTooltip,this),this.selector=new f(this.messageList,this.currentMessage,".messageListItem .actionHandle",".messageListItem.selected",".messageListItem .checkboxMessage",".messageListItem.focused"),this.selector.on("onItemSelect",i.bind(function(e){e?(b.message(b.staticMessageList.populateByMessageListItem(e)),this.populateMessageBody(b.message()),l.Layout.NoPreview===b.layout()&&(v.setHash(p.messagePreview(),!0),b.message.focused(!0))):b.message(null)},this)),this.selector.on("onItemGetUid",function(e){return e?e.generateUid():""}),b.messageListEndHash.subscribe(function(){this.selector.scrollToTop()},this),b.layout.subscribe(function(e){this.selector.autoSelect(l.Layout.NoPreview!==e)},this),b.layout.valueHasMutated(),m.sub("mailbox.message-list.selector.go-down",function(){this.selector.goDown(!0)},this).sub("mailbox.message-list.selector.go-up",function(){this.selector.goUp(!0)},this),v.constructorEnd(this)}var i=s(2),o=s(14),n=s(3),r=s(19),a=s(47),c=s(116),l=s(6),u=s(17),h=s(7),d=s(1),p=s(11),m=s(22),f=s(36),g=s(10),y=s(20),b=s(8),S=s(13),v=s(5),w=s(9);v.extendAsViewModel(["View:RainLoop:MailBoxMessageList","MailBoxMessageListViewModel"],t),i.extend(t.prototype,w.prototype),t.prototype.emptySubjectValue="",t.prototype.searchEnterAction=function(){this.mainMessageListSearch(this.sLastSearchValue),this.inputMessageListSearchFocus(!1)},t.prototype.printableMessageCountForDeletion=function(){var e=this.messageListCheckedOrSelectedUidsWithSubMails().length;return e>1?" ("+(100>e?e:"99+")+")":""},t.prototype.cancelSearch=function(){this.mainMessageListSearch(""),this.inputMessageListSearchFocus(!1)},t.prototype.moveSelectedMessagesToFolder=function(e,t){return this.canBeMoved()&&s(4).moveMessagesToFolder(b.currentFolderFullNameRaw(),b.messageListCheckedOrSelectedUidsWithSubMails(),e,t),!1},t.prototype.dragAndDronHelper=function(e){e&&e.checked(!0);var t=d.draggeblePlace(),s=b.messageListCheckedOrSelectedUidsWithSubMails();return t.data("rl-folder",b.currentFolderFullNameRaw()),t.data("rl-uids",s),t.find(".text").text(""+s.length),i.defer(function(){var e=b.messageListCheckedOrSelectedUidsWithSubMails();t.data("rl-uids",e),t.find(".text").text(""+e.length)}),t},t.prototype.onMessageResponse=function(e,t,s){b.hideMessageBodies(),b.messageLoading(!1),l.StorageResultType.Success===e&&t&&t.Result?b.setMessage(t,s):l.StorageResultType.Unload===e?(b.message(null),b.messageError("")):l.StorageResultType.Abort!==e&&(b.message(null),b.messageError(d.getNotification(t&&t.ErrorCode?t.ErrorCode:l.Notification.UnknownError)))},t.prototype.populateMessageBody=function(e){e&&(S.message(this.onMessageResponse,e.folderFullNameRaw,e.uid)?b.messageLoading(!0):d.log("Error: Unknown message request: "+e.folderFullNameRaw+" ~ "+e.uid+" [e-101]"))},t.prototype.setAction=function(e,t,o){var n=[],r=null,a=0;if(d.isUnd(o)&&(o=b.messageListChecked()),n=i.map(o,function(e){return e.uid}),""!==e&&0<n.length){switch(t){case l.MessageSetAction.SetSeen:i.each(o,function(e){e.unseen()&&a++,e.unseen(!1),y.storeMessageFlagsToCache(e)}),r=y.getFolderFromCacheList(e),r&&r.messageCountUnread(r.messageCountUnread()-a),S.messageSetSeen(d.emptyFunction,e,n,!0);break;case l.MessageSetAction.UnsetSeen:i.each(o,function(e){e.unseen()&&a++,e.unseen(!0),y.storeMessageFlagsToCache(e)}),r=y.getFolderFromCacheList(e),r&&r.messageCountUnread(r.messageCountUnread()-a+n.length),S.messageSetSeen(d.emptyFunction,e,n,!1);break;case l.MessageSetAction.SetFlag:i.each(o,function(e){e.flagged(!0),y.storeMessageFlagsToCache(e)}),S.messageSetFlagged(d.emptyFunction,e,n,!0);break;case l.MessageSetAction.UnsetFlag:i.each(o,function(e){e.flagged(!1),y.storeMessageFlagsToCache(e)}),S.messageSetFlagged(d.emptyFunction,e,n,!1)}s(4).reloadFlagsCurrentMessageListAndMessageFromCache()}},t.prototype.setActionForAll=function(e,t){var o=null,n=b.messageList();if(""!==e&&(o=y.getFolderFromCacheList(e))){switch(t){case l.MessageSetAction.SetSeen:o=y.getFolderFromCacheList(e),o&&(i.each(n,function(e){e.unseen(!1)}),o.messageCountUnread(0),y.clearMessageFlagsFromCacheByFolder(e)),S.messageSetSeenToAll(d.emptyFunction,e,!0);break;case l.MessageSetAction.UnsetSeen:o=y.getFolderFromCacheList(e),o&&(i.each(n,function(e){e.unseen(!0)}),o.messageCountUnread(o.messageCountAll()),y.clearMessageFlagsFromCacheByFolder(e)),S.messageSetSeenToAll(d.emptyFunction,e,!1)}s(4).reloadFlagsCurrentMessageListAndMessageFromCache()}},t.prototype.listSetSeen=function(){this.setAction(b.currentFolderFullNameRaw(),l.MessageSetAction.SetSeen,b.messageListCheckedOrSelected())},t.prototype.listSetAllSeen=function(){this.setActionForAll(b.currentFolderFullNameRaw(),l.MessageSetAction.SetSeen)},t.prototype.listUnsetSeen=function(){this.setAction(b.currentFolderFullNameRaw(),l.MessageSetAction.UnsetSeen,b.messageListCheckedOrSelected())},t.prototype.listSetFlags=function(){this.setAction(b.currentFolderFullNameRaw(),l.MessageSetAction.SetFlag,b.messageListCheckedOrSelected())},t.prototype.listUnsetFlags=function(){this.setAction(b.currentFolderFullNameRaw(),l.MessageSetAction.UnsetFlag,b.messageListCheckedOrSelected())},t.prototype.flagMessages=function(e){var t=this.messageListCheckedOrSelected(),s=[];e&&(0<t.length&&(s=i.map(t,function(e){return e.uid})),0<s.length&&-1<d.inArray(e.uid,s)?this.setAction(e.folderFullNameRaw,e.flagged()?l.MessageSetAction.UnsetFlag:l.MessageSetAction.SetFlag,t):this.setAction(e.folderFullNameRaw,e.flagged()?l.MessageSetAction.UnsetFlag:l.MessageSetAction.SetFlag,[e]))},t.prototype.flagMessagesFast=function(e){var t=this.messageListCheckedOrSelected(),s=[];0<t.length&&(s=i.filter(t,function(e){return e.flagged()}),d.isUnd(e)?this.setAction(t[0].folderFullNameRaw,t.length===s.length?l.MessageSetAction.UnsetFlag:l.MessageSetAction.SetFlag,t):this.setAction(t[0].folderFullNameRaw,e?l.MessageSetAction.SetFlag:l.MessageSetAction.UnsetFlag,t))},t.prototype.seenMessagesFast=function(e){var t=this.messageListCheckedOrSelected(),s=[];0<t.length&&(s=i.filter(t,function(e){return e.unseen()}),d.isUnd(e)?this.setAction(t[0].folderFullNameRaw,0<s.length?l.MessageSetAction.SetSeen:l.MessageSetAction.UnsetSeen,t):this.setAction(t[0].folderFullNameRaw,e?l.MessageSetAction.SetSeen:l.MessageSetAction.UnsetSeen,t))},t.prototype.onBuild=function(e){var t=this;this.oContentVisible=o(".b-content",e),this.oContentScrollable=o(".content",this.oContentVisible),this.oContentVisible.on("click",".fullThreadHandle",function(){var e=[],t=n.dataFor(this);return t&&!t.lastInCollapsedThreadLoading()&&(b.messageListThreadFolder(t.folderFullNameRaw),e=b.messageListThreadUids(),t.lastInCollapsedThread()?e.push(0<t.parentUid()?t.parentUid():t.uid):e=i.without(e,0<t.parentUid()?t.parentUid():t.uid),b.messageListThreadUids(i.uniq(e)),t.lastInCollapsedThreadLoading(!0),t.lastInCollapsedThread(!t.lastInCollapsedThread()),s(4).reloadMessageList()),!1}),this.selector.init(this.oContentVisible,this.oContentScrollable,l.KeyState.MessageList),e.on("click",".messageList .b-message-list-wrapper",function(){t.message.focused()&&t.message.focused(!1)}).on("click",".e-pagenator .e-page",function(){var e=n.dataFor(this);e&&v.setHash(p.mailBox(b.currentFolderFullNameHash(),e.value,b.messageListSearch()))}).on("click",".messageList .checkboxCkeckAll",function(){t.checkAll(!t.checkAll())}).on("click",".messageList .messageListItem .flagParent",function(){t.flagMessages(n.dataFor(this))}),this.initUploaderForAppend(),this.initShortcuts(),!h.bMobileDevice&&g.capa(l.Capa.Prefetch)&&c&&(c.setIdleDuration(10),c.idle(function(){t.prefetchNextTick()}))},t.prototype.initShortcuts=function(){var e=this;r("ctrl+p, command+p",l.KeyState.MessageList,function(){return!1}),r("z",[l.KeyState.MessageList,l.KeyState.MessageView],function(){return e.archiveCommand(),!1}),r("delete, shift+delete, shift+3",l.KeyState.MessageList,function(t,s){return t?(0<b.messageListCheckedOrSelected().length&&(s&&"shift+delete"===s.shortcut?e.deleteWithoutMoveCommand():e.deleteCommand()),!1):void 0}),r("ctrl+r, command+r",[l.KeyState.FolderList,l.KeyState.MessageList,l.KeyState.MessageView],function(){return e.reloadCommand(),!1}),r("ctrl+a, command+a",l.KeyState.MessageList,function(){return e.checkAll(!(e.checkAll()&&!e.isIncompleteChecked())),!1}),r("w,c",[l.KeyState.MessageList,l.KeyState.MessageView],function(){return v.showScreenPopup(s(21)),!1}),r("i",[l.KeyState.MessageList,l.KeyState.MessageView],function(){return e.flagMessagesFast(),!1}),r("m",l.KeyState.MessageList,function(){return e.moveDropdownTrigger(!0),!1}),r("q",[l.KeyState.MessageList,l.KeyState.MessageView],function(){return e.seenMessagesFast(!0),!1}),r("u",[l.KeyState.MessageList,l.KeyState.MessageView],function(){return e.seenMessagesFast(!1),!1}),r("shift+f",[l.KeyState.MessageList,l.KeyState.MessageView],function(){return e.multyForwardCommand(),!1}),r("/",[l.KeyState.MessageList,l.KeyState.MessageView],function(){return e.inputMessageListSearchFocus(!0),!1}),r("esc",l.KeyState.MessageList,function(){return""!==e.messageListSearchDesc()?(e.cancelSearch(),!1):void 0}),r("tab, shift+tab, left, right",l.KeyState.MessageList,function(t,s){return t&&s&&("shift+tab"===s.shortcut||"left"===s.shortcut)?e.folderList.focused(!0):e.message()&&e.message.focused(!0),!1}),r("ctrl+left, command+left",l.KeyState.MessageView,function(){return!1}),r("ctrl+right, command+right",l.KeyState.MessageView,function(){return!1})},t.prototype.prefetchNextTick=function(){if(!this.bPrefetch&&!c.now()&&this.viewModelVisibility()){var e=this,t=i.find(this.messageList(),function(e){return e&&!y.hasRequestedMessage(e.folderFullNameRaw,e.uid)});t&&(this.bPrefetch=!0,y.addRequestedMessage(t.folderFullNameRaw,t.uid),S.message(function(t,s){var o=!(l.StorageResultType.Success!==t||!s||!s.Result);i.delay(function(){e.bPrefetch=!1,o&&e.prefetchNextTick()},1e3)},t.folderFullNameRaw,t.uid))}},t.prototype.composeClick=function(){v.showScreenPopup(s(21))},t.prototype.advancedSearchClick=function(){v.showScreenPopup(s(103))},t.prototype.quotaTooltip=function(){return d.i18n("MESSAGE_LIST/QUOTA_SIZE",{SIZE:d.friendlySize(this.userUsageSize()),PROC:this.userUsageProc(),LIMIT:d.friendlySize(this.userQuota())})},t.prototype.initUploaderForAppend=function(){if(!g.settingsGet("AllowAppendMessage")||!this.dragOverArea())return!1;var e=new a({action:p.append(),name:"AppendFile",queueSize:1,multipleSizeLimit:1,disableFolderDragAndDrop:!0,hidden:{Folder:function(){return b.currentFolderFullNameRaw()}},dragAndDropElement:this.dragOverArea(),dragAndDropBodyElement:this.dragOverBodyArea()});return e.on("onDragEnter",i.bind(function(){this.dragOverEnter(!0)},this)).on("onDragLeave",i.bind(function(){this.dragOverEnter(!1)},this)).on("onBodyDragEnter",i.bind(function(){this.dragOver(!0)},this)).on("onBodyDragLeave",i.bind(function(){this.dragOver(!1)},this)).on("onSelect",i.bind(function(e,t){return e&&t&&"message/rfc822"===t.Type?(b.messageListLoading(!0),!0):!1},this)).on("onComplete",i.bind(function(){s(4).reloadMessageList(!0,!0)},this)),!!e},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){g.call(this,"Right","MailMessageView");var e=this,t="",i=function(t){return u.createCommand(e,function(){this.replyOrforward(t)},e.canBeRepliedOrForwarded)};this.oMessageScrollerDom=null,this.message=p.message,this.currentMessage=p.currentMessage,this.messageListChecked=p.messageListChecked,this.hasCheckedMessages=p.hasCheckedMessages,this.messageListCheckedOrSelectedUidsWithSubMails=p.messageListCheckedOrSelectedUidsWithSubMails,this.messageLoading=p.messageLoading,this.messageLoadingThrottle=p.messageLoadingThrottle,this.messagesBodiesDom=p.messagesBodiesDom,this.useThreads=p.useThreads,this.replySameFolder=p.replySameFolder,this.layout=p.layout,this.usePreviewPane=p.usePreviewPane,this.isMessageSelected=p.isMessageSelected,this.messageActiveDom=p.messageActiveDom,this.messageError=p.messageError,this.fullScreenMode=p.messageFullScreenMode,this.showFullInfo=n.observable(!1),this.moreDropdownTrigger=n.observable(!1),this.messageDomFocused=n.observable(!1).extend({rateLimit:0}),this.messageVisibility=n.computed(function(){return!this.messageLoadingThrottle()&&!!this.message()},this),this.message.subscribe(function(e){e||this.currentMessage(null)},this),this.canBeRepliedOrForwarded=this.messageVisibility,this.closeMessage=u.createCommand(this,function(){p.message(null)}),this.replyCommand=i(c.ComposeType.Reply),this.replyAllCommand=i(c.ComposeType.ReplyAll),this.forwardCommand=i(c.ComposeType.Forward),this.forwardAsAttachmentCommand=i(c.ComposeType.ForwardAsAttachment),this.editAsNewCommand=i(c.ComposeType.EditAsNew),this.messageVisibilityCommand=u.createCommand(this,u.emptyFunction,this.messageVisibility),this.messageEditCommand=u.createCommand(this,function(){this.editMessage()},this.messageVisibility),this.deleteCommand=u.createCommand(this,function(){this.message()&&s(4).deleteMessagesFromFolder(c.FolderType.Trash,this.message().folderFullNameRaw,[this.message().uid],!0)},this.messageVisibility),this.deleteWithoutMoveCommand=u.createCommand(this,function(){this.message()&&s(4).deleteMessagesFromFolder(c.FolderType.Trash,p.currentFolderFullNameRaw(),[this.message().uid],!1)},this.messageVisibility),this.archiveCommand=u.createCommand(this,function(){this.message()&&s(4).deleteMessagesFromFolder(c.FolderType.Archive,this.message().folderFullNameRaw,[this.message().uid],!0)},this.messageVisibility),this.spamCommand=u.createCommand(this,function(){this.message()&&s(4).deleteMessagesFromFolder(c.FolderType.Spam,this.message().folderFullNameRaw,[this.message().uid],!0)},this.messageVisibility),this.notSpamCommand=u.createCommand(this,function(){this.message()&&s(4).deleteMessagesFromFolder(c.FolderType.NotSpam,this.message().folderFullNameRaw,[this.message().uid],!0)},this.messageVisibility),this.viewHash="",this.viewSubject=n.observable(""),this.viewFromShort=n.observable(""),this.viewToShort=n.observable(""),this.viewFrom=n.observable(""),this.viewTo=n.observable(""),this.viewCc=n.observable(""),this.viewBcc=n.observable(""),this.viewDate=n.observable(""),this.viewSize=n.observable(""),this.viewMoment=n.observable(""),this.viewLineAsCcc=n.observable(""),this.viewViewLink=n.observable(""),this.viewDownloadLink=n.observable(""),this.viewUserPic=n.observable(a.DataImages.UserDotPic),this.viewUserPicVisible=n.observable(!1),this.viewPgpPassword=n.observable(""),this.viewPgpSignedVerifyStatus=n.computed(function(){return this.message()?this.message().pgpSignedVerifyStatus():c.SignedVerifyStatus.None},this),this.viewPgpSignedVerifyUser=n.computed(function(){return this.message()?this.message().pgpSignedVerifyUser():""},this),this.message.subscribe(function(s){this.messageActiveDom(null),this.viewPgpPassword(""),s?(this.viewHash!==s.hash&&this.scrollMessageToTop(),this.viewHash=s.hash,this.viewSubject(s.subject()),this.viewFromShort(s.fromToLine(!0,!0)),this.viewToShort(s.toToLine(!0,!0)),this.viewFrom(s.fromToLine(!1)),this.viewTo(s.toToLine(!1)),this.viewCc(s.ccToLine(!1)),this.viewBcc(s.bccToLine(!1)),this.viewDate(s.fullFormatDateValue()),this.viewSize(s.friendlySize()),this.viewMoment(s.momentDate()),this.viewLineAsCcc(s.lineAsCcc()),this.viewViewLink(s.viewLink()),this.viewDownloadLink(s.downloadLink()),t=s.fromAsSingleEmail(),d.getUserPic(t,function(s,i){s!==e.viewUserPic()&&t===i&&(e.viewUserPicVisible(!1),e.viewUserPic(a.DataImages.UserDotPic),""!==s&&(e.viewUserPicVisible(!0),e.viewUserPic(s)))})):(this.viewHash="",this.scrollMessageToTop())},this),this.fullScreenMode.subscribe(function(e){e?l.$html.addClass("rl-message-fullscreen"):l.$html.removeClass("rl-message-fullscreen"),u.windowResize()}),this.messageLoadingThrottle.subscribe(function(e){e&&u.windowResize()}),this.goUpCommand=u.createCommand(this,function(){h.pub("mailbox.message-list.selector.go-up")}),this.goDownCommand=u.createCommand(this,function(){h.pub("mailbox.message-list.selector.go-down")}),f.constructorEnd(this)}var i=s(2),o=s(14),n=s(3),r=s(19),a=s(17),c=s(6),l=s(7),u=s(1),h=s(22),d=s(20),p=s(8),m=s(13),f=s(5),g=s(9);f.extendAsViewModel(["View:RainLoop:MailBoxMessageView","MailBoxMessageViewViewModel"],t),i.extend(t.prototype,g.prototype),t.prototype.isPgpActionVisible=function(){return c.SignedVerifyStatus.Success!==this.viewPgpSignedVerifyStatus()},t.prototype.isPgpStatusVerifyVisible=function(){return c.SignedVerifyStatus.None!==this.viewPgpSignedVerifyStatus()},t.prototype.isPgpStatusVerifySuccess=function(){return c.SignedVerifyStatus.Success===this.viewPgpSignedVerifyStatus()},t.prototype.pgpStatusVerifyMessage=function(){var e="";switch(this.viewPgpSignedVerifyStatus()){case c.SignedVerifyStatus.UnknownPublicKeys:e=u.i18n("PGP_NOTIFICATIONS/NO_PUBLIC_KEYS_FOUND");break;case c.SignedVerifyStatus.UnknownPrivateKey:e=u.i18n("PGP_NOTIFICATIONS/NO_PRIVATE_KEY_FOUND");break;case c.SignedVerifyStatus.Unverified:e=u.i18n("PGP_NOTIFICATIONS/UNVERIFIRED_SIGNATURE");break;case c.SignedVerifyStatus.Error:e=u.i18n("PGP_NOTIFICATIONS/DECRYPTION_ERROR");break;case c.SignedVerifyStatus.Success:e=u.i18n("PGP_NOTIFICATIONS/GOOD_SIGNATURE",{USER:this.viewPgpSignedVerifyUser()})}return e},t.prototype.fullScreen=function(){this.fullScreenMode(!0),u.windowResize()},t.prototype.unFullScreen=function(){this.fullScreenMode(!1),u.windowResize()},t.prototype.toggleFullScreen=function(){u.removeSelection(),this.fullScreenMode(!this.fullScreenMode()),u.windowResize()},t.prototype.replyOrforward=function(e){f.showScreenPopup(s(21),[e,p.message()])},t.prototype.onBuild=function(e){var t=this;this.fullScreenMode.subscribe(function(e){e&&t.message.focused(!0)},this),o(".attachmentsPlace",e).magnificPopup({delegate:".magnificPopupImage:visible",type:"image",gallery:{enabled:!0,preload:[1,1],navigateByImgClick:!0},callbacks:{open:function(){l.useKeyboardShortcuts(!1)},close:function(){l.useKeyboardShortcuts(!0)}},mainClass:"mfp-fade",removalDelay:400}),e.on("click","a",function(e){return!(e&&3!==e.which&&u.mailToHelper(o(this).attr("href"),s(21)))}).on("click",".attachmentsPlace .attachmentPreview",function(e){e&&e.stopPropagation&&e.stopPropagation()}).on("click",".attachmentsPlace .attachmentItem",function(){var e=n.dataFor(this);e&&e.download&&s(4).download(e.linkDownload())}),this.message.focused.subscribe(function(e){e&&!u.inFocus()?this.messageDomFocused(!0):(this.messageDomFocused(!1),this.scrollMessageToTop(),this.scrollMessageToLeft())},this),this.messageDomFocused.subscribe(function(e){e||c.KeyState.MessageView!==l.keyScope()||this.message.focused(!1)},this),l.keyScope.subscribe(function(e){c.KeyState.MessageView===e&&this.message.focused()&&this.messageDomFocused(!0)},this),this.oMessageScrollerDom=e.find(".messageItem .content"),this.oMessageScrollerDom=this.oMessageScrollerDom&&this.oMessageScrollerDom[0]?this.oMessageScrollerDom:null,this.initShortcuts()},t.prototype.escShortcuts=function(){return this.viewModelVisibility()&&this.message()?(this.fullScreenMode()?this.fullScreenMode(!1):c.Layout.NoPreview===p.layout()?this.message(null):this.message.focused(!1),!1):void 0},t.prototype.initShortcuts=function(){var e=this;r("esc",c.KeyState.MessageView,i.bind(this.escShortcuts,this)),r("enter",c.KeyState.MessageView,function(){return e.toggleFullScreen(),!1}),r("enter",c.KeyState.MessageList,function(){return c.Layout.NoPreview!==p.layout()&&e.message()?(e.toggleFullScreen(),!1):void 0}),r("r",[c.KeyState.MessageList,c.KeyState.MessageView],function(){return p.message()?(e.replyCommand(),!1):void 0}),r("a",[c.KeyState.MessageList,c.KeyState.MessageView],function(){return p.message()?(e.replyAllCommand(),!1):void 0}),r("f",[c.KeyState.MessageList,c.KeyState.MessageView],function(){return p.message()?(e.forwardCommand(),!1):void 0}),r("b",[c.KeyState.MessageList,c.KeyState.MessageView],function(){return p.message()&&p.message().body?(p.message().body.find(".rlBlockquoteSwitcher").click(),!1):void 0}),r("ctrl+left, command+left, ctrl+up, command+up",c.KeyState.MessageView,function(){return e.goUpCommand(),!1}),r("ctrl+right, command+right, ctrl+down, command+down",c.KeyState.MessageView,function(){return e.goDownCommand(),!1}),r("ctrl+p, command+p",c.KeyState.MessageView,function(){return e.message()&&e.message().printMessage(),!1}),r("delete, shift+delete",c.KeyState.MessageView,function(t,s){return t?(s&&"shift+delete"===s.shortcut?e.deleteWithoutMoveCommand():e.deleteCommand(),!1):void 0}),r("tab, shift+tab, left",c.KeyState.MessageView,function(t,s){if(!e.fullScreenMode()&&e.message()&&c.Layout.NoPreview!==p.layout())if(t&&s&&"left"===s.shortcut){if(e.oMessageScrollerDom&&0<e.oMessageScrollerDom.scrollLeft())return!0;e.message.focused(!1)}else e.message.focused(!1);else if(e.message()&&c.Layout.NoPreview===p.layout()&&t&&s&&"left"===s.shortcut)return!0;return!1})},t.prototype.isDraftFolder=function(){return p.message()&&p.draftFolder()===p.message().folderFullNameRaw},t.prototype.isSentFolder=function(){return p.message()&&p.sentFolder()===p.message().folderFullNameRaw},t.prototype.isSpamFolder=function(){return p.message()&&p.spamFolder()===p.message().folderFullNameRaw},t.prototype.isSpamDisabled=function(){return p.message()&&p.spamFolder()===a.Values.UnuseOptionValue},t.prototype.isArchiveFolder=function(){return p.message()&&p.archiveFolder()===p.message().folderFullNameRaw},t.prototype.isArchiveDisabled=function(){return p.message()&&p.archiveFolder()===a.Values.UnuseOptionValue},t.prototype.isDraftOrSentFolder=function(){return this.isDraftFolder()||this.isSentFolder()},t.prototype.composeClick=function(){f.showScreenPopup(s(21))},t.prototype.editMessage=function(){p.message()&&f.showScreenPopup(s(21),[c.ComposeType.Draft,p.message()])},t.prototype.scrollMessageToTop=function(){this.oMessageScrollerDom&&(this.oMessageScrollerDom.scrollTop(0),u.windowResize())},t.prototype.scrollMessageToLeft=function(){this.oMessageScrollerDom&&(this.oMessageScrollerDom.scrollLeft(0),u.windowResize())},t.prototype.showImages=function(e){e&&e.showExternalImages&&e.showExternalImages(!0)},t.prototype.printableCheckedMessageCount=function(){var e=this.messageListCheckedOrSelectedUidsWithSubMails().length;return e>0?100>e?e:"99+":""},t.prototype.verifyPgpSignedClearMessage=function(e){e&&e.verifyPgpSignedClearMessage()},t.prototype.decryptPgpEncryptedMessage=function(e){e&&e.decryptPgpEncryptedMessage(this.viewPgpPassword())},t.prototype.readReceipt=function(e){e&&""!==e.readReceipt()&&(m.sendReadReceiptMessage(u.emptyFunction,e.folderFullNameRaw,e.uid,e.readReceipt(),u.i18n("READ_RECEIPT/SUBJECT",{SUBJECT:e.subject()}),u.i18n("READ_RECEIPT/BODY",{"READ-RECEIPT":p.accountEmail()})),e.isReadReceipt(!0),d.storeMessageFlagsToCache(e),s(4).reloadFlagsCurrentMessageListAndMessageFromCache())},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){n.call(this),o.constructorEnd(this)}var i=s(2),o=s(5),n=s(41);o.extendAsViewModel(["View:RainLoop:MailBoxSystemDropDown","MailBoxSystemDropDownViewModel"],t),i.extend(t.prototype,n.prototype),e.exports=t}()},,function(e,t,s){!function(){"use strict";function t(){c.call(this,"Popups","PopupsAddOpenPgpKey"),this.key=o.observable(""),this.key.error=o.observable(!1),this.key.focus=o.observable(!1),this.key.subscribe(function(){this.key.error(!1)},this),this.addOpenPgpKeyCommand=n.createCommand(this,function(){var e=30,t=null,i=n.trim(this.key()),o=/[\-]{3,6}BEGIN[\s]PGP[\s](PRIVATE|PUBLIC)[\s]KEY[\s]BLOCK[\-]{3,6}[\s\S]+?[\-]{3,6}END[\s]PGP[\s](PRIVATE|PUBLIC)[\s]KEY[\s]BLOCK[\-]{3,6}/gi,a=r.openpgpKeyring;if(i=i.replace(/[\r\n]([a-zA-Z0-9]{2,}:[^\r\n]+)[\r\n]+([a-zA-Z0-9\/\\+=]{10,})/g,"\n$1!-!N!-!$2").replace(/[\n\r]+/g,"\n").replace(/!-!N!-!/g,"\n\n"),this.key.error(""===i),!a||this.key.error())return!1;for(;;){if(t=o.exec(i),!t||0>e)break;t[0]&&t[1]&&t[2]&&t[1]===t[2]&&("PRIVATE"===t[1]?a.privateKeys.importKey(t[0]):"PUBLIC"===t[1]&&a.publicKeys.importKey(t[0])),e--}return a.store(),s(4).reloadOpenPgpKeys(),n.delegateRun(this,"cancelCommand"),!0}),a.constructorEnd(this)}var i=s(2),o=s(3),n=s(1),r=s(8),a=s(5),c=s(9);a.extendAsViewModel(["View:Popup:AddOpenPgpKey","PopupsAddOpenPgpKeyViewModel"],t),i.extend(t.prototype,c.prototype),t.prototype.clearPopup=function(){this.key(""),this.key.error(!1)},t.prototype.onShow=function(){this.clearPopup()},t.prototype.onFocus=function(){this.key.focus(!0)},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){l.call(this,"Popups","PopupsAdvancedSearch"),this.fromFocus=o.observable(!1),this.from=o.observable(""),this.to=o.observable(""),this.subject=o.observable(""),this.text=o.observable(""),this.selectedDateValue=o.observable(-1),this.hasAttachment=o.observable(!1),this.starred=o.observable(!1),this.unseen=o.observable(!1),this.searchCommand=r.createCommand(this,function(){var e=this.buildSearchString();""!==e&&a.mainMessageListSearch(e),this.cancelCommand()}),c.constructorEnd(this)}var i=s(2),o=s(3),n=s(25),r=s(1),a=s(8),c=s(5),l=s(9);c.extendAsViewModel(["View:Popup:AdvancedSearch","PopupsAdvancedSearchViewModel"],t),i.extend(t.prototype,l.prototype),t.prototype.buildSearchStringValue=function(e){return-1<e.indexOf(" ")&&(e='"'+e+'"'),e},t.prototype.buildSearchString=function(){var e=[],t=r.trim(this.from()),s=r.trim(this.to()),i=r.trim(this.subject()),o=r.trim(this.text()),a=[],c=[];return t&&""!==t&&e.push("from:"+this.buildSearchStringValue(t)),s&&""!==s&&e.push("to:"+this.buildSearchStringValue(s)),i&&""!==i&&e.push("subject:"+this.buildSearchStringValue(i)),this.hasAttachment()&&c.push("attachment"),this.unseen()&&a.push("unseen"),this.starred()&&a.push("flagged"),0<c.length&&e.push("has:"+c.join(",")),0<a.length&&e.push("is:"+a.join(",")),-1<this.selectedDateValue()&&e.push("date:"+n().subtract("days",this.selectedDateValue()).format("YYYY.MM.DD")+"/"),o&&""!==o&&e.push("text:"+this.buildSearchStringValue(o)),r.trim(e.join(" "))},t.prototype.clearPopup=function(){this.from(""),this.to(""),this.subject(""),this.text(""),this.selectedDateValue(-1),this.hasAttachment(!1),this.starred(!1),this.unseen(!1),this.fromFocus(!0)},t.prototype.onShow=function(){this.clearPopup()},t.prototype.onFocus=function(){this.fromFocus(!0)},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){d.call(this,"Popups","PopupsComposeOpenPgp"),this.notification=n.observable(""),this.sign=n.observable(!0),this.encrypt=n.observable(!0),this.password=n.observable(""),this.password.focus=n.observable(!1),this.buttonFocus=n.observable(!1),this.from=n.observable(""),this.to=n.observableArray([]),this.text=n.observable(""),this.resultCallback=null,this.submitRequest=n.observable(!1),this.doCommand=a.createCommand(this,function(){var e=this,t=!0,s=null,n=[];this.submitRequest(!0),t&&this.sign()&&""===this.from()&&(this.notification(a.i18n("PGP_NOTIFICATIONS/SPECIFY_FROM_EMAIL")),t=!1),t&&this.sign()&&(s=l.findPrivateKeyByEmail(this.from(),this.password()),s||(this.notification(a.i18n("PGP_NOTIFICATIONS/NO_PRIVATE_KEY_FOUND_FOR",{EMAIL:this.from()})),t=!1)),t&&this.encrypt()&&0===this.to().length&&(this.notification(a.i18n("PGP_NOTIFICATIONS/SPECIFY_AT_LEAST_ONE_RECIPIENT")),t=!1),t&&this.encrypt()&&(n=[],o.each(this.to(),function(s){var i=l.findPublicKeysByEmail(s);0===i.length&&t&&(e.notification(a.i18n("PGP_NOTIFICATIONS/NO_PUBLIC_KEYS_FOUND_FOR",{EMAIL:s})),t=!1),n=n.concat(i)}),!t||0!==n.length&&this.to().length===n.length||(t=!1)),o.delay(function(){if(e.resultCallback&&t)try{s&&0===n.length?e.resultCallback(i.openpgp.signClearMessage([s],e.text())):s&&0<n.length?e.resultCallback(i.openpgp.signAndEncryptMessage(n,s,e.text())):!s&&0<n.length&&e.resultCallback(i.openpgp.encryptMessage(n,e.text()))}catch(o){e.notification(a.i18n("PGP_NOTIFICATIONS/PGP_ERROR",{ERROR:""+o})),t=!1}t&&e.cancelCommand(),e.submitRequest(!1)},10)},function(){return!this.submitRequest()&&(this.sign()||this.encrypt())}),this.sDefaultKeyScope=c.KeyState.PopupComposeOpenPGP,h.constructorEnd(this)}var i=s(12),o=s(2),n=s(3),r=s(19),a=s(1),c=s(6),l=s(8),u=s(23),h=s(5),d=s(9);h.extendAsViewModel(["View:Popup:ComposeOpenPgp","PopupsComposeOpenPgpViewModel"],t),o.extend(t.prototype,d.prototype),t.prototype.clearPopup=function(){this.notification(""),this.password(""),this.password.focus(!1),this.buttonFocus(!1),this.from(""),this.to([]),this.text(""),this.submitRequest(!1),this.resultCallback=null},t.prototype.onBuild=function(){r("tab,shift+tab",c.KeyState.PopupComposeOpenPGP,o.bind(function(){switch(!0){case this.password.focus():this.buttonFocus(!0);break;case this.buttonFocus():this.password.focus(!0)}return!1},this))},t.prototype.onHide=function(){this.clearPopup()},t.prototype.onFocus=function(){this.sign()?this.password.focus(!0):this.buttonFocus(!0)},t.prototype.onShow=function(e,t,s,i,n,r){this.clearPopup();var c=new u,l="",h=[];this.resultCallback=e,c.clear(),c.mailsoParse(s),""!==c.email&&(l=c.email),""!==i&&h.push(i),""!==n&&h.push(n),""!==r&&h.push(r),h=h.join(", ").split(","),h=o.compact(o.map(h,function(e){return c.clear(),c.mailsoParse(a.trim(e)),""===c.email?!1:c.email})),this.from(l),this.to(h),this.text(t)},e.exports=t}()},,function(e,t,s){!function(){"use strict";function t(){l.call(this,"Popups","PopupsFilter"),this.filter=o.observable(null),this.selectedFolderValue=o.observable(n.Values.UnuseOptionValue),this.folderSelectList=a.folderMenuForMove,this.defautOptionsAfterRender=r.defautOptionsAfterRender,c.constructorEnd(this)}var i=s(2),o=s(3),n=s(17),r=s(1),a=s(8),c=s(5),l=s(9);c.extendAsViewModel(["View:Popup:Filter","PopupsFilterViewModel"],t),i.extend(t.prototype,l.prototype),t.prototype.clearPopup=function(){},t.prototype.onShow=function(e){this.clearPopup(),this.filter(e)},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){h.call(this,"Popups","PopupsFolderClear"),this.selectedFolder=o.observable(null),this.clearingProcess=o.observable(!1),this.clearingError=o.observable(""),this.folderFullNameForClear=o.computed(function(){var e=this.selectedFolder();return e?e.printableFullName():""},this),this.folderNameForClear=o.computed(function(){var e=this.selectedFolder();return e?e.localName():""},this),this.dangerDescHtml=o.computed(function(){return r.i18n("POPUPS_CLEAR_FOLDER/DANGER_DESC_HTML_1",{FOLDER:this.folderNameForClear()})},this),this.clearCommand=r.createCommand(this,function(){var e=this,t=this.selectedFolder();t&&(a.message(null),a.messageList([]),this.clearingProcess(!0),t.messageCountAll(0),t.messageCountUnread(0),c.setFolderHash(t.fullNameRaw,""),l.folderClear(function(t,i){e.clearingProcess(!1),n.StorageResultType.Success===t&&i&&i.Result?(s(4).reloadMessageList(!0),e.cancelCommand()):e.clearingError(i&&i.ErrorCode?r.getNotification(i.ErrorCode):r.getNotification(n.Notification.MailServerError))
},t.fullNameRaw))},function(){var e=this.selectedFolder(),t=this.clearingProcess();return!t&&null!==e}),u.constructorEnd(this)}var i=s(2),o=s(3),n=s(6),r=s(1),a=s(8),c=s(20),l=s(13),u=s(5),h=s(9);u.extendAsViewModel(["View:Popup:FolderClear","PopupsFolderClearViewModel"],t),i.extend(t.prototype,h.prototype),t.prototype.clearPopup=function(){this.clearingProcess(!1),this.selectedFolder(null)},t.prototype.onShow=function(e){this.clearPopup(),e&&this.selectedFolder(e)},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){l.call(this,"Popups","PopupsNewOpenPgpKey"),this.email=n.observable(""),this.email.focus=n.observable(""),this.email.error=n.observable(!1),this.name=n.observable(""),this.password=n.observable(""),this.keyBitLength=n.observable(2048),this.submitRequest=n.observable(!1),this.email.subscribe(function(){this.email.error(!1)},this),this.generateOpenPgpKeyCommand=r.createCommand(this,function(){var e=this,t="",n=null,c=a.openpgpKeyring;return this.email.error(""===r.trim(this.email())),!c||this.email.error()?!1:(t=this.email(),""!==this.name()&&(t=this.name()+" <"+t+">"),this.submitRequest(!0),o.delay(function(){n=i.openpgp.generateKeyPair({userId:t,numBits:r.pInt(e.keyBitLength()),passphrase:r.trim(e.password())}),n&&n.privateKeyArmored&&(c.privateKeys.importKey(n.privateKeyArmored),c.publicKeys.importKey(n.publicKeyArmored),c.store(),s(4).reloadOpenPgpKeys(),r.delegateRun(e,"cancelCommand")),e.submitRequest(!1)},100),!0)}),c.constructorEnd(this)}var i=s(12),o=s(2),n=s(3),r=s(1),a=s(8),c=s(5),l=s(9);c.extendAsViewModel(["View:Popup:NewOpenPgpKey","PopupsNewOpenPgpKeyViewModel"],t),o.extend(t.prototype,l.prototype),t.prototype.clearPopup=function(){this.name(""),this.password(""),this.email(""),this.email.error(!1),this.keyBitLength(2048)},t.prototype.onShow=function(){this.clearPopup()},t.prototype.onFocus=function(){this.email.focus(!0)},e.exports=t}()},,function(e,t,s){!function(){"use strict";function t(){l.call(this,"Popups","PopupsTwoFactorTest");var e=this;this.code=o.observable(""),this.code.focused=o.observable(!1),this.code.status=o.observable(null),this.testing=o.observable(!1),this.testCode=r.createCommand(this,function(){this.testing(!0),a.testTwoFactor(function(t,s){e.testing(!1),e.code.status(n.StorageResultType.Success===t&&s&&s.Result?!0:!1)},this.code())},function(){return""!==this.code()&&!this.testing()}),c.constructorEnd(this)}var i=s(2),o=s(3),n=s(6),r=s(1),a=s(13),c=s(5),l=s(9);c.extendAsViewModel(["View:Popup:TwoFactorTest","PopupsTwoFactorTestViewModel"],t),i.extend(t.prototype,l.prototype),t.prototype.clearPopup=function(){this.code(""),this.code.focused(!1),this.code.status(null),this.testing(!1)},t.prototype.onShow=function(){this.clearPopup()},t.prototype.onFocus=function(){this.code.focused(!0)},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){a.call(this,"Popups","PopupsViewOpenPgpKey"),this.key=o.observable(""),this.keyDom=o.observable(null),r.constructorEnd(this)}var i=s(2),o=s(3),n=s(1),r=s(5),a=s(9);r.extendAsViewModel(["View:Popup:ViewOpenPgpKey","PopupsViewOpenPgpKeyViewModel"],t),i.extend(t.prototype,a.prototype),t.prototype.clearPopup=function(){this.key("")},t.prototype.selectKey=function(){var e=this.keyDom();e&&n.selectElement(e)},t.prototype.onShow=function(e){this.clearPopup(),e&&this.key(e.armor)},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(e){a.call(this,"Left","SettingsMenu"),this.leftPanelDisabled=o.leftPanelDisabled,this.menu=e.menu,r.constructorEnd(this)}var i=s(2),o=s(7),n=s(11),r=s(5),a=s(9);r.extendAsViewModel(["View:RainLoop:SettingsMenu","SettingsMenuViewModel"],t),i.extend(t.prototype,a.prototype),t.prototype.link=function(e){return n.settings(e)},t.prototype.backToMailBoxClick=function(){r.setHash(n.inbox())},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){l.call(this,"Right","SettingsPane"),c.constructorEnd(this)}var i=s(2),o=s(19),n=s(6),r=s(11),a=s(8),c=s(5),l=s(9);c.extendAsViewModel(["View:RainLoop:SettingsPane","SettingsPaneViewModel"],t),i.extend(t.prototype,l.prototype),t.prototype.onBuild=function(){var e=this;o("esc",n.KeyState.Settings,function(){e.backToMailBoxClick()})},t.prototype.onShow=function(){a.message(null)},t.prototype.backToMailBoxClick=function(){c.setHash(r.inbox())},e.exports=t}()},function(e,t,s){!function(){"use strict";function t(){n.call(this),o.constructorEnd(this)}var i=s(2),o=s(5),n=s(41);o.extendAsViewModel(["View:RainLoop:SettingsSystemDropDown","SettingsSystemDropDownViewModel"],t),i.extend(t.prototype,n.prototype),e.exports=t}()},,function(e){e.exports=ifvisible}]));